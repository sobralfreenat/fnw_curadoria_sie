<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GERIiAH - INDIVIDUAL 7.3.0</title>
    
    <!-- Favicon e PWA Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="shortcut icon" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    
    <!-- Apple Touch Icons para iOS -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="57x57" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    
    <!-- Android Chrome Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="icon" type="image/png" sizes="512x512" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    
    <!-- Meta tags PWA -->
    <meta name="theme-color" content="#503060">
    <meta name="msapplication-TileColor" content="#503060">
    <meta name="msapplication-TileImage" content="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkdFUmlBSCAtIENhdMOhbG9nbyBkZSBSZWN1cnNvcyIsCiAgInNob3J0X25hbWUiOiAiR0VSaUFIIiwKICAiZGVzY3JpcHRpb24iOiAiUGxhdGFmb3JtYSBkZSBhcHJlbmRpemFnZW0gcGFyYSBtYWR1cm9zIGUgaWRvc29zIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiM1MDMwNjAiLAogICJ0aGVtZV9jb2xvciI6ICIjNTAzMDYwIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9kMXllaTJ6M2k2azM1ei5jbG91ZGZyb250Lm5ldC8xMjk3NDUyOS82ODRkOWFiMzYwYmNfR0VSaUFITE9HTzhTUVVBUkUyZG9ud2xvYWQucG5nIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9LAogICAgewogICAgICAic3JjIjogImh0dHBzOi8vZDF5ZWkyejNpNmszNXouY2xvdWRmcm9udC5uZXQvMTI5NzQ1MjkvNjg0ZDlhYjM2MGJjX0dFUmlBSExPR084U1FVQVJFMGRVD3dsb2FkLnBuZyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIgogICAgfQogIF0KfQ==">
    
    <style>
        /* Reset de overflow para layout fixo */
        html, body { height: 100%; margin: 0; padding: 0; }
        body { 
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-image: linear-gradient(to bottom, #503060, #3B204A);
            background-color: #3B204A; /* Fallback */
            color: #e5e5e5; /* Cor de texto padrão clara */
            padding-top: 70px !important; /* Espaço para o header fixo */
        }
        /* Header fixo GERiAH */
        header { 
            position: fixed !important; 
            top: 0 !important; 
            left: 0 !important; 
            right: 0 !important; 
            height: 70px; 
            background-color: rgba(71, 71, 71, 0.452);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #fff; 
            display: flex; 
            align-items: center; 
            padding: 0 30px; /* Aumentado de 20px para 30px para mais espaçamento */
            z-index: 9999 !important; /* Z-index alto */
            border-bottom: 1px solid rgba(255,255,255,0.1); /* Linha sutil de separação */
            gap: 15px; /* Adiciona espaçamento entre elementos do header */
        }
        header h3 { /* Ajuste no título do header */
            margin: 0; 
            font-size: 1.2em; 
            font-weight: normal;
        }
        /* Estilos para o toggle de modo de edição */
        .edit-mode-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
            margin-right: 15px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.3);
            transition: 0.3s;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #ff6b35;
            border-color: #ff6b35;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        #toggleLabel {
            font-size: 0.9em;
            font-weight: normal;
            white-space: nowrap;
        }
        
        /* Modo de edição ativo */
        body.edit-mode {
            background-image: linear-gradient(to bottom, #6b4423, #4a2f16);
        }
        
        body.edit-mode header {
            background-color: rgba(107, 68, 35, 0.8);
        }
        
        body.edit-mode #headerTitle {
            color: #ffcc80;
        }
        
        /* Ajuste de font-size para o headerTitle - aumentado 50% */
        #headerTitle {
            font-size: 1.05em; /* 50% maior que o padrão original */
            margin: 0 15px; /* Mais espaçamento lateral */
        }
        
        body.edit-mode aside {
            background: rgba(74, 47, 22, 0.8);
            border-right: 1px solid rgba(107, 68, 35, 0.7);
        }
        
        body.edit-mode main {
            background-color: #2d1810;
        }
        
        /* Botões editáveis no modo de edição */
        body.edit-mode .editable-item {
            border: 2px dashed #ff6b35 !important;
            position: relative;
        }
        
        body.edit-mode .editable-item::after {
            content: "✏️";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
            background: #ff6b35;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* Estilos para o botão de toggle do menu (hamburger) */
        .menu-toggle {
            display: block !important; /* Força a exibição do botão hamburger */
            background: transparent;
            border: none;
            font-size: 2em;
            color: #ffffff !important; /* Cor branca para contraste */
            cursor: pointer;
            padding: 5px 10px;
            z-index: 10000 !important; /* Garante que fique acima de outros elementos do header */
            margin-right: 15px;
            line-height: 1;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5); /* Sombra para melhor legibilidade */
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }
        
        .menu-toggle:hover {
            color: #e0e0e0 !important; /* Cor ligeiramente mais escura no hover */
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
        }
        
        /* Cor específica para modo de edição */
        body.edit-mode .menu-toggle {
            color: #ffffff !important; /* Mantém branco no modo de edição */
            text-shadow: 0 1px 3px rgba(255, 107, 53, 0.5); /* Sombra laranja no modo de edição */
        }
        
        body.edit-mode .menu-toggle:hover {
            color: #fff3e0 !important; /* Tom mais quente no hover do modo de edição */
            text-shadow: 0 2px 4px rgba(255, 107, 53, 0.8);
        }
        
        /* Sidebar abaixo do header */
        aside {
            position: fixed;
            top: 70px;
            left: 0;
            width: 250px;
            height: calc(100vh - 70px);
            background: rgba(80, 48, 96, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #e5e5e5;
            z-index: 990;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }
        /* Adicionado para espaçar a primeira categoria do topo da sidebar */
        aside .accordion-item:first-of-type {
            margin-top: 20px; /* Espaço do topo da sidebar */
        }
        /* Novo estilo para o separador cego */
        .category-separator {
            height: 15px; /* Altura do espaçador */
            background-color: rgba(26, 15, 33, 0.3); /* AJUSTADO: Púrpura mais escuro com 30% de transparência */
            margin: 15px 0; /* Margem vertical para espaçar */
            border-radius: 3px;
        }
        aside h2 { 
            margin-top: 0; /* Garante que o h2 respeite o margin-bottom do botão acima */
            font-size: 1.1em; 
            color: #fff; 
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(80, 48, 96, 0.7);
        }
        #categoriesList {
            list-style: none; 
            /* padding: 0; Removido daqui, será tratado pelo .accordion-content */
        }
        #categoriesList li { margin-bottom: 8px; }
        /* #categoriesList button { // Comentado para usar o seletor mais genérico abaixo
            width: 100%; 
            padding: 10px 15px; 
            text-align: left; 
            border: none; 
            background: transparent; 
            color: #d3d3d3; 
            cursor: pointer; 
            border-radius: 4px; 
            font-size: 0.95em;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        #categoriesList button.active, #categoriesList button:hover { 
            background: rgba(80, 48, 96, 0.9); 
            color: #fff; 
        } */

        /* Novo seletor genérico para botões dentro dos acordeões da sidebar */
        aside .accordion-content ul li button {
            width: 100%; 
            padding: 10px 15px; 
            text-align: left; 
            border: none; 
            background: transparent; 
            color: #d3d3d3; /* Lightgray para itens não ativos */
            cursor: pointer; 
            border-radius: 4px; 
            font-size: 1.0125em;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        aside .accordion-content ul li button:hover,
        aside .accordion-content ul li button.active { /* .active ainda é útil para categorias */
            background: rgba(80, 48, 96, 0.9); /* Roxo mais forte para ativo/hover */
            color: #fff; 
        }

        #myCoursesBtn { 
            /* Estilos de posicionamento fixo na aside removidos */
            /* z-index: 10; */
            /* background-color: #2A1A3A; */ 

            /* width:100%; */ /* Não mais 100% da aside */
            padding: 8px 15px; /* Padding ajustado para o header */
            color:#fff; 
            border: 1px solid #fff; 
            border-radius:4px; 
            background: transparent; /* Fundo transparente no header */
            cursor:pointer; 
            margin-left: auto; /* Empurra o botão para a direita do header */
            margin-right: 10px; /* Pequena margem da borda direita do header */
            /* margin-bottom removido pois não é mais relevante para o fluxo da aside */
            font-size: 0.9em; /* Levemente reduzido para o header */
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        #myCoursesBtn:hover { 
            background: rgba(255,255,255,0.1); /* Hover sutil no header */
            color: #fff;
        }
        /* Conteúdo ao lado da sidebar, abaixo do header */
        main { 
            margin-left: 250px; /* Largura da sidebar */
            padding: 70px 30px 20px 30px; /* AJUSTADO padding-top para 70px (era 8px) */
            background-color: #100818; /* MAIS ESCURO: Fundo sólido para o main, próximo ao preto */
            transition: margin-left 0.3s ease-in-out; /* Transição para o push/pull */
        }
        main h1 { /* Este é o #mainTitle - agora usado apenas se necessário ou pode ser removido do JS */
            margin-top: 0; 
            color: #fff; 
        }
        /* Estilo para o título da categoria quando exibido acima do carrossel */
        .category-title-header {
            font-size: 0.9em; 
            color: #fff; 
            margin-bottom: 10px; /* AJUSTADO (era 30px) para aproximar ainda mais o carrossel do título */
            padding-bottom: 10px; 
            border-bottom: 1px solid rgba(80, 48, 96, 0.7);
        }

        /* Removido .courses-grid, agora usamos .carousel-track */
        .carousel-track {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden; /* Esconde scrollbar vertical se houver */
            padding: 20px 500px 130px 500px; /* AJUSTADO padding-top (era 120px) para aproximar do título */
            margin-bottom: 1px; /* AJUSTADO (era 10px) */
            position: relative; /* Necessário para posicionar os pseudo-elementos do esfumaçado */
            /* Adicionando perspectiva para transformações 3D dos cards */
            perspective: 1200px;
            transform-style: preserve-3d; /* Garante que os filhos sejam tratados em 3D */
            /* Estilizando a scrollbar horizontal para o trilho */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: rgba(70, 40, 86, 0.9) rgba(30, 18, 40, 0.7); /* Firefox: thumb track - AJUSTADO */
        }
        .carousel-track::-webkit-scrollbar {
            height: 12px; /* AJUSTADO (era 8px) */
        }
        .carousel-track::-webkit-scrollbar-track {
            background: rgba(30, 18, 40, 0.7); /* AJUSTADO (era rgba(42, 26, 58, 0.5)) */
        }
        .carousel-track::-webkit-scrollbar-thumb {
            background: rgba(70, 40, 86, 0.9); /* AJUSTADO (era rgba(80, 48, 96, 0.8)) */
            border-radius: 4px;
        }
        .carousel-track::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 68, 116, 1); 
        }

        /* Pseudo-elementos para o efeito de esfumaçar nas laterais do carrossel */
        .carousel-track::before, .carousel-track::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0; 
            width: 280px; /* AUMENTADO: Largura da faixa de esfumaçamento (era 180px) */
            z-index: 2; 
            pointer-events: none; 
        }
        .carousel-track::before {
            left: 0;
            /* AJUSTADO: Degradê com início na cor do novo fundo do main mais dominante e transição mais para dentro */
            background: linear-gradient(to right, #100818 60%, rgba(16, 8, 24, 0.65) 85%, rgba(16, 8, 24, 0) 100%);
        }
        .carousel-track::after {
            right: 0;
            /* AJUSTADO: Degradê com início na cor do novo fundo do main mais dominante e transição mais para dentro */
            background: linear-gradient(to left, #100818 60%, rgba(16, 8, 24, 0.65) 85%, rgba(16, 8, 24, 0) 100%);
        }

        .course-card { 
            background: rgba(63, 44, 80, 0.7); 
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border:1px solid rgba(80, 48, 96, 0.9); 
            border-radius: 8px; 
            overflow:hidden; 
            box-shadow:0 4px 8px rgba(0,0,0,0.3); 
            cursor: pointer; 
            color: #e5e5e5;
            width: 308px; /* AUMENTADO 40% (de 220px) */
            flex-shrink: 0; 
            margin-right: 2px; /* MARGEM MÍNIMA para evitar que colem totalmente sem transform */
            transition: transform 0.4s ease-in-out, box-shadow 0.4s ease-in-out, opacity 0.4s ease-in-out, filter 0.4s ease-in-out, z-index 0s 0.2s; 
            opacity: 0.1; 
            filter: brightness(0.1); 
            /* Transform inicial: recuado e menor. translateX e rotateY serão via JS para vizinhos */
            transform: translateZ(-200px) scale(0.8);
            transform-origin: center center; 
        }
        .course-card:last-child {
            margin-right: 0; 
        }
        .course-card:hover {
            /* Hover mantém uma escala mais próxima do 'normal' mas ainda se destaca dos distantes */
            transform: scale(1.12); /* Mantém scale uniforme no hover, sem espremer */
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            z-index: 10; 
            opacity: 0.95; 
            filter: brightness(0.9); 
        }
        /* Nova classe para o card focado no centro do carrossel */
        .course-card.focused-card {
            /* EFEITO 3D: Card focado vem para frente e aumenta */
            transform: translateZ(60px) scale(1.12); /* Leve ajuste no scale/translateZ do focado */
            box-shadow: 0 20px 45px rgba(0,0,0,0.8); 
            z-index: 20; 
            opacity: 1; 
            filter: brightness(1); 
        }
        /* Classe para cards adjacentes (nível 1) ao focado - Usada para opacidade/brilho */
        .course-card.adjacent-style {
            opacity: 0.6; 
            filter: brightness(0.6); 
            /* transform é aplicado via JS */
        }
        /* Classe para cards vizinhos de segundo nível - Usada para opacidade/brilho */
        .course-card.secondary-neighbor-style {
            opacity: 0.3;
            filter: brightness(0.3);
            /* transform é aplicado via JS */
        }
        .course-card img { 
            width: 60px; /* AJUSTADO: Tamanho explícito para o ícone */
            height: 60px; /* AJUSTADO: Tamanho explícito para o ícone */
            object-fit: contain; /* AJUSTADO: Garante que o ícone se ajuste sem cortar */
            border-bottom: none; /* REMOVIDO: Borda inferior para ícones */
            margin: 15px auto 10px auto; /* AJUSTADO: Centraliza e adiciona margem */
            display: block; /* Garante que seja um bloco para centralizar */
        }
        .course-card .info { 
            padding:15px; 
        }
        .course-card h3 { 
            margin:0 0 10px; 
            font-size:1.05em; 
            color:#fff; 
            height: 56px; /* AUMENTADO 40% (de 40px) */
            overflow: hidden;
        }
        .course-card p { 
            font-size:0.85em; 
            color:#ccc; /* Cor da descrição um pouco mais clara */
            margin:0; 
            line-height: 1.3;
            height: 70px; /* AUMENTADO 40% (de 50px) */
            overflow: hidden;
        }
        /* Modal */
        .modal { 
            position: fixed; 
            top:0; 
            left:0; 
            width:100%; 
            height:100%; 
            background: rgba(0,0,0,0.8); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 1001; /* Mais alto que o header */
        }
        .modal.hidden { display: none; }
        .modal-content { 
            background: rgba(59, 32, 74, 0.95); /* Roxo GERiAH para modal */
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            color: #fff;
            width: 90%; 
            max-width: 700px; 
            padding: 25px; 
            border-radius:6px; 
            border: 1px solid rgba(80, 48, 96, 1);
            position: relative; 
            max-height: 90vh; 
            overflow-y: auto; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .modal-content img { 
            width:100%; 
            height:auto; 
            margin-bottom:20px; 
            border-radius: 4px; 
        }
        .modal-content h2 { 
            margin-top: 0; 
            font-size: 1.6em;
            margin-bottom: 15px;
        }
        .modal-content p {
            font-size: 1em;
            line-height: 1.6;
            color: #e0e0e0;
            margin-bottom: 10px;
        }
        .close { 
            position: absolute; 
            top: 15px; 
            right: 20px; 
            font-size: 1.8em; 
            color: #aaa; 
            cursor: pointer; 
            transition: color 0.2s ease;
        }
        .close:hover {
            color: #fff;
        }
        /* Scrollbar customizada (Webkit) - GERiAH Style */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(42, 26, 58, 0.5); /* Roxo translúcido para track */
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(80, 48, 96, 0.8); /* Roxo mais sólido para thumb */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 68, 116, 1); /* Roxo mais claro no hover */
        }

        /* Estilos para Acordeão na Sidebar */
        aside .accordion-item {
            border-bottom: 1px solid rgba(80, 48, 96, 0.7);
            margin-bottom: 25px; /* AJUSTADO: Maior espaçamento entre os itens principais */
        }

        aside .accordion-header { /* Estilo para os H2 que são cabeçalhos de acordeão */
            cursor: pointer;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            width: 100%;
            padding-bottom: 15px; /* AJUSTADO: Mais espaço abaixo do cabeçalho */
            padding-right: 25px; /* Espaço para a seta */
            margin-bottom: 0;
            font-size: 0.99em;
            color: #fff; 
            margin-top: 0; /* Garante que não haja margem superior extra */
            border-radius: 6px;
            padding-left: 10px;
            padding-top: 10px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        aside .accordion-header:hover,
        aside .accordion-header.active {
            background: rgba(80, 48, 96, 0.8);
            box-shadow: 0 2px 8px rgba(80, 48, 96, 0.4);
        }
        
        aside .accordion-header.active {
            background: rgba(100, 68, 116, 0.9);
        }
        
        /* Removemos o estilo global de aside h2 para não conflitar com accordion-header */
        /* aside h2 { ... } */


        aside .accordion-icon {
            font-size: 0.8em;
            margin-left: auto;
            flex-shrink: 0;
        }

        aside .accordion-content {
            padding-left: 10px; 
            padding-top: 5px; 
            padding-bottom: 10px; 
            display: none; /* Começa fechado */
        }
        aside .accordion-content ul { /* Para #categoriesList e #toolsCategoriesList */
            padding: 0; 
            margin:0;
            list-style: none; /* Garante que não haja marcadores de lista padrão */
        }
        aside .accordion-content ul li {
            margin-bottom: 15px; /* AJUSTADO: Espaçamento entre itens das subcategorias */
        }
        /* Fim Estilos Acordeão */

        /* Estilos para Sub-Acordeões dentro de EXCLUSIVO */
        .sub-accordion-item {
            margin-bottom: 15px;
        }
        
        .sub-accordion-header {
            width: 100%;
            background: transparent;
            border: none;
            color: #d3d3d3;
            cursor: pointer;
            padding: 8px 25px 8px 15px; /* Ajustado: mais padding à direita para a seta */
            text-align: left;
            border-radius: 4px;
            font-size: 0.9em;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }
        
        .sub-accordion-header:hover,
        .sub-accordion-header.active {
            background: rgba(80, 48, 96, 0.7);
            color: #fff;
        }
        
        .sub-accordion-content {
            padding-left: 20px;
            padding-top: 10px;
        }
        
        .sub-accordion-icon {
            font-size: 0.7em;
            margin-left: auto;
            flex-shrink: 0;
        }
        
        /* Estilos para Terceiro Nível - Cards no Menu */
        .sub-sub-accordion-item {
            margin-bottom: 8px;
            margin-left: 15px;
        }
        
        .sub-sub-accordion-header {
            width: 100%;
            background: transparent;
            border: none;
            color: #b8b8b8;
            cursor: pointer;
            padding: 6px 20px 6px 10px;
            text-align: left;
            border-radius: 3px;
            font-size: 0.85em;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            border-left: 2px solid rgba(128, 76, 154, 0.3);
        }
        
        .sub-sub-accordion-header:hover,
        .sub-sub-accordion-header.active {
            background: rgba(128, 76, 154, 0.4);
            color: #fff;
            border-left-color: rgba(128, 76, 154, 0.8);
        }
        
        .sub-sub-accordion-content {
            padding-left: 15px;
            padding-top: 5px;
        }
        
        .card-menu-item {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            margin: 2px 0;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
            color: #a8a8a8;
            transition: all 0.2s ease;
            border-left: 2px solid transparent;
        }
        
        .card-menu-item:hover {
            background: rgba(128, 76, 154, 0.2);
            color: #fff;
            border-left-color: rgba(128, 76, 154, 0.6);
        }
        
        .card-menu-item.active {
            background: rgba(128, 76, 154, 0.3);
            color: #fff;
            border-left-color: rgba(128, 76, 154, 1);
        }

        .card-menu-item.menu-hover-highlight {
            background: rgba(255, 193, 7, 0.2) !important;
            color: #FFD700 !important;
            border-left: 2px solid #FFD700 !important;
            transition: all 0.3s ease !important;
        }
        
        .card-menu-icon {
            width: 14px;
            height: 14px;
            margin-right: 6px;
            opacity: 0.7;
        }
        /* Fim Estilos Terceiro Nível */

        /* Ajustes para o Modal de Curadoria - GERiAH Style */
        #curationModal .modal-content {
            /* Herda a maioria dos estilos de .modal-content */
            background: rgba(59, 32, 74, 0.98); /* Um pouco mais opaco para legibilidade */
        }
        /* Estilos para o Modal P.A.I (Painel de Acesso Imediato) */
        #paiModal .modal-content {
            /* Ajustes específicos se necessário, por ex, para altura do iframe */
            /* background: rgba(50, 25, 65, 0.98); /* Um roxo um pouco diferente se desejar */
            height: 90%; /* Ajustar conforme necessidade */
            width: 90%; /* Ajustar conforme necessidade */
            max-width: 1400px; /* Um pouco maior para ferramentas complexas */
            display: flex; /* Para organizar título e iframe */
            flex-direction: column; /* Título acima, iframe abaixo */
        }
        #paiModal iframe {
            flex-grow: 1; /* Iframe ocupa o espaço restante */
            border-radius: 0 0 6px 6px; /* Se o modal-content tiver border-radius */
        }

        #curationModal h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #fff;
        }
        #curationConfirm p, #curationReview h3, #curationList li {
            color: #e5e5e5;
        }
        #curationConfirm button, #curationReview button {
            background-color: rgba(100, 68, 116, 0.9); /* Roxo GERiAH para botões */
            border: 1px solid rgba(120, 88, 136, 1);
            padding: 10px 15px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        #curationConfirm button:hover, #curationReview button:hover {
            background-color: rgba(120, 88, 136, 1);
            border-color: rgba(140, 108, 156, 1);
        }
        #curationConfirm button#curateNo, #curationReview button#curateBack { /* Botão secundário */
            background-color: rgba(70, 70, 70, 0.8);
            border-color: rgba(90,90,90,1);
        }
        #curationConfirm button#curateNo:hover, #curationReview button#curateBack:hover {
            background-color: rgba(90, 90, 90, 0.9);
            border-color: rgba(110,110,110,1);
        }
        #curationList input[type=checkbox] {
            margin-right: 8px;
            accent-color: #804C9A; /* Cor roxa para o checkbox */
        }

        /* Media Query para Telas Pequenas (Mobile) */
        @media (max-width: 768px) {
            body { padding-top: 70px; } /* Ajusta padding do body */
            header {
                justify-content: flex-start; /* Alinha itens à esquerda */
            }
            .menu-toggle {
                display: block; /* Mostra o botão hamburger no mobile */
                color: #ffffff !important; /* Cor branca para contraste no mobile */
                text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5); /* Sombra para melhor legibilidade */
            }
            aside {
                transform: translateX(-100%); /* Esconde a sidebar por padrão no mobile */
                left: 0; /* Garante que o ponto de partida seja 0 */
                box-shadow: 2px 0 5px rgba(0,0,0,0.3); /* Sombra para destacar quando aberta */
            }
            main {
                margin-left: 0; /* Main ocupa largura total quando sidebar está oculta */
            }

            /* Estado: Sidebar aberta */
            body.sidebar-open aside {
                transform: translateX(0); /* Mostra a sidebar */
            }
            body.sidebar-open main {
                margin-left: 250px; /* Main é empurrado para a direita pela sidebar */
            }
            /* Opcional: Adicionar um overlay escuro quando a sidebar estiver aberta */
            body.sidebar-open::after {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0,0,0,0.5);
                z-index: 980; /* Abaixo da sidebar, acima do main */
            }

            /* Ajustes para o botão de Meus Cursos no mobile */
            #myCoursesBtn {
                margin-left: auto; /* Empurra para a direita para alinhar ao final do header */
            }

            .carousel-track {
                /* Reduzir padding para telas menores */
                padding: 80px 60px 80px 60px;
            }

            .carousel-track::before,
            .carousel-track::after {
                width: 100px; /* Largura do esfumaçado reduzida */
            }

            .carousel-track::before {
                background: linear-gradient(to right, #100818 30%, rgba(16, 8, 24, 0.65) 75%, rgba(16, 8, 24, 0) 100%);
            }

            .carousel-track::after {
                background: linear-gradient(to left, #100818 30%, rgba(16, 8, 24, 0.65) 75%, rgba(16, 8, 24, 0) 100%);
            }
            
            /* Ajustar posição da lista de resultados no mobile */
            .search-results {
                left: 260px !important;
                width: 300px !important;
                max-width: calc(100vw - 270px);
                top: 75px !important;
                max-height: 350px;
            }
            
            /* Quando sidebar está fechada no mobile, lista fica mais à esquerda */
            body:not(.sidebar-open) .search-results {
                left: 10px !important;
                width: 280px !important;
                max-width: calc(100vw - 20px);
            }
        }

        .access-course-button {
            background-color: #804C9A; /* Roxo GERiAH */
            border: none;
            padding: 8px 15px;
            margin-top: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: block; /* Ocupa a largura total */
            width: calc(100% - 0px); /* Ajusta para preencher o info div */
            text-align: center;
            text-decoration: none; /* Remove underline para links */
        }
        .access-course-button:hover {
            background-color: #6C3D82; /* Roxo mais escuro no hover */
        }
        /* Fim Novos estilos para botão Acessar */

        /* Estilos para Sub-Acordeões dentro de EXCLUSIVO */

        /* Estilo para mensagens de instrução */
        .instruction-message {
            color: #ccc;
            text-align: left;
            margin: 80px 30px 50px 30px;
            font-size: 1.2em;
            line-height: 1.4;
        }
        
        /* Logo discreto de suporte */
        .support-logo {
            width: 48px;
            height: 48px;
            opacity: 1.0; /* Totalmente opaco/aceso */
            cursor: pointer;
            transition: opacity 0.3s ease, transform 0.3s ease;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            margin-left: auto;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .support-logo:hover {
            opacity: 1.0; /* Mantém totalmente opaco no hover */
            transform: scale(1.1);
        }
        
        .support-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }
        
        /* Quando o toggle está visível, logo fica mais visível */
        .support-logo.toggle-visible {
            opacity: 1.0; /* Totalmente visível */
            background: rgba(255, 107, 53, 0.2);
            border: 2px solid rgba(255, 107, 53, 0.5);
        }
        
        .support-logo.toggle-visible:hover {
            opacity: 1.0; /* Mantém totalmente visível */
            background: rgba(255, 107, 53, 0.3);
        }
        
        /* Ajustar posicionamento no header */
        header .support-logo {
            position: relative;
        }
        
        /* Logo visível mesmo no modo de edição */
        body.edit-mode .support-logo {
            opacity: 0.8; /* Mais visível no modo de edição */
            background: rgba(255, 107, 53, 0.1);
        }
        
        body.edit-mode .support-logo:hover {
            opacity: 1.0; /* Totalmente visível no hover do modo de edição */
        }
        
        /* Estilos para itens personalizados */
        .customized-item {
            position: relative;
            background: rgba(76, 175, 80, 0.1) !important;
            border-left: 3px solid #4CAF50 !important;
        }
        
        .customized-item::before {
            content: "✨";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
            opacity: 0.7;
        }
        
        body.edit-mode .customized-item {
            background: rgba(255, 193, 7, 0.2) !important;
            border-left: 3px solid #FFC107 !important;
        }
        
        body.edit-mode .customized-item::before {
            content: "✏️";
        }
        
        /* Estilos para badges do menu Meus Apps */
        .check-icon {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            font-size: 0.8em;
            padding: 2px 5px;
            border-radius: 50%;
            margin-right: 8px;
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
            animation: check-glow 3s infinite;
        }
        
        /* Ícone de check para apps individuais funcionais */
        .app-check {
            color: #4CAF50;
            font-size: 0.9em;
            margin-right: 6px;
            text-shadow: 0 1px 2px rgba(76, 175, 80, 0.3);
        }
        
        /* Ícone de pendente para apps não testados ainda */
        .app-pending {
            color: #FF9800;
            font-size: 0.9em;
            margin-right: 6px;
            text-shadow: 0 1px 2px rgba(255, 152, 0, 0.3);
        }
        
        .apps-counter {
            color: #4CAF50;
            font-size: 0.9em;
            margin-right: 100px !important;
        }
        
        @keyframes check-glow {
            0%, 100% { 
                box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 2px 8px rgba(76, 175, 80, 0.6);
                transform: scale(1.05);
            }
        }
        
        /* Hover effect para o header Meus Apps */
        .accordion-header:has(.check-icon):hover .check-icon {
            background: linear-gradient(45deg, #66BB6A, #81C784);
            transform: scale(1.1);
        }
        
        .accordion-header:has(.apps-counter):hover .apps-counter {
            background: rgba(76, 175, 80, 1);
            transform: scale(1.05);
        }
        
        /* Indicadores de status das subcategorias */
        .subcat-status {
            font-size: 0.8em;
            margin-right: 6px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .subcat-status.complete {
            color: #4CAF50; /* Verde - todos os apps funcionam */
        }
        
        .subcat-status.partial {
            color: #FF9800; /* Laranja - alguns apps reservados */
        }
        
        .subcat-status.empty {
            color: #757575; /* Cinza - nenhum app funcional */
        }
        
        /* Estilo para subcategorias não implementadas - visual desbotado */
        .sub-accordion-header:has(.subcat-status.empty) {
            opacity: 0.5;
            color: #999999 !important;
        }
        
        .sub-accordion-header:has(.subcat-status.empty) img {
            opacity: 0.4;
            filter: grayscale(50%);
        }
        
        .sub-accordion-header:has(.subcat-status.empty):hover {
            opacity: 0.7;
            background: rgba(80, 48, 96, 0.3) !important;
        }

        /* Esconder contadores quando modo de edição está inativo */
        body:not(.edit-mode) .apps-counter {
            display: none !important;
        }
        
        /* Mostrar contadores apenas quando modo de edição está ativo */
        body.edit-mode .apps-counter {
            display: inline !important;
        }

        /* Badge USER */
        .user-badge {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            z-index: 999;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 175, 80, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            opacity: 0.7;
            pointer-events: none;
        }

        .user-badge:hover {
            opacity: 1;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }


        /* Estilos para categoria MEUS FAVORITOS */
        .add-favorite-placeholder {
            list-style: none;
            margin: 10px 0;
        }

        .add-favorite-btn {
            width: 100%;
            background: linear-gradient(135deg, #4A148C, #6A1B9A); /* Roxo mais escuro para melhor contraste */
            border: none;
            padding: 12px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            color: #ffffff; /* Texto branco para contraste */
            font-weight: 500; /* Texto mais destacado */
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border-radius: 6px; /* Bordas arredondadas */
        }

        .add-favorite-btn:hover {
            background: linear-gradient(135deg, #6A1B9A, #7B1FA2); /* Roxo mais claro no hover */
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(74, 20, 140, 0.4); /* Sombra roxa */
        }

        .add-favorite-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Favoritos individuais */
        .favorite-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            margin: 8px 0;
            padding: 10px;
            transition: all 0.3s ease;
            position: relative;
        }

        .favorite-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .favorite-item .favorite-link {
            color: #e5e5e5;
            text-decoration: none;
            display: block;
            font-weight: 500;
        }

        .favorite-item .favorite-link:hover {
            color: #FFD700;
        }

        .favorite-delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        body.edit-mode .favorite-delete-btn {
            display: block;
        }

        /* Estilos para o botão de toggle do menu (hamburger) */

        /* Badge USER integrado no sidebar */
        .sidebar-user-header {
            position: sticky;
            top: 0;
            background: rgba(80, 48, 96, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #fff;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 101;
            margin: 0;
        }

        .sidebar-user-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            pointer-events: none;
        }

        /* Remover badge fixo */
        .user-badge {
            display: none;
        }

        /* Estilos para Sub-Acordeões dentro de EXCLUSIVO */

        /* Estilos para o campo de busca do menu */
        .menu-search-container {
            position: sticky;
            top: 0;
            background: rgba(80, 48, 96, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            margin: 0;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }
        
        /* Container do conteúdo do menu com scroll */
        .menu-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0 15px 20px 15px;
        }
        
        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        #menuSearchInput {
            width: 100%;
            padding: 10px 35px 10px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 0.9em;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        #menuSearchInput:focus {
            outline: none;
            border-color: #804C9A;
            background: rgba(128, 76, 154, 0.15);
            box-shadow: 0 0 10px rgba(128, 76, 154, 0.3);
        }
        
        #menuSearchInput::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .clear-search-btn {
            position: absolute;
            right: 8px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 18px;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
        .clear-search-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        .search-results {
            position: fixed;
            top: 70px;
            left: 250px;
            width: 350px;
            background: rgba(59, 32, 74, 0.98);
            border: 1px solid rgba(128, 76, 154, 0.4);
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 9999;
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            margin: 10px;
        }
        
        .search-result-item {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-item:hover {
            background: rgba(128, 76, 154, 0.2);
        }
        
        .search-result-item:active {
            background: rgba(128, 76, 154, 0.4);
            transform: translateX(2px);
        }
        
        .search-result-item.clicked {
            background: rgba(255, 215, 0, 0.2);
            border-left: 3px solid #FFD700;
            animation: itemClicked 0.3s ease;
        }
        
        @keyframes itemClicked {
            0% { transform: translateX(0); }
            50% { transform: translateX(4px); }
            100% { transform: translateX(0); }
        }
        
        .search-result-name {
            color: #fff;
            font-weight: 500;
            font-size: 0.9em;
        }
        
        .search-result-path {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.8em;
            font-style: italic;
        }
        
        .search-no-results {
            padding: 15px;
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
        }
        
        /* Highlight do termo pesquisado */
        .search-highlight {
            background: rgba(255, 235, 59, 0.3);
            color: #fff;
            padding: 1px 2px;
            border-radius: 2px;
        }
        
        /* Destaque dos itens encontrados no menu */
        .search-highlighted-item {
            background: rgba(255, 235, 59, 0.2) !important;
            border-left: 3px solid #FFD700 !important;
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.4) !important;
            animation: searchPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes searchPulse {
            0%, 100% { 
                box-shadow: 0 0 8px rgba(255, 215, 0, 0.4);
            }
            50% { 
                box-shadow: 0 0 12px rgba(255, 215, 0, 0.6);
            }
        }

        /* Estilo para mensagens de instrução */
        .instruction-message {
            color: #ccc;
            text-align: left;
            margin: 80px 30px 50px 30px;
            font-size: 1.2em;
            line-height: 1.4;
        }

        /* ================ ESTILOS PARA FAVORITOS ================ */
        .favorite-star {
            display: inline-block;
            font-size: 20px;
            color: #999;
            cursor: pointer;
            margin-right: 8px;
            transition: all 0.3s ease;
            user-select: none;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
            border: 1px solid #999;
            border-radius: 3px;
            background: rgba(255,255,255,0.1);
        }

        .favorite-star:hover {
            color: #FFD700;
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.1);
        }

        .favorite-star.favorited {
            color: #FFD700;
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.3);
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
        }

        .favorite-star.favorited:hover {
            color: #FFA500;
            border-color: #FFA500;
            background: rgba(255, 165, 0, 0.3);
        }

        /* Estilos específicos para diferentes tipos de itens do menu */
        .sub-accordion-header .favorite-star {
            position: absolute;
            right: 35px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }

        .sub-accordion-header.has-favorite {
            padding-right: 55px;
        }

        .sub-sub-accordion-header .favorite-star {
            position: absolute;
            right: 35px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }

        .sub-sub-accordion-header.has-favorite {
            padding-right: 55px;
        }

        .card-menu-item .favorite-star {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            font-size: 18px;
            width: 22px;
            height: 22px;
            line-height: 20px;
            pointer-events: auto;
        }

        .card-menu-item.has-favorite {
            padding-right: 35px;
            position: relative;
        }

        /* Garantir que estrelas sejam clicáveis */
        .favorite-star {
            pointer-events: auto !important;
            z-index: 1000 !important;
        }

        /* Animação quando adiciona/remove favorito */
        @keyframes favoriteAdded {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); color: #FFD700; }
            100% { transform: scale(1); }
        }

        .favorite-star.animate-favorite {
            animation: favoriteAdded 0.6s ease;
        }

        /* Toast de notificação para favoritos */
        .favorite-toast {
            position: fixed;
            top: 90px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #FFD700;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.3s ease;
            border: 1px solid #FFD700;
        }

        .favorite-toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .favorite-toast.removing {
            opacity: 0;
            transform: translateX(100px);
        }

        /* Estilos limpos para favoritos */
        .clean-favorite-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 2px;
        }

        .clean-favorite-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .favorite-item-name {
            flex: 1;
            margin-left: 8px;
            font-size: 14px;
            color: #e0e0e0;
        }

        .clean-star {
            position: absolute !important;
            right: 8px !important;
            top: 50% !important;
            transform: translateY(-50%) !important;
            width: 20px !important;
            height: 20px !important;
            font-size: 14px !important;
            background: rgba(255, 255, 255, 0.1) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 50% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            color: #999 !important;
            transition: all 0.2s ease !important;
        }

        .clean-star:hover {
            background: rgba(255, 0, 0, 0.2) !important;
            color: #ff6b6b !important;
            border-color: #ff6b6b !important;
        }

        .clean-add-btn {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #ccc;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .clean-add-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            color: #fff;
        }

        /* Ícones dos favoritos com cor amarela */
        .favorite-icon-selected {
            filter: hue-rotate(45deg) brightness(1.5) contrast(1.2) !important;
            opacity: 0.9 !important;
        }

        .favorite-icon-added {
            filter: hue-rotate(45deg) brightness(1.5) contrast(1.2) !important;
            opacity: 0.9 !important;
        }

        /* Controle de visibilidade do modo edição */
        .edit-mode-only {
            display: none !important;
        }

        body.edit-mode .edit-mode-only {
            display: flex !important;
        }

        /* Estilos para modal de substituição */
        .existing-favorites-list {
            padding: 10px;
        }

        .replace-favorite-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .replace-favorite-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .replace-favorite-item:last-child {
            margin-bottom: 0;
        }

        .replace-favorite-item img {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            border-radius: 4px;
        }

        .replace-favorite-info {
            flex: 1;
        }

        .replace-favorite-name {
            font-weight: bold;
            color: #e0e0e0;
            margin-bottom: 4px;
        }

        .replace-favorite-type {
            font-size: 12px;
            color: #999;
        }

        .replace-favorite-btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .replace-favorite-btn:hover {
            background: #e55a2b;
        }

        .new-favorite-info {
            display: flex;
            align-items: center;
        }

        .new-favorite-info img {
            width: 32px;
            height: 32px;
            margin-right: 15px;
            border-radius: 6px;
        }

        .new-favorite-details h4 {
            margin: 0 0 5px 0;
            color: #4CAF50;
            font-size: 16px;
        }

        .new-favorite-details p {
            margin: 0;
            color: #81C784;
            font-size: 14px;
        }
    </style>

</head>
<body>
    <header>
        <button id="menuToggle" class="menu-toggle">☰</button>
        <h3 id="headerTitle">Acessos</h3>
        <div id="supportLogo" class="support-logo">
            <img src="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png" 
                 alt="GERiAH Support" 
                 title="Clique para acessar ferramentas de suporte">
        </div>
        <div class="edit-mode-toggle" id="editModeToggleContainer" style="display: none;">
            <label class="toggle-switch">
                <input type="checkbox" id="editModeToggle">
                <span class="toggle-slider"></span>
            </label>
            <span id="toggleLabel">Editar</span>
        </div>
        <button id="myCoursesBtn">iA</button>
    </header>
    <aside>
        <div class="sidebar-user-header">
            🎯 INDIVIDUAL
        </div>
        
        <!-- Campo de busca do menu -->
        <div class="menu-search-container">
            <div class="search-input-wrapper">
                <input type="text" id="menuSearchInput" placeholder="🔍 Buscar no menu..." autocomplete="off">
                <button id="clearSearchBtn" class="clear-search-btn" style="display: none;">&times;</button>
            </div>
        </div>
        
        <!-- Conteúdo do menu com scroll -->
        <div class="menu-content">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <img src="https://api.iconify.design/tabler/apps.svg?color=%23e5e5e5" alt="MeusApps Logo" style="width: 24px; height: 24px; margin-right: 10px; vertical-align: middle;">
                    CEL APPS 
                    <span class="apps-counter">45</span>
                    <span class="accordion-icon">►</span>
                </h2>
                <div class="accordion-content">
                    <ul id="meusAppsMainItemsList">
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/health-recognition.svg?color=%23e5e5e5" alt="Saúde Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    <span class="subcat-status partial">●</span>
                                    Saúde
                                    <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">4</span>
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="saudeItemsList"><li>Carregando...</li></ul>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/message.svg?color=%23e5e5e5" alt="Comunicar Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    <span class="subcat-status partial">●</span>
                                    Comunicar
                                    <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">6</span>
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="comunicacaoItemsList"><li>Carregando...</li></ul>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/credit-card.svg?color=%23e5e5e5" alt="Banco Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    <span class="subcat-status partial">●</span>
                                    Banco
                                    <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">6</span>
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="bancoItemsList"><li>Carregando...</li></ul>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/pizza.svg?color=%23e5e5e5" alt="Alimentação Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    <span class="subcat-status partial">●</span>
                                    Alimentação
                                    <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">2</span>
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="alimentacaoItemsList"><li>Carregando...</li></ul>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/tool.svg?color=%23e5e5e5" alt="Utilidades Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    <span class="subcat-status partial">●</span>
                                    Utilidades
                                    <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">20</span>
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="utilidadesItemsList"><li>Carregando...</li></ul>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/device-gamepad.svg?color=%23e5e5e5" alt="Lazer Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    <span class="subcat-status partial">●</span>
                                    Lazer
                                    <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">5</span>
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="lazerItemsList"><li>Carregando...</li></ul>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/car.svg?color=%23e5e5e5" alt="Transporte Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    <span class="subcat-status partial">●</span>
                                    Transporte
                                    <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">4</span>
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="transporteItemsList"><li>Carregando...</li></ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="category-separator"></div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <img src="https://api.iconify.design/tabler/gift.svg?color=%23e5e5e5" alt="Exclusivo Logo" style="width: 24px; height: 24px; margin-right: 10px; vertical-align: middle;">
                    EXCLUSIVO 
                    <span class="accordion-icon">►</span>
                </h2>
                <div class="accordion-content">
                    <ul id="paiMainItemsList">
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/video.svg?color=%23e5e5e5" alt="Videos Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    Videos Disponíveis
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="videosItemsList"><li>Carregando...</li></ul>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/school.svg?color=%23e5e5e5" alt="Conteudo de Apoio Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    Conteúdo de Apoio
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="categoriesList"><li>Carregando...</li></ul>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/tools.svg?color=%23e5e5e5" alt="Ferramentas Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    Ferramentas & Negócios
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="paiItemsList">
                                        <li>
                                            <div class="sub-sub-accordion-item">
                                                <button class="sub-sub-accordion-header">
                                                    <img src="https://api.iconify.design/tabler/briefcase.svg?color=%23b8b8b8" alt="FNW Assessoria Logo" style="width: 16px; height: 16px; margin-right: 6px; vertical-align: middle;">
                                                    FNW Assessoria
                                                    <span class="sub-accordion-icon">►</span>
                                                </button>
                                                <div class="sub-sub-accordion-content" style="display: none;">
                                                    <div class="card-menu-item has-favorite" data-card-name="FNW - Formulário Estratégico">
                                                        <span class="favorite-star" data-item-name="FNW - Formulário Estratégico" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'FNW - Formulário Estratégico')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/file-text.svg?color=%23a8a8a8" alt="Formulário" class="card-menu-icon">
                                                        FNW - Formulário Estratégico
                                                    </div>
                                                    <div class="card-menu-item has-favorite" data-card-name="FNW - ROI Maker">
                                                        <span class="favorite-star" data-item-name="FNW - ROI Maker" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'FNW - ROI Maker')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/calculator.svg?color=%23a8a8a8" alt="ROI" class="card-menu-icon">
                                                        FNW - ROI Maker
                                                    </div>
                                                    <div class="card-menu-item has-favorite" data-card-name="Painel ETO">
                                                        <span class="favorite-star" data-item-name="Painel ETO" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'Painel ETO')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/layout-dashboard.svg?color=%23a8a8a8" alt="Painel" class="card-menu-icon">
                                                        Painel ETO
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="sub-sub-accordion-item">
                                                <button class="sub-sub-accordion-header">
                                                    <img src="https://api.iconify.design/tabler/users-group.svg?color=%23b8b8b8" alt="50+ Logo" style="width: 16px; height: 16px; margin-right: 6px; vertical-align: middle;">
                                                    50+ | Maduros e Idosos
                                                    <span class="sub-accordion-icon">►</span>
                                                </button>
                                                <div class="sub-sub-accordion-content" style="display: none;">
                                                    <div class="card-menu-item has-favorite" data-card-name="Longevidade">
                                                        <span class="favorite-star" data-item-name="Longevidade" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'Longevidade')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/plant.svg?color=%23a8a8a8" alt="Longevidade" class="card-menu-icon">
                                                        Longevidade
                                                    </div>
                                                    <div class="card-menu-item has-favorite" data-card-name="Analise CNIS">
                                                        <span class="favorite-star" data-item-name="Analise CNIS" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'Analise CNIS')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/file-text.svg?color=%23a8a8a8" alt="CNIS" class="card-menu-icon">
                                                        Analise CNIS
                                                    </div>
                                                    <div class="card-menu-item has-favorite" data-card-name="CNIS Suporte">
                                                        <span class="favorite-star" data-item-name="CNIS Suporte" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'CNIS Suporte')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/tool.svg?color=%23a8a8a8" alt="Suporte" class="card-menu-icon">
                                                        CNIS Suporte
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/brain.svg?color=%23e5e5e5" alt="Suporte IA Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    Suporte - IA
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul id="suporteIaItemsList">
                                        <li>
                                            <div class="sub-sub-accordion-item">
                                                <button class="sub-sub-accordion-header">
                                                    <img src="https://api.iconify.design/tabler/wand.svg?color=%23b8b8b8" alt="Wizzards Logo" style="width: 16px; height: 16px; margin-right: 6px; vertical-align: middle;">
                                                    Wizzards
                                                    <span class="sub-accordion-icon">►</span>
                                                </button>
                                                <div class="sub-sub-accordion-content" style="display: none;">
                                                    <div class="card-menu-item has-favorite" data-card-name="IA Prompt Wizzard">
                                                        <span class="favorite-star" data-item-name="IA Prompt Wizzard" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'IA Prompt Wizzard')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/wand.svg?color=%23a8a8a8" alt="IA Prompt" class="card-menu-icon">
                                                        IA Prompt Wizzard
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="sub-sub-accordion-item">
                                                <button class="sub-sub-accordion-header">
                                                    <img src="https://api.iconify.design/tabler/robot.svg?color=%23b8b8b8" alt="Assistentes Logo" style="width: 16px; height: 16px; margin-right: 6px; vertical-align: middle;">
                                                    Assistentes
                                                    <span class="sub-accordion-icon">►</span>
                                                </button>
                                                <div class="sub-sub-accordion-content" style="display: none;">
                                                    <div class="card-menu-item has-favorite" data-card-name="Chat Rosio Livia Geriah">
                                                        <span class="favorite-star" data-item-name="Chat Rosio Livia Geriah" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'Chat Rosio Livia Geriah')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/message-dots.svg?color=%23a8a8a8" alt="Chat Rosio" class="card-menu-icon">
                                                        Chat Rosio Livia Geriah
                                                    </div>
                                                    <div class="card-menu-item has-favorite" data-card-name="HumanIA">
                                                        <span class="favorite-star" data-item-name="HumanIA" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'HumanIA')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/users-group.svg?color=%23a8a8a8" alt="HumanIA" class="card-menu-icon">
                                                        HumanIA
                                                    </div>
                                                    <div class="card-menu-item has-favorite" data-card-name="London Lord">
                                                        <span class="favorite-star" data-item-name="London Lord" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'London Lord')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/user-hexagon.svg?color=%23a8a8a8" alt="London Lord" class="card-menu-icon">
                                                        London Lord
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="category-separator"></div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <img src="https://api.iconify.design/tabler/users.svg?color=%23e5e5e5" alt="Participe Logo" style="width: 24px; height: 24px; margin-right: 10px; vertical-align: middle;">
                    PARTICIPE 
                    <span class="accordion-icon">►</span>
                </h2>
                <div class="accordion-content">
                    <ul id="participeItemsList">
                        <li>
                            <div class="sub-accordion-item">
                                <button class="sub-accordion-header">
                                    <img src="https://api.iconify.design/tabler/handshake.svg?color=%23e5e5e5" alt="Parcerias Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                    Parcerias
                                    <span class="sub-accordion-icon">►</span>
                                </button>
                                <div class="sub-accordion-content" style="display: none;">
                                    <ul>
                                        <li>
                                            <div class="sub-sub-accordion-item">
                                                <button class="sub-sub-accordion-header">
                                                    <img src="https://api.iconify.design/tabler/building-store.svg?color=%23b8b8b8" alt="Empresas Logo" style="width: 16px; height: 16px; margin-right: 6px; vertical-align: middle;">
                                                    Empresas Parceiras
                                                    <span class="sub-accordion-icon">►</span>
                                                </button>
                                                <div class="sub-sub-accordion-content" style="display: none;">
                                                    <div class="card-menu-item has-favorite" data-card-name="FNW Sinergias">
                                                        <span class="favorite-star" data-item-name="FNW Sinergias" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'FNW Sinergias')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/home.svg?color=%23a8a8a8" alt="FNW Sinergias" class="card-menu-icon">
                                                        FNW Sinergias
                                                    </div>
                                                    <div class="card-menu-item has-favorite" data-card-name="IDEIA21">
                                                        <span class="favorite-star" data-item-name="IDEIA21" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'IDEIA21')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/user.svg?color=%23a8a8a8" alt="IDEIA21" class="card-menu-icon">
                                                        IDEIA21
                                                    </div>
                                                    <div class="card-menu-item has-favorite" data-card-name="IPSOLON">
                                                        <span class="favorite-star" data-item-name="IPSOLON" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'IPSOLON')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/git-fork.svg?color=%23a8a8a8" alt="IPSOLON" class="card-menu-icon">
                                                        IPSOLON
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        <li>
                                            <div class="sub-sub-accordion-item">
                                                <button class="sub-sub-accordion-header">
                                                    <img src="https://api.iconify.design/tabler/edit.svg?color=%23b8b8b8" alt="Feito Por Você Logo" style="width: 16px; height: 16px; margin-right: 6px; vertical-align: middle;">
                                                    Feito Por Você
                                                    <span class="sub-accordion-icon">►</span>
                                                </button>
                                                <div class="sub-sub-accordion-content" style="display: none;">
                                                    <div class="card-menu-item has-favorite" data-card-name="Feito Por Você">
                                                        <span class="favorite-star" data-item-name="Feito Por Você" data-item-type="app" title="Adicionar aos favoritos" onclick="toggleFavoriteSimple(this, 'Feito Por Você')">☆</span>
                                                        <img src="https://api.iconify.design/tabler/edit.svg?color=%23a8a8a8" alt="Feito Por Você" class="card-menu-icon">
                                                        Feito Por Você
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="category-separator"></div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <img src="https://api.iconify.design/tabler/star.svg?color=%23FFD700" alt="Favoritos Logo" style="width: 24px; height: 24px; margin-right: 10px; vertical-align: middle;">
                    MEUS FAVORITOS 
                    <span class="apps-counter" id="favoritosCounter">0/7</span>
                    <span class="accordion-icon">►</span>
                </h2>
                <div class="accordion-content">
                    <ul id="favoritosItemsList">
                        <li class="add-favorite-placeholder">
                            <button class="add-favorite-btn" id="addFavoriteBtn">
                                <span style="font-size: 1.2em;">➕</span>
                                Adicionar Favorito
                            </button> 
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </aside>
    
    <!-- Lista de resultados de busca lateral (fora do sidebar) -->
    <div id="searchResults" class="search-results" style="display: none;"></div>
    
    <main>
        <h1 id="mainTitle"></h1>
        <div id="coursesContainer"><p class="instruction-message">Selecione uma categoria no Menu e acesse os recursos.</p></div>
    </main>

    <div id="modal" class="modal hidden">
        <div class="modal-content">
            <span id="modalClose" class="close">&times;</span>
            <div id="courseDetails"></div>
        </div>
    </div>

    <!-- Modal de Curadoria -->
    <div id="curationModal" class="modal hidden">
      <div class="modal-content">
        <h2>Curadoria de Recursos</h2>
        <!-- Passo 1: adicionar/ignorar -->
        <div id="curationConfirm">
          <p id="curationMessage"></p>
          <p id="curationRemaining" style="font-weight:bold; margin:5px 0;"></p>
          <button id="curateYes">Sim</button>
          <button id="curateNo">Não</button>
          <button id="accessNowBtn" style="display:none;">Acessar Agora</button>
        </div>
        <!-- Passo 2: rever seleção com nome/email -->
        <div id="curationReview" style="display:none; margin-top:15px;">
          <h3>Revise sua seleção</h3>
          <ul id="curationList"></ul>
          <div style="margin-top:10px;">
            <button id="curateBack">Voltar</button>
            <button id="curateContinue">Continuar</button>
            <button id="curateFinish">Finalizar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- NOVO Modal P.A.I. -->
    <div id="paiModal" class="modal hidden">
        <div class="modal-content pai-modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding-bottom:10px; border-bottom: 1px solid rgba(80, 48, 96, 0.7);">
                <h2 id="paiModalTitle" style="margin:0; font-size:1.4em; color: #fff;"></h2>
                <span id="paiModalClose" class="close" style="font-size:1.8em; cursor:pointer; color: #aaa;">&times;</span>
            </div>
            <iframe id="paiModalIframe" style="width:100%; height:100%; border:none; background-color: #fff;"></iframe>
        </div>
    </div>

    <!-- Modal de Confirmação do Modo de Edição -->
    <div id="editModeConfirmModal" class="modal hidden">
        <div class="modal-content">
            <span id="editModeConfirmClose" class="close">&times;</span>
            <h2>🔧 Ativar Modo de Edição</h2>
            <p>No modo de edição você poderá:</p>
            <ul style="text-align: left; margin: 20px 0; color: #e0e0e0;">
                <li>✏️ Personalizar nomes dos aplicativos</li>
                <li>🔗 Alterar URLs para seus sites preferidos</li>
                <li>🎨 Modificar ícones (futuro)</li>
                <li>💾 Salvar suas configurações</li>
            </ul>
            <p style="color: #ffcc80; font-weight: bold;">⚠️ Suas alterações serão salvas automaticamente</p>
            <div style="margin-top: 25px;">
                <button id="confirmEditMode" style="background-color: #ff6b35; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer; font-weight: bold;">Ativar Modo de Edição</button>
                <button id="cancelEditMode" style="background-color: #666; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer;">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Edição Individual -->
    <div id="itemEditModal" class="modal hidden">
        <div class="modal-content">
            <span id="itemEditClose" class="close">&times;</span>
            <h2>✏️ Editar Item</h2>
            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 10px; color: #e0e0e0; font-weight: bold;">
                    📝 Nome do Aplicativo:
                </label>
                <input type="text" id="editItemName" style="width: 100%; padding: 10px; border: 1px solid #666; border-radius: 4px; background: #2a2a2a; color: white; font-size: 16px;" placeholder="Digite o nome do aplicativo">
                
                <label style="display: block; margin: 20px 0 10px 0; color: #e0e0e0; font-weight: bold;">
                    🔗 URL de Destino:
                </label>
                <input type="url" id="editItemUrl" style="width: 100%; padding: 10px; border: 1px solid #666; border-radius: 4px; background: #2a2a2a; color: white; font-size: 16px;" placeholder="https://exemplo.com">
                
                <div style="margin: 20px 0; padding: 15px; background: rgba(255, 107, 53, 0.1); border: 1px solid rgba(255, 107, 53, 0.3); border-radius: 4px;">
                    <p style="margin: 0; color: #ffcc80; font-size: 14px;">
                        💡 <strong>Dica:</strong> Certifique-se de incluir "https://" no início da URL
                    </p>
                </div>
            </div>
            
            <div style="margin-top: 25px; text-align: right;">
                <button id="cancelItemEdit" style="background-color: #666; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer;">Cancelar</button>
                <button id="saveItemEdit" style="background-color: #ff6b35; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer; font-weight: bold;">💾 Salvar Alterações</button>
            </div>
        </div>
    </div>

    <!-- Modal de App (para Play Store) -->
    <div id="appModal" class="modal hidden">
        <div class="modal-content">
            <span id="appModalClose" class="close">&times;</span>
            <div style="text-align: center; padding: 20px;">
                <h2 id="appModalTitle" style="margin-bottom: 20px; color: #fff;"></h2>
                <div style="background: rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <p style="color: #e0e5e5; margin-bottom: 15px;">📱 Este é um aplicativo móvel oficial</p>
                    <p style="color: #ccc; font-size: 0.9em; margin-bottom: 20px;">Clique no botão abaixo para:</p>
                    <ul style="color: #ccc; text-align: left; margin: 15px 0; padding-left: 20px;">
                        <li>✅ Abrir o app se já estiver instalado</li>
                        <li>📥 Ir para a loja para download se não estiver instalado</li>
                    </ul>
                </div>
                <button id="openAppButton" style="
                    background: linear-gradient(45deg, #4CAF50, #45a049);
                    border: none;
                    padding: 15px 30px;
                    font-size: 16px;
                    cursor: pointer;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                    transition: transform 0.2s ease;
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    🚀 Abrir Aplicativo
                </button>
                <p style="color: #999; font-size: 0.8em; margin-top: 15px;">
                    💡 Você permanecerá no GERiAH até clicar no botão
                </p>
            </div>
        </div>
    </div>

    <!-- Modal de Edição de Cards -->
    <div id="cardEditModal" class="modal hidden">
        <div class="modal-content">
            <span id="cardEditModalClose" class="close">&times;</span>
            <h2>Editar Card</h2>
            <form id="cardEditForm">
                <div style="margin-bottom: 15px;">
                    <label for="editCardTitle" style="display: block; margin-bottom: 5px; color: #fff;">Título:</label>
                    <input type="text" id="editCardTitle" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="editCardImage" style="display: block; margin-bottom: 5px; color: #fff;">URL da Imagem:</label>
                    <input type="url" id="editCardImage" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="editCardUrl" style="display: block; margin-bottom: 5px; color: #fff;">URL de Acesso:</label>
                    <input type="url" id="editCardUrl" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="editCardDescription" style="display: block; margin-bottom: 5px; color: #fff;">Descrição:</label>
                    <textarea id="editCardDescription" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; resize: vertical;"></textarea>
                </div>
                <div style="text-align: right;">
                    <button type="button" id="cancelCardEdit" style="margin-right: 10px; padding: 8px 16px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                    <button type="button" id="saveCardEdit" style="padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Edição de Itens Simples -->
    <div id="simpleItemEditModal" class="modal hidden">
        <div class="modal-content">
            <span id="simpleItemEditModalClose" class="close">&times;</span>
            <h2>Editar Item</h2>
            <form id="simpleItemEditForm">
                <div style="margin-bottom: 15px;">
                    <label for="editSimpleItemName" style="display: block; margin-bottom: 5px; color: #fff;">Nome:</label>
                    <input type="text" id="editSimpleItemName" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="editSimpleItemUrl" style="display: block; margin-bottom: 5px; color: #fff;">URL de Acesso:</label>
                    <input type="url" id="editSimpleItemUrl" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div style="text-align: right;">
                    <button type="button" id="cancelSimpleItemEdit" style="margin-right: 10px; padding: 8px 16px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                    <button type="button" id="saveSimpleItemEdit" style="padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Adicionar Favorito -->
    <div id="addFavoriteModal" class="modal hidden">
        <div class="modal-content">
            <span id="addFavoriteModalClose" class="close">&times;</span>
            <h2>⭐ Adicionar aos Meus Favoritos</h2>
            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 10px; color: #e0e0e0; font-weight: bold;">
                    📝 Nome do Favorito:
                </label>
                <input type="text" id="addFavoriteName" style="width: 100%; padding: 10px; border: 1px solid #666; border-radius: 4px; background: #2a2a2a; color: white; font-size: 16px;" placeholder="Ex: Meu Site Favorito">
                
                <label style="display: block; margin: 20px 0 10px 0; color: #e0e0e0; font-weight: bold;">
                    🔗 URL de Destino:
                </label>
                <input type="url" id="addFavoriteUrl" style="width: 100%; padding: 10px; border: 1px solid #666; border-radius: 4px; background: #2a2a2a; color: white; font-size: 16px;" placeholder="https://exemplo.com">
                
                <label style="display: block; margin: 20px 0 10px 0; color: #e0e0e0; font-weight: bold;">
                    📄 Descrição (opcional):
                </label>
                <textarea id="addFavoriteDescription" style="width: 100%; padding: 10px; border: 1px solid #666; border-radius: 4px; background: #2a2a2a; color: white; font-size: 16px; resize: vertical;" rows="3" placeholder="Breve descrição do site ou ferramenta"></textarea>
                
                <div style="margin: 25px 0; padding: 20px; background: rgba(76, 175, 80, 0.1); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 8px;">
                    <p style="margin: 0; color: #81C784; font-size: 15px; line-height: 1.6; text-align: center;">
                          ⭐ <strong>Versão INDIVIDUAL:</strong> Você pode adicionar até <strong>7 favoritos</strong> personalizados.<br><br>
                          💡 Quando atingir o limite, você poderá <strong>substituir</strong> um favorito existente ou fazer <strong>upgrade para PERSONALIZADO</strong>!
                    </p>
                </div>
            </div>
            
            <div style="margin-top: 25px; text-align: right;">
                <button id="cancelAddFavorite" style="background-color: #666; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer;">Cancelar</button>
                <button id="saveAddFavorite" style="background-color: #4CAF50; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer; font-weight: bold;">⭐ Adicionar Favorito</button>
            </div>
        </div>
    </div>

    <!-- Modal de Substituição de Favoritos -->
    <div id="replaceFavoriteModal" class="modal hidden">
        <div class="modal-content">
            <span id="replaceFavoriteClose" class="close">&times;</span>
            <h2>🔄 Substituir Favorito</h2>
            <p style="color: #e0e0e0; margin-bottom: 20px;">Você já tem <strong>7 favoritos</strong> (limite máximo).</p>
            <p style="color: #e0e0e0; margin-bottom: 20px;">Deseja <strong>substituir</strong> um favorito existente por:</p>
            <div id="newFavoriteInfo" class="new-favorite-info" style="
                background: rgba(76, 175, 80, 0.1);
                border: 1px solid rgba(76, 175, 80, 0.3);
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 20px;
            ">
                <!-- Será preenchido dinamicamente -->
            </div>
            <h3 style="color: #e0e0e0; margin-bottom: 15px;">Escolha qual favorito substituir:</h3>
            <div id="existingFavoritesList" class="existing-favorites-list" style="
                max-height: 300px;
                overflow-y: auto;
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 6px;
                background: rgba(0, 0, 0, 0.2);
            ">
                <!-- Lista será preenchida dinamicamente -->
            </div>
            <div style="margin-top: 25px; text-align: right;">
                <button id="cancelReplace" style="background-color: #666; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer;">❌ Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Variáveis para controle do modo de edição - DEFINIDAS NO INÍCIO
        let isEditMode = false;
        let isToggleVisible = false;
        let currentEditingItem = null;
        let customItemData = {};
        
        const curationList = [];
        const MAX_CURATION = 4;

        // ================ SISTEMA DE FAVORITOS SIMPLES ================
        let userFavorites = JSON.parse(localStorage.getItem('userFavorites')) || [];
        const MAX_USER_FAVORITES = 7;
        let customCardData = {};

        // Mapa de dados dos itens para replicar comportamento
        const itemsDataMap = {
            // 50+ | Maduros e Idosos
            "Longevidade": { 
                url: "https://longevidade.com.br/", 
                image: "https://api.iconify.design/tabler/plant.svg?color=%23a8a8a8" 
            },
            "Analise CNIS": { 
                url: "https://sobralfreenat.github.io/poc_avaliacao_cnis_aposentadoria/", 
                image: "https://api.iconify.design/tabler/file-text.svg?color=%23a8a8a8" 
            },
            "CNIS Suporte": { 
                url: "https://sobralfreenat.github.io/cnis_fluxo02_backoffice/", 
                image: "https://api.iconify.design/tabler/tool.svg?color=%23a8a8a8" 
            },
            // FNW Assessoria
            "FNW - Formulário Estratégico": { 
                url: "https://websim.com/@shiningrainbow72249063/formul-rio-estrat-gico", 
                image: "https://api.iconify.design/tabler/file-text.svg?color=%23a8a8a8" 
            },
            "FNW - ROI Maker": { 
                url: "https://sobralfreenat.github.io/fnw_clevel_roi-maker/", 
                image: "https://api.iconify.design/tabler/calculator.svg?color=%23a8a8a8" 
            },
            "Painel ETO": { 
                url: "https://sobralfreenat.github.io/fnw_connect_panel/", 
                image: "https://api.iconify.design/tabler/layout-dashboard.svg?color=%23a8a8a8" 
            },
            // Suporte IA
            "IA Prompt Wizzard": { 
                url: "https://sobralfreenat.github.io/agent_ai_prompt_gen_tool/", 
                image: "https://api.iconify.design/tabler/wand.svg?color=%23a8a8a8" 
            },
            "Chat Rosio Livia Geriah": { 
                url: "https://sobralfreenat.github.io/chat_rosio_livia_geriah/", 
                image: "https://api.iconify.design/tabler/message-dots.svg?color=%23a8a8a8" 
            },
            "HumanIA": { 
                url: "https://dash.superagentes.ai/@humania", 
                image: "https://api.iconify.design/tabler/users-group.svg?color=%23a8a8a8" 
            },
            "London Lord": { 
                url: "https://sobralfreenat.github.io/agb_gabriel_bourne_master/", 
                image: "https://api.iconify.design/tabler/user-hexagon.svg?color=%23a8a8a8" 
            },
            // Participe
            "FNW Sinergias": { 
                url: "https://sobralfreenat.github.io/fnw_parceria_sinergia/", 
                image: "https://api.iconify.design/tabler/home.svg?color=%23a8a8a8" 
            },
            "IDEIA21": { 
                url: "https://sobralfreenat.github.io/ideia21_lp_consultores/", 
                image: "https://api.iconify.design/tabler/user.svg?color=%23a8a8a8" 
            },
            "IPSOLON": { 
                url: "https://websim.com/@shiningrainbow72249063/ipsolon-instituto-de-promo-o-da-sa-de-orientada-lo", 
                image: "https://api.iconify.design/tabler/git-fork.svg?color=%23a8a8a8" 
            },
            "Feito Por Você": { 
                url: "https://forms.gle/kFdaEY5L9gDYCUpC8", 
                image: "https://api.iconify.design/tabler/edit.svg?color=%23a8a8a8" 
            },
            // Favoritos manuais comuns
            "sANDboX W3": { 
                url: "#", 
                image: "https://api.iconify.design/tabler/world.svg?color=%23a8a8a8",
                isManual: true
            }
        };

        // Função GLOBAL integrada com o sistema existente de favoritos
        function toggleFavoriteSimple(element, itemName) {
            const favoriteIndex = userFavorites.findIndex(fav => fav.name === itemName);
            
            if (favoriteIndex === -1) {
                // ADICIONAR aos favoritos
                if (userFavorites.length >= MAX_USER_FAVORITES) {
                    // Abrir modal de substituição ao invés de apenas mostrar erro
                    openReplaceFavoriteModal(itemName);
                    return;
                }
                
                // Verificar se é item do sistema ou manual
                const itemData = itemsDataMap[itemName];
                let newFavorite;
                
                if (itemData && !itemData.isManual) {
                    // Item do sistema - navegação interna
                    newFavorite = {
                        name: itemName,
                        type: 'aplicativo',
                        url: itemData.url,
                        image: itemData.image,
                        dateAdded: new Date().toISOString()
                    };
                } else {
                    // Item manual ou não mapeado - buscar nos favoritos existentes
                    const existingFavorite = userFavorites.find(fav => fav.name === itemName);
                    if (existingFavorite) {
                        // Já existe, não adicionar novamente
                        return;
                    }
                    
                    // Não permitir adicionar itens não mapeados via estrela
                    showFavoriteToast(`"${itemName}" só pode ser adicionado manualmente!`, 'error');
                    return;
                }
                
                userFavorites.push(newFavorite);
                
                element.textContent = '★';
                element.classList.add('favorited', 'animate-favorite');
                element.title = 'Remover dos favoritos';
                
                showFavoriteToast(`"${itemName}" adicionado aos favoritos!`);
                
            } else {
                // REMOVER dos favoritos
                userFavorites.splice(favoriteIndex, 1);
                
                element.textContent = '☆';
                element.classList.remove('favorited');
                element.title = 'Adicionar aos favoritos';
                
                showFavoriteToast(`"${itemName}" removido dos favoritos!`);
            }
            
            // Salvar e atualizar
            localStorage.setItem('userFavorites', JSON.stringify(userFavorites));
            updateFavoritesCounter();
            updateFavoritesDisplay();
            
            // Atualizar todas as estrelas do mesmo item na página
            const allStarsOfItem = document.querySelectorAll(`.favorite-star[data-item-name="${itemName}"]`);
            allStarsOfItem.forEach(star => {
                const isFavorited = userFavorites.some(fav => fav.name === itemName);
                if (isFavorited) {
                    star.textContent = '★';
                    star.classList.add('favorited');
                    star.title = 'Remover dos favoritos';
                    star.style.color = '#FFD700';
                } else {
                    star.textContent = '☆';
                    star.classList.remove('favorited');
                    star.title = 'Adicionar aos favoritos';
                    star.style.color = '#999';
                }
            });
            
            // Remover animação
            setTimeout(() => element.classList.remove('animate-favorite'), 600);
        }

        // Função para inicializar o estado das estrelas baseado nos favoritos salvos
        function initializeStarsState() {
            console.log('🔄 Inicializando estado das estrelas...');
            
            // Buscar todas as estrelas na página
            const allStars = document.querySelectorAll('.favorite-star');
            
            allStars.forEach(star => {
                const itemName = star.getAttribute('data-item-name');
                if (!itemName) return;
                
                // Verificar se o item está nos favoritos
                const isFavorited = userFavorites.some(fav => fav.name === itemName);
                
                if (isFavorited) {
                    // Marcar como favorito
                    star.textContent = '★';
                    star.classList.add('favorited');
                    star.title = 'Remover dos favoritos';
                    star.style.color = '#FFD700';
                    console.log(`⭐ Estrela marcada: ${itemName}`);
                } else {
                    // Marcar como não favorito
                    star.textContent = '☆';
                    star.classList.remove('favorited');
                    star.title = 'Adicionar aos favoritos';
                    star.style.color = '#999';
                }
            });
            
            console.log(`✅ ${allStars.length} estrelas inicializadas`);
        }

        // Função para observar mudanças no DOM e inicializar estrelas novas
        function observeStarsChanges() {
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        // Verificar se novos elementos com estrelas foram adicionados
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeType === Node.ELEMENT_NODE) {
                                const newStars = node.querySelectorAll ? node.querySelectorAll('.favorite-star') : [];
                                if (newStars.length > 0) {
                                    console.log(`🔍 Novas estrelas detectadas: ${newStars.length}`);
                                    setTimeout(initializeStarsState, 100); // Pequeno delay para garantir que o DOM está pronto
                                }
                            }
                        });
                    }
                });
            });

            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
            
            console.log('👁️ Observer de estrelas ativado');
        }

        // Torna as funções disponíveis globalmente
        window.toggleFavoriteSimple = toggleFavoriteSimple;
        window.initializeStarsState = initializeStarsState;

        // ================ SISTEMA DE SUBSTITUIÇÃO DE FAVORITOS ================
        
        // Variável para armazenar o item que quer ser adicionado
        let pendingFavoriteItem = null;

        // Função para abrir modal de substituição
        function openReplaceFavoriteModal(itemName) {
            // Buscar dados do item
            const itemData = itemsDataMap[itemName];
            if (!itemData) {
                showFavoriteToast(`Item "${itemName}" não encontrado!`, 'error');
                return;
            }

            // Armazenar item pendente
            pendingFavoriteItem = {
                name: itemName,
                type: 'aplicativo',
                url: itemData.url,
                image: itemData.image,
                dateAdded: new Date().toISOString()
            };

            // Preencher informações do novo favorito
            const newFavoriteInfo = document.getElementById('newFavoriteInfo');
            newFavoriteInfo.innerHTML = `
                <img src="${itemData.image}" alt="${itemName}">
                <div class="new-favorite-details">
                    <h4>⭐ ${itemName}</h4>
                    <p>🔗 Navegação interna do sistema</p>
                </div>
            `;

            // Preencher lista de favoritos existentes COM SEPARAÇÃO POR TIPO
            const existingFavoritesList = document.getElementById('existingFavoritesList');
            
            // Separar favoritos por tipo
            const selecoes = userFavorites.filter(fav => fav.type === 'aplicativo');
            const adicoes = userFavorites.filter(fav => fav.type === 'manual');
            
            let favoritesHtml = '';
            
            // Seção Seleções (estrelas) - PRIMEIRO
            if (selecoes.length > 0) {
                favoritesHtml += `
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #4CAF50; margin: 0 0 10px 0; font-size: 0.9rem; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1rem;">⭐</span> Seleção (${selecoes.length})
                        </h4>
                `;
                selecoes.forEach((favorite) => {
                    const realIndex = userFavorites.findIndex(fav => fav === favorite);
                    const favoriteImage = favorite.image || "https://api.iconify.design/tabler/star.svg?color=%23FFD700";
                    
                    favoritesHtml += `
                        <div class="replace-favorite-item" style="border: 1px solid #4CAF50; background: rgba(76, 175, 80, 0.1);">
                            <img src="${favoriteImage}" alt="${favorite.name}">
                            <div class="replace-favorite-info">
                                <div class="replace-favorite-name">${favorite.name}</div>
                                <div class="replace-favorite-type" style="color: #4CAF50;">⭐ Navegação interna</div>
                            </div>
                                                         <button class="replace-favorite-btn" onclick="replaceFavorite(${realIndex})" style="background: #5e4b75; color: white; border: none;">
                                 🔄 Substituir
                             </button>
                        </div>
                    `;
                });
                favoritesHtml += '</div>';
            }
            
            // Seção Adições (manuais) - SEGUNDO
            if (adicoes.length > 0) {
                favoritesHtml += `
                    <div>
                        <h4 style="color: #FF9800; margin: 0 0 10px 0; font-size: 0.9rem; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1rem;">➕</span> Adição (${adicoes.length})
                        </h4>
                `;
                adicoes.forEach((favorite) => {
                    const realIndex = userFavorites.findIndex(fav => fav === favorite);
                    const favoriteImage = favorite.image || "https://api.iconify.design/tabler/world.svg?color=%23a8a8a8";
                    
                    favoritesHtml += `
                        <div class="replace-favorite-item" style="border: 1px solid #FF9800; background: rgba(255, 152, 0, 0.1);">
                            <img src="${favoriteImage}" alt="${favorite.name}">
                            <div class="replace-favorite-info">
                                <div class="replace-favorite-name">${favorite.name}</div>
                                <div class="replace-favorite-type" style="color: #FF9800;">➕ URL externa</div>
                            </div>
                                                         <button class="replace-favorite-btn" onclick="replaceFavorite(${realIndex})" style="background: #5e4b75; color: white; border: none;">
                                 🔄 Substituir
                             </button>
                        </div>
                    `;
                });
                favoritesHtml += '</div>';
            }

            existingFavoritesList.innerHTML = favoritesHtml;

            // Mostrar modal
            document.getElementById('replaceFavoriteModal').classList.remove('hidden');
        }

        // Função para substituir favorito
        function replaceFavorite(index) {
            if (!pendingFavoriteItem) {
                showFavoriteToast('Erro: Item pendente não encontrado!', 'error');
                return;
            }

            const oldFavorite = userFavorites[index];
            
            // Substituir o favorito
            userFavorites[index] = pendingFavoriteItem;
            
            // Salvar no localStorage
            localStorage.setItem('userFavorites', JSON.stringify(userFavorites));
            
            // Atualizar displays
            updateFavoritesCounter();
            updateFavoritesDisplay();
            initializeStarsState();
            
            // Fechar modal
            closeReplaceFavoriteModal();
            
            // Mostrar confirmação
            showFavoriteToast(`"${pendingFavoriteItem.name}" substituiu "${oldFavorite.name}"!`);
        }

        // Função para fechar modal de substituição
        function closeReplaceFavoriteModal() {
            document.getElementById('replaceFavoriteModal').classList.add('hidden');
            pendingFavoriteItem = null;
        }

        // Tornar funções globais
        window.openReplaceFavoriteModal = openReplaceFavoriteModal;
        window.replaceFavorite = replaceFavorite;
        window.closeReplaceFavoriteModal = closeReplaceFavoriteModal;

        // Função para mostrar notificação toast
        function showFavoriteToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'favorite-toast';
            toast.textContent = message;
            
            if (type === 'error') {
                toast.style.borderColor = '#ff4444';
                toast.style.color = '#ff4444';
            }
            
            document.body.appendChild(toast);
            
            // Mostrar toast
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Remover toast após 3 segundos
            setTimeout(() => {
                toast.classList.add('removing');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Função para adicionar/remover favoritos
        function toggleFavorite(itemName, itemType, element) {
            const favoriteIndex = userFavorites.findIndex(fav => fav.name === itemName);
            
            if (favoriteIndex === -1) {
                // Adicionar aos favoritos
                if (userFavorites.length >= MAX_USER_FAVORITES) {
                    showFavoriteToast(`Máximo de ${MAX_USER_FAVORITES} favoritos atingido!`, 'error');
                    return;
                }
                
                userFavorites.push({
                    name: itemName,
                    type: itemType,
                    dateAdded: new Date().toISOString()
                });
                
                element.textContent = '★';
                element.classList.add('favorited', 'animate-favorite');
                element.title = 'Remover dos favoritos';
                
                showFavoriteToast(`"${itemName}" adicionado aos favoritos!`);
                
            } else {
                // Remover dos favoritos
                userFavorites.splice(favoriteIndex, 1);
                
                element.textContent = '☆';
                element.classList.remove('favorited');
                element.title = 'Adicionar aos favoritos';
                
                showFavoriteToast(`"${itemName}" removido dos favoritos!`);
            }
            
            // Salvar no localStorage
            localStorage.setItem('userFavorites', JSON.stringify(userFavorites));
            
            // Atualizar contador de favoritos
            updateFavoritesCounter();
            
            // Atualizar lista de favoritos se estiver visível
            updateFavoritesDisplay();
            
            // Remover animação após completar
            setTimeout(() => element.classList.remove('animate-favorite'), 600);
        }

        // Função para atualizar o contador de favoritos
        function updateFavoritesCounter() {
            const counter = document.getElementById('favoritosCounter');
            if (counter) {
                counter.textContent = `${userFavorites.length}/${MAX_USER_FAVORITES}`;
            }
        }

        // Função para atualizar a exibição da lista de favoritos COM SUBCATEGORIAS
        function updateFavoritesDisplay() {
            const favoritosItemsList = document.getElementById('favoritosItemsList');
            if (!favoritosItemsList) return;
            
            if (userFavorites.length === 0) {
                favoritosItemsList.innerHTML = `
                    <li class="add-favorite-placeholder">
                        <button class="add-favorite-btn" onclick="openAddFavoriteModal()">
                            <span style="font-size: 1.2em;">➕</span>
                            Adicionar Favorito
                        </button>
                    </li>`;
                return;
            }
            
            // Separar favoritos por tipo
            const sistemaFavorites = userFavorites.filter(fav => fav.type === 'aplicativo');
            const manualFavorites = userFavorites.filter(fav => fav.type === 'manual');
            
            let favoritesHtml = '';
            
            // SEÇÃO: FAVORITOS DO SISTEMA
            if (sistemaFavorites.length > 0) {
                favoritesHtml += `
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header" style="background: rgba(76, 175, 80, 0.1); border-left: 3px solid #4CAF50;">
                                <img src="https://api.iconify.design/tabler/apps.svg?color=%234CAF50" style="width: 16px; height: 16px; margin-right: 6px;">
                                Seleção (${sistemaFavorites.length})
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: block;">
                                <ul>`;
                
                sistemaFavorites.forEach((favorite, index) => {
                    const itemImage = favorite.image || "https://api.iconify.design/tabler/star.svg?color=%23FFD700";
                    
                    favoritesHtml += `
                        <li>
                            <div class="card-menu-item has-favorite clean-favorite-item" data-card-name="${favorite.name}" 
                                 onclick="loadCardCategory('${favorite.name}')" 
                                 style="cursor: pointer; margin-left: 10px; position: relative;">
                                <img src="${itemImage}" alt="${favorite.name}" class="card-menu-icon favorite-icon-selected">
                                <span class="favorite-item-name">${favorite.name}</span>
                                <span class="favorite-star favorited clean-star edit-mode-only" 
                                      data-item-name="${favorite.name}" 
                                      data-item-type="${favorite.type}" 
                                      title="Remover dos favoritos"
                                      onclick="event.stopPropagation(); toggleFavoriteSimple(this, '${favorite.name}')">×</span>
                            </div>
                        </li>`;
                });
                
                favoritesHtml += `
                                </ul>
                            </div>
                        </div>
                    </li>`;
            }
            
            // SEÇÃO: FAVORITOS MANUAIS
            if (manualFavorites.length > 0) {
                favoritesHtml += `
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header" style="background: rgba(255, 152, 0, 0.1); border-left: 3px solid #FF9800;">
                                <img src="https://api.iconify.design/tabler/world.svg?color=%23FF9800" style="width: 16px; height: 16px; margin-right: 6px;">
                                Adição (${manualFavorites.length})
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: block;">
                                <ul>`;
                
                manualFavorites.forEach((favorite, index) => {
                    const itemImage = favorite.image || "https://api.iconify.design/tabler/world.svg?color=%23FF9800";
                    
                    favoritesHtml += `
                        <li>
                            <div class="card-menu-item has-favorite clean-favorite-item" data-card-name="${favorite.name}" 
                                 onclick="window.open('${favorite.url}', '_blank')" 
                                 style="cursor: pointer; margin-left: 10px; position: relative;">
                                <img src="${itemImage}" alt="${favorite.name}" class="card-menu-icon favorite-icon-added">
                                <span class="favorite-item-name">${favorite.name}</span>
                                <span class="favorite-star favorited clean-star edit-mode-only" 
                                      data-item-name="${favorite.name}" 
                                      data-item-type="${favorite.type}" 
                                      title="Remover dos favoritos"
                                      onclick="event.stopPropagation(); toggleFavoriteSimple(this, '${favorite.name}')">×</span>
                            </div>
                        </li>`;
                });
                
                favoritesHtml += `
                                </ul>
                            </div>
                        </div>
                    </li>`;
            }
            
            // BOTÃO ADICIONAR
            favoritesHtml += `
                <li class="add-favorite-placeholder">
                    <button class="add-favorite-btn clean-add-btn" onclick="openAddFavoriteModal()">
                        <span style="font-size: 1.2em;">➕</span>
                        Adicionar Favorito
                    </button>
                </li>`;
            
            favoritosItemsList.innerHTML = favoritesHtml;
            
            // Adicionar funcionalidade de abrir/fechar subcategorias
            initializeFavoriteAccordions();
        }
        
        // Função para inicializar acordeões dos favoritos
        function initializeFavoriteAccordions() {
            const accordionHeaders = document.querySelectorAll('#favoritosItemsList .sub-accordion-header');
            
            accordionHeaders.forEach(header => {
                header.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const content = this.parentElement.querySelector('.sub-accordion-content');
                    const icon = this.querySelector('.sub-accordion-icon');
                    
                    if (content.style.display === 'none') {
                        content.style.display = 'block';
                        icon.textContent = '▼';
                        this.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
                    } else {
                        content.style.display = 'none';
                        icon.textContent = '►';
                        this.style.backgroundColor = '';
                    }
                });
            });
        }

        // Função para inicializar as estrelas de favoritos
        function initializeFavoriteStars() {
            const stars = document.querySelectorAll('.favorite-star');
            console.log(`🔧 Inicializando ${stars.length} estrelas`);
            
            stars.forEach(star => {
                // Remover event listeners existentes
                star.removeEventListener('click', handleStarClick);
                
                const itemName = star.getAttribute('data-item-name');
                const itemType = star.getAttribute('data-item-type');
                
                console.log(`⭐ Configurando estrela: ${itemName}`);
                
                // Verificar se já está nos favoritos
                const isFavorited = userFavorites.some(fav => fav.name === itemName);
                if (isFavorited) {
                    star.textContent = '★';
                    star.classList.add('favorited');
                    star.title = 'Remover dos favoritos';
                } else {
                    star.textContent = '☆';
                    star.classList.remove('favorited');
                    star.title = 'Adicionar aos favoritos';
                }
                
                // Adicionar event listener
                star.addEventListener('click', handleStarClick);
                
                // Teste adicional - adicionar um evento simples
                star.addEventListener('click', function() {
                    console.log(`🌟 CLIQUE DETECTADO em: ${itemName}`);
                    alert(`CLIQUE FUNCIONOU! Item: ${itemName}`);
                });
            });
        }

        // Handler para clique nas estrelas
        function handleStarClick(event) {
            event.stopPropagation();
            event.preventDefault();
            
            const star = event.target;
            const itemName = star.getAttribute('data-item-name');
            const itemType = star.getAttribute('data-item-type');
            
            toggleFavorite(itemName, itemType, star);
        }

        // Nova estrutura para categorias P.A.I.
        const paiCategoriesData = [
            {
                name: "50+ | Maduros e Idosos",
                items: [
                    { name: "Longevidade", url: "https://longevidade.com.br/", image: "https://api.iconify.design/tabler/plant.svg?color=%23e5e5e5" }, 
                    { name: "Analise CNIS", url: "https://sobralfreenat.github.io/poc_avaliacao_cnis_aposentadoria/", image: "https://api.iconify.design/tabler/file-text.svg?color=%23e5e5e5" },
                    { name: "CNIS Suporte", url: "https://sobralfreenat.github.io/cnis_fluxo02_backoffice/", image: "https://api.iconify.design/tabler/tool.svg?color=%23e5e5e5" }
                ]
            },
            {
                name: "FNW Assessoria",
                items: [
           //         { name: "Plataforma FNW Assessoria", url: "https://sobralfreenat.github.io/menu_fixo_replica/", image: "https://api.iconify.design/tabler/briefcase.svg?color=%23e5e5e5" },
                    { name: "FNW - Formulário Estratégico", url: "https://websim.com/@shiningrainbow72249063/formul-rio-estrat-gico", image: "https://api.iconify.design/tabler/file-text.svg?color=%23e5e5e5" },
                    { name: "FNW - ROI Maker", url: "https://sobralfreenat.github.io/fnw_clevel_roi-maker/", image: "https://api.iconify.design/tabler/calculator.svg?color=%23e5e5e5" },
                    { name: "Painel ETO", url: "https://sobralfreenat.github.io/fnw_connect_panel/", image: "https://api.iconify.design/tabler/layout-dashboard.svg?color=%23e5e5e5" },
           //         { name: "Mapa Tatico SP MG", url: "https://sobralfreenat.github.io/mapa150_sp-106_mg/", image: "https://api.iconify.design/tabler/map-2.svg?color=%23e5e5e5" }
                ]
            }
        ];

        // Restaurando a estrutura de subcategorias para Suporte IA
        const suporteIaCategoriesData = [
            {
                name: "Wizzards",
                items: [
                    { name: "IA Prompt Wizzard", url: "https://sobralfreenat.github.io/agent_ai_prompt_gen_tool/", image: "https://api.iconify.design/tabler/wand.svg?color=%23e5e5e5" },
               //     { name: "Plano de Aula - S", url: "https://sobralfreenat.github.io/fnw_plano_aula/", image: "https://api.iconify.design/tabler/school.svg?color=%23e5e5e5" }
                ]
            },
            {
                name: "Assistentes",
                items: [
                    { name: "Chat Rosio Livia Geriah", url: "https://sobralfreenat.github.io/chat_rosio_livia_geriah/", image: "https://api.iconify.design/tabler/message-dots.svg?color=%23e5e5e5" },
                    { name: "HumanIA", url: "https://dash.superagentes.ai/@humania", image: "https://api.iconify.design/tabler/users-group.svg?color=%23e5e5e5" },
                    { name: "London Lord", url: "https://sobralfreenat.github.io/agb_gabriel_bourne_master/", image: "https://api.iconify.design/tabler/user-hexagon.svg?color=%23e5e5e5" }
                ]
            },
            {
               // name: "Agentes",
                items: [
                    { name: "Agente Exemplo 1", url: "#", image: "https://api.iconify.design/tabler/robot.svg?color=%23e5e5e5" },
                    { name: "Agente Exemplo 2", url: "#", image: "https://api.iconify.design/tabler/gizmo.svg?color=%23e5e5e5" }
                ],
                statusMessage: "" // Limpa a mensagem pois agora temos itens
            },
            {
                // name: "Automações",
                items: [
                    { name: "Automação Exemplo 1", url: "#", image: "https://api.iconify.design/simple-icons/n8n.svg?color=%23e5e5e5" },
                    { name: "Automação Exemplo 2", url: "#", image: "https://api.iconify.design/simple-icons/make.svg?color=%23e5e5e5" }
                ],
                statusMessage: "" // Limpa a mensagem pois agora temos itens
            }
        ];

        // Nova estrutura para categoria "Participe"
        const participeCategoriesData = [
            {
                name: "Parcerias",
                items: [
                    { name: "FNW Sinergias", url: "https://sobralfreenat.github.io/fnw_parceria_sinergia/", image: "https://api.iconify.design/tabler/home.svg?color=%23e5e5e5" },
                    { name: "IDEIA21", url: "https://sobralfreenat.github.io/ideia21_lp_consultores/", image: "https://api.iconify.design/tabler/user.svg?color=%23e5e5e5" },
                    { name: "IPSOLON", url: "https://websim.com/@shiningrainbow72249063/ipsolon-instituto-de-promo-o-da-sa-de-orientada-lo", image: "https://api.iconify.design/tabler/git-fork.svg?color=%23e5e5e5" }

                ]
            },
            {
                name: "Feito Por Você",
                items: [
                    { name: "Feito Por Você", url: "https://forms.gle/kFdaEY5L9gDYCUpC8", image: "https://api.iconify.design/tabler/edit.svg?color=%23e5e5e5" } // Use um ícone relevante
                ]
            }
        ];

        // Nova estrutura para categoria "Videos"
        const videosCategoriesData = [
            {
                name: "Entretenimento",
                items: [
                    { name: "Séries", url: "https://pluto.tv/br/live-tv/5f1212ad1728050007a523b8", image: "https://api.iconify.design/tabler/square.svg?color=%23e5e5e5" }, // Alterado para um ícone genérico para teste
                    { name: "Curiosidades", url: "https://pluto.tv/br/live-tv/5f1213ba0ecebc00070e170f", image: "https://api.iconify.design/tabler/circle.svg?color=%23e5e5e5" }, // Use um ícone relevante
                    { name: "Estilo de Vida", url: "https://pluto.tv/br/live-tv/664df5221dc48600087592b1", image: "https://api.iconify.design/tabler/triangle.svg?color=%23e5e5e5" }, // Use um ícone relevante
					
					{ name: "Notícias de Europa", url: "https://www.youtube.com/embed/O9mOtdZ-nSk", image: "https://api.iconify.design/tabler/box.svg?color=%23e5e5e5" } // Use um ícone relevante
                ]
            },
            {
                name: "Internos",
                items: [
                { name: "CNIS", url: "https://www.youtube.com/embed/OkqGQA-0XQU", image: "https://api.iconify.design/tabler/video.svg?color=%23e5e5e5" }, // Use um ícone relevante


// <iframe width="853" height="480" src="https://www.youtube.com/embed/OkqGQA-0XQU" title="GERiAH  CNIS01  2025 06 12 11 53 38" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe> 



//<iframe width="889" height="500" src="https://www.youtube.com/embed/O9mOtdZ-nSk" title="euronews en directo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>




                   // { name: "Curiosidades", url: "https://pluto.tv/br/live-tv/5f1213ba0ecebc00070e170f", image: "https://api.iconify.design/tabler/circle.svg?color=%23e5e5e5" }, // Use um ícone relevante
                  //  { name: "Estilo de Vida", url: "https://pluto.tv/br/live-tv/664df5221dc48600087592b1", image: "https://api.iconify.design/tabler/triangle.svg?color=%23e5e5e5" } // Use um ícone relevante
                ]
            },
            {
                name: "Ofertas",
                items: [
                    //{ name: "Curiosidades", url: "https://pluto.tv/br/live-tv/5f1213ba0ecebc00070e170f", image: "https://api.iconify.design/tabler/circle.svg?color=%23e5e5e5" } // Use um ícone relevante
                ]
            }
        ];

        // Variáveis para parâmetros da URL e estado de embedding
        let urlParams = new URLSearchParams(window.location.search);
        let embeddedMode = urlParams.get('embedded') === 'true';
        let parentOrigin = urlParams.get('origin');
        let userToken = urlParams.get('userToken');
        let userId = urlParams.get('userId'); // Pode ser usado futuramente se necessário
        console.log('GERIiAH_USER: userToken from URL params:', userToken);
        console.log('GERIiAH_USER: embeddedMode from URL params:', embeddedMode);

        // Usa o token da URL se disponível, senão usa o fallback
        const apiToken = userToken || 'dbb2c4d19a5ef0fec48e363618611614b4e0dfce'; 

        const categoryUrl = 'https://www.iped.com.br/api/category/get-categories';
        const coursesUrl = 'https://www.iped.com.br/api/course/get-courses';

        const relevantKeywordsFor50Plus = [
            'saude', 'bem-estar', 'memoria', 'mente', 'corpo', 'nutricao', 'alimentacao', 'exercicio', 'ginastica', 'yoga', 'pilates', 'dança', 'esportes', 'fisioterapia',
            'artesanato', 'pintura', 'desenho', 'musica', 'canto', 'instrumento', 'fotografia',
            'historia', 'cultura', 'arte', 'literatura', 'idiomas', 'linguas', 'escrita',
            'finanças', 'investimentos', 'empreendedorismo', 'negocios', 'direito', 'aposentadoria',
            'jardinagem', 'horta', 'culinaria', 'gastronomia', 'receitas',
            'tecnologia', 'digital', 'informatica', 'informática', 'internet', 'computador', 'celular', 'redes sociais',
            'viagem', 'turismo', 'lazer', 'jogos', 'espiritualidade', 'meditacao', 'qualidade de vida', 'voluntariado',
            'gsuite', 'g-suite', 'google', 'gmail', 'drive', 'docs', 'sheets', 'slides', 'forms', 'calendar', 'meet', 'workspace',
            'planilha', 'documento', 'apresentacao', 'formulario', 'agenda', 'email', 'nuvem', 'cloud', 'office', 'produtividade'
        ];

        // Função para ocultar o header e ajustar layout se em modo embedded
        function adjustForEmbeddedMode() {
            if (embeddedMode) {
                const headerElement = document.querySelector('header');
                const asideElement = document.querySelector('aside');
                const menuToggle = document.getElementById('menuToggle');

                // Forçar visibilidade e posicionamento do header no modo embarcado
                if (headerElement) {
                    headerElement.style.setProperty('display', 'flex', 'important');
                    headerElement.style.setProperty('position', 'fixed', 'important');
                    headerElement.style.setProperty('top', '0', 'important');
                    headerElement.style.setProperty('left', '0', 'important');
                    headerElement.style.setProperty('right', '0', 'important');
                    headerElement.style.setProperty('z-index', '9999', 'important');
                }
                // Forçar visibilidade e z-index do botão de menu (hambúrguer)
                if (menuToggle) {
                    menuToggle.style.setProperty('display', 'block', 'important');
                    menuToggle.style.setProperty('z-index', '10000', 'important');
                }
                // Ajusta o padding-top do body para 70px, pois o header está visível
                document.body.style.setProperty('padding-top', '70px', 'important');
                
                // Ajusta a posição do aside para o topo da página (abaixo do header)
                if (asideElement) {
                    asideElement.style.setProperty('top', '70px', 'important');
                }

                // --- Início da lógica restaurada para botões de curadoria no modo embarcado ---
                const accessNowBtn = document.getElementById('accessNowBtn');
                if (accessNowBtn) {
                    accessNowBtn.style.display = 'inline-block'; // Mostra o botão em modo embedded
                    // Estilizar como os outros botões:
                    accessNowBtn.style.backgroundColor = 'rgba(100, 68, 116, 0.9)';
                    accessNowBtn.style.color = 'white';
                    accessNowBtn.style.border = '1px solid rgba(120, 88, 136, 1)';
                    accessNowBtn.style.padding = '10px 15px';
                    accessNowBtn.style.margin = '5px';
                    accessNowBtn.style.borderRadius = '4px';
                    accessNowBtn.style.cursor = 'pointer';
                    accessNowBtn.style.fontWeight = 'bold';
                    accessNowBtn.addEventListener('click', () => {
                        if (current && parentOrigin) {
                            window.parent.postMessage({ action: 'acessarItem', itemId: current.course_id }, parentOrigin);
                            document.getElementById('curationModal').classList.add('hidden'); // Fecha o modal
                        }
                    });
                }
                 // No modo embedded, o botão "Sim" para adicionar à curadoria deve estar oculto
                const curateYesBtn = document.getElementById('curateYes');
                if(curateYesBtn) curateYesBtn.style.display = 'none';
                
                // No modo embedded, o botão "Não" (ignorar) deve estar oculto
                const curateNoBtn = document.getElementById('curateNo');
                if(curateNoBtn) curateNoBtn.style.display = 'none';
                 // Ajustar texto do prompt de curadoria em modo embedded
                const curationMessageEl = document.getElementById('curationMessage');
                if (curationMessageEl && current) {
                    curationMessageEl.textContent = `Acessar conteúdo "${current.course_title}"?`;
                }
                const curationRemainingEl = document.getElementById('curationRemaining');
                if(curationRemainingEl) curationRemainingEl.style.display = 'none'; // Não relevante para acesso direto
                // --- Fim da lógica restaurada para botões de curadoria no modo embarcado ---
            }
        }


        async function fetchCategories() {
            const ul = document.getElementById('categoriesList');
            ul.innerHTML = '<li>Carregando...</li>';
            console.log('fetchCategories: Iniciando requisição para categorias...');
            console.log('fetchCategories: Usando apiToken:', apiToken);
            
            // DEBUG: Mostrar palavras-chave que estão sendo usadas
            console.log('DEBUG: Palavras-chave para filtro:', relevantKeywordsFor50Plus);
            
            try {
                const fd = new FormData();
                fd.append('token', apiToken);
                fd.append('all_formats', 'true');
                const res = await fetch(categoryUrl, { method: 'POST', body: fd });
                console.log('fetchCategories: Resposta recebida. Status:', res.status, 'OK:', res.ok);
                const data = await res.json();
                console.log('fetchCategories: Dados da resposta:', data);
                if (data.CATEGORIES) renderCategories(data.CATEGORIES);
                else {
                    ul.innerHTML = '<li>Erro ao carregar categorias.</li>';
                    console.error('fetchCategories: Dados de categorias inválidos ou ausentes.', data);
                }
            } catch (error) {
                ul.innerHTML = '<li>Erro de rede.</li>';
                console.error('fetchCategories: Erro na requisição:', error);
            }
        }

        function renderCategories(cats) {
            const ul = document.getElementById('categoriesList');
            ul.innerHTML = '';
            let categoriesRendered = 0;

            // DEBUG: Log de todas as categorias recebidas
            console.log('DEBUG: Categorias recebidas da API IPED:', cats.length);
            cats.forEach((cat, idx) => {
                console.log(`DEBUG: Categoria ${idx + 1}: "${cat.category_title}"`);
            });

            cats.forEach((cat, idx) => {
                const categoryTitleLower = cat.category_title.toLowerCase();
                const isRelevant = relevantKeywordsFor50Plus.some(keyword => categoryTitleLower.includes(keyword));

                // DEBUG: Log do processo de filtragem
                console.log(`DEBUG: "${cat.category_title}" -> ${categoryTitleLower} -> Relevante: ${isRelevant}`);

                if (isRelevant) {
                    const li = document.createElement('li');
                    const btn = document.createElement('button');
                    btn.textContent = cat.category_title;
                    btn.dataset.id = cat.category_id;
                    btn.addEventListener('click', () => selectCategory(btn));
                    li.appendChild(btn);
                    ul.appendChild(li);
                    categoriesRendered++;
                    console.log(`DEBUG: Categoria "${cat.category_title}" ADICIONADA à lista`);
                }
            });

            console.log(`DEBUG: Total de categorias renderizadas: ${categoriesRendered}`);

            if (categoriesRendered === 0) {
                ul.innerHTML = '<li>Nenhuma categoria de interesse para 50+ encontrada no momento.</li>';
            }
        }

        function selectCategory(btn) {
            // Atualiza classe ativa
            document.querySelectorAll('#categoriesList button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            // Limpa o contêiner de cursos antes de buscar novos
            document.getElementById('coursesContainer').innerHTML = '<p style="color: #ccc;">Carregando recursos da categoria: ' + btn.textContent + '...</p>';
            fetchCourses(btn.dataset.id, btn.textContent);
            // Chama closeSidebar() após a seleção de categoria
            closeSidebar();
        }

        async function fetchCourses(catId, catTitle) {
            const cont = document.getElementById('coursesContainer');
            try {
                const fd = new FormData();
                fd.append('token', apiToken);
                fd.append('category_id', catId);
                fd.append('all_formats', 'true');
                const res = await fetch(coursesUrl, { method: 'POST', body: fd });
                const data = await res.json();
                if (data.COURSES) renderCourses(data.COURSES, catTitle);
                else cont.innerHTML = '<p style="color: #ff6b6b;">Erro ao carregar recursos.</p>';
            } catch {
                cont.innerHTML = '<p style="color: #ff6b6b;">Erro de rede ao buscar recursos.</p>';
            }
        }

        function renderCourses(courses, categoryTitle) {
            console.log('renderCourses: userToken value:', userToken);
            const container = document.getElementById('coursesContainer');
            container.innerHTML = '';

            // Cria o título da categoria principal (antigo #mainTitle, agora dinâmico)
            // Este título fica fora do carrossel, no topo da área de cursos.
            const categoryHeader = document.createElement('h2');
            categoryHeader.className = 'category-title-header'; // Reutiliza o estilo existente
            categoryHeader.textContent = categoryTitle;
            container.appendChild(categoryHeader);

            if (!courses || courses.length === 0) { // Verificação mais robusta
                // Se não há cursos, apenas mostra a mensagem abaixo do título da categoria.
                // Não cria o .carousel-track nem os pseudo-elementos de esfumaçar.
                const noCoursesMessage = document.createElement('p');
                noCoursesMessage.textContent = 'Nenhum recurso encontrado nesta categoria.';
                noCoursesMessage.style.color = '#ccc';
                noCoursesMessage.style.marginTop = '20px';
                container.appendChild(noCoursesMessage);
                return;
            }

            // Cria o trilho do carrossel
            const carouselTrack = document.createElement('div');
            carouselTrack.className = 'carousel-track';

            courses.forEach(course => {
                const card = document.createElement('div');
                card.className = 'course-card';
                if(course.course_id) card.dataset.courseId = course.course_id;

                let displayTitle = course.course_title || 'Curso sem título';
                if (displayTitle.toLowerCase().startsWith('curso de ')) {
                    displayTitle = displayTitle.substring(9); // Remove "Curso de " (9 caracteres)
                }

                card.innerHTML = `
                    <img src="${course.course_image || 'https://via.placeholder.com/308x196.png?text=Sem+Imagem'}" alt="${course.course_title || 'Curso sem título'}" style="width:100%; height:196px; object-fit:cover; border-bottom: 1px solid rgba(80, 48, 96, 0.9);">
                    <div class="info" style="padding:15px;">
                        <h3 style="margin:0 0 10px; font-size:1.05em; color:#fff; height: 56px; overflow: hidden;">${displayTitle}</h3>
                        <p style="font-size:0.85em; color:#ccc; margin:0; line-height: 1.3; height: 70px; overflow: hidden;">${(course.course_description || 'Sem descrição disponível.').substring(0, 100)}...</p>
                        ${userToken ? `<button class="access-course-button" data-course-id="${course.course_id}">Acessar</button>` : ''}
                    </div>`;

                if (userToken) {
                    // Se o usuário está logado, o clique no card não faz nada,
                    // e a ação de acesso é via o botão "Acessar".
                    // card.onclick = null; // Já é null por padrão se não for atribuído
                    const accessButton = card.querySelector('.access-course-button');
                    if (accessButton) {
                        accessButton.addEventListener('click', (e) => {
                            e.stopPropagation(); // Impede que o clique no botão propague para o card
                            if (course.course_id && parentOrigin) {
                                window.parent.postMessage({ action: 'acessarItem', itemId: course.course_id }, parentOrigin);
                            }
                            closeSidebar(); // Fechar sidebar após iniciar o acesso ao curso
                        });
                    }
                } else {
                    // Se o usuário NÃO está logado, o clique no card abre o modal de curadoria.
                    card.onclick = () => {
                        promptCurate(course);
                        // closeSidebar(); // REMOVIDO: Permitir que o menu hambúrguer funcione com o modal aberto
                    };
                }
                carouselTrack.appendChild(card);
            });
            container.appendChild(carouselTrack);

            // Adiciona listener de scroll ao carrossel recém-criado
            const debouncedUpdateFocus = debounce(() => updateCarouselFocus(carouselTrack), 50);
            
            let scrollEndTimer = null;
            carouselTrack.addEventListener('scroll', () => {
                // Atualiza o foco visualmente durante o scroll
                debouncedUpdateFocus(); 

                // Detecta o fim do scroll para o snap
                clearTimeout(scrollEndTimer);
                scrollEndTimer = setTimeout(() => {
                    snapToNearestCard(carouselTrack);
                }, 150); // Ajuste este valor se necessário (tempo para considerar o scroll parado)
            });

            // Chama uma vez para definir o foco inicial se houver scroll inicial
            updateCarouselFocus(carouselTrack); 
        }

        function snapToNearestCard(carouselTrack) {
            if (!carouselTrack || carouselTrack.children.length === 0) return;

            const cards = Array.from(carouselTrack.querySelectorAll('.course-card'));
            if (cards.length === 0) return;

            const trackRect = carouselTrack.getBoundingClientRect();
            const trackVisibleWidth = carouselTrack.clientWidth; // Largura visível, excluindo scrollbars
            const trackScrollLeft = carouselTrack.scrollLeft;

            let nearestCard = null;
            let smallestDistance = Infinity;

            // Calcula a "linha central" da área visível do carrossel
            const viewportCenterLine = trackScrollLeft + trackVisibleWidth / 2;

            cards.forEach(card => {
                const cardMidPoint = card.offsetLeft + card.offsetWidth / 2;
                const distance = Math.abs(viewportCenterLine - cardMidPoint);

                if (distance < smallestDistance) {
                    smallestDistance = distance;
                    nearestCard = card;
                }
            });

            if (nearestCard) {
                // Calcula o scrollLeft necessário para centralizar o nearestCard
                const targetScrollLeft = nearestCard.offsetLeft - (trackVisibleWidth / 2) + (nearestCard.offsetWidth / 2);
                
                // Só faz o scroll se a posição alvo for significativamente diferente da atual
                // para evitar loops de snap em alguns casos, e para não "snappar" se já estiver perto.
                if (Math.abs(carouselTrack.scrollLeft - targetScrollLeft) > 1) { 
                    carouselTrack.scrollTo({
                        left: targetScrollLeft,
                        behavior: 'smooth'
                    });
                    // A debouncedUpdateFocus no listener de scroll cuidará de atualizar o visual após a animação de snap.
                }
            }
        }

        // Função Debounce para otimizar eventos de scroll/resize
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Função para atualizar o foco no card central do carrossel
        function updateCarouselFocus(carouselTrack) {
            if (!carouselTrack || carouselTrack.children.length === 0) return;

            const trackRect = carouselTrack.getBoundingClientRect();
            const trackCenter = trackRect.left + trackRect.width / 2;
            const cards = Array.from(carouselTrack.querySelectorAll('.course-card'));

            const cardWidth = cards[0] ? cards[0].offsetWidth : 308;

            // --- Parâmetros Responsivos --- 
            const isMobile = window.innerWidth <= 768;

            // Parâmetros de estilo
            const MAX_SCALE = isMobile ? 1.15 : 1.28; 
            const MIN_SCALE = 0.8;
            const MAX_TRANSLATE_Z = isMobile ? 30 : 60; 
            const MIN_TRANSLATE_Z = isMobile ? -100 : -200;
            const MAX_OPACITY = 1.0;
            const MIN_OPACITY_EDGE = isMobile ? 0.6 : 0.4; 
            const MIN_OPACITY_FAR = isMobile ? 0.2 : 0.1; 
            const MAX_BRIGHTNESS = 1.0;
            const MIN_BRIGHTNESS_EDGE = isMobile ? 0.6 : 0.4;
            const MIN_BRIGHTNESS_FAR = isMobile ? 0.2 : 0.1;

            const BORDER_DARK_COLOR = '#21112E';
            const BORDER_LIGHT_COLOR = '#D3C5E0';
            const BORDER_THICKNESS = 2; 

            const FOCUS_ZONE_WIDTH = cardWidth * (isMobile ? 1.5 : 2.0); 

            const Y_ROTATE_PER_CARD = isMobile ? 5 : 10; 
            const Y_ROTATE_FOCUS_DAMPING = 0.4; 
            const X_TRANSLATE_BASE_FACTOR = cardWidth * (isMobile ? 0.15 : 0.25);
            // --- Fim Parâmetros Responsivos ---


            let centralCardIndex = -1;
            let minDistanceToTrackCenterForPivoting = Infinity;
            cards.forEach((card, index) => {
                const cardRect = card.getBoundingClientRect();
                const cardCenter = cardRect.left + cardRect.width / 2;
                const distance = Math.abs(cardCenter - trackCenter);
                if (distance < minDistanceToTrackCenterForPivoting) {
                    minDistanceToTrackCenterForPivoting = distance;
                    centralCardIndex = index;
                }
            });

            cards.forEach((card, index) => {
                const cardRect = card.getBoundingClientRect();
                const cardCenter = cardRect.left + cardRect.width / 2;

                const distanceToTrackCenterCurrentCard = Math.abs(cardCenter - trackCenter);
                let focusFactor = 1 - (distanceToTrackCenterCurrentCard / (FOCUS_ZONE_WIDTH / 2));
                focusFactor = Math.max(0, Math.min(1, focusFactor));

                const scale = MIN_SCALE + (MAX_SCALE - MIN_SCALE) * focusFactor;
                const translateZ = MIN_TRANSLATE_Z + (MAX_TRANSLATE_Z - MIN_TRANSLATE_Z) * focusFactor;
                
                let opacity, brightness;
                let boxShadow = `0 8px 20px rgba(0,0,0,${(0.3 + focusFactor * 0.5).toFixed(2)})`; // Sombra base interpolada

                if (focusFactor > 0.95) { // Ápice do foco
                    const elevationShadow = `0 20px 45px rgba(0,0,0,0.8)`;
                    const darkBorder = `0 0 0 ${BORDER_THICKNESS}px ${BORDER_DARK_COLOR}`;
                    const lightBorder = `0 0 0 ${BORDER_THICKNESS * 2}px ${BORDER_LIGHT_COLOR}`;
                    boxShadow = `${darkBorder}, ${lightBorder}, ${elevationShadow}`;
                } else if (focusFactor > 0.5) { // Zona de foco intermediária
                    const currentElevationAlpha = (0.3 + focusFactor * 0.5).toFixed(2);
                    boxShadow = `0 ${Math.round(8 + 12 * focusFactor)}px ${Math.round(20 + 25 * focusFactor)}px rgba(0,0,0,${currentElevationAlpha})`;
                } // Para focusFactor <= 0.5, a sombra base já definida é suficiente (menor e mais sutil)

                if (focusFactor > 0) {
                    opacity = MIN_OPACITY_EDGE + (MAX_OPACITY - MIN_OPACITY_EDGE) * focusFactor;
                    brightness = MIN_BRIGHTNESS_EDGE + (MAX_BRIGHTNESS - MIN_BRIGHTNESS_EDGE) * focusFactor;
                } else {
                    const falloffDistance = cardWidth * 1.5;
                    const distBeyondFocusZone = distanceToTrackCenterCurrentCard - (FOCUS_ZONE_WIDTH / 2);
                    const decay = Math.max(0, 1 - (distBeyondFocusZone / falloffDistance));
                    opacity = MIN_OPACITY_FAR + (MIN_OPACITY_EDGE - MIN_OPACITY_FAR) * decay;
                    brightness = MIN_BRIGHTNESS_FAR + (MIN_BRIGHTNESS_EDGE - MIN_BRIGHTNESS_FAR) * decay;
                }
                
                let translateX = 0;
                let rotateY = 0;

                if (centralCardIndex !== -1) {
                    const offsetFromCentral = index - centralCardIndex; 

                    rotateY = offsetFromCentral * Y_ROTATE_PER_CARD * (1 - (focusFactor * Y_ROTATE_FOCUS_DAMPING));

                    if (offsetFromCentral !== 0) {
                        // Cards são empurrados para os lados baseados no offset.
                        // Este efeito é atenuado se o card atual (index) estiver ele mesmo em foco.
                        translateX = offsetFromCentral * X_TRANSLATE_BASE_FACTOR * (1 - focusFactor * 0.6);
                    } else {
                        translateX = 0; // Card central não tem translateX relativo ao pivô.
                    }
                }
                
                card.style.transform = `translateX(${translateX.toFixed(1)}px) rotateY(${rotateY.toFixed(1)}deg) translateZ(${translateZ.toFixed(0)}px) scale(${scale.toFixed(2)})`;
                card.style.opacity = opacity.toFixed(2);
                card.style.filter = `brightness(${brightness.toFixed(2)})`;
                card.style.zIndex = Math.floor(translateZ + 200); 
                card.style.boxShadow = boxShadow;

                card.classList.remove('focused-card', 'adjacent-style', 'secondary-neighbor-style');
            });
        }

        async function openDetails(id) {
            try {
                const fd = new FormData();
                fd.append('token', apiToken);
                fd.append('course_id', id);
                const res = await fetch(coursesUrl, { method: 'POST', body: fd });
                const d = await res.json();
                if (d.COURSES && d.COURSES[0]) showModal(d.COURSES[0]);
            } catch {
                console.error('Erro ao carregar detalhes');
            }
        }

        function showModal(course) {
            const md = document.getElementById('modal');
            const div = document.getElementById('courseDetails');
            div.innerHTML = `
                <img src="${course.course_image || ''}">
                <h2>${course.course_title}</h2>
                <p>${course.course_description || ''}</p>
                <p><strong>Professor:</strong> ${course.course_teacher?.teacher_name || ''}</p>
                <p><strong>Preço:</strong> R$${course.course_price?.toFixed(2) || '--'}</p>`;
            md.classList.remove('hidden');
        }

        document.getElementById('modalClose').addEventListener('click', () => {
            document.getElementById('modal').classList.add('hidden');
        });

        document.getElementById('myCoursesBtn').addEventListener('click', () => {
            window.location.href = 'https://sobralfreenat.github.io/chat_rosio_livia_geriah/';
        });

        const MAX_SELECTION = 4;
        let selection = [];
        let current = null;
        
        function promptCurate(course) {
            current = course;
            const curationMessageEl = document.getElementById('curationMessage');
            const curationRemainingEl = document.getElementById('curationRemaining');
            const accessNowBtn = document.getElementById('accessNowBtn');
            const curateYesBtn = document.getElementById('curateYes');
            const curateNoBtn = document.getElementById('curateNo');

            if (embeddedMode) {
                if (curationMessageEl) curationMessageEl.textContent = `Acessar conteúdo "${current.course_title}"?`;
                if (curationRemainingEl) curationRemainingEl.style.display = 'none';
                if (accessNowBtn) accessNowBtn.style.display = 'inline-block';
                if (curateYesBtn) curateYesBtn.style.display = 'none';
                if (curateNoBtn) curateNoBtn.style.display = 'none';
            } else {
                if (curationMessageEl) curationMessageEl.textContent = `Adicionar "${course.course_title}" à sua curadoria?`;
                if (curationRemainingEl) {
                    curationRemainingEl.style.display = 'block';
                    curationRemainingEl.textContent = `Você pode selecionar ${MAX_SELECTION - selection.length} recurso${selection.length !== MAX_SELECTION-1?'s':''}`;
                }
                if (accessNowBtn) accessNowBtn.style.display = 'none';
                if (curateYesBtn) curateYesBtn.style.display = 'inline-block';
                if (curateNoBtn) curateNoBtn.style.display = 'inline-block';
            }
            
            document.getElementById('curationConfirm').style.display = 'block';
            document.getElementById('curationReview').style.display = 'none';
            document.getElementById('curationModal').classList.remove('hidden');
        }

        document.getElementById('curateYes').onclick = () => {
            if (selection.length < MAX_SELECTION && !selection.find(c => c.course_id === current.course_id)) {
                selection.push(current);
            }
            // Se não estiver em modo embedded, vai para a revisão.
            // Se estiver em modo embedded, este botão não deveria ser clicável ou visível.
            if (!embeddedMode) {
                showReview();
            } else {
                // Em modo embedded, o fluxo de curadoria é diferente, "Sim" não se aplica diretamente aqui.
                // O acesso é feito pelo botão "Acessar Agora".
                 document.getElementById('curationModal').classList.add('hidden');
            }
        };

        // O botão "Não" (ignorar) em modo não-embedded simplesmente fecha o modal ou vai para revisão sem adicionar.
        // Em modo embedded, este botão também não é primário. Se visível, poderia apenas fechar o modal.
        document.getElementById('curateNo').onclick = () => {
            if (!embeddedMode) {
                showReview(); // No modo normal, "Não" ainda pode levar à revisão (para desmarcar outros)
            } else {
                 // Em modo embedded, "Não" pode simplesmente fechar o modal se "Acessar Agora" não for clicado.
                document.getElementById('curationModal').classList.add('hidden');
            }
        };


        function showReview() {
            // Esta função é principalmente para o modo não-embedded (curadoria completa)
            if (embeddedMode) {
                // Não deve chegar aqui no fluxo de "Acessar Agora"
                document.getElementById('curationModal').classList.add('hidden');
                return;
            }
            document.getElementById('curationConfirm').style.display = 'none';
            document.getElementById('curationReview').style.display = 'block';
            const ul = document.getElementById('curationList'); ul.innerHTML = '';
            selection.forEach((c,i) => {
                const li = document.createElement('li');
                li.innerHTML = `<label><input type='checkbox' data-idx='${i}' checked> ${c.course_title}</label>`;
                ul.appendChild(li);
            });
        }

        // Atualiza seleção a partir das checkboxes da revisão
        function applyReview() {
            const newSel = [];
            document.querySelectorAll('#curationList input[type=checkbox]').forEach(cb => {
                if (cb.checked) newSel.push(selection[parseInt(cb.dataset.idx)]);
            });
            selection = newSel;
        }
        // Atualiza contagem no passo de confirmação
        function updateRemainingConfirm() {
            document.getElementById('curationRemaining').textContent =
                `Você pode selecionar ${MAX_SELECTION - selection.length} recurso${selection.length !== MAX_SELECTION - 1 ? 's' : ''}`;
        }
        document.getElementById('curateBack').onclick = () => {
            applyReview();
            updateRemainingConfirm();
            document.getElementById('curationReview').style.display = 'none';
            document.getElementById('curationConfirm').style.display = 'block';
        };
        document.getElementById('curateContinue').onclick = () => {
            applyReview();
            document.getElementById('curationModal').classList.add('hidden');
        };
        document.getElementById('curateFinish').onclick = () => {
            applyReview(); // Garante que a seleção da lista de checkboxes seja aplicada
            const finalList = selection;

            if (embeddedMode && parentOrigin) {
                // Em modo embedded, envia a lista de cursos para a página pai
                // A página pai será responsável por coletar nome/email se necessário
                window.parent.postMessage({ action: 'finalizarTrilha', trilhaData: finalList }, parentOrigin);
                document.getElementById('curationModal').classList.add('hidden');
                // Limpa a seleção para a próxima vez que o modal for aberto.
                selection = []; 
                updateRemainingConfirm();
            } else {
                // Comportamento original: prompt para nome/email e download JSON
                const name = prompt('Digite seu nome:');
                const email = prompt('Digite seu email:');
                if (!name || !email) {
                    alert('Nome e email são obrigatórios.');
                    return;
                }
                const payload = { name, email, courses: finalList };
                const dataStr = JSON.stringify(payload, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const fileName = `trilha_${name.replace(/\\s+/g,'_')}_${email.replace(/[@\\.]/g,'_')}.json`;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                document.getElementById('curationModal').classList.add('hidden');
                // Limpa a seleção
                selection = []; 
                updateRemainingConfirm();
            }
        };

        // RENOMEADA e AJUSTADA: Agora recebe uma ÚNICA categoria P.A.I. e renderiza seus itens.
        function displayPaiCategoryItems(paiCategory, parentCategoryName = "Participe") {
            console.log('=== DEBUG: displayPaiCategoryItems chamada ===');
            console.log('paiCategory:', paiCategory);
            console.log('parentCategoryName:', parentCategoryName);
            
            const container = document.getElementById('coursesContainer');
            if (!container) {
                console.error('ERRO: coursesContainer não encontrado em displayPaiCategoryItems!');
                return;
            }
            
            console.log('Container encontrado, limpando conteúdo...');
            container.innerHTML = ''; // Limpa conteúdo anterior

            const paiSectionTitle = document.createElement('h2');
            paiSectionTitle.className = 'category-title-header';
            paiSectionTitle.textContent = `${parentCategoryName} - ${paiCategory.name}`; // AJUSTADO: Usa o parâmetro da categoria pai
            container.appendChild(paiSectionTitle);

            if ((!paiCategory.items || paiCategory.items.length === 0)) {
                const noItemsMessage = document.createElement('p');
                if (paiCategory.statusMessage) {
                    noItemsMessage.textContent = paiCategory.statusMessage;
                } else {
                    noItemsMessage.textContent = `Nenhum recurso encontrado na categoria ${parentCategoryName}: ${paiCategory.name}.`; // AJUSTADO: Usa o parâmetro da categoria pai
                }
                noItemsMessage.style.color = '#ccc';
                noItemsMessage.style.marginTop = '20px';
                container.appendChild(noItemsMessage);
                return;
            }

            const carouselTrack = document.createElement('div');
            carouselTrack.className = 'carousel-track';

            paiCategory.items.forEach(paiItem => {
                const card = document.createElement('div');
                card.className = 'course-card';

                card.addEventListener('click', () => {
                    // SINCRONIZAÇÃO: Atualiza menu quando card é clicado
                    syncMenuSelection(paiItem.name);
                    openPaiItemInModal(paiItem);
                });

                card.innerHTML = `
                    <img src="${paiItem.image || 'https://via.placeholder.com/308x196.png?text=Recurso'}" alt="${paiItem.name}" style="width:100%; height:196px; object-fit:cover; border-bottom: 1px solid rgba(80, 48, 96, 0.9);">
                    <div class="info" style="padding:15px;">
                        <h3 style="margin:0 0 10px; font-size:1.05em; color:#fff; height: 56px; overflow: hidden;">${paiItem.name}</h3>
                        <p style="font-size:0.85em; color:#ccc; margin:0; line-height: 1.3; height: 70px; overflow: hidden;">Acesse Aqui</p>
                    </div>
                `;
                carouselTrack.appendChild(card);

                // Adicionar console.log para depuração do ícone
                const imgElement = card.querySelector('img');
                if (imgElement) {
                    console.log(`Ícone para ${paiItem.name}: ${imgElement.src}`);
                }
            });
            container.appendChild(carouselTrack);

            const debouncedUpdateFocus = debounce(() => updateCarouselFocus(carouselTrack), 50);
            let scrollEndTimer = null;
            carouselTrack.addEventListener('scroll', () => {
                debouncedUpdateFocus();
                clearTimeout(scrollEndTimer);
                scrollEndTimer = setTimeout(() => {
                    snapToNearestCard(carouselTrack);
                }, 150);
            });

            setTimeout(() => {
                updateCarouselFocus(carouselTrack);
            }, 0);
        }

        function openPaiItemInModal(paiItem) {
            // Detecta URLs da Play Store e mostra modal especial
            if (paiItem.url.includes('play.google.com/store/apps')) {
                showAppModal(paiItem);
                return;
            }
            
            const modal = document.getElementById('paiModal');
            const titleElement = document.getElementById('paiModalTitle');
            const iframeElement = document.getElementById('paiModalIframe');

            if (!modal || !titleElement || !iframeElement) {
                console.error('Elementos do modal P.A.I. não encontrados.');
                return;
            }

            titleElement.textContent = paiItem.name;
            iframeElement.src = paiItem.url;
            modal.classList.remove('hidden');
        }

        function showAppModal(appItem) {
            const modal = document.getElementById('appModal');
            const titleElement = document.getElementById('appModalTitle');
            const openButton = document.getElementById('openAppButton');

            if (!modal || !titleElement || !openButton) {
                console.error('Elementos do modal de app não encontrados.');
                return;
            }

            titleElement.textContent = appItem.name;
            
            // Remove listeners anteriores e adiciona novo
            const newButton = openButton.cloneNode(true);
            openButton.parentNode.replaceChild(newButton, openButton);
            
            newButton.addEventListener('click', () => {
                window.open(appItem.url, '_blank');
                modal.classList.add('hidden');
            });

            modal.classList.remove('hidden');
        }

        function renderSuporteIaSubcategoriesSidebar() {
            const ul = document.getElementById('suporteIaItemsList');
            ul.innerHTML = ''; 

            if (!suporteIaCategoriesData || suporteIaCategoriesData.length === 0) {
                ul.innerHTML = '<li>Nenhuma subcategoria de Suporte IA configurada.</li>';
                return;
            }

            suporteIaCategoriesData.forEach(subCategory => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                btn.textContent = subCategory.name;

                btn.addEventListener('click', () => {
                    ul.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    displayPaiCategoryItems(subCategory, "Suporte-IA"); // Passa o nome da categoria pai
                    closeSidebar(); // Fechar sidebar após selecionar subcategoria de Suporte IA
                });
                li.appendChild(btn);
                ul.appendChild(li);
            });
        }

        // Função para fechar a sidebar em mobile (definida globalmente)
        function closeSidebar() {
            if (window.innerWidth <= 768) { // Apenas em telas móveis
                document.body.classList.remove('sidebar-open');
            }
        }

        // Sistema de busca em tempo real no menu
        function setupRealTimeMenuSearch() {
            try {
                const searchInput = document.getElementById('menuSearchInput');
                const clearButton = document.getElementById('clearSearchBtn');
                
                if (!searchInput) {
                    console.error('Campo de busca não encontrado!');
                    return;
                }
                
                console.log('Inicializando busca em tempo real do menu...');
            
            // Array para armazenar todos os itens do menu
            let allMenuItems = [];
            
            // Função ROBUSTA para coletar TODOS os itens do menu
            function collectAllMenuItems() {
                allMenuItems = [];
                
                console.log('🔍 === INICIANDO COLETA COMPLETA E ROBUSTA ===');
                let totalFound = 0;
                
                // 🎯 FASE 1: Coleta TODOS os botões (mais abrangente)
                console.log('📋 FASE 1: Coletando TODOS os botões...');
                const allButtons = document.querySelectorAll('aside button, aside .button, aside [role="button"]');
                console.log(`Encontrados ${allButtons.length} botões potenciais`);
                
                allButtons.forEach((button, index) => {
                    const text = button.textContent.trim();
                    const cleanText = text.replace(/►|▼|\d+|\s+/g, ' ').replace(/\s+/g, ' ').trim();
                    
                    // Filtros mais inteligentes
                    const isValidButton = cleanText && 
                                        cleanText.length > 1 && 
                                        cleanText !== '☰' && 
                                        cleanText !== 'iA' && 
                                        !cleanText.includes('×') && 
                                        !cleanText.includes('➕') &&
                                        !cleanText.includes('...') &&
                                        cleanText !== 'Carregando';
                    
                    if (isValidButton) {
                        let itemType = 'button';
                        let categoryHint = '';
                        
                        // Identificação mais robusta do tipo
                        if (button.classList.contains('accordion-header') || button.tagName === 'H2') {
                            itemType = 'main-category';
                        } else if (button.classList.contains('sub-accordion-header')) {
                            itemType = 'sub-category';
                        } else if (button.classList.contains('sub-sub-accordion-header')) {
                            itemType = 'sub-sub-category';
                        } else if (button.closest('.sub-sub-accordion-content')) {
                            itemType = 'sub-sub-item';
                        } else if (button.closest('.sub-accordion-content')) {
                            itemType = 'sub-item';
                        }
                        
                        // Identificação de categoria pai mais robusta
                        let parentElement = button.closest('.accordion-item');
                        if (parentElement) {
                            const mainHeader = parentElement.querySelector('h2, .accordion-header');
                            if (mainHeader) {
                                categoryHint = mainHeader.textContent.replace(/►|▼|\d+/g, '').trim();
                            }
                        }
                        
                        allMenuItems.push({
                            element: button,
                            parent: button.parentElement,
                            text: cleanText,
                            originalText: text,
                            type: itemType,
                            categoryName: categoryHint,
                            extraKeywords: '',
                            domIndex: index
                        });
                        totalFound++;
                        
                        console.log(`✅ [${totalFound}] ${itemType.toUpperCase()}: "${cleanText}" (${categoryHint})`);
                    } else {
                        console.log(`❌ Botão rejeitado: "${cleanText}"`);
                    }
                });
                
                // 🎯 FASE 2: Coleta TODOS os itens com data-card-name e similares
                console.log('\n📋 FASE 2: Coletando itens de card/menu...');
                const cardItems = document.querySelectorAll('.card-menu-item, [data-card-name], .menu-item, .item');
                console.log(`Encontrados ${cardItems.length} itens de card potenciais`);
                
                cardItems.forEach((item, index) => {
                    const text = item.textContent.trim();
                    const cardName = item.getAttribute('data-card-name') || text;
                    
                    if (text && text.length > 1 && text !== 'Carregando...' && !text.includes('...')) {
                        // Identificação robusta de categoria pai
                        let categoryHint = '';
                        let subcategoryHint = '';
                        
                        let parentElement = item.closest('.accordion-item');
                        if (parentElement) {
                            const mainHeader = parentElement.querySelector('h2, .accordion-header');
                            if (mainHeader) {
                                categoryHint = mainHeader.textContent.replace(/►|▼|\d+/g, '').trim();
                            }
                        }
                        
                        // Verifica se está dentro de uma subcategoria
                        let subParent = item.closest('.sub-accordion-content');
                        if (subParent) {
                            const subHeader = subParent.previousElementSibling;
                            if (subHeader && subHeader.classList.contains('sub-accordion-header')) {
                                subcategoryHint = subHeader.textContent.replace(/►|▼|\d+/g, '').trim();
                            }
                        }
                        
                        allMenuItems.push({
                            element: item,
                            parent: item.parentElement,
                            text: text,
                            originalText: text,
                            type: 'card-menu-item',
                            categoryName: categoryHint,
                            subcategoryName: subcategoryHint,
                            extraKeywords: cardName,
                            cardName: cardName,
                            domIndex: index
                        });
                        totalFound++;
                        
                        console.log(`✅ [${totalFound}] CARD-ITEM: "${text}" (${categoryHint} › ${subcategoryHint})`);
                    }
                });
                
                // 🎯 FASE 3: Coleta elementos de lista (li, a, span clicáveis)
                console.log('\n📋 FASE 3: Coletando elementos de lista e links...');
                const listItems = document.querySelectorAll('aside li, aside a, aside span[onclick], aside [data-action]');
                console.log(`Encontrados ${listItems.length} elementos de lista potenciais`);
                
                listItems.forEach((item, index) => {
                    const text = item.textContent.trim();
                    const cleanText = text.replace(/►|▼|\d+|\s+/g, ' ').replace(/\s+/g, ' ').trim();
                    
                    // Evita duplicatas e items já processados
                    const isAlreadyAdded = allMenuItems.some(existing => 
                        existing.element === item || 
                        (existing.text === cleanText && cleanText.length > 2)
                    );
                    
                    if (cleanText && cleanText.length > 2 && !isAlreadyAdded && 
                        cleanText !== 'Carregando...' && !cleanText.includes('...')) {
                        
                        let categoryHint = '';
                        let parentElement = item.closest('.accordion-item');
                        if (parentElement) {
                            const mainHeader = parentElement.querySelector('h2, .accordion-header');
                            if (mainHeader) {
                                categoryHint = mainHeader.textContent.replace(/►|▼|\d+/g, '').trim();
                            }
                        }
                        
                        allMenuItems.push({
                            element: item,
                            parent: item.parentElement,
                            text: cleanText,
                            originalText: text,
                            type: 'list-item',
                            categoryName: categoryHint,
                            extraKeywords: '',
                            domIndex: index
                        });
                        totalFound++;
                        
                        console.log(`✅ [${totalFound}] LIST-ITEM: "${cleanText}" (${categoryHint})`);
                    }
                });
                
                // 2.5. Adiciona EXPLICITAMENTE todas as subcategorias de CEL APPS
                const celAppsSubcategories = [
                    { 
                        name: 'Saúde', 
                        selector: 'button:contains("Saúde")', 
                        keywords: 'saude medicina clinica hospital doutor medico enfermeira', 
                        apps: ['Dr. Consulta', 'Alice', 'Conexa Saúde', 'Telemedicina'] 
                    },
                    { 
                        name: 'Comunicar', 
                        selector: 'button:contains("Comunicar")', 
                        keywords: 'comunicacao conversar falar chat mensagem email telefone', 
                        apps: ['WhatsApp', 'WhatsApp Business', 'Telegram', 'Gmail', 'Google Meet', 'Zoom'] 
                    },
                    { 
                        name: 'Banco', 
                        selector: 'button:contains("Banco")', 
                        keywords: 'banco dinheiro conta corrente poupanca cartao pix transferencia', 
                        apps: ['Bradesco', 'Banco do Brasil', 'Caixa', 'Nubank', 'Santander', 'Itaú'] 
                    },
                    { 
                        name: 'Alimentação', 
                        selector: 'button:contains("Alimentação")', 
                        keywords: 'alimentacao comida delivery restaurante mercado supermercado', 
                        apps: ['iFood', 'Pão de Açúcar', 'Carrefour', 'Extra'] 
                    },
                    { 
                        name: 'Utilidades', 
                        selector: 'button:contains("Utilidades")', 
                        keywords: 'utilidade ferramenta mapa navegacao compras loja online', 
                        apps: ['Google Maps', 'Waze', 'Amazon', 'Shopee', 'Mercado Livre', 'Magazine Luiza', 'Casas Bahia', 'Americanas'] 
                    },
                    { 
                        name: 'Lazer', 
                        selector: 'button:contains("Lazer")', 
                        keywords: 'lazer diversao entretenimento video musica filme tv social rede', 
                        apps: ['YouTube', 'PlutoTV', 'Instagram', 'Facebook', 'LinkedIn', 'TikTok'] 
                    },
                    { 
                        name: 'Transporte', 
                        selector: 'button:contains("Transporte")', 
                        keywords: 'transporte viagem taxi uber carro onibus metro', 
                        apps: ['Uber', '99', 'Moovit', 'Citymapper'] 
                    }
                ];
                
                // Adiciona as subcategorias de CEL APPS
                celAppsSubcategories.forEach(subcat => {
                    // Encontra o elemento DOM correspondente
                    let domElement = null;
                    document.querySelectorAll('.sub-accordion-header').forEach(button => {
                        if (button.textContent.includes(subcat.name)) {
                            domElement = button;
                        }
                    });
                    
                    if (domElement) {
                        // Adiciona a subcategoria principal
                        const alreadyExists = allMenuItems.some(item => 
                            item.text.toLowerCase().includes(subcat.name.toLowerCase())
                        );
                        
                        if (!alreadyExists) {
                            allMenuItems.push({
                                element: domElement,
                                parent: domElement.parentElement,
                                text: subcat.name,
                                originalText: domElement.textContent.trim(),
                                type: 'cel-apps-subcategory',
                                categoryName: 'CEL APPS',
                                extraKeywords: subcat.keywords
                            });
                        }
                        
                        // Adiciona todos os apps dessa subcategoria
                        subcat.apps.forEach(appName => {
                            allMenuItems.push({
                                element: domElement, // Usa o mesmo elemento pai
                                parent: domElement.parentElement,
                                text: appName,
                                originalText: appName,
                                type: 'cel-apps-item',
                                categoryName: 'CEL APPS',
                                subcategoryName: subcat.name,
                                extraKeywords: `${subcat.keywords} ${appName.toLowerCase()}`
                            });
                        });
                    }
                });
                
                // 3. Adiciona itens específicos conhecidos do JavaScript
                const knownItems = [
                    // Apps de Comunicação
                    { name: 'WhatsApp', category: 'Comunicar', keywords: 'chat mensagem conversa' },
                    { name: 'WhatsApp Business', category: 'Comunicar', keywords: 'chat negócio trabalho' },
                    { name: 'Telegram', category: 'Comunicar', keywords: 'chat mensagem conversa' },
                    { name: 'Gmail', category: 'Comunicar', keywords: 'email correio google' },
                    { name: 'Google Meet', category: 'Comunicar', keywords: 'reunião videoconferência google' },
                    { name: 'Zoom', category: 'Comunicar', keywords: 'reunião videoconferência' },
                    
                    // Apps de Banco
                    { name: 'Bradesco', category: 'Banco', keywords: 'banco dinheiro pagar conta' },
                    { name: 'Banco do Brasil', category: 'Banco', keywords: 'banco dinheiro pagar conta' },
                    { name: 'Caixa', category: 'Banco', keywords: 'banco dinheiro pagar conta caixa econômica' },
                    { name: 'Nubank', category: 'Banco', keywords: 'banco dinheiro pagar conta cartão' },
                    { name: 'Santander', category: 'Banco', keywords: 'banco dinheiro pagar conta' },
                    { name: 'Itaú', category: 'Banco', keywords: 'banco dinheiro pagar conta' },
                    
                    // Apps de Transporte
                    { name: 'Uber', category: 'Transporte', keywords: 'viagem taxi transporte carro' },
                    { name: '99', category: 'Transporte', keywords: 'viagem taxi transporte carro' },
                    { name: 'Google Maps', category: 'Utilidades', keywords: 'mapa navegação maps trânsito localização' },
                    { name: 'Waze', category: 'Utilidades', keywords: 'mapa navegação maps trânsito' },
                    
                    // Apps de Alimentação
                    { name: 'iFood', category: 'Alimentação', keywords: 'comida delivery entrega restaurante' },
                    { name: 'Pão de Açúcar', category: 'Alimentação', keywords: 'comida mercado supermercado compras' },
                    
                    // Apps de Compras
                    { name: 'Amazon', category: 'Utilidades', keywords: 'compras loja online ecommerce' },
                    { name: 'Shopee', category: 'Utilidades', keywords: 'compras loja online ecommerce' },
                    { name: 'Mercado Livre', category: 'Utilidades', keywords: 'compras loja online ecommerce mercado' },
                    
                    // Apps de Entretenimento
                    { name: 'YouTube', category: 'Lazer', keywords: 'vídeo entretenimento música' },
                    { name: 'PlutoTV', category: 'Lazer', keywords: 'tv filme vídeo entretenimento' },
                    { name: 'Instagram', category: 'Lazer', keywords: 'social rede foto vídeo' },
                    { name: 'Facebook', category: 'Lazer', keywords: 'social rede amigos' },
                    { name: 'LinkedIn', category: 'Lazer', keywords: 'social rede trabalho profissional' },
                    
                    // Ferramentas e Negócios
                    { name: 'FNW - Formulário Estratégico', category: 'EXCLUSIVO', keywords: 'formulário estratégia negócio' },
                    { name: 'FNW - ROI Maker', category: 'EXCLUSIVO', keywords: 'roi calculadora retorno investimento' },
                    { name: 'Painel ETO', category: 'EXCLUSIVO', keywords: 'painel dashboard eto' },
                    { name: 'Longevidade', category: 'EXCLUSIVO', keywords: 'longevidade saúde idade' },
                    { name: 'Analise CNIS', category: 'EXCLUSIVO', keywords: 'cnis análise previdência' },
                    { name: 'CNIS Suporte', category: 'EXCLUSIVO', keywords: 'cnis suporte previdência' },
                    
                    // IA e Assistentes
                    { name: 'IA Prompt Wizzard', category: 'EXCLUSIVO', keywords: 'ia inteligência artificial prompt wizard' },
                    { name: 'Chat Rosio Livia Geriah', category: 'EXCLUSIVO', keywords: 'chat ia assistente rosio livia' },
                    { name: 'HumanIA', category: 'EXCLUSIVO', keywords: 'ia human inteligência artificial' },
                    { name: 'London Lord', category: 'EXCLUSIVO', keywords: 'london lord assistente' },
                    
                    // Parcerias
                    { name: 'FNW Sinergias', category: 'PARTICIPE', keywords: 'fnw sinergias parceria' },
                    { name: 'IDEIA21', category: 'PARTICIPE', keywords: 'ideia21 ideia parceria' },
                    { name: 'IPSOLON', category: 'PARTICIPE', keywords: 'ipsolon parceria' },
                    { name: 'Feito Por Você', category: 'PARTICIPE', keywords: 'feito você criação' }
                ];
                
                knownItems.forEach(knownItem => {
                    // Procura o elemento correspondente no DOM
                    let domElement = null;
                    
                    // Busca em botões
                    document.querySelectorAll('aside button, aside .card-menu-item').forEach(element => {
                        const elementText = element.textContent.trim();
                        if (elementText.includes(knownItem.name) || knownItem.name.includes(elementText)) {
                            if (!domElement) { // Pega apenas o primeiro encontrado
                                domElement = element;
                            }
                        }
                    });
                    
                    // Se não encontrou elemento específico, adiciona como virtual
                    if (!domElement) {
                        console.log(`⚠️ Item não encontrado no DOM: ${knownItem.name}`);
                    } else {
                        // Verifica se já não foi adicionado
                        const alreadyExists = allMenuItems.some(item => 
                            item.text.includes(knownItem.name) || knownItem.name.includes(item.text)
                        );
                        
                        if (!alreadyExists) {
                            allMenuItems.push({
                                element: domElement,
                                parent: domElement.parentElement,
                                text: knownItem.name,
                                originalText: domElement.textContent.trim(),
                                type: 'known-item',
                                categoryName: knownItem.category,
                                extraKeywords: knownItem.keywords
                            });
                        }
                    }
                });
                
                // 🎯 ESTATÍSTICAS FINAIS
                console.log(`\n📊 === RELATÓRIO FINAL DE COLETA ===`);
                console.log(`✅ Total de itens coletados: ${totalFound}`);
                console.log(`📂 Tipos encontrados:`, [...new Set(allMenuItems.map(item => item.type))]);
                
                // Estatísticas por categoria
                const categoriesStats = {};
                allMenuItems.forEach(item => {
                    const cat = item.categoryName || 'Sem categoria';
                    if (!categoriesStats[cat]) categoriesStats[cat] = 0;
                    categoriesStats[cat]++;
                });
                
                console.log(`\n📈 Itens por categoria:`);
                Object.entries(categoriesStats).forEach(([cat, count]) => {
                    console.log(`  - ${cat}: ${count} itens`);
                });
                
                // Verifica se alguns elementos importantes podem ter sido perdidos
                const missedElements = document.querySelectorAll('aside *');
                console.log(`\n🔍 Total de elementos no menu: ${missedElements.length}`);
                console.log(`📋 Taxa de cobertura: ${((totalFound / missedElements.length) * 100).toFixed(1)}%`);
                
                if (totalFound < 50) {
                    console.warn(`⚠️ ATENÇÃO: Apenas ${totalFound} itens coletados. Pode haver elementos sendo perdidos!`);
                }
                
                console.log(`\n✅ === COLETA FINALIZADA ===`);
            }
            
            // 🔄 Sistema de re-indexação automática
            function setupAutoReindexing() {
                console.log('🔄 Configurando re-indexação automática...');
                
                // Re-indexa quando novos elementos aparecem no menu
                const observer = new MutationObserver((mutations) => {
                    let shouldReindex = false;
                    
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                            // Verifica se novos elementos foram adicionados ao menu
                            mutation.addedNodes.forEach((node) => {
                                if (node.nodeType === 1 && // É um elemento
                                    (node.closest('aside') || node.querySelector('aside'))) {
                                    shouldReindex = true;
                                }
                            });
                        }
                        
                        // Verifica mudanças de atributos que podem afetar a busca
                        if (mutation.type === 'attributes' && 
                            (mutation.attributeName === 'style' || 
                             mutation.attributeName === 'data-card-name' || 
                             mutation.attributeName === 'class')) {
                            shouldReindex = true;
                        }
                    });
                    
                    if (shouldReindex) {
                        console.log('🔄 Detectadas mudanças no menu. Re-indexando...');
                        setTimeout(collectAllMenuItems, 1000); // Delay para permitir que mudanças se completem
                    }
                });
                
                // Observa mudanças no menu
                const menuElement = document.querySelector('aside');
                if (menuElement) {
                    observer.observe(menuElement, {
                        childList: true,
                        subtree: true,
                        attributes: true,
                        attributeFilter: ['style', 'data-card-name', 'class']
                    });
                    console.log('✅ Observer configurado para re-indexação automática');
                }
            }
            
            // Função para remover destaques anteriores
            function clearHighlights() {
                document.querySelectorAll('.search-highlighted-item').forEach(item => {
                    item.classList.remove('search-highlighted-item');
                });
            }
            
            // Função para expandir acordeões pais
            function expandParentAccordions(element) {
                let current = element;
                while (current && current !== document.body) {
                    // Verifica se é um acordeão fechado
                    if (current.classList.contains('accordion-content') && current.style.display === 'none') {
                        current.style.display = 'block';
                        const header = current.previousElementSibling;
                        if (header && header.classList.contains('accordion-header')) {
                            header.classList.add('active');
                            const icon = header.querySelector('.accordion-icon');
                            if (icon) icon.textContent = '▼';
                        }
                    }
                    
                    // Verifica se é um sub-acordeão fechado (CEL APPS subcategorias)
                    if (current.classList.contains('sub-accordion-content') && current.style.display === 'none') {
                        current.style.display = 'block';
                        const header = current.previousElementSibling;
                        if (header && header.classList.contains('sub-accordion-header')) {
                            header.classList.add('active');
                            const icon = header.querySelector('.sub-accordion-icon');
                            if (icon) icon.textContent = '▼';
                        }
                    }
                    
                    // Verifica se é um sub-sub-acordeão fechado
                    if (current.classList.contains('sub-sub-accordion-content') && current.style.display === 'none') {
                        current.style.display = 'block';
                        const header = current.previousElementSibling;
                        if (header && header.classList.contains('sub-sub-accordion-header')) {
                            header.classList.add('active');
                            const icon = header.querySelector('.sub-accordion-icon');
                            if (icon) icon.textContent = '▼';
                        }
                    }
                    
                    // Verifica se é um sub-acordeão fechado
                    if (current.classList.contains('sub-accordion-content') && current.style.display === 'none') {
                        current.style.display = 'block';
                        const header = current.previousElementSibling;
                        if (header && header.classList.contains('sub-accordion-header')) {
                            const icon = header.querySelector('.sub-accordion-icon');
                            if (icon) icon.textContent = '▼';
                        }
                    }
                    
                    // Verifica se é um sub-sub-acordeão fechado
                    if (current.classList.contains('sub-sub-accordion-content') && current.style.display === 'none') {
                        current.style.display = 'block';
                        const header = current.previousElementSibling;
                        if (header && header.classList.contains('sub-sub-accordion-header')) {
                            const icon = header.querySelector('.sub-accordion-icon');
                            if (icon) icon.textContent = '▼';
                        }
                    }
                    
                    current = current.parentElement;
                }
            }
            
            // Mapa de palavras-chave especiais para melhorar a busca
            const specialKeywords = {
                // Navegação e mapas
                'mapa': ['Google Maps', 'Waze'],
                'maps': ['Google Maps', 'Waze'],
                'navegação': ['Google Maps', 'Waze'],
                'trânsito': ['Google Maps', 'Waze'],
                'localização': ['Google Maps', 'Waze'],
                
                // Bancos e pagamentos
                'banco': ['Bradesco', 'Banco do Brasil', 'Caixa', 'Nubank', 'Santander', 'Itaú'],
                'dinheiro': ['Bradesco', 'Banco do Brasil', 'Caixa', 'Nubank', 'Santander', 'Itaú'],
                'pagar': ['Bradesco', 'Banco do Brasil', 'Caixa', 'Nubank', 'Santander', 'Itaú'],
                'conta': ['Bradesco', 'Banco do Brasil', 'Caixa', 'Nubank', 'Santander', 'Itaú'],
                'cartão': ['Nubank', 'Bradesco', 'Santander', 'Itaú'],
                
                // Alimentação e compras
                'comida': ['iFood', 'Pão de Açúcar'],
                'delivery': ['iFood'],
                'entrega': ['iFood'],
                'restaurante': ['iFood'],
                'mercado': ['Pão de Açúcar', 'Mercado Livre'],
                'supermercado': ['Pão de Açúcar'],
                'compras': ['Amazon', 'Shopee', 'Mercado Livre', 'Pão de Açúcar'],
                'loja': ['Amazon', 'Shopee', 'Mercado Livre'],
                'ecommerce': ['Amazon', 'Shopee', 'Mercado Livre'],
                
                // Transporte
                'transporte': ['Uber', '99'],
                'viagem': ['Uber', '99'],
                'taxi': ['Uber', '99'],
                'carro': ['Uber', '99'],
                
                // Comunicação
                'chat': ['WhatsApp', 'Telegram', 'WhatsApp Business'],
                'conversa': ['WhatsApp', 'Telegram'],
                'mensagem': ['WhatsApp', 'Telegram'],
                'email': ['Gmail'],
                'correio': ['Gmail'],
                'reunião': ['Google Meet', 'Zoom'],
                'videoconferência': ['Google Meet', 'Zoom'],
                'meet': ['Google Meet'],
                
                // Redes sociais
                'social': ['Instagram', 'Facebook', 'LinkedIn'],
                'rede': ['Instagram', 'Facebook', 'LinkedIn'],
                'foto': ['Instagram'],
                'amigos': ['Facebook'],
                'trabalho': ['LinkedIn', 'WhatsApp Business'],
                'profissional': ['LinkedIn', 'WhatsApp Business'],
                'negócio': ['WhatsApp Business'],
                
                // Entretenimento
                'vídeo': ['YouTube', 'PlutoTV'],
                'filme': ['PlutoTV'],
                'tv': ['PlutoTV'],
                'entretenimento': ['YouTube', 'PlutoTV', 'Instagram'],
                'música': ['YouTube'],
                
                // IA e tecnologia
                'ia': ['IA Prompt Wizzard', 'HumanIA', 'Chat Rosio Livia Geriah'],
                'inteligência': ['IA Prompt Wizzard', 'HumanIA'],
                'artificial': ['IA Prompt Wizzard', 'HumanIA'],
                'assistente': ['Chat Rosio Livia Geriah', 'HumanIA', 'London Lord'],
                'prompt': ['IA Prompt Wizzard'],
                'wizard': ['IA Prompt Wizzard'],
                'rosio': ['Chat Rosio Livia Geriah'],
                'livia': ['Chat Rosio Livia Geriah'],
                'london': ['London Lord'],
                
                // Ferramentas de negócio
                'formulário': ['FNW - Formulário Estratégico'],
                'estratégia': ['FNW - Formulário Estratégico'],
                'roi': ['FNW - ROI Maker'],
                'retorno': ['FNW - ROI Maker'],
                'investimento': ['FNW - ROI Maker'],
                'calculadora': ['FNW - ROI Maker'],
                'painel': ['Painel ETO'],
                'dashboard': ['Painel ETO'],
                'eto': ['Painel ETO'],
                
                // Saúde e previdência
                'saúde': ['Saúde'],
                'longevidade': ['Longevidade'],
                'idade': ['Longevidade'],
                'cnis': ['Analise CNIS', 'CNIS Suporte'],
                'previdência': ['Analise CNIS', 'CNIS Suporte'],
                'análise': ['Analise CNIS'],
                'suporte': ['CNIS Suporte'],
                
                // Parcerias
                'parceria': ['Parcerias', 'FNW Sinergias', 'IDEIA21', 'IPSOLON'],
                'fnw': ['FNW Sinergias', 'FNW - Formulário Estratégico', 'FNW - ROI Maker'],
                'sinergias': ['FNW Sinergias'],
                'ideia': ['IDEIA21'],
                'ipsolon': ['IPSOLON'],
                'feito': ['Feito Por Você'],
                'criação': ['Feito Por Você']
            };
            
            // Função principal de busca
            function performSearch(query) {
                clearHighlights();
                
                if (!query || query.length < 1) {
                    clearButton.style.display = 'none';
                    return;
                }
                
                clearButton.style.display = 'block';
                const lowerQuery = query.toLowerCase();
                let foundItems = [];
                
                // Verifica se a query corresponde a alguma palavra-chave especial
                let specialMatches = [];
                Object.keys(specialKeywords).forEach(keyword => {
                    if (keyword.includes(lowerQuery) || lowerQuery.includes(keyword)) {
                        specialMatches = specialMatches.concat(specialKeywords[keyword]);
                    }
                });
                
                // Busca nos itens coletados com múltiplos critérios
                allMenuItems.forEach(item => {
                    // Busca no texto principal
                    const textMatch = item.text.toLowerCase().includes(lowerQuery);
                    
                    // Busca no texto original (pode conter mais informações)
                    const originalTextMatch = item.originalText && item.originalText.toLowerCase().includes(lowerQuery);
                    
                    // Busca nas palavras-chave extras
                    const keywordMatch = item.extraKeywords && item.extraKeywords.toLowerCase().includes(lowerQuery);
                    
                    // Busca na categoria
                    const categoryMatch = item.categoryName && item.categoryName.toLowerCase().includes(lowerQuery);
                    
                    // Busca no cardName se existir
                    const cardNameMatch = item.cardName && item.cardName.toLowerCase().includes(lowerQuery);
                    
                    // Verifica se o item corresponde a alguma palavra-chave especial
                    const specialMatch = specialMatches.some(appName => {
                        const itemLower = item.text.toLowerCase();
                        const appNameLower = appName.toLowerCase();
                        return itemLower.includes(appNameLower) || appNameLower.includes(itemLower);
                    });
                    
                    // Busca parcial mais flexível (para nomes compostos)
                    const partialMatch = lowerQuery.length >= 3 && (
                        item.text.toLowerCase().indexOf(lowerQuery) !== -1 ||
                        (item.extraKeywords && item.extraKeywords.toLowerCase().indexOf(lowerQuery) !== -1)
                    );
                    
                    if (textMatch || originalTextMatch || keywordMatch || categoryMatch || cardNameMatch || specialMatch || partialMatch) {
                        foundItems.push(item);
                        
                        // Destaca o item
                        item.element.classList.add('search-highlighted-item');
                        
                        // Expande acordeões pais para tornar o item visível
                        expandParentAccordions(item.element);
                        
                        // Log para debug
                        console.log(`🔍 Encontrado: "${item.text}" (tipo: ${item.type})`);
                        
                        // Rola para o primeiro item encontrado
                        if (foundItems.length === 1) {
                            item.element.scrollIntoView({
                                behavior: 'smooth',
                                block: 'center'
                            });
                        }
                    }
                });
                
                console.log(`Busca por "${query}": encontrados ${foundItems.length} itens`);
                
                // Feedback visual no campo de busca
                if (foundItems.length > 0) {
                    searchInput.style.borderColor = '#4CAF50';
                    searchInput.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.3)';
                } else {
                    searchInput.style.borderColor = '#FF5722';
                    searchInput.style.boxShadow = '0 0 10px rgba(255, 87, 34, 0.3)';
                }
            }
            
            // Event listener para busca em tempo real
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                performSearch(query);
            });
            
            // Event listener para limpar busca
            clearButton.addEventListener('click', () => {
                searchInput.value = '';
                clearHighlights();
                clearButton.style.display = 'none';
                searchInput.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                searchInput.style.boxShadow = 'none';
                searchInput.focus();
            });
            
            // Event listener para tecla ESC
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    searchInput.value = '';
                    clearHighlights();
                    clearButton.style.display = 'none';
                    searchInput.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                    searchInput.style.boxShadow = 'none';
                }
            });
            
            // Coleta inicial dos itens
            collectAllMenuItems();
            
            // Ativa re-indexação automática
            setupAutoReindexing();
            
            // Re-indexa periodicamente para capturar elementos carregados dinamicamente
            setInterval(() => {
                console.log('🔄 Re-indexação periódica...');
                collectAllMenuItems();
            }, 30000); // A cada 30 segundos
            
            // Re-coleta itens quando o DOM muda (útil para itens dinâmicos)
            const observer = new MutationObserver(() => {
                setTimeout(collectAllMenuItems, 100);
            });
            
            observer.observe(document.querySelector('aside'), {
                childList: true,
                subtree: true
            });
            
            console.log('Busca em tempo real configurada com sucesso!');
            
            } catch (error) {
                console.error('Erro ao configurar busca em tempo real:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // ===== DEBUG INICIAL =====
            alert('🚀 JavaScript carregou! DOMContentLoaded executando...');
            
            const aside = document.querySelector('aside'); // Definir aside aqui para escopo
            const menuToggle = document.getElementById('menuToggle');
            const body = document.body;

            // Inicializa o menu mobile
            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    body.classList.toggle('sidebar-open');
                });
            }

            // Event listeners para modo de edição
            const editModeToggle = document.getElementById('editModeToggle');
            const confirmEditMode = document.getElementById('confirmEditMode');
            const cancelEditMode = document.getElementById('cancelEditMode');
            const editModeConfirmClose = document.getElementById('editModeConfirmClose');
            const supportLogo = document.getElementById('supportLogo');

            // LIMPEZA COMPLETA E FORÇADA - ESTADO SEMPRE LIMPO
            // Remove TODOS os estados salvos relacionados ao modo de edição
            localStorage.removeItem('editMode');
            localStorage.removeItem('toggleVisible');
            
            // Força estado inicial completamente limpo
            isEditMode = false;
            isToggleVisible = false;
            
            // Remove todas as classes e estados visuais
            body.classList.remove('edit-mode');
            document.getElementById('headerTitle').textContent = 'Acessos';
            document.getElementById('editModeToggleContainer').style.setProperty('display', 'none', 'important');
            
            // Limpa o toggle e logo
            if (editModeToggle) editModeToggle.checked = false;
            if (supportLogo) {
                supportLogo.classList.remove('toggle-visible');
                supportLogo.style.opacity = '0.4'; // Força opacidade inicial
            }
            
            // Remove classes editáveis
            removeEditableClasses();
            
            // Debug para verificar estado inicial
            console.log('Estado inicial:', {
                isEditMode: isEditMode,
                isToggleVisible: isToggleVisible,
                toggleDisplay: document.getElementById('editModeToggleContainer').style.display,
                bodyClasses: body.className
            });

            // Não restaurar NADA do localStorage - sempre começar do zero
            // Comentado para forçar estado limpo:
            // const savedToggleVisible = localStorage.getItem('toggleVisible') === 'true';
            // if (savedToggleVisible) { ... }

            // Preparando para futuras implementações de controle de acesso/pagamento

            // Clique no logo de suporte para mostrar/esconder toggle
            if (supportLogo) {
                supportLogo.addEventListener('click', () => {
                    toggleEditModeVisibility();
                });
            }

            // Toggle do modo de edição
            if (editModeToggle) {
                editModeToggle.addEventListener('change', (e) => {
                    if (e.target.checked && !isEditMode) {
                        // Tentar ativar - mostrar confirmação
                        showEditModeConfirmation();
                        // Reverter o toggle até a confirmação
                        e.target.checked = false;
                    } else if (!e.target.checked && isEditMode) {
                        // Desativar diretamente
                        toggleEditMode(false);
                    }
                });
            }

            // Confirmar ativação do modo de edição
            if (confirmEditMode) {
                confirmEditMode.addEventListener('click', () => {
                    toggleEditMode(true);
                    hideEditModeConfirmation();
                });
            }

            // Cancelar ativação do modo de edição
            if (cancelEditMode) {
                cancelEditMode.addEventListener('click', () => {
                    hideEditModeConfirmation();
                });
            }

            // Fechar modal de confirmação
            if (editModeConfirmClose) {
                editModeConfirmClose.addEventListener('click', () => {
                    hideEditModeConfirmation();
                });
            }

            // Adiciona um listener para cliques fora da sidebar quando ela está aberta
            document.addEventListener('click', (event) => {
                if (body.classList.contains('sidebar-open') &&
                    !aside.contains(event.target) &&
                    !menuToggle.contains(event.target) &&
                    !event.target.closest('#searchResults')) {
                    closeSidebar();
                }
            });

            adjustForEmbeddedMode(); 
            fetchCategories();
            renderMeusAppsCategoriesSidebar(); // Adicionando chamada para renderizar a nova categoria 'MeusApps'
            // renderPaiCategoriesSidebar(); // COMENTADO: Não sobrescrever estrutura HTML customizada
            // renderSuporteIaSubcategoriesSidebar(); // COMENTADO: Não sobrescrever estrutura HTML customizada
            // renderParticipeCategoriesSidebar(); // COMENTADO: Não sobrescrever estrutura HTML customizada
            renderVideosCategoriesSidebar(); // Adicionando chamada para renderizar a nova categoria 'Videos'
            
            // ================ INICIALIZAÇÃO FAVORITOS ================
            console.log('🚀 JavaScript executando...');
            
            // Inicializar lista de favoritos
            setTimeout(() => {
                updateFavoritesList();
                console.log('✅ Lista de favoritos inicializada');
            }, 1000);
            
            // Inicializar busca em tempo real
            setupRealTimeMenuSearch();

            const paiModal = document.getElementById('paiModal');
            const paiModalClose = document.getElementById('paiModalClose');
            const paiModalIframe = document.getElementById('paiModalIframe');

            if (paiModal && paiModalClose && paiModalIframe) {
                paiModalClose.addEventListener('click', () => {
                    paiModal.classList.add('hidden');
                    paiModalIframe.src = 'about:blank'; // Limpa o iframe para parar carregamento
                });
            }

            // Event listeners para o modal de app
            const appModal = document.getElementById('appModal');
            const appModalClose = document.getElementById('appModalClose');

            if (appModal && appModalClose) {
                appModalClose.addEventListener('click', () => {
                    appModal.classList.add('hidden');
                });
            }

            // Accordion functionality for sidebar
            document.querySelectorAll('aside .accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('.accordion-icon');
                    const isMeusAppsHeader = header.textContent.trim().startsWith('Meus Apps');
                    const isPaiHeader = header.textContent.trim().startsWith('EXCLUSIVO');
                    const isParticipeHeader = header.textContent.trim().startsWith('Participe');
                    
                    if (!content) return;

                    const isVisible = content.style.display === 'block';
                    
                    // Remove active de todos os cabeçalhos principais
                    document.querySelectorAll('aside .accordion-header').forEach(h => {
                        if (h !== header) {
                            h.classList.remove('active');
                        }
                    });
                    
                    document.querySelectorAll('aside .accordion-content').forEach(c => {
                        if (c !== content) {
                            c.style.display = 'none';
                            const otherIcon = c.previousElementSibling.querySelector('.accordion-icon');
                            if (otherIcon) otherIcon.textContent = '►';
                        }
                    });

                    content.style.display = isVisible ? 'none' : 'block';
                    if (icon) {
                        icon.textContent = isVisible ? '►' : '▼';
                    }
                    
                    // Adiciona ou remove active do cabeçalho clicado
                    if (isVisible) {
                        header.classList.remove('active');
                    } else {
                        header.classList.add('active');
                    }

                    // Mensagens específicas para cada categoria principal
                    if (isMeusAppsHeader && !isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma subcategoria de Meus Apps na lista.</p>';
                    } else if (isMeusAppsHeader && isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione um conteúdo ou ferramenta ao lado.</p>';
                    } else if (isPaiHeader && !isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma categoria dentro de EXCLUSIVO na lista.</p>';
                    } else if (isPaiHeader && isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione um conteúdo ou ferramenta ao lado.</p>';
                    } else if (isParticipeHeader && !isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma opção da categoria Participe na lista.</p>';
                    } else if (isParticipeHeader && isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma opção da categoria Participe na lista.</p>';
                    }
                });
            });

            // Sub-accordion functionality for PAI category
            document.querySelectorAll('.sub-accordion-header').forEach(subHeader => {
                subHeader.addEventListener('click', () => {
                    const subContent = subHeader.nextElementSibling;
                    const subIcon = subHeader.querySelector('.sub-accordion-icon');
                    const subHeaderText = subHeader.textContent.trim();
                    
                    if (!subContent) return;

                    const isSubVisible = subContent.style.display === 'block';
                    
                    // Fecha todos os outros sub-acordeões
                    document.querySelectorAll('.sub-accordion-content').forEach(c => {
                        if (c !== subContent) {
                            c.style.display = 'none';
                            const otherSubIcon = c.previousElementSibling.querySelector('.sub-accordion-icon');
                            if (otherSubIcon) otherSubIcon.textContent = '►';
                            c.previousElementSibling.classList.remove('active');
                        }
                    });

                    subContent.style.display = isSubVisible ? 'none' : 'block';
                    if (subIcon) {
                        subIcon.textContent = isSubVisible ? '►' : '▼';
                    }
                    
                    if (isSubVisible) {
                        subHeader.classList.remove('active');
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma categoria dentro de EXCLUSIVO na lista.</p>';
                    } else {
                        subHeader.classList.add('active');
                        
                        // Mensagens específicas para cada sub-categoria
                        if (subHeaderText.startsWith('Videos Disponíveis')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma opção da categoria Videos Disponíveis na lista.</p>';
                        } else if (subHeaderText.startsWith('Conteúdo de Apoio')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma categoria ao lado para ver os recursos.</p>';
                        } else if (subHeaderText.startsWith('Ferramentas')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma subcategoria de Ferramentas & Negócios na lista.</p>';
                        } else if (subHeaderText.startsWith('Suporte - IA')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma subcategoria de Suporte - IA na lista.</p>';
                        } else if (subHeaderText.startsWith('Parcerias')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma subcategoria de Parcerias na lista.</p>';
                        }
                    }
                });
            });

            // Sub-sub-accordion functionality (Terceiro Nível)
            document.querySelectorAll('.sub-sub-accordion-header').forEach(subSubHeader => {
                subSubHeader.addEventListener('click', () => {
                    const subSubContent = subSubHeader.nextElementSibling;
                    const subSubIcon = subSubHeader.querySelector('.sub-accordion-icon');
                    const subSubHeaderText = subSubHeader.textContent.trim();
                    
                    if (!subSubContent) return;

                    const isSubSubVisible = subSubContent.style.display === 'block';
                    
                    // Fecha todos os outros sub-sub-acordeões
                    document.querySelectorAll('.sub-sub-accordion-content').forEach(c => {
                        if (c !== subSubContent) {
                            c.style.display = 'none';
                            const otherSubSubIcon = c.previousElementSibling.querySelector('.sub-accordion-icon');
                            if (otherSubSubIcon) otherSubSubIcon.textContent = '►';
                            c.previousElementSibling.classList.remove('active');
                        }
                    });

                    subSubContent.style.display = isSubSubVisible ? 'none' : 'block';
                    if (subSubIcon) {
                        subSubIcon.textContent = isSubSubVisible ? '►' : '▼';
                    }
                    
                    if (isSubSubVisible) {
                        subSubHeader.classList.remove('active');
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione um card na lista.</p>';
                    } else {
                        subSubHeader.classList.add('active');
                        
                        // Mensagens específicas para cada sub-sub-categoria
                        if (subSubHeaderText.startsWith('FNW Assessoria')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma ferramenta da FNW Assessoria na lista.</p>';
                        } else if (subSubHeaderText.startsWith('50+ | Maduros')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione um recurso para Maduros e Idosos na lista.</p>';
                        } else if (subSubHeaderText.startsWith('Assistentes')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione um assistente de IA na lista.</p>';
                        } else if (subSubHeaderText.startsWith('Empresas Parceiras')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma empresa parceira na lista.</p>';
                        }
                    }
                });
            });

            // Card menu items functionality
            document.querySelectorAll('.card-menu-item').forEach(cardItem => {
                cardItem.addEventListener('click', () => {
                    const cardName = cardItem.getAttribute('data-card-name');
                    
                    // Remove active de todos os card-menu-items
                    document.querySelectorAll('.card-menu-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // Adiciona active ao item clicado
                    cardItem.classList.add('active');
                    
                    // Procura pelo card correspondente na área principal
                    const realCard = Array.from(document.querySelectorAll('.card, .course-card, .resource-card')).find(card => {
                        const cardTitle = card.querySelector('h3, .card-title, .course-title');
                        return cardTitle && cardTitle.textContent.trim() === cardName;
                    });
                    
                    if (realCard) {
                        // Simula um clique no card da área principal
                        realCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        
                        // Adiciona destaque temporário
                        realCard.classList.add('card-highlighted');
                        setTimeout(() => {
                            realCard.classList.remove('card-highlighted');
                        }, 2000);
                        
                        // Se o card for clicável, simula o clique
                        if (realCard.onclick || realCard.getAttribute('onclick')) {
                            realCard.click();
                        }
                    } else {
                        // Se não encontrar o card, mostra uma mensagem
                        document.getElementById('coursesContainer').innerHTML = `
                            <p class="instruction-message">
                                🔍 Procurando por "${cardName}"...<br>
                                <small>Este card pode estar em outra categoria ou ainda não foi carregado.</small>
                            </p>
                        `;
                    }
                    
                    // Fecha o sidebar no mobile
                    closeSidebar();
                });
            });

            // Event listeners para o Modal de Edição Individual
            const itemEditClose = document.getElementById('itemEditClose');
            const cancelItemEdit = document.getElementById('cancelItemEdit');
            const saveItemEdit = document.getElementById('saveItemEdit');

            if (itemEditClose) {
                itemEditClose.addEventListener('click', closeItemEditModal);
            }

            if (cancelItemEdit) {
                cancelItemEdit.addEventListener('click', closeItemEditModal);
            }

            if (saveItemEdit) {
                saveItemEdit.addEventListener('click', () => {
                    saveItemEditData();
                });
            }

            // Carrega dados personalizados salvos
            loadCustomItemData();

            // Event listeners para modal de edição de cards
            document.getElementById('cardEditModalClose').addEventListener('click', closeCardEditModal);
            document.getElementById('cancelCardEdit').addEventListener('click', closeCardEditModal);
            document.getElementById('saveCardEdit').addEventListener('click', saveCardEdit);

            // Fecha modal de edição de cards ao clicar fora
            document.getElementById('cardEditModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCardEditModal();
                }
            });

            // Carrega dados personalizados
            loadCustomItemData();

            // Event listeners para modal de edição de itens simples
            document.getElementById('simpleItemEditModalClose').addEventListener('click', closeSimpleItemEditModal);
            document.getElementById('cancelSimpleItemEdit').addEventListener('click', closeSimpleItemEditModal);
            document.getElementById('saveSimpleItemEdit').addEventListener('click', saveSimpleItemEdit);

            // Fecha modal de edição de itens simples ao clicar fora
            document.getElementById('simpleItemEditModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSimpleItemEditModal();
                }
            });

            // Carrega dados personalizados
            loadCustomItemData();
            
            // Event listeners para modal de adicionar favorito
            document.getElementById('addFavoriteModalClose').addEventListener('click', closeAddFavoriteModal);
            document.getElementById('cancelAddFavorite').addEventListener('click', closeAddFavoriteModal);
            document.getElementById('saveAddFavorite').addEventListener('click', saveNewFavorite);

            // Event listeners para o modal de substituição
            document.getElementById('replaceFavoriteClose').addEventListener('click', closeReplaceFavoriteModal);
            document.getElementById('cancelReplace').addEventListener('click', closeReplaceFavoriteModal);

            // Fecha modal de adicionar favorito ao clicar fora
            document.getElementById('addFavoriteModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddFavoriteModal();
                }
            });
            
            // Criar índice de busca após tudo estar carregado
            setTimeout(() => {
                createMenuSearchIndex();
                setupCardMenuEventListeners(); // Adiciona event listeners para os card-menu-items
                setupCardKeyboardNavigation(); // Ativa navegação por teclado
                setupBidirectionalSync(); // Sincronização bidirecional
                console.log('🔍 Índice de busca criado após estrutura HTML estar pronta');
                console.log('⌨️ Navegação por teclado ativada (setas + Enter)');
                console.log('🔄 Sincronização bidirecional ativada');
            }, 1000);
        });

        // Função para configurar event listeners dos card-menu-items
        function setupCardMenuEventListeners() {
            console.log('🎯 Configurando event listeners para card-menu-items...');
            
            // Remove event listeners anteriores para evitar duplicação
            document.querySelectorAll('.card-menu-item').forEach(cardItem => {
                cardItem.replaceWith(cardItem.cloneNode(true));
            });
            
            // Adiciona novos event listeners
            document.querySelectorAll('.card-menu-item').forEach(cardItem => {
                cardItem.addEventListener('click', () => {
                    const cardName = cardItem.getAttribute('data-card-name');
                    console.log('🎯 Card menu clicado:', cardName);
                    
                    // SINCRONIZAÇÃO: Atualiza estado do menu
                    syncMenuSelection(cardName);
                    
                    // Procura pelo card correspondente na área principal
                    const realCard = Array.from(document.querySelectorAll('.card, .course-card, .resource-card')).find(card => {
                        const cardTitle = card.querySelector('h3, .card-title, .course-title');
                        return cardTitle && cardTitle.textContent.trim() === cardName;
                    });
                    
                    if (realCard) {
                        console.log('✅ Card encontrado na área principal:', cardName);
                        // Centraliza o card no carrossel
                        centerCardInCarousel(realCard);
                        
                        // Adiciona destaque temporário
                        realCard.classList.add('card-highlighted');
                        setTimeout(() => {
                            realCard.classList.remove('card-highlighted');
                        }, 2000);
                    } else {
                        console.log('❌ Card não encontrado na área principal:', cardName);
                        // Tenta carregar a categoria correspondente primeiro
                        loadCardCategory(cardName);
                    }
                    
                    // Fecha o sidebar no mobile
                    closeSidebar();
                });
            });
            
            console.log('✅ Event listeners configurados para', document.querySelectorAll('.card-menu-item').length, 'card-menu-items');
        }

        // Função para sincronizar seleção do menu
        function syncMenuSelection(cardName) {
            console.log('🔄 Sincronizando seleção do menu para:', cardName);
            
            // Remove active de todos os card-menu-items
            document.querySelectorAll('.card-menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Remove destaque de todos os cards
            document.querySelectorAll('.course-card, .card, .resource-card').forEach(card => {
                card.classList.remove('card-selected');
            });
            
            // Busca EXATA por correspondência no menu
            const targetMenuItem = Array.from(document.querySelectorAll('.card-menu-item')).find(item => {
                const itemCardName = item.getAttribute('data-card-name');
                return itemCardName && itemCardName.trim() === cardName.trim();
            });
            
            if (targetMenuItem) {
                targetMenuItem.classList.add('active');
                console.log('✅ Menu item ativado:', cardName);
                
                // Expande o caminho do menu até o item se necessário
                expandMenuPathToItem(targetMenuItem);
                
                // Scroll suave até o item no menu
                targetMenuItem.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center',
                    inline: 'nearest'
                });
            } else {
                console.log('⚠️ Menu item não encontrado para:', cardName);
                // Lista todos os card-menu-items disponíveis para debug
                const availableItems = Array.from(document.querySelectorAll('.card-menu-item')).map(item => 
                    item.getAttribute('data-card-name')
                );
                console.log('📋 Itens disponíveis no menu:', availableItems);
            }
            
            // Busca EXATA por correspondência no card
            const targetCard = Array.from(document.querySelectorAll('.course-card, .card, .resource-card')).find(card => {
                const cardTitle = card.querySelector('h3, .card-title, .course-title');
                return cardTitle && cardTitle.textContent.trim() === cardName.trim();
            });
            
            if (targetCard) {
                targetCard.classList.add('card-selected');
                console.log('✅ Card destacado:', cardName);
                
                // Centraliza o card no carrossel
                centerCardInCarousel(targetCard);
            } else {
                console.log('⚠️ Card não encontrado na área principal para:', cardName);
                // Lista todos os cards disponíveis para debug
                const availableCards = Array.from(document.querySelectorAll('.course-card, .card, .resource-card')).map(card => {
                    const cardTitle = card.querySelector('h3, .card-title, .course-title');
                    return cardTitle ? cardTitle.textContent.trim() : 'Sem título';
                });
                console.log('📋 Cards disponíveis na área principal:', availableCards);
            }
            
            // Atualiza estado global
            window.currentSelectedCard = cardName;
            
            // Dispara evento personalizado para outros componentes
            window.dispatchEvent(new CustomEvent('cardSelectionChanged', { 
                detail: { cardName: cardName } 
            }));
        }

        // Função para expandir o caminho do menu até um item específico
        function expandMenuPathToItem(menuItem) {
            console.log('🔍 Expandindo caminho do menu até o item...');
            
            // Encontra todos os containers pais que precisam estar expandidos
            let currentElement = menuItem;
            const containersToExpand = [];
            
            while (currentElement && currentElement !== document.body) {
                // Verifica se é um accordion content que precisa estar visível
                if (currentElement.classList.contains('sub-sub-accordion-content') ||
                    currentElement.classList.contains('sub-accordion-content') ||
                    currentElement.classList.contains('accordion-content')) {
                    
                    const header = currentElement.previousElementSibling;
                    if (header && currentElement.style.display === 'none') {
                        containersToExpand.push(header);
                    }
                }
                currentElement = currentElement.parentElement;
            }
            
            // Expande os containers na ordem correta (do mais externo para o mais interno)
            containersToExpand.reverse().forEach((header, index) => {
                setTimeout(() => {
                    if (header.click) {
                        console.log('🔓 Expandindo container:', header.textContent.trim());
                        header.click();
                    }
                }, index * 100); // Pequeno delay entre cada expansão
            });
        }

        // Função para navegar entre cards com teclado
        function setupCardKeyboardNavigation() {
            document.addEventListener('keydown', (e) => {
                const currentCards = document.querySelectorAll('.course-card');
                const currentActive = document.querySelector('.card-menu-item.active');
                
                if (currentCards.length === 0) return;
                
                let currentIndex = -1;
                if (currentActive) {
                    const activeCardName = currentActive.getAttribute('data-card-name');
                    currentIndex = Array.from(currentCards).findIndex(card => {
                        const cardTitle = card.querySelector('h3');
                        return cardTitle && cardTitle.textContent.trim() === activeCardName;
                    });
                }
                
                let newIndex = currentIndex;
                
                // Navegação com setas
                if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                    e.preventDefault();
                    newIndex = (currentIndex + 1) % currentCards.length;
                } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                    e.preventDefault();
                    newIndex = currentIndex <= 0 ? currentCards.length - 1 : currentIndex - 1;
                } else if (e.key === 'Enter' && currentIndex >= 0) {
                    e.preventDefault();
                    currentCards[currentIndex].click();
                    return;
                }
                
                // Atualiza seleção se mudou
                if (newIndex !== currentIndex && newIndex >= 0) {
                    const newCard = currentCards[newIndex];
                    const newCardTitle = newCard.querySelector('h3');
                    if (newCardTitle) {
                        const cardName = newCardTitle.textContent.trim();
                        syncMenuSelection(cardName);
                        
                        // Destaca o card visualmente e centraliza no carrossel
                        centerCardInCarousel(newCard);
                        newCard.classList.add('card-highlighted');
                        setTimeout(() => {
                            newCard.classList.remove('card-highlighted');
                        }, 1000);
                        
                        console.log('⌨️ Navegação por teclado:', cardName);
                    }
                }
            });
        }

        // Função para configurar sincronização bidirecional
        function setupBidirectionalSync() {
            console.log('🔄 Configurando sincronização bidirecional...');
            
            // Observer para detectar quando novos cards são adicionados
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === 1) { // Element node
                                // Procura por cards recém-adicionados
                                const newCards = node.querySelectorAll ? 
                                    node.querySelectorAll('.course-card, .card, .resource-card') :
                                    (node.classList && (node.classList.contains('course-card') || 
                                                       node.classList.contains('card') || 
                                                       node.classList.contains('resource-card')) ? [node] : []);
                                
                                newCards.forEach(card => {
                                    addCardSyncListener(card);
                                });
                            }
                        });
                    }
                });
            });
            
            // Observa mudanças no container principal
            const mainContent = document.querySelector('.main-content, .content-area, .cards-container');
            if (mainContent) {
                observer.observe(mainContent, { childList: true, subtree: true });
            }
            
            // Adiciona listeners aos cards existentes
            document.querySelectorAll('.course-card, .card, .resource-card').forEach(card => {
                addCardSyncListener(card);
            });
            
            console.log('✅ Sincronização bidirecional configurada');
        }

        // Função para adicionar listener de sincronização a um card
        function addCardSyncListener(card) {
            // Evita duplicar listeners
            if (card._syncListenerAdded) return;
            card._syncListenerAdded = true;
            
            // Listener para cliques no card
            card.addEventListener('click', () => {
                const cardTitle = card.querySelector('h3, .card-title, .course-title');
                if (cardTitle) {
                    const cardName = cardTitle.textContent.trim();
                    console.log('🎯 Card clicado na área principal:', cardName);
                    
                    // Sincroniza com o menu
                    syncMenuSelection(cardName);
                }
            });
            
            // Listener para hover no card
            card.addEventListener('mouseenter', () => {
                const cardTitle = card.querySelector('h3, .card-title, .course-title');
                if (cardTitle) {
                    const cardName = cardTitle.textContent.trim();
                    
                    // Destaca o item correspondente no menu
                    const menuItem = document.querySelector(`.card-menu-item[data-card-name="${cardName}"]`);
                    if (menuItem) {
                        menuItem.classList.add('menu-hover-highlight');
                    }
                }
            });
            
            card.addEventListener('mouseleave', () => {
                // Remove destaque do menu
                document.querySelectorAll('.card-menu-item').forEach(item => {
                    item.classList.remove('menu-hover-highlight');
                });
            });
        }

        // Função para centralizar card no carrossel
        function centerCardInCarousel(targetCard) {
            console.log('🎯 Centralizando card no carrossel...', targetCard);
            
            // Primeiro, tenta encontrar o container do carrossel
            let carouselTrack = targetCard.closest('.carousel-track');
            
            // Se não encontrou, procura por containers de scroll horizontal
            if (!carouselTrack) {
                carouselTrack = targetCard.closest('.cards-container, .content-area, main');
                console.log('🔍 Usando container alternativo:', carouselTrack);
            }
            
            if (!carouselTrack) {
                console.log('⚠️ Container de scroll não encontrado, usando scroll padrão');
                targetCard.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center',
                    inline: 'center'
                });
                return;
            }
            
            // Aguarda um pouco para garantir que o DOM está atualizado
            setTimeout(() => {
                // Recalcula posições após o delay
                const cardRect = targetCard.getBoundingClientRect();
                const containerRect = carouselTrack.getBoundingClientRect();
                
                // Posição atual do scroll
                const currentScrollLeft = carouselTrack.scrollLeft;
                
                // Posição do card em relação ao container
                const cardOffsetLeft = targetCard.offsetLeft;
                
                // Largura do container visível
                const containerWidth = carouselTrack.clientWidth;
                
                // Largura do card
                const cardWidth = targetCard.offsetWidth;
                
                // Calcula a posição para centralizar o card
                const targetScrollLeft = cardOffsetLeft - (containerWidth / 2) + (cardWidth / 2);
                
                console.log('📊 Dados detalhados do carrossel:', {
                    cardName: targetCard.querySelector('h3, .card-title, .course-title')?.textContent?.trim(),
                    cardOffsetLeft,
                    containerWidth,
                    cardWidth,
                    currentScrollLeft,
                    targetScrollLeft,
                    cardRect,
                    containerRect
                });
                
                // Método 1: scrollTo com comportamento suave
                if (carouselTrack.scrollTo) {
                    carouselTrack.scrollTo({
                        left: Math.max(0, targetScrollLeft),
                        behavior: 'smooth'
                    });
                    console.log('✅ Usando scrollTo para centralizar');
                } else {
                    // Método 2: scrollLeft com animação manual
                    const startScrollLeft = carouselTrack.scrollLeft;
                    const distance = Math.max(0, targetScrollLeft) - startScrollLeft;
                    const duration = 500;
                    const startTime = Date.now();
                    
                    function animateScroll() {
                        const elapsed = Date.now() - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        
                        // Easing function (ease-out)
                        const easeOut = 1 - Math.pow(1 - progress, 3);
                        
                        carouselTrack.scrollLeft = startScrollLeft + (distance * easeOut);
                        
                        if (progress < 1) {
                            requestAnimationFrame(animateScroll);
                        }
                    }
                    
                    animateScroll();
                    console.log('✅ Usando animação manual para centralizar');
                }
                
                // Também faz scroll vertical se necessário
                targetCard.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center',
                    inline: 'nearest'
                });
                
                console.log('✅ Card centralizado no carrossel');
                
            }, 100); // Pequeno delay para garantir que o DOM está atualizado
        }

        // Função para carregar a categoria do card
        function loadCardCategory(cardName) {
            console.log('🔄 Tentando carregar categoria para:', cardName);
            
            // MAPEAMENTO PRECISO E DIRETO - Cada card tem seu caminho exato no menu
            const cardNavigationMap = {
                // EXCLUSIVO → Ferramentas & Negócios → FNW Assessoria
                'FNW - Formulário Estratégico': {
                    category: 'EXCLUSIVO',
                    subcategory: 'Ferramentas & Negócios', 
                    subsubcategory: 'FNW Assessoria',
                    dataSource: 'paiCategoriesData',
                    dataKey: 'FNW Assessoria'
                },
                'FNW - ROI Maker': {
                    category: 'EXCLUSIVO',
                    subcategory: 'Ferramentas & Negócios',
                    subsubcategory: 'FNW Assessoria',
                    dataSource: 'paiCategoriesData',
                    dataKey: 'FNW Assessoria'
                },
                'Painel ETO': {
                    category: 'EXCLUSIVO',
                    subcategory: 'Ferramentas & Negócios',
                    subsubcategory: 'FNW Assessoria',
                    dataSource: 'paiCategoriesData',
                    dataKey: 'FNW Assessoria'
                },
                
                // EXCLUSIVO → Ferramentas & Negócios → 50+ | Maduros e Idosos
                'Longevidade': {
                    category: 'EXCLUSIVO',
                    subcategory: 'Ferramentas & Negócios',
                    subsubcategory: '50+ | Maduros e Idosos',
                    dataSource: 'paiCategoriesData',
                    dataKey: '50+ | Maduros e Idosos'
                },
                'Analise CNIS': {
                    category: 'EXCLUSIVO',
                    subcategory: 'Ferramentas & Negócios',
                    subsubcategory: '50+ | Maduros e Idosos',
                    dataSource: 'paiCategoriesData',
                    dataKey: '50+ | Maduros e Idosos'
                },
                'CNIS Suporte': {
                    category: 'EXCLUSIVO',
                    subcategory: 'Ferramentas & Negócios',
                    subsubcategory: '50+ | Maduros e Idosos',
                    dataSource: 'paiCategoriesData',
                    dataKey: '50+ | Maduros e Idosos'
                },
                
                // EXCLUSIVO → Suporte - IA → Wizzards
                'IA Prompt Wizzard': {
                    category: 'EXCLUSIVO',
                    subcategory: 'Suporte - IA',
                    subsubcategory: 'Wizzards',
                    dataSource: 'suporteIaCategoriesData',
                    dataKey: 'Wizzards'
                },
                
                // EXCLUSIVO → Suporte - IA → Assistentes
                'Chat Rosio Livia Geriah': {
                    category: 'EXCLUSIVO',
                    subcategory: 'Suporte - IA',
                    subsubcategory: 'Assistentes',
                    dataSource: 'suporteIaCategoriesData',
                    dataKey: 'Assistentes'
                },
                'HumanIA': {
                    category: 'EXCLUSIVO',
                    subcategory: 'Suporte - IA',
                    subsubcategory: 'Assistentes',
                    dataSource: 'suporteIaCategoriesData',
                    dataKey: 'Assistentes'
                },
                'London Lord': {
                    category: 'EXCLUSIVO',
                    subcategory: 'Suporte - IA',
                    subsubcategory: 'Assistentes',
                    dataSource: 'suporteIaCategoriesData',
                    dataKey: 'Assistentes'
                },
                
                // PARTICIPE → Parcerias → Empresas Parceiras
                'FNW Sinergias': {
                    category: 'PARTICIPE',
                    subcategory: 'Parcerias',
                    subsubcategory: 'Empresas Parceiras',
                    dataSource: 'participeCategoriesData',
                    dataKey: 'Parcerias'
                },
                'IDEIA21': {
                    category: 'PARTICIPE',
                    subcategory: 'Parcerias',
                    subsubcategory: 'Empresas Parceiras',
                    dataSource: 'participeCategoriesData',
                    dataKey: 'Parcerias'
                },
                'IPSOLON': {
                    category: 'PARTICIPE',
                    subcategory: 'Parcerias',
                    subsubcategory: 'Empresas Parceiras',
                    dataSource: 'participeCategoriesData',
                    dataKey: 'Parcerias'
                },
                
                // PARTICIPE → Parcerias → Feito Por Você
                'Feito Por Você': {
                    category: 'PARTICIPE',
                    subcategory: 'Parcerias',
                    subsubcategory: 'Feito Por Você',
                    dataSource: 'participeCategoriesData',
                    dataKey: 'Feito Por Você'
                }
            };
            
            const cardInfo = cardNavigationMap[cardName];
            if (cardInfo) {
                console.log(`🎯 NAVEGAÇÃO PRECISA: ${cardName}`);
                console.log(`📍 Caminho: ${cardInfo.category} → ${cardInfo.subcategory} → ${cardInfo.subsubcategory}`);
                console.log(`🗂️ Fonte de dados: ${cardInfo.dataSource} → ${cardInfo.dataKey}`);
                
                // PASSO 1: Abrir categoria principal (EXCLUSIVO/PARTICIPE)
                const categoryButton = Array.from(document.querySelectorAll('.accordion-header')).find(header => 
                    header.textContent.includes(cardInfo.category)
                );
                
                if (categoryButton) {
                    const categoryContent = categoryButton.parentElement.querySelector('.accordion-content');
                    if (categoryContent && categoryContent.style.display === 'none') {
                        console.log('🔓 PASSO 1: Abrindo categoria principal:', cardInfo.category);
                        categoryButton.click();
                    }
                    
                    // PASSO 2: Abrir subcategoria (Ferramentas & Negócios / Suporte - IA / Parcerias)
                    setTimeout(() => {
                        const subcategoryButton = Array.from(document.querySelectorAll('.sub-accordion-header')).find(header => 
                            header.textContent.includes(cardInfo.subcategory)
                        );
                        
                        if (subcategoryButton) {
                            const subcategoryContent = subcategoryButton.parentElement.querySelector('.sub-accordion-content');
                            if (subcategoryContent && subcategoryContent.style.display === 'none') {
                                console.log('🔓 PASSO 2: Abrindo subcategoria:', cardInfo.subcategory);
                                subcategoryButton.click();
                            }
                            
                            // PASSO 3: Abrir sub-subcategoria (FNW Assessoria / 50+ / Wizzards / etc)
                            setTimeout(() => {
                                const subsubcategoryButton = Array.from(document.querySelectorAll('.sub-sub-accordion-header')).find(header => 
                                    header.textContent.includes(cardInfo.subsubcategory)
                                );
                                
                                if (subsubcategoryButton) {
                                    const subsubcategoryContent = subsubcategoryButton.parentElement.querySelector('.sub-sub-accordion-content');
                                    if (subsubcategoryContent && subsubcategoryContent.style.display === 'none') {
                                        console.log('🔓 PASSO 3: Abrindo sub-subcategoria:', cardInfo.subsubcategory);
                                        subsubcategoryButton.click();
                                    }
                                }
                                
                                // PASSO 4: Carregar dados e renderizar cards
                                setTimeout(() => {
                                    let dataSource = null;
                                    
                                    // Buscar dados da fonte correta
                                    if (cardInfo.dataSource === 'paiCategoriesData') {
                                        dataSource = paiCategoriesData.find(cat => cat.name === cardInfo.dataKey);
                                    } else if (cardInfo.dataSource === 'suporteIaCategoriesData') {
                                        dataSource = suporteIaCategoriesData.find(cat => cat.name === cardInfo.dataKey);
                                    } else if (cardInfo.dataSource === 'participeCategoriesData') {
                                        dataSource = participeCategoriesData.find(cat => cat.name === cardInfo.dataKey);
                                    }
                                    
                                    if (dataSource) {
                                        console.log('✅ PASSO 4: Carregando dados de:', cardInfo.dataSource, '→', cardInfo.dataKey);
                                        displayPaiCategoryItems(dataSource, cardInfo.category);
                                        
                                        // PASSO 5: Destacar card específico
                                        setTimeout(() => {
                                            const realCard = Array.from(document.querySelectorAll('.course-card')).find(card => {
                                                const cardTitle = card.querySelector('h3');
                                                return cardTitle && cardTitle.textContent.trim() === cardName;
                                            });
                                            
                                            if (realCard) {
                                                console.log('🎯 SUCESSO: Card encontrado e destacado:', cardName);
                                                realCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                                realCard.classList.add('card-highlighted');
                                                setTimeout(() => {
                                                    realCard.classList.remove('card-highlighted');
                                                }, 2000);
                                            } else {
                                                console.log('❌ ERRO: Card não encontrado após navegação completa:', cardName);
                                            }
                                        }, 400);
                                    } else {
                                        console.log('❌ ERRO: Fonte de dados não encontrada:', cardInfo.dataSource, cardInfo.dataKey);
                                    }
                                }, 200);
                            }, 200);
                        } else {
                            console.log('❌ ERRO: Subcategoria não encontrada no DOM:', cardInfo.subcategory);
                        }
                    }, 200);
                } else {
                    console.log('❌ ERRO: Categoria principal não encontrada no DOM:', cardInfo.category);
                }
            } else {
                console.log('❌ Mapeamento não encontrado para card:', cardName);
                // Mostra mensagem de busca
                document.getElementById('coursesContainer').innerHTML = `
                    <p class="instruction-message">
                        🔍 Procurando por "${cardName}"...<br>
                        <small>Este card pode estar em outra categoria ou ainda não foi carregado.</small>
                    </p>
                `;
            }
        }

        function renderPaiCategoriesSidebar() {
            const paiListUl = document.getElementById('paiItemsList');
            paiListUl.innerHTML = ''; // Limpa itens anteriores, como "Nenhum item P.A.I configurado."

            if (!paiCategoriesData || paiCategoriesData.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Nenhuma categoria P.A.I. configurada.';
                paiListUl.appendChild(li);
                return;
            }

            paiCategoriesData.forEach(paiCategory => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                btn.textContent = paiCategory.name;
                // Adiciona a classe 'active' ao primeiro botão por padrão ou com base em estado salvo
                // if (index === 0) btn.classList.add('active'); 

                btn.addEventListener('click', () => {
                    // Remove 'active' de todos os botões P.A.I.
                    paiListUl.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                    // Adiciona 'active' ao botão clicado
                    btn.classList.add('active');
                    // Exibe os itens da categoria P.A.I. selecionada
                    displayPaiCategoryItems(paiCategory, "EXCLUSIVO"); // Passa o nome da categoria pai
                    closeSidebar(); // Fechar sidebar após selecionar categoria P.A.I.
                });

                li.appendChild(btn);
                paiListUl.appendChild(li);
            });
        }

        function renderParticipeCategoriesSidebar() {
            const participeListUl = document.getElementById('participeItemsList');
            participeListUl.innerHTML = '';

            if (!participeCategoriesData || participeCategoriesData.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Nenhuma categoria de Participação configurada.';
                participeListUl.appendChild(li);
                return;
            }

            participeCategoriesData.forEach(participeCategory => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                btn.textContent = participeCategory.name;

                btn.addEventListener('click', () => {
                    participeListUl.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    displayPaiCategoryItems(participeCategory, "Participe"); // Passa o nome da categoria pai
                    closeSidebar();
                });

                li.appendChild(btn);
                participeListUl.appendChild(li);
            });
        }

        function renderMeusAppsCategoriesSidebar() {
            console.log('renderMeusAppsCategoriesSidebar chamada, isEditMode:', isEditMode); // Debug
            // Agora os sub-acordeões são renderizados diretamente no HTML
            // Esta função renderiza os conteúdos de cada sub-acordeão

            // Renderizar Saúde
            const saudeUl = document.getElementById('saudeItemsList');
            const saudeData = meusAppsCategoriesData.find(cat => cat.name === "Saúde");
            renderSubCategoryItems(saudeUl, saudeData);

            // Renderizar Comunicar
            const comunicacaoUl = document.getElementById('comunicacaoItemsList');
            const comunicacaoData = meusAppsCategoriesData.find(cat => cat.name === "Comunicar");
            renderSubCategoryItems(comunicacaoUl, comunicacaoData);

            // Renderizar Banco
            const bancoUl = document.getElementById('bancoItemsList');
            const bancoData = meusAppsCategoriesData.find(cat => cat.name === "Banco");
            renderSubCategoryItems(bancoUl, bancoData);

            // Renderizar Alimentação
            const alimentacaoUl = document.getElementById('alimentacaoItemsList');
            const alimentacaoData = meusAppsCategoriesData.find(cat => cat.name === "Alimentação");
            renderSubCategoryItems(alimentacaoUl, alimentacaoData);

            // Renderizar Transporte
            const transporteUl = document.getElementById('transporteItemsList');
            const transporteData = meusAppsCategoriesData.find(cat => cat.name === "Transporte");
            renderSubCategoryItems(transporteUl, transporteData);

            // Renderizar Utilidades
            const utilidadesUl = document.getElementById('utilidadesItemsList');
            const utilidadesData = meusAppsCategoriesData.find(cat => cat.name === "Utilidades");
            renderSubCategoryItems(utilidadesUl, utilidadesData);

            // Renderizar Lazer
            const lazerUl = document.getElementById('lazerItemsList');
            const lazerData = meusAppsCategoriesData.find(cat => cat.name === "Lazer");
            renderSubCategoryItems(lazerUl, lazerData);
        }

        function renderSubCategoryItems(ul, categoryData) {
            if (!categoryData || !categoryData.items || categoryData.items.length === 0) {
                ul.innerHTML = '<li>Nenhum item disponível.</li>';
                return;
            }

            ul.innerHTML = '';
            
            // Lista dos apps testados e funcionando
            const testedApps = ['Bradesco', 'Banco do Brasil', 'Caixa', 'Nubank', 'Santander', 'WhatsApp', 'Telegram', 'PlutoTV', 'YouTube', 'Google Meet', 'WhatsApp Business', 'iFood', 'Pão de Açúcar', 'Uber', '99'];
            
            // Lista dos apps implementados (mas podem não estar testados)
            const implementedApps = ['Bradesco', 'Banco do Brasil', 'Caixa', 'Nubank', 'Santander', 'Itaú', 'WhatsApp', 'Telegram', 'PlutoTV', 'YouTube', 'Google Meet', 'WhatsApp Business', 'iFood', 'Pão de Açúcar', 'Uber', '99'];
            
            categoryData.items.forEach(item => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                
                // Verifica se há dados personalizados para este item
                const itemKey = generateItemKey(item);
                const customData = customItemData[itemKey];
                let displayName = customData ? customData.name : item.name;
                const targetUrl = customData ? customData.url : item.url;
                
                // Adiciona ícone baseado no status real
                const isReserved = item.disabled || item.name === "Reservado";
                const isTested = testedApps.includes(item.name);
                const isImplemented = implementedApps.includes(item.name);
                let statusIcon = '';
                
                if (!isReserved && isTested) {
                    statusIcon = '<span class="app-check">✓</span> ';
                } else if (!isReserved && isImplemented && !isTested) {
                    statusIcon = '<span class="app-pending">●</span> ';
                }
                // Apps não implementados ficam sem ícone
                
                // Se o item tem subitens, adiciona um indicador visual
                if (item.hasSubItems) {
                    // Conta quantos subitens não são "Reservado" ou disabled
                    const activeSubItems = item.subItems ? item.subItems.filter(subItem => 
                        !subItem.disabled && subItem.name !== "Reservado"
                    ).length : 0;
                    
                    statusIcon += `<span style="color: #4CAF50; margin-right: 4px;">📋</span> `;
                    // O contador será adicionado depois do nome APENAS no modo edição
                    console.log(`Verificando contador para ${item.name}:`, { 
                        isEditMode: isEditMode, 
                        activeSubItems: activeSubItems,
                        shouldShowCounter: isEditMode 
                    }); // Debug detalhado
                    
                    if (isEditMode) {
                        console.log(`✅ Adicionando contador ${activeSubItems} para ${item.name} (modo edição ativo)`); // Debug
                        displayName += ` <span style="color: #4CAF50; font-size: 0.8em; font-weight: bold;">${activeSubItems}</span>`;
                    } else {
                        console.log(`❌ NÃO adicionando contador para ${item.name} (modo edição inativo)`); // Debug
                    }
                }
                
                btn.innerHTML = statusIcon + displayName;

                // Tratamento especial para itens reservados
                if (isReserved) {
                    if (isEditMode) {
                        // No modo de edição, itens reservados ficam editáveis
                        btn.style.opacity = '0.7';
                        btn.style.cursor = 'pointer';
                        btn.style.color = '#cccccc';
                        btn.disabled = false;
                        btn.title = 'Clique para personalizar este espaço reservado';
                        
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Editando item reservado:', item.name);
                            openSimpleItemEditModal(categoryData.name, item.name);
                        });
                        
                        // Adiciona botão de edição para itens reservados
                        li.style.position = 'relative';
                        
                        const editBtn = document.createElement('button');
                        editBtn.className = 'edit-simple-item-btn';
                        editBtn.innerHTML = '✏️';
                        editBtn.style.cssText = `
                            position: absolute;
                            right: 8px;
                            top: 50%;
                            transform: translateY(-50%);
                            background: rgba(101, 31, 57, 0.9);
                            border: none;
                            border-radius: 50%;
                            width: 22px;
                            height: 22px;
                            cursor: pointer;
                            font-size: 11px;
                            z-index: 10;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        `;
                        
                        editBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Editando item reservado via botão:', item.name);
                            openSimpleItemEditModal(categoryData.name, item.name);
                        });
                        
                        li.appendChild(editBtn);
                    } else {
                        // No modo normal, itens reservados ficam desabilitados
                        btn.style.opacity = '0.4';
                        btn.style.cursor = 'not-allowed';
                        btn.style.color = '#666666';
                        btn.disabled = true;
                        btn.title = 'Espaço reservado para futuras funcionalidades';
                    }
                } else if (!isImplemented && !item.hasSubItems) {
                    // Apps não implementados ainda (mas permite subitens mesmo sem implementação)
                    btn.style.opacity = '0.5';
                    btn.style.color = '#999999';
                    btn.style.cursor = 'not-allowed';
                    btn.disabled = true;
                    btn.title = 'App ainda não implementado';
                } else if (isImplemented && !isTested && !item.hasSubItems) {
                    // Apps implementados mas não testados ainda (apenas Itaú)
                    btn.style.opacity = '0.7';
                    btn.style.color = '#cccccc';
                    btn.title = 'App implementado mas ainda não testado';
                } else {
                    // Apps testados e funcionais OU itens com subitens
                    // Adiciona classe se foi personalizado
                    if (customData) {
                        btn.classList.add('customized-item');
                    }
                    
                    btn.addEventListener('click', (e) => {
                        console.log('Botão clicado:', { 
                            itemName: item.name, 
                            isEditMode: isEditMode,
                            hasSubItems: item.hasSubItems,
                            hasEditableClass: btn.classList.contains('editable-item')
                        }); // Debug
                        
                        // Se estiver no modo de edição, abre o modal de edição
                        if (isEditMode) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Abrindo modal de edição para:', item.name); // Debug
                            openItemEditModal(item, btn);
                            return;
                        }
                        
                        console.log('Abrindo item normalmente:', item.name); // Debug
                        
                        
                        // Comportamento normal - abre o item
                        ul.querySelectorAll('button:not([disabled])').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        // Se o item tem subitens, exibe os cards
                        if (item.hasSubItems && item.subItems) {
                            displaySubItemsAsCards(item, categoryData.name);
                        } else {
                            // Usa a URL personalizada se existir
                            const itemToOpen = {
                                ...item,
                                name: displayName,
                                url: targetUrl
                            };
                            
                            openPaiItemInModal(itemToOpen);
                        }
                        closeSidebar();
                    });
                    
                    // Adiciona botão de edição para itens simples no modo de edição
                    if (isEditMode && !item.hasSubItems) {
                        li.style.position = 'relative';
                        
                        const editBtn = document.createElement('button');
                        editBtn.className = 'edit-simple-item-btn';
                        editBtn.innerHTML = '✏️';
                        editBtn.style.cssText = `
                            position: absolute;
                            right: 8px;
                            top: 50%;
                            transform: translateY(-50%);
                            background: rgba(101, 31, 57, 0.9);
                            border: none;
                            border-radius: 50%;
                            width: 22px;
                            height: 22px;
                            cursor: pointer;
                            font-size: 11px;
                            z-index: 10;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        `;
                        
                        editBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Editando item simples:', item.name);
                            openSimpleItemEditModal(categoryData.name, item.name);
                        });
                        
                        li.appendChild(editBtn);
                    }
                }

                li.appendChild(btn);
                ul.appendChild(li);
            });
        }

        // Nova função para exibir subitens como cards no carrossel
        function displaySubItemsAsCards(parentItem, categoryName) {
            console.log('=== DEBUG: displaySubItemsAsCards chamada ===');
            console.log('parentItem:', parentItem);
            console.log('categoryName:', categoryName);
            
            const container = document.getElementById('coursesContainer');
            if (!container) {
                console.error('ERRO: coursesContainer não encontrado!');
                return;
            }
            
            console.log('Container encontrado, limpando conteúdo...');
            container.innerHTML = '';

            // Cria o título da subcategoria
            const categoryHeader = document.createElement('h2');
            categoryHeader.className = 'category-title-header';
            categoryHeader.textContent = `${categoryName} - ${parentItem.name}`;
            container.appendChild(categoryHeader);
            console.log('Título adicionado:', categoryHeader.textContent);

            if (!parentItem.subItems || parentItem.subItems.length === 0) {
                console.log('Nenhum subitem encontrado, exibindo mensagem...');
                const noItemsMessage = document.createElement('p');
                noItemsMessage.textContent = `Nenhum recurso encontrado em ${parentItem.name}.`;
                noItemsMessage.style.color = '#ccc';
                noItemsMessage.style.marginTop = '20px';
                container.appendChild(noItemsMessage);
                return;
            }

            console.log(`Criando ${parentItem.subItems.length} cards...`);
            
            // Cria o trilho do carrossel
            const carouselTrack = document.createElement('div');
            carouselTrack.className = 'carousel-track';

            parentItem.subItems.forEach((subItem, index) => {
                console.log(`Criando card ${index + 1}:`, subItem.name);
                
                const card = document.createElement('div');
                card.className = 'course-card';
                
                // Verifica se há dados personalizados para este card
                const cardKey = generateCardKey(categoryName, parentItem.name, index);
                const customData = customCardData[cardKey];
                
                // Usa dados personalizados se disponíveis, senão usa os originais
                const displayName = customData ? customData.name : subItem.name;
                const displayDescription = customData ? customData.description : (subItem.description || 'Clique para acessar');
                const displayUrl = customData ? customData.url : subItem.url;
                
                // Verifica se é um card editável
                if (subItem.isCard) {
                    // Card editável com imagem personalizada
                    const cardImage = customData ? customData.cardImage : (subItem.cardImage || subItem.image || 'https://via.placeholder.com/308x196.png?text=AudioLivro');
                    
                    console.log(`Renderizando card editável: ${displayName}`, {
                        isEditMode: isEditMode,
                        shouldShowButton: isEditMode,
                        parentItemName: parentItem.name,
                        cardIndex: index
                    });
                    
                    card.innerHTML = `
                        <div class="card-image-container" style="position: relative;">
                            <img src="${cardImage}" alt="${displayName}" style="width:100%; height:196px; object-fit:cover; border-bottom: 1px solid rgba(80, 48, 96, 0.9);">
                            ${isEditMode ? `<button class="edit-card-btn" onclick="openCardEditModal('${parentItem.name}', ${index})" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 14px;">✏️</button>` : ''}
                        </div>
                        <div class="info" style="padding:15px;">
                            <h3 style="margin:0 0 10px; font-size:1.05em; color:#fff; height: 56px; overflow: hidden;">${displayName}</h3>
                            <p style="font-size:0.85em; color:#ccc; margin:0; line-height: 1.3; height: 70px; overflow: hidden;">${displayDescription}</p>
                        </div>
                    `;
                } else {
                    // Card padrão
                    card.innerHTML = `
                        <img src="${subItem.image || 'https://via.placeholder.com/308x196.png?text=Recurso'}" alt="${subItem.name}" style="width:100%; height:196px; object-fit:cover; border-bottom: 1px solid rgba(80, 48, 96, 0.9);">
                        <div class="info" style="padding:15px;">
                            <h3 style="margin:0 0 10px; font-size:1.05em; color:#fff; height: 56px; overflow: hidden;">${subItem.name}</h3>
                            <p style="font-size:0.85em; color:#ccc; margin:0; line-height: 1.3; height: 70px; overflow: hidden;">${subItem.description || 'Clique para acessar'}</p>
                        </div>
                    `;
                }

                card.addEventListener('click', (e) => {
                    // Não abrir se clicou no botão de editar
                    if (e.target.classList.contains('edit-card-btn')) {
                        return;
                    }
                    
                    // Cria objeto com dados personalizados se disponíveis
                    const itemToOpen = {
                        name: displayName,
                        url: displayUrl,
                        description: displayDescription
                    };
                    
                    // Detecta se é URL da Play Store para mostrar modal específico
                    if (displayUrl.includes('play.google.com/store/apps')) {
                        showAppModal(itemToOpen);
                    } else {
                        // Para URLs web, abre em modal iframe
                        openPaiItemInModal(itemToOpen);
                    }
                });

                carouselTrack.appendChild(card);
                console.log(`Card ${index + 1} adicionado ao carrossel`);
            });

            container.appendChild(carouselTrack);
            console.log('Carrossel adicionado ao container');
            console.log('Container final HTML:', container.innerHTML.substring(0, 200) + '...');

            // Adiciona funcionalidade de carrossel
            const debouncedUpdateFocus = debounce(() => updateCarouselFocus(carouselTrack), 50);
            let scrollEndTimer = null;
            carouselTrack.addEventListener('scroll', () => {
                debouncedUpdateFocus();
                clearTimeout(scrollEndTimer);
                scrollEndTimer = setTimeout(() => {
                    snapToNearestCard(carouselTrack);
                }, 150);
            });

            setTimeout(() => {
                updateCarouselFocus(carouselTrack);
                console.log('Focus do carrossel atualizado');
            }, 0);
            
            console.log('=== FIM DEBUG: displaySubItemsAsCards ===');
        }

        function renderVideosCategoriesSidebar() {
            const videosListUl = document.getElementById('videosItemsList');
            videosListUl.innerHTML = '';

            if (!videosCategoriesData || videosCategoriesData.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Nenhuma categoria de Vídeos configurada.';
                videosListUl.appendChild(li);
                return;
            }

            videosCategoriesData.forEach(videoCategory => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                btn.textContent = videoCategory.name;

                btn.addEventListener('click', () => {
                    videosListUl.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    displayPaiCategoryItems(videoCategory, "Videos"); // Passa o nome da categoria pai
                    closeSidebar();
                });

                li.appendChild(btn);
                videosListUl.appendChild(li);
            });
        }

        // Nova estrutura para categoria "Meus Apps"
        const meusAppsCategoriesData = [
            {
                name: "Saúde",
                items: [
                    { 
                        name: "Prevenção", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Drogasil", 
                                url: "https://play.google.com/store/apps/details?id=br.com.drogasil", 
                                image: "https://api.iconify.design/tabler/pill.svg?color=%23e5e5e5", 
                                description: "Drogaria Online 24h - App oficial",
                                isCard: true,
                                cardImage: "https://logoeps.com/wp-content/uploads/2013/03/drogasil-vector-logo.png"
                            },
                            { 
                                name: "SUS Digital", 
                                url: "https://play.google.com/store/apps/details?id=br.gov.datasus.cnsdigital", 
                                image: "https://api.iconify.design/tabler/id-badge.svg?color=%23e5e5e5", 
                                description: "Cartão Nacional de Saúde Digital",
                                isCard: true,
                                cardImage: "https://www.gov.br/saude/pt-br/assuntos/saude-digital/cartao-nacional-de-saude/sus-digital.png"
                            },
                            { 
                                name: "Conecte SUS", 
                                url: "https://play.google.com/store/apps/details?id=br.gov.datasus.conectesus", 
                                image: "https://api.iconify.design/tabler/heart-handshake.svg?color=%23e5e5e5", 
                                description: "Aplicativo oficial do SUS",
                                isCard: true,
                                cardImage: "https://conectesus.saude.gov.br/static/media/logo-conecte-sus.png"
                            },
                            { 
                                name: "Naturais", 
                                url: "#", 
                                image: "https://api.iconify.design/tabler/leaf.svg?color=%23e5e5e5", 
                                description: "Produtos naturais e fitoterápicos",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { name: "Nutrição", url: "https://www.dietbox.me/", image: "https://api.iconify.design/tabler/apple.svg?color=%23e5e5e5" },
                    { name: "Atividades", url: "https://www.smartfit.com.br/", image: "https://api.iconify.design/tabler/barbell.svg?color=%23e5e5e5" },
                    { name: "Convênio", url: "https://www.unimed.coop.br/", image: "https://api.iconify.design/tabler/shield-heart.svg?color=%23e5e5e5" },
                    { name: "Médico", url: "https://www.doctoralia.com.br/", image: "https://api.iconify.design/tabler/stethoscope.svg?color=%23e5e5e5" },
                    { name: "Farmácia", url: "https://www.drogasil.com.br/", image: "https://api.iconify.design/tabler/pill.svg?color=%23e5e5e5" },
                    { name: "Hospital", url: "https://www.hospitalsiriolibanes.org.br/", image: "https://api.iconify.design/tabler/building-hospital.svg?color=%23e5e5e5" }
                ]
            },
            {
                name: "Comunicar",
                items: [
                    { name: "WhatsApp", url: "https://play.google.com/store/apps/details?id=com.whatsapp", image: "https://api.iconify.design/logos/whatsapp-icon.svg?color=%23e5e5e5" },
                    { name: "Telegram", url: "https://play.google.com/store/apps/details?id=org.telegram.messenger", image: "https://api.iconify.design/logos/telegram.svg?color=%23e5e5e5" },
                    { name: "Email Gmail", url: "https://mail.google.com/", image: "https://api.iconify.design/logos/google-gmail.svg?color=%23e5e5e5" },
                    { name: "Google Meet", url: "https://meet.google.com/", image: "https://api.iconify.design/logos/google-meet.svg?color=%23e5e5e5" },
                    { name: "Zoom", url: "https://zoom.us/", image: "https://api.iconify.design/logos/zoom-icon.svg?color=%23e5e5e5" },
                    { name: "WhatsApp Business", url: "https://play.google.com/store/apps/details?id=com.whatsapp.w4b", image: "https://api.iconify.design/logos/whatsapp-icon.svg?color=%23e5e5e5" },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
                ]
            },
            {
                name: "Banco",
                items: [
                    { name: "Banco do Brasil", url: "https://play.google.com/store/apps/details?id=br.com.bb.android", image: "https://api.iconify.design/tabler/building-bank.svg?color=%23e5e5e5" },
                    { name: "Bradesco", url: "https://play.google.com/store/apps/details?id=com.bradesco", image: "https://api.iconify.design/tabler/credit-card.svg?color=%23e5e5e5" },
                    { name: "Caixa", url: "https://play.google.com/store/apps/details?id=br.com.gabba.Caixa", image: "https://api.iconify.design/tabler/home.svg?color=%23e5e5e5" },
                    { name: "Itaú", url: "https://play.google.com/store/apps/details?id=com.itau", image: "https://api.iconify.design/tabler/building-bank.svg?color=%23e5e5e5" },
                    { name: "Nubank", url: "https://play.google.com/store/apps/details?id=com.nu.production", image: "https://api.iconify.design/tabler/credit-card.svg?color=%23e5e5e5" },
                    { name: "Santander", url: "https://play.google.com/store/apps/details?id=com.santander.app", image: "https://api.iconify.design/tabler/credit-card.svg?color=%23e5e5e5" },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
                ]
            },
            {
                name: "Utilidades",
                items: [
                    { 
                        name: "Calculadora", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Calculadora Google", 
                                url: "https://www.google.com/search?q=calculator", 
                                image: "https://api.iconify.design/tabler/calculator.svg?color=%23e5e5e5", 
                                description: "Calculadora online do Google",
                                isCard: true,
                                cardImage: "https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png"
                            },
                            { 
                                name: "Calculadora Científica", 
                                url: "https://web2.0calc.com/", 
                                image: "https://api.iconify.design/tabler/math-function.svg?color=%23e5e5e5", 
                                description: "Calculadora científica avançada",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "Conversor de Unidades", 
                                url: "https://www.convertworld.com/pt/", 
                                image: "https://api.iconify.design/tabler/arrows-exchange.svg?color=%23e5e5e5", 
                                description: "Conversor de medidas e unidades",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1611224923853-80b023f02d71?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "Calculadora Financeira", 
                                url: "https://www.calculadorafinanceira.com.br/", 
                                image: "https://api.iconify.design/tabler/coin.svg?color=%23e5e5e5", 
                                description: "Cálculos financeiros e investimentos",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1554224155-6726b3ff858f?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { 
                        name: "Clima", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Weather.com", 
                                url: "https://weather.com/pt-BR", 
                                image: "https://api.iconify.design/tabler/cloud.svg?color=%23e5e5e5", 
                                description: "Previsão do tempo detalhada",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "ClimaTempo", 
                                url: "https://www.climatempo.com.br/", 
                                image: "https://api.iconify.design/tabler/sun.svg?color=%23e5e5e5", 
                                description: "Previsão do tempo no Brasil",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "INMET", 
                                url: "https://portal.inmet.gov.br/", 
                                image: "https://api.iconify.design/tabler/cloud-rain.svg?color=%23e5e5e5", 
                                description: "Instituto Nacional de Meteorologia",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1534088568595-a066f410bcda?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "AccuWeather", 
                                url: "https://www.accuweather.com/pt/br/brazil-weather", 
                                image: "https://api.iconify.design/tabler/temperature.svg?color=%23e5e5e5", 
                                description: "Previsão meteorológica global",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1592210454359-9043f067919b?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { 
                        name: "Tradutor", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Google Tradutor", 
                                url: "https://translate.google.com/", 
                                image: "https://api.iconify.design/logos/google-translate.svg?color=%23e5e5e5", 
                                description: "Tradutor do Google",
                                isCard: true,
                                cardImage: "https://ssl.gstatic.com/translate/community/backgrounds/globe_small.png"
                            },
                            { 
                                name: "DeepL", 
                                url: "https://www.deepl.com/translator", 
                                image: "https://api.iconify.design/tabler/language.svg?color=%23e5e5e5", 
                                description: "Tradutor com IA avançada",
                                isCard: true,
                                cardImage: "https://static.deepl.com/img/logo/deepl-logo-blue.svg"
                            },
                            { 
                                name: "Reverso", 
                                url: "https://www.reverso.net/text-translation", 
                                image: "https://api.iconify.design/tabler/abc.svg?color=%23e5e5e5", 
                                description: "Tradutor com contexto e exemplos",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1455390582262-044cdead277a?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "Linguee", 
                                url: "https://www.linguee.com.br/", 
                                image: "https://api.iconify.design/tabler/book.svg?color=%23e5e5e5", 
                                description: "Dicionário e tradutor bilíngue",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { 
                        name: "Mapas", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Google Maps", 
                                url: "https://maps.google.com/", 
                                image: "https://api.iconify.design/logos/google-maps.svg?color=%23e5e5e5", 
                                description: "Mapas e navegação do Google",
                                isCard: true,
                                cardImage: "https://developers.google.com/static/maps/images/maps-icon.svg"
                            },
                            { 
                                name: "Waze", 
                                url: "https://www.waze.com/pt-BR/live-map", 
                                image: "https://api.iconify.design/tabler/route.svg?color=%23e5e5e5", 
                                description: "Navegação com trânsito em tempo real",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1569154941061-e231b4725ef1?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "OpenStreetMap", 
                                url: "https://www.openstreetmap.org/", 
                                image: "https://api.iconify.design/tabler/map-2.svg?color=%23e5e5e5", 
                                description: "Mapa colaborativo mundial",
                                isCard: true,
                                cardImage: "https://wiki.openstreetmap.org/w/images/thumb/b/b0/Openstreetmap_logo.svg/256px-Openstreetmap_logo.svg.png"
                            },
                            { 
                                name: "Here Maps", 
                                url: "https://wego.here.com/", 
                                image: "https://api.iconify.design/tabler/map-pin.svg?color=%23e5e5e5", 
                                description: "Mapas e navegação Here",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1524661135-423995f22d0b?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { 
                        name: "Calendário", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Google Calendar", 
                                url: "https://calendar.google.com/", 
                                image: "https://api.iconify.design/logos/google-calendar.svg?color=%23e5e5e5", 
                                description: "Calendário do Google",
                                isCard: true,
                                cardImage: "https://ssl.gstatic.com/calendar/images/dynamiclogo_2020q4/calendar_31_2x.png"
                            },
                            { 
                                name: "Outlook Calendar", 
                                url: "https://outlook.live.com/calendar/", 
                                image: "https://api.iconify.design/logos/microsoft-outlook.svg?color=%23e5e5e5", 
                                description: "Calendário do Outlook",
                                isCard: true,
                                cardImage: "https://res-1.cdn.office.net/files/fabric-cdn-prod_20230815.002/assets/brand-icons/product/svg/outlook_48x1.svg"
                            },
                            { 
                                name: "Calendário Online", 
                                url: "https://www.calendario.com.br/", 
                                image: "https://api.iconify.design/tabler/calendar-event.svg?color=%23e5e5e5", 
                                description: "Calendário brasileiro online",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "TimeAndDate", 
                                url: "https://www.timeanddate.com/calendar/", 
                                image: "https://api.iconify.design/tabler/clock.svg?color=%23e5e5e5", 
                                description: "Calendário mundial com fusos",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1495364141860-b0d03eccd065?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
                ]
            },
            {
                name: "Lazer",
                items: [
                    { 
                        name: "AudioLivros", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Audible", 
                                url: "https://www.audible.com.br/", 
                                image: "https://api.iconify.design/tabler/headphones.svg?color=%23e5e5e5", 
                                description: "Plataforma de audiolivros da Amazon",
                                isCard: true,
                                cardImage: "https://m.media-amazon.com/images/G/32/audible/web/logo-audible-white._CB1565125222_.png"
                            },
                            { 
                                name: "Storytel", 
                                url: "https://www.storytel.com/br/pt/", 
                                image: "https://api.iconify.design/tabler/book-2.svg?color=%23e5e5e5", 
                                description: "Streaming de audiolivros e e-books",
                                isCard: true,
                                cardImage: "https://cdn.storytel.com/web/assets/storytel-logo-white.svg"
                            }
                        ]
                    },
                    { name: "Netflix", url: "https://www.netflix.com/", image: "https://api.iconify.design/logos/netflix-icon.svg?color=%23e5e5e5" },
                    { name: "PlutoTV", url: "https://pluto.tv/br/", image: "https://api.iconify.design/tabler/device-tv.svg?color=%23e5e5e5" },
                    { name: "Prime Video", url: "https://www.primevideo.com/", image: "https://api.iconify.design/tabler/video.svg?color=%23e5e5e5" },
                    { name: "Spotify", url: "https://open.spotify.com/", image: "https://api.iconify.design/logos/spotify-icon.svg?color=%23e5e5e5" },
                    { name: "YouTube", url: "https://play.google.com/store/apps/details?id=com.google.android.youtube", image: "https://api.iconify.design/logos/youtube-icon.svg?color=%23e5e5e5" },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
                ]
            },
            {
                name: "Alimentação",
                items: [
                    { name: "iFood", url: "https://play.google.com/store/apps/details?id=br.com.brainweb.ifood", image: "https://api.iconify.design/tabler/tools-kitchen-2.svg?color=%23e5e5e5" },
                    { name: "Pão de Açúcar", url: "https://play.google.com/store/apps/details?id=br.com.paodeacucar.mobile", image: "https://api.iconify.design/tabler/shopping-cart.svg?color=%23e5e5e5" },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
                ]
            },
            {
                name: "Transporte",
                items: [
        { name: "Uber", url: "https://play.google.com/store/apps/details?id=com.ubercab", image: "https://api.iconify.design/tabler/car.svg?color=%23e5e5e5" },
        { name: "99", url: "https://play.google.com/store/apps/details?id=com.taxis99", image: "https://api.iconify.design/tabler/taxi.svg?color=%23e5e5e5" },
        { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
        { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
        { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
        { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
        { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
            ]
        },   
    ];
        

        // Nova estrutura para categoria "Participe"

        // Variáveis para controle do modo de edição - MOVIDAS PARA O TOPO
        // let isEditMode = false; // REMOVIDO - já definido no início
        // let isToggleVisible = false; // REMOVIDO - já definido no início  
        // let currentEditingItem = null; // REMOVIDO - já definido no início
        // let customItemData = {}; // REMOVIDO - já definido no início
        
        // Função para ativar/desativar modo de edição
        function toggleEditMode(activate) {
            isEditMode = activate;
            const body = document.body;
            const headerTitle = document.getElementById('headerTitle');
            const editToggle = document.getElementById('editModeToggle');
            
            console.log(`Modo de edição ${activate ? 'ATIVADO' : 'DESATIVADO'}:`, {
                isEditMode: isEditMode,
                bodyHasClass: body.classList.contains('edit-mode')
            });

            if (activate) {
                body.classList.add('edit-mode');
                headerTitle.textContent = 'Edição... [INDIVIDUAL]';
                if (editToggle) editToggle.checked = true;
                
                // Adiciona classes editáveis aos elementos
                addEditableClasses();
                
                // Adiciona indicadores de upgrade
                addUpgradeIndicators();
                
                // Ativa interceptação de edição de categorias
                interceptCategoryEdit();
            } else {
                body.classList.remove('edit-mode');
                headerTitle.textContent = 'Acessos';
                if (editToggle) editToggle.checked = false;
                
                // Remove classes editáveis
                removeEditableClasses();
                
                // Remove indicadores de upgrade
                addUpgradeIndicators();
            }

            // Re-renderiza a sidebar para atualizar contadores
            renderMeusAppsCategoriesSidebar();
            
            // Re-renderiza cards se estiver visualizando qualquer subcategoria com cards
            const currentTitle = document.querySelector('.category-title-header');
            if (currentTitle) {
                const titleText = currentTitle.textContent;
                
                // Extrai o nome da categoria e subcategoria do título (formato: "Categoria - Subcategoria")
                const titleParts = titleText.split(' - ');
                if (titleParts.length === 2) {
                    const categoryName = titleParts[0].trim();
                    const subCategoryName = titleParts[1].trim();
                    
                    // Encontra a categoria nos dados
                    const category = meusAppsCategoriesData.find(cat => cat.name === categoryName);
                    if (category) {
                        // Encontra o item/subcategoria
                        const subCategoryItem = category.items.find(item => item.name === subCategoryName);
                        if (subCategoryItem && subCategoryItem.hasSubItems) {
                            console.log(`Re-renderizando cards para: ${categoryName} - ${subCategoryName}`);
                            displaySubItemsAsCards(subCategoryItem, categoryName);
                        }
                    }
                }
            }
            
            // Salva o estado no localStorage
            localStorage.setItem('editMode', activate.toString());
        }
        
        // Função para re-renderizar os botões de Meus Apps
        function reRenderMeusAppsButtons() {
            console.log('Re-renderizando botões, isEditMode:', isEditMode); // Debug
            renderMeusAppsCategoriesSidebar();
        }
        
        // Função para adicionar classes editáveis
        function addEditableClasses() {
            // Adicionar apenas aos botões de Meus Apps (nos sub-acordeões)
            const meusAppsSubButtons = document.querySelectorAll('#saudeItemsList button:not([disabled]), #comunicacaoItemsList button:not([disabled]), #bancoItemsList button:not([disabled]), #utilidadesItemsList button:not([disabled]), #lazerItemsList button:not([disabled])');
            console.log('addEditableClasses: Encontrados', meusAppsSubButtons.length, 'botões para adicionar classe editable'); // Debug
            meusAppsSubButtons.forEach((btn, index) => {
                btn.classList.add('editable-item');
                console.log(`Classe editable-item adicionada ao botão ${index + 1}:`, btn.textContent); // Debug
                
                // Intercepta cliques em botões "Reservado"
                if (btn.textContent.trim() === 'Reservado') {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        showUpgradeAlert('Adicionar novos aplicativos');
                    });
                    
                    // Adiciona indicador visual
                    if (!btn.querySelector('.PERSONALIZADO-mini-indicator')) {
                        const miniIndicator = document.createElement('span');
                        miniIndicator.className = 'PERSONALIZADO-mini-indicator';
                        miniIndicator.innerHTML = '🚀';
                        miniIndicator.style.cssText = `
                            position: absolute;
                            top: -5px;
                            right: -5px;
                            background: #ff6b35;
                            border-radius: 50%;
                            width: 16px;
                            height: 16px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            z-index: 10;
                        `;
                        btn.style.position = 'relative';
                        btn.appendChild(miniIndicator);
                    }
                }
            });
        }
        
        // Função para remover classes editáveis
        function removeEditableClasses() {
            const editableItems = document.querySelectorAll('.editable-item');
            editableItems.forEach(item => {
                item.classList.remove('editable-item');
                
                // Remove indicadores mini de upgrade
                const miniIndicator = item.querySelector('.PERSONALIZADO-mini-indicator');
                if (miniIndicator) {
                    miniIndicator.remove();
                }
            });
        }
        
        // Função para mostrar modal de confirmação
        function showEditModeConfirmation() {
            document.getElementById('editModeConfirmModal').classList.remove('hidden');
        }
        
        // Função para esconder modal de confirmação
        function hideEditModeConfirmation() {
            document.getElementById('editModeConfirmModal').classList.add('hidden');
        }

        // Função para mostrar/esconder o toggle de edição
        function toggleEditModeVisibility() {
            const toggleContainer = document.getElementById('editModeToggleContainer');
            const supportLogo = document.getElementById('supportLogo');
            
            isToggleVisible = !isToggleVisible;
            
            if (isToggleVisible) {
                toggleContainer.style.display = 'flex';
                supportLogo.classList.add('toggle-visible');
                // NÃO salvar estado no localStorage - sempre força clique manual
                // localStorage.setItem('toggleVisible', 'true'); // REMOVIDO
            } else {
                toggleContainer.style.display = 'none';
                supportLogo.classList.remove('toggle-visible');
                // Sempre desativar o modo de edição ao esconder o toggle
                if (isEditMode) {
                    toggleEditMode(false);
                }
                // Não salvar estado - sempre inicia oculto
                // localStorage.removeItem('editMode'); // Já removido na função toggleEditMode
                // localStorage.setItem('toggleVisible', 'false'); // REMOVIDO
            }
        }

        // Funções para o Modal de Edição Individual
        function openItemEditModal(itemData, buttonElement) {
            currentEditingItem = { data: itemData, element: buttonElement };
            
            // Carrega dados personalizados se existirem
            const itemKey = generateItemKey(itemData);
            const customData = customItemData[itemKey] || {};
            
            // Preenche os campos do modal
            document.getElementById('editItemName').value = customData.name || itemData.name;
            document.getElementById('editItemUrl').value = customData.url || itemData.url;
            
            // Mostra o modal
            document.getElementById('itemEditModal').classList.remove('hidden');
        }

        function closeItemEditModal() {
            document.getElementById('itemEditModal').classList.add('hidden');
            currentEditingItem = null;
        }

        function saveItemEditData() {
            if (!currentEditingItem) return;
            
            const newName = document.getElementById('editItemName').value.trim();
            const newUrl = document.getElementById('editItemUrl').value.trim();
            
            // Validação básica
            if (!newName) {
                alert('Por favor, digite um nome para o aplicativo.');
                return;
            }
            
            if (!newUrl) {
                alert('Por favor, digite uma URL válida.');
                return;
            }
            
            // Adiciona https:// se não tiver protocolo
            let finalUrl = newUrl;
            if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) {
                finalUrl = 'https://' + newUrl;
            }
            
            // Salva os dados personalizados
            const itemKey = generateItemKey(currentEditingItem.data);
            customItemData[itemKey] = {
                name: newName,
                url: finalUrl,
                originalName: currentEditingItem.data.name,
                originalUrl: currentEditingItem.data.url
            };
            
            // Salva no localStorage
            localStorage.setItem('customItemData', JSON.stringify(customItemData));
            
            // Atualiza o botão visualmente
            updateButtonDisplay(currentEditingItem.element, newName);
            
            // Fecha o modal
            closeItemEditModal();
            
            // Feedback visual
            showSaveConfirmation();
        }

        function generateItemKey(itemData) {
            // Gera uma chave única baseada no nome original do item
            return itemData.name.toLowerCase().replace(/\s+/g, '_');
        }

        function updateButtonDisplay(buttonElement, newName) {
            // Atualiza o texto do botão
            buttonElement.textContent = newName;
            
            // Adiciona uma classe para indicar que foi personalizado
            buttonElement.classList.add('customized-item');
        }

        function showSaveConfirmation() {
            // Cria um feedback visual temporário
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 4px;
                z-index: 10000;
                box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            `;
            feedback.textContent = '✅ Alterações salvas com sucesso!';
            document.body.appendChild(feedback);
            
            // Remove após 3 segundos
            setTimeout(() => {
                document.body.removeChild(feedback);
            }, 3000);
        }

        function loadCustomItemData() {
            // Carrega dados personalizados do localStorage
            const saved = localStorage.getItem('customItemData');
            if (saved) {
                try {
                    customItemData = JSON.parse(saved);
                } catch (e) {
                    console.error('Erro ao carregar dados personalizados:', e);
                    customItemData = {};
                }
            }
            
            // Carrega também os dados de cards
            loadCustomCardData();
            
            // Migra dados antigos para novo formato se necessário
            migrateOldDataFormat();
        }

        // Função para migrar dados antigos para novo formato
        function migrateOldDataFormat() {
            let needsSave = false;
            
            // Migra dados de cards
            const oldCardKeys = Object.keys(customCardData).filter(key => !key.startsWith('card_') && !key.startsWith('item_'));
            oldCardKeys.forEach(oldKey => {
                const parts = oldKey.split('_');
                if (parts.length === 3) {
                    const [categoryName, parentItemName, cardIndex] = parts;
                    const newKey = generateCardKey(categoryName, parentItemName, cardIndex);
                    
                    // Move dados para nova chave se não existir
                    if (!customCardData[newKey]) {
                        customCardData[newKey] = customCardData[oldKey];
                        needsSave = true;
                    }
                    
                    // Remove chave antiga
                    delete customCardData[oldKey];
                    needsSave = true;
                }
            });
            
            // Migra dados de itens simples
            const oldItemKeys = Object.keys(customItemData).filter(key => !key.startsWith('item_'));
            oldItemKeys.forEach(oldKey => {
                const parts = oldKey.split('_');
                if (parts.length === 2) {
                    const [categoryName, itemName] = parts;
                    const newKey = generateItemKey(categoryName, itemName);
                    
                    // Move dados para nova chave se não existir
                    if (!customItemData[newKey]) {
                        customItemData[newKey] = customItemData[oldKey];
                        needsSave = true;
                    }
                    
                    // Remove chave antiga
                    delete customItemData[oldKey];
                    needsSave = true;
                }
            });
            
            // Salva se houve mudanças
            if (needsSave) {
                localStorage.setItem('customCardData', JSON.stringify(customCardData));
                localStorage.setItem('customItemData', JSON.stringify(customItemData));
                console.log('Dados migrados para novo formato de chaves');
            }
        }

        // Variáveis para controle da edição de cards
        let currentEditingCard = null;

        // Função para abrir modal de edição de card
        function openCardEditModal(parentItemName, cardIndex) {
            // Encontra o item pai e o card específico
            const category = meusAppsCategoriesData.find(cat => 
                cat.items.some(item => item.name === parentItemName)
            );
            
            if (!category) return;
            
            const parentItem = category.items.find(item => item.name === parentItemName);
            if (!parentItem || !parentItem.subItems || !parentItem.subItems[cardIndex]) return;
            
            const card = parentItem.subItems[cardIndex];
            currentEditingCard = { 
                categoryName: category.name,
                parentItemName: parentItemName, 
                cardIndex: cardIndex,
                originalCard: card 
            };
            
            // Carrega dados personalizados se existirem
            const cardKey = generateCardKey(category.name, parentItemName, cardIndex);
            const customData = customCardData[cardKey] || {};
            
            // Preenche os campos do modal
            document.getElementById('editCardTitle').value = customData.name || card.name;
            document.getElementById('editCardImage').value = customData.cardImage || card.cardImage || card.image;
            document.getElementById('editCardUrl').value = customData.url || card.url;
            document.getElementById('editCardDescription').value = customData.description || card.description || '';
            
            // Mostra o modal
            document.getElementById('cardEditModal').classList.remove('hidden');
        }

        // Função para fechar modal de edição de card
        function closeCardEditModal() {
            document.getElementById('cardEditModal').classList.add('hidden');
            currentEditingCard = null;
        }

        // Função para salvar edição de card
        function saveCardEdit() {
            if (!currentEditingCard) return;
            
            const newTitle = document.getElementById('editCardTitle').value.trim();
            const newImage = document.getElementById('editCardImage').value.trim();
            const newUrl = document.getElementById('editCardUrl').value.trim();
            const newDescription = document.getElementById('editCardDescription').value.trim();
            
            // Validação básica
            if (!newTitle) {
                alert('Por favor, digite um título para o card.');
                return;
            }
            
            if (!newUrl) {
                alert('Por favor, digite uma URL de acesso válida.');
                return;
            }
            
            // Adiciona https:// se não tiver protocolo
            let finalUrl = newUrl;
            if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) {
                finalUrl = 'https://' + newUrl;
            }
            
            // Salva os dados personalizados
            const cardKey = generateCardKey(
                currentEditingCard.categoryName, 
                currentEditingCard.parentItemName, 
                currentEditingCard.cardIndex
            );
            
            customCardData[cardKey] = {
                name: newTitle,
                cardImage: newImage,
                url: finalUrl,
                description: newDescription,
                originalName: currentEditingCard.originalCard.name,
                originalCardImage: currentEditingCard.originalCard.cardImage,
                originalUrl: currentEditingCard.originalCard.url,
                originalDescription: currentEditingCard.originalCard.description
            };
            
            // Salva no localStorage
            localStorage.setItem('customCardData', JSON.stringify(customCardData));
            
            // Re-renderiza os cards para mostrar as mudanças
            const category = meusAppsCategoriesData.find(cat => cat.name === currentEditingCard.categoryName);
            const parentItem = category.items.find(item => item.name === currentEditingCard.parentItemName);
            displaySubItemsAsCards(parentItem, currentEditingCard.categoryName);
            
            // Fecha o modal
            closeCardEditModal();
            
            // Feedback visual
            showSaveConfirmation();
        }

        // Função para gerar chave única do card
        function generateCardKey(categoryName, parentItemName, cardIndex) {
            // Encontra o índice da categoria para garantir unicidade absoluta
            const categoryIndex = meusAppsCategoriesData.findIndex(cat => cat.name === categoryName);
            // Inclui mais informações para garantir unicidade absoluta
            return `card_${categoryIndex}_${categoryName}_${parentItemName}_${cardIndex}`.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
        }

        // Função para carregar dados personalizados de cards
        function loadCustomCardData() {
            const saved = localStorage.getItem('customCardData');
            if (saved) {
                try {
                    customCardData = JSON.parse(saved);
                } catch (e) {
                    console.error('Erro ao carregar dados personalizados de cards:', e);
                    customCardData = {};
                }
            }
        }

        // Função para aplicar dados personalizados aos cards
        function applyCustomCardData() {
            Object.keys(customCardData).forEach(cardKey => {
                const customData = customCardData[cardKey];
                
                // Novo formato: card_index_categoria_subcategoria_cardindex
                if (cardKey.startsWith('card_')) {
                    const parts = cardKey.substring(5).split('_'); // Remove 'card_' e divide
                    if (parts.length >= 4) {
                        const cardIndex = parts.pop(); // Último elemento é o índice do card
                        const parentItemName = parts.pop(); // Penúltimo é o item pai
                        const categoryIndex = parts.shift(); // Primeiro é o índice da categoria
                        const categoryName = parts.join('_'); // Resto é a categoria
                        
                        // Usa o índice da categoria para encontrar a categoria correta
                        const category = meusAppsCategoriesData[parseInt(categoryIndex)];
                        
                        if (category && category.name.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '') === categoryName) {
                            const parentItem = category.items.find(item => 
                                item.name.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '') === parentItemName
                            );
                            
                            if (parentItem && parentItem.subItems && parentItem.subItems[parseInt(cardIndex)]) {
                                const card = parentItem.subItems[parseInt(cardIndex)];
                                // Aplica os dados personalizados temporariamente para renderização
                                card._customName = customData.name;
                                card._customCardImage = customData.cardImage;
                                card._customUrl = customData.url;
                                card._customDescription = customData.description;
                            }
                        }
                    }
                } else {
                    // Formato antigo para compatibilidade (será removido gradualmente)
                    const [categoryName, parentItemName, cardIndex] = cardKey.split('_');
                    
                    const category = meusAppsCategoriesData.find(cat => 
                        cat.name.toLowerCase().replace(/\s+/g, '_') === categoryName
                    );
                    
                    if (category) {
                        const parentItem = category.items.find(item => 
                            item.name.toLowerCase().replace(/\s+/g, '_') === parentItemName
                        );
                        
                        if (parentItem && parentItem.subItems && parentItem.subItems[parseInt(cardIndex)]) {
                            const card = parentItem.subItems[parseInt(cardIndex)];
                            // Aplica os dados personalizados temporariamente para renderização
                            card._customName = customData.name;
                            card._customCardImage = customData.cardImage;
                            card._customUrl = customData.url;
                            card._customDescription = customData.description;
                        }
                    }
                }
            });
        }

        // Variáveis para controle da edição de itens simples
        let currentEditingSimpleItem = null;

        // Função para abrir modal de edição de item simples
        function openSimpleItemEditModal(categoryName, itemName) {
            // Encontra o item específico
            const category = meusAppsCategoriesData.find(cat => cat.name === categoryName);
            if (!category) return;
            
            const item = category.items.find(i => i.name === itemName);
            if (!item || item.hasSubItems) return; // Só para itens simples
            
            currentEditingSimpleItem = { 
                categoryName: categoryName,
                itemName: itemName,
                originalItem: item 
            };
            
            // Carrega dados personalizados se existirem
            const itemKey = generateItemKey(categoryName, itemName);
            const customData = customItemData[itemKey] || {};
            
            // Preenche os campos do modal
            document.getElementById('editSimpleItemName').value = customData.name || item.name;
            document.getElementById('editSimpleItemUrl').value = customData.url || item.url;
            
            // Mostra o modal
            document.getElementById('simpleItemEditModal').classList.remove('hidden');
        }

        // Função para fechar modal de edição de item simples
        function closeSimpleItemEditModal() {
            document.getElementById('simpleItemEditModal').classList.add('hidden');
            currentEditingSimpleItem = null;
        }

        // Função para salvar edição de item simples
        function saveSimpleItemEdit() {
            if (!currentEditingSimpleItem) return;
            
            const newName = document.getElementById('editSimpleItemName').value.trim();
            const newUrl = document.getElementById('editSimpleItemUrl').value.trim();
            
            // Validação básica
            if (!newName) {
                alert('Por favor, digite um nome para o item.');
                return;
            }
            
            if (!newUrl) {
                alert('Por favor, digite uma URL de acesso válida.');
                return;
            }
            
            // Adiciona https:// se não tiver protocolo
            let finalUrl = newUrl;
            if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) {
                finalUrl = 'https://' + newUrl;
            }
            
            // Salva os dados personalizados
            const itemKey = generateItemKey(
                currentEditingSimpleItem.categoryName, 
                currentEditingSimpleItem.itemName
            );
            
            customItemData[itemKey] = {
                name: newName,
                url: finalUrl,
                originalName: currentEditingSimpleItem.originalItem.name,
                originalUrl: currentEditingSimpleItem.originalItem.url
            };
            
            // Salva no localStorage
            localStorage.setItem('customItemData', JSON.stringify(customItemData));
            
            // Re-renderiza a sidebar para mostrar as mudanças
            renderMeusAppsCategoriesSidebar();
            
            // Fecha o modal
            closeSimpleItemEditModal();
            
            // Feedback visual
            showSaveConfirmation();
        }

        // Função para gerar chave única do item simples
        function generateItemKey(categoryName, itemName) {
            // Encontra o índice da categoria para garantir unicidade absoluta
            const categoryIndex = meusAppsCategoriesData.findIndex(cat => cat.name === categoryName);
            // Inclui prefixo, índice da categoria e sanitização para garantir unicidade absoluta
            return `item_${categoryIndex}_${categoryName}_${itemName}`.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
        }

        function loadCustomItemData() {
            // Carrega dados personalizados do localStorage
            const saved = localStorage.getItem('customItemData');
            if (saved) {
                try {
                    customItemData = JSON.parse(saved);
                } catch (e) {
                    console.error('Erro ao carregar dados personalizados:', e);
                    customItemData = {};
                }
            }
            
            // Carrega também os dados de cards
            loadCustomCardData();
        }

        // Função para limpar dados conflitantes (usar apenas em caso de emergência)
        function clearConflictingData() {
            if (confirm('ATENÇÃO: Isso irá limpar TODAS as personalizações. Tem certeza?')) {
                customCardData = {};
                customItemData = {};
                localStorage.removeItem('customCardData');
                localStorage.removeItem('customItemData');
                
                // Re-renderiza tudo
                renderMeusAppsCategoriesSidebar();
                
                alert('Dados limpos com sucesso! Todas as personalizações foram removidas.');
                console.log('Dados conflitantes limpos pelo usuário');
            }
        }

        // Inicialização quando a página carrega
        document.addEventListener('DOMContentLoaded', function() {
            // VERSÃO INDIVIDUAL: SEM limpeza automática - dados são persistidos
            console.log('🔧 Versão INDIVIDUAL inicializada - dados persistidos');
            
            // Carrega dados existentes
            loadCustomItemData();
            renderMeusAppsCategoriesSidebar();
            renderVideosCategoriesSidebar();
            
            // Função global para emergência (acessível via console)
            window.clearAllCustomData = clearConflictingData;
            
            // Funções de Export/Import disponíveis globalmente
            window.exportUserConfig = exportUserConfig;
            window.importUserConfig = importUserConfig;
            
            console.log('🔧 Sistema de edição INDIVIDUAL inicializado');
            console.log('💡 Funções disponíveis:');
            console.log('   - exportUserConfig() - Exporta configurações');
            console.log('   - importUserConfig(jsonData) - Importa configurações');
            console.log('   - clearAllCustomData() - Limpa todas as personalizações');
            
            // Adiciona botões de Export/Import
            setTimeout(addExportImportButtons, 1000);
        });

        // Função para exportar configurações do usuário
        function exportUserConfig() {
            // Separar favoritos por tipo
            const sistemaFavorites = userFavorites.filter(fav => fav.type === 'aplicativo');
            const manualFavorites = userFavorites.filter(fav => fav.type === 'manual');
            
            const config = {
                version: "7.1.0",
                timestamp: new Date().toISOString(),
                type: "INDIVIDUAL",
                customizations: customCardData,
                itemCustomizations: customItemData,
                userFavorites: userFavorites, // Array completo para compatibilidade
                starFavorites: sistemaFavorites, // Favoritos por estrelas (seleção)
                manualFavorites: manualFavorites, // Favoritos manuais (adição)
                metadata: {
                    totalCustomizations: Object.keys(customCardData).length + Object.keys(customItemData).length,
                    totalFavorites: userFavorites.length,
                    totalStarFavorites: sistemaFavorites.length,
                    totalManualFavorites: manualFavorites.length
                }
            };
            
            const jsonString = JSON.stringify(config, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `geriah_user_config_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('✅ Configurações exportadas com sucesso!');
            alert(`✅ Configurações exportadas!\n\n📊 Incluído:\n• ${Object.keys(customItemData).length} personalizações de itens\n• ${Object.keys(customCardData).length} personalizações de cards\n• ${sistemaFavorites.length} favoritos por seleção (estrelas)\n• ${manualFavorites.length} favoritos por adição`);
        }

        // Função para importar configurações do usuário
        function importUserConfig(jsonData) {
            try {
                let config;
                
                // Se recebeu string, faz parse
                if (typeof jsonData === 'string') {
                    config = JSON.parse(jsonData);
                } else {
                    config = jsonData;
                }
                
                // Validação básica
                if (!config.type || config.type !== 'INDIVIDUAL') {
                    throw new Error('Arquivo não é uma configuração USER válida');
                }
                
                // Confirma importação
                const itemCount = Object.keys(config.itemCustomizations || config.customItemData || {}).length;
                const cardCount = Object.keys(config.customizations || config.customCardData || {}).length;
                const totalFavCount = (config.userFavorites || []).length;
                const starFavCount = (config.starFavorites || []).length;
                const manualFavCount = (config.manualFavorites || []).length;
                
                // Se não há separação, calcular baseado no total
                const displayStarCount = starFavCount > 0 ? starFavCount : totalFavCount - manualFavCount;
                const displayManualCount = manualFavCount > 0 ? manualFavCount : totalFavCount - starFavCount;
                
                if (!confirm(`Importar configurações de ${config.timestamp}?\n\n📊 Será importado:\n• ${itemCount} personalizações de itens\n• ${cardCount} personalizações de cards\n• ${Math.max(0, displayStarCount)} favoritos por seleção (estrelas)\n• ${Math.max(0, displayManualCount)} favoritos por adição\n\nIsso substituirá suas configurações atuais.`)) {
                    return;
                }
                
                // Importa dados - suporta tanto formato novo quanto antigo
                if (config.itemCustomizations || config.customItemData) {
                    customItemData = config.itemCustomizations || config.customItemData;
                    localStorage.setItem('customItemData', JSON.stringify(customItemData));
                }
                
                if (config.customizations || config.customCardData) {
                    customCardData = config.customizations || config.customCardData;
                    localStorage.setItem('customCardData', JSON.stringify(customCardData));
                }
                
                if (config.userFavorites) {
                    userFavorites = config.userFavorites;
                    localStorage.setItem('userFavorites', JSON.stringify(userFavorites));
                    updateFavoritesCounter();
                    updateFavoritesDisplay();
                }
                
                // Não precisa de tratamento especial para starFavorites
                // pois eles já estão incluídos no userFavorites com type: 'aplicativo'
                
                // Re-renderiza tudo
                renderMeusAppsCategoriesSidebar();
                
                console.log('✅ Configurações importadas com sucesso!');
                alert('✅ Configurações importadas com sucesso!');
                
            } catch (error) {
                console.error('❌ Erro ao importar configurações:', error);
                alert('❌ Erro ao importar configurações: ' + error.message);
            }
        }

        // Função para criar input de arquivo para importação
        function createImportFileInput() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        importUserConfig(e.target.result);
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Adiciona botões de Export/Import ao DOM
        function addExportImportButtons() {
            if (!document.getElementById('exportImportButtons')) {
                const buttonsContainer = document.createElement('div');
                buttonsContainer.id = 'exportImportButtons';
                buttonsContainer.style.cssText = `
                    position: fixed;
                    bottom: 80px;
                    right: 20px;
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                    z-index: 1000;
                `;
                
                const exportBtn = document.createElement('button');
                exportBtn.textContent = '📤 Exportar';
                exportBtn.style.cssText = `
                    border: none;
                    padding: 8px 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 12px;
                    transition: all 0.3s ease;
                `;
                exportBtn.onclick = exportUserConfig;
                
                const importBtn = document.createElement('button');
                importBtn.textContent = '📥 Importar';
                importBtn.style.cssText = `
                    background: #2196F3;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 12px;
                    transition: all 0.3s ease;
                `;
                importBtn.onclick = createImportFileInput;
                
                buttonsContainer.appendChild(exportBtn);
                buttonsContainer.appendChild(importBtn);
                document.body.appendChild(buttonsContainer);
                
                console.log('✅ Botões Export/Import adicionados');
            }
        }

        // Função para mostrar aviso de upgrade
        function showUpgradeAlert(feature) {
            const upgradeModal = document.createElement('div');
            upgradeModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #2d1810, #4a2f16);
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                max-width: 400px;
                border: 2px solid #ff6b35;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            `;
            
            modalContent.innerHTML = `
                <div style="color: #ff6b35; font-size: 3rem; margin-bottom: 15px;">🚀</div>
                <h2 style="color: #ffcc80; margin-bottom: 15px; font-size: 1.5rem;">Recurso PERSONALIZADO</h2>
                <p style="color: #e5e5e5; margin-bottom: 20px; line-height: 1.5;">
                    <strong>${feature}</strong> está disponível apenas na versão <strong>PERSONALIZADO</strong>.
                </p>
                <div style="background: rgba(255, 107, 53, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="color: #ffcc80; margin: 0; font-size: 0.9rem;">
                        ✨ <strong>PERSONALIZADO inclui:</strong><br>
                        • Criar/editar categorias<br>
                        • Personalizar cores e logo<br>
                        • Configurações avançadas<br>
                        • Suporte prioritário
                    </p>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button id="upgradeBtn" style="
                        background: linear-gradient(135deg, #ff6b35, #e55a2b);
                        border: none;
                        padding: 12px 20px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">🚀 FAZER UPGRADE</button>
                    <button id="closeUpgradeModal" style="
                        background: transparent;
                        color: #e5e5e5;
                        border: 1px solid #666;
                        padding: 12px 20px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">Fechar</button>
                </div>
            `;
            
            upgradeModal.appendChild(modalContent);
            document.body.appendChild(upgradeModal);
            
            // Event listeners
            document.getElementById('upgradeBtn').onclick = function() {
                alert('🚀 Entre em contato para upgrade PERSONALIZADO!\n\n📧 Email: novosnegocios@geriah.com\n📱 WhatsApp: +55 11 91159-5028');
                document.body.removeChild(upgradeModal);
            };
            
            document.getElementById('closeUpgradeModal').onclick = function() {
                document.body.removeChild(upgradeModal);
            };
            
            upgradeModal.onclick = function(e) {
                if (e.target === upgradeModal) {
                    document.body.removeChild(upgradeModal);
                }
            };
        }

        // Função para interceptar tentativas de edição de categoria
        function interceptCategoryEdit() {
            // Intercepta cliques nos headers das categorias principais
            document.addEventListener('click', function(e) {
                // Se estiver em modo de edição e clicar em header de categoria
                if (isEditMode && e.target.closest('.accordion-header')) {
                    const header = e.target.closest('.accordion-header');
                    const categoryName = header.textContent.trim().split('\n')[0].trim();
                    
                    // Verifica se é uma categoria principal (não subcategoria)
                    if (header.parentElement.classList.contains('accordion-item')) {
                        e.preventDefault();
                        e.stopPropagation();
                        showUpgradeAlert(`Editar categoria "${categoryName}"`);
            return false;
                    }
                }
                
                // Intercepta tentativas de adicionar nova categoria/subcategoria
                if (isEditMode && e.target.closest('.sub-accordion-header')) {
                    const subHeader = e.target.closest('.sub-accordion-header');
                    const subCategoryName = subHeader.textContent.trim().split('\n')[0].trim();
                    
                    // Se clicar com Ctrl ou Alt (indicando intenção de adicionar)
                    if (e.ctrlKey || e.altKey) {
                        e.preventDefault();
                        e.stopPropagation();
                        showUpgradeAlert(`Adicionar nova subcategoria em "${subCategoryName}"`);
                        return false;
                    }
                }
            });
        }

        // Função para adicionar indicadores visuais de upgrade
        function addUpgradeIndicators() {
            if (isEditMode) {
                // Adiciona indicadores nas categorias principais
                const categoryHeaders = document.querySelectorAll('.accordion-header');
                categoryHeaders.forEach(header => {
                    if (!header.querySelector('.PERSONALIZADO-indicator')) {
                        const indicator = document.createElement('span');
                        indicator.className = 'PERSONALIZADO-indicator';
                        indicator.innerHTML = '🚀';
                        indicator.style.cssText = `
                            position: absolute;
                            right: 30px;
                            top: 50%;
                            transform: translateY(-50%);
                            background: linear-gradient(135deg, #ff6b35, #e55a2b);
                            border-radius: 10px;
                            font-size: 0.7rem;
                            cursor: pointer;
                            z-index: 100;
                        `;
                        indicator.title = 'Clique para upgrade PERSONALIZADO';
                        indicator.onclick = function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            showUpgradeAlert('Editar estrutura de categorias');
                        };
                        header.style.position = 'relative';
                        header.appendChild(indicator);
                    }
                });
            } else {
                // Remove indicadores quando sair do modo de edição
                document.querySelectorAll('.PERSONALIZADO-indicator').forEach(indicator => {
                    indicator.remove();
                });
            }
        }

        // ========== FUNÇÕES PARA MEUS FAVORITOS (USER) ==========

        // Função para carregar favoritos do localStorage (UNIFICADA)
        function loadUserFavorites() {
            const saved = localStorage.getItem('userFavorites');
            if (saved) {
                try {
                    userFavorites = JSON.parse(saved);
                } catch (e) {
                    console.error('Erro ao carregar favoritos:', e);
                    userFavorites = [];
                }
            }
            // Usar função unificada
            updateFavoritesCounter();
            updateFavoritesDisplay();
            
            // Inicializar estado das estrelas após carregar favoritos
            setTimeout(() => {
                initializeStarsState();
                observeStarsChanges(); // Ativar observer para mudanças futuras
            }, 500); // Delay para garantir que o DOM está carregado
        }

        // Função para salvar favoritos no localStorage
        function saveUserFavorites() {
            localStorage.setItem('userFavorites', JSON.stringify(userFavorites));
        }

        // Função para renderizar a lista de favoritos COM SUBCATEGORIAS (SUBSTITUÍDA)
        function renderUserFavorites() {
            // Chamar nossa função unificada
            updateFavoritesDisplay();
        }

        // Função para abrir modal de adicionar favorito
        function openAddFavoriteModal() {
            // Sempre abre o modal - a verificação de limite será feita ao salvar
            
            // Limpa campos
            document.getElementById('addFavoriteName').value = '';
            document.getElementById('addFavoriteUrl').value = '';
            document.getElementById('addFavoriteDescription').value = '';
            
            // Mostra modal
            document.getElementById('addFavoriteModal').classList.remove('hidden');
        }

        // Função para fechar modal de adicionar favorito
        function closeAddFavoriteModal() {
            document.getElementById('addFavoriteModal').classList.add('hidden');
        }

        // Função para salvar novo favorito (UNIFICADA)
        function saveNewFavorite() {
            const name = document.getElementById('addFavoriteName').value.trim();
            const url = document.getElementById('addFavoriteUrl').value.trim();
            const description = document.getElementById('addFavoriteDescription').value.trim();
            
            // Validação
            if (!name) {
                alert('Por favor, digite um nome para o favorito.');
                return;
            }
            
            if (!url) {
                alert('Por favor, digite uma URL válida.');
                return;
            }
            
            // Adiciona https:// se necessário
            let finalUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                finalUrl = 'https://' + url;
            }
            
            // Verifica limite - se atingido, mostra modal de substituição/upgrade
            if (userFavorites.length >= MAX_USER_FAVORITES) {
                // Armazenar dados do novo favorito temporariamente
                window.pendingNewFavorite = {
                    name: name,
                    type: 'manual',
                    url: finalUrl,
                    image: "https://api.iconify.design/tabler/world.svg?color=%23a8a8a8",
                    description: description,
                    dateAdded: new Date().toISOString()
                };
                
                // Fechar modal de adicionar favorito
                closeAddFavoriteModal();
                
                // Mostrar modal de substituição/upgrade
                showAddFavoriteReplacementModal(name);
                return;
            }
            
            // Adiciona favorito com estrutura UNIFICADA
            const newFavorite = {
                name: name,
                type: 'manual', // Identificar como manual
                url: finalUrl,
                image: "https://api.iconify.design/tabler/world.svg?color=%23a8a8a8", // Ícone padrão para manuais
                description: description,
                dateAdded: new Date().toISOString()
            };
            
            userFavorites.push(newFavorite);
            localStorage.setItem('userFavorites', JSON.stringify(userFavorites));
            
            // Usar a função unificada de atualização
            updateFavoritesCounter();
            updateFavoritesDisplay();
            closeAddFavoriteModal();
            
            // Feedback unificado
            showFavoriteToast(`"${name}" adicionado aos favoritos!`);
        }

        // Função para deletar favorito (UNIFICADA)
        function deleteFavorite(index) {
            if (index >= 0 && index < userFavorites.length) {
                const favorite = userFavorites[index];
                if (confirm(`Remover "${favorite.name}" dos favoritos?`)) {
                    userFavorites.splice(index, 1);
                    localStorage.setItem('userFavorites', JSON.stringify(userFavorites));
                    updateFavoritesCounter();
                    updateFavoritesDisplay();
                    showFavoriteToast(`"${favorite.name}" removido dos favoritos!`);
                }
            }
        }

        // Event listeners para modal de favoritos
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar favoritos na inicialização
            loadUserFavorites();
            
            // Garantir que as estrelas sejam inicializadas mesmo se já houver conteúdo
            setTimeout(() => {
                initializeStarsState();
            }, 1000);
        });

        // ========== FIM DAS FUN��ES DE FAVORITOS ==========

        // Função para mostrar modal de substituição/upgrade quando adicionar favorito manual
        function showAddFavoriteReplacementModal(newItemName) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #2d1810, #4a2f16);
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                max-width: 500px;
                border: 2px solid #ff6b35;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            `;
            
            modalContent.innerHTML = `
                <div style="color: #ff6b35; font-size: 2.5rem; margin-bottom: 15px;">⚠️</div>
                <h2 style="color: #ffcc80; margin-bottom: 15px; font-size: 1.4rem;">Limite de Favoritos Atingido!</h2>
                <p style="color: #e5e5e5; margin-bottom: 20px; line-height: 1.5;">
                    Você já tem ${MAX_USER_FAVORITES} favoritos. Para adicionar "<strong>${newItemName}</strong>", escolha uma opção:
                </p>
                
                <div style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px;">
                    <button id="replaceOption" style="
                        background: linear-gradient(135deg, #4CAF50, #45a049);
                        color: white;
                        border: none;
                        padding: 15px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                        font-size: 1rem;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 10px;
                    ">
                        🔄 Substituir um favorito existente
                    </button>
                    
                    <button id="upgradeOption" style="
                        background: linear-gradient(135deg, #ff6b35, #e55a2b);
                        color: white;
                        border: none;
                        padding: 15px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                        font-size: 1rem;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 10px;
                    ">
                        🚀 Fazer Upgrade para PERSONALIZADO
                    </button>
                </div>
                
                <button id="cancelAddFavorite" style="
                    background: transparent;
                    color: #999;
                    border: 1px solid #555;
                    padding: 10px 20px;
                    border-radius: 6px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">Cancelar</button>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Event listeners
            document.getElementById('replaceOption').onclick = function() {
                document.body.removeChild(modal);
                showReplaceFavoriteListModal(newItemName);
            };
            
            document.getElementById('upgradeOption').onclick = function() {
                document.body.removeChild(modal);
                showContactAlert();
            };
            
            document.getElementById('cancelAddFavorite').onclick = function() {
                window.pendingNewFavorite = null;
                document.body.removeChild(modal);
            };
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    window.pendingNewFavorite = null;
                    document.body.removeChild(modal);
                }
            };
        }
        
        // Função para mostrar lista de favoritos para substituição
        function showReplaceFavoriteListModal(newItemName) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #2d1810, #4a2f16);
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                border: 2px solid #4CAF50;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            `;
            
            // Separar favoritos por tipo
            const selecoes = userFavorites.filter(fav => fav.type === 'aplicativo');
            const adicoes = userFavorites.filter(fav => fav.type === 'manual');
            
            let favoritesList = '<div style="display: flex; flex-direction: column; gap: 15px;">';
            
            // Seção Seleções (estrelas)
            if (selecoes.length > 0) {
                favoritesList += `
                    <div style="margin-bottom: 10px;">
                        <h4 style="color: #4CAF50; margin: 0 0 10px 0; font-size: 1rem; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.2rem;">⭐</span> Seleção (${selecoes.length})
                        </h4>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                `;
                selecoes.forEach((favorite, originalIndex) => {
                    const realIndex = userFavorites.findIndex(fav => fav === favorite);
                    favoritesList += `
                                            <button onclick="replaceFavoriteWithNew(${realIndex})" style="
                        background: rgba(76, 175, 80, 0.1);
                        border: 1px solid #4CAF50;
                        color: #e5e5e5;
                        padding: 12px 15px;
                        border-radius: 8px;
                        cursor: pointer;
                        text-align: left;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        gap: 10px;
                    " onmouseover="this.style.background='rgba(76, 175, 80, 0.2)'" 
                       onmouseout="this.style.background='rgba(76, 175, 80, 0.1)'">
                                                    <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2rem; color: #FFD700;">⭐</span>
                            <div>
                                <div style="font-weight: bold;">${favorite.name}</div>
                                <div style="font-size: 0.8rem; color: #4CAF50;">Navegação interna</div>
                            </div>
                        </div>
                        <div style="background: #5e4b75; color: white; padding: 6px 12px; border-radius: 4px; font-size: 0.8rem; font-weight: bold;">
                            🔄 Clique para Substituir
                        </div>
                        </button>
                    `;
                });
                favoritesList += '</div></div>';
            }
            
            // Seção Adições (manuais)
            if (adicoes.length > 0) {
                favoritesList += `
                    <div>
                        <h4 style="color: #FF9800; margin: 0 0 10px 0; font-size: 1rem; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.2rem;">➕</span> Adição (${adicoes.length})
                        </h4>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                `;
                adicoes.forEach((favorite, originalIndex) => {
                    const realIndex = userFavorites.findIndex(fav => fav === favorite);
                    favoritesList += `
                                            <button onclick="replaceFavoriteWithNew(${realIndex})" style="
                        background: rgba(255, 152, 0, 0.1);
                        border: 1px solid #FF9800;
                        color: #e5e5e5;
                        padding: 12px 15px;
                        border-radius: 8px;
                        cursor: pointer;
                        text-align: left;
                        transition: all 0.3s ease;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        gap: 10px;
                    " onmouseover="this.style.background='rgba(255, 152, 0, 0.2)'" 
                       onmouseout="this.style.background='rgba(255, 152, 0, 0.1)'">
                                                    <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2rem; color: #FF9800;">➕</span>
                            <div>
                                <div style="font-weight: bold;">${favorite.name}</div>
                                <div style="font-size: 0.8rem; color: #FF9800;">URL externa</div>
                            </div>
                        </div>
                        <div style="background: #5e4b75; color: white; padding: 6px 12px; border-radius: 4px; font-size: 0.8rem; font-weight: bold;">
                            🔄 Clique para Substituir
                        </div>
                        </button>
                    `;
                });
                favoritesList += '</div></div>';
            }
            
            favoritesList += '</div>';
            
            modalContent.innerHTML = `
                <div style="color: #4CAF50; font-size: 2rem; margin-bottom: 15px;">🔄</div>
                <h2 style="color: #ffcc80; margin-bottom: 15px; font-size: 1.4rem;">Substituir Favorito</h2>
                <p style="color: #e5e5e5; margin-bottom: 8px; line-height: 1.5;">
                    Clique no favorito que deseja substituir por "<strong style="color: #FFD700;">${newItemName}</strong>":
                </p>
                <p style="color: #999; margin-bottom: 20px; font-size: 0.9rem; font-style: italic;">
                    💡 A organização abaixo reflete a ordem do seu menu de favoritos
                </p>
                
                ${favoritesList}
                
                <button id="cancelReplace" style="
                    background: transparent;
                    color: #999;
                    border: 1px solid #555;
                    padding: 10px 20px;
                    border-radius: 6px;
                    cursor: pointer;
                    margin-top: 20px;
                    transition: all 0.3s ease;
                ">Cancelar</button>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Função global para substituir favorito
            window.replaceFavoriteWithNew = function(index) {
                if (window.pendingNewFavorite && index >= 0 && index < userFavorites.length) {
                    const oldFavorite = userFavorites[index];
                    userFavorites[index] = window.pendingNewFavorite;
                    
                    localStorage.setItem('userFavorites', JSON.stringify(userFavorites));
                    updateFavoritesCounter();
                    updateFavoritesDisplay();
                    
                    showFavoriteToast(`"${oldFavorite.name}" substituído por "${window.pendingNewFavorite.name}"!`);
                    
                    window.pendingNewFavorite = null;
                    document.body.removeChild(modal);
                }
            };
            
            // Event listeners
            document.getElementById('cancelReplace').onclick = function() {
                window.pendingNewFavorite = null;
                document.body.removeChild(modal);
            };
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    window.pendingNewFavorite = null;
                    document.body.removeChild(modal);
                }
            };
        }

        // Disponibilizar as funções globalmente
        window.showAddFavoriteReplacementModal = showAddFavoriteReplacementModal;
        window.showReplaceFavoriteListModal = showReplaceFavoriteListModal;

        // Função para mostrar aviso de contato para upgrade
        function showContactAlert() {
            const contactModal = document.createElement('div');
            contactModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #2d1810, #4a2f16);
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                max-width: 450px;
                border: 2px solid #ff6b35;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            `;
            
            modalContent.innerHTML = `
                <div style="color: #ff6b35; font-size: 3rem; margin-bottom: 15px;">🚀</div>
                <h2 style="color: #ffcc80; margin-bottom: 15px; font-size: 1.5rem;">Upgrade para PERSONALIZADO</h2>
                <p style="color: #e5e5e5; margin-bottom: 20px; line-height: 1.5;">
                    Entre em contato conosco para fazer o upgrade e desbloquear todos os recursos!
                </p>
                <div style="background: rgba(255, 107, 53, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="color: #ffcc80; margin: 0; font-size: 0.9rem; text-align: left;">
                        ✨ <strong>PERSONALIZADO inclui:</strong><br>
                        • Favoritos ilimitados<br>
                        • Criar/editar categorias personalizadas<br>
                        • Personalizar cores e logo<br>
                        • Configurações avançadas<br>
                        • Suporte prioritário
                    </p>
                </div>
                <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="color: #81C784; margin: 0; font-size: 0.9rem;">
                        📧 <strong>Email:</strong> novosnegocios@geriah.com<br>
                        📱 <strong>WhatsApp:</strong> +55 11 91159-5028
                    </p>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button id="closeContactModal" style="
                        background: linear-gradient(135deg, #ff6b35, #e55a2b);
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: bold;
                        transition: all 0.3s ease;
                    ">Entendi</button>
                </div>
            `;
            
            contactModal.appendChild(modalContent);
            document.body.appendChild(contactModal);
            
            // Event listeners
            document.getElementById('closeContactModal').onclick = function() {
                document.body.removeChild(contactModal);
            };
            
            contactModal.onclick = function(e) {
                if (e.target === contactModal) {
                    document.body.removeChild(contactModal);
                }
            };
        }
        
        // ========== FUNCIONALIDADE DE BUSCA DO MENU ==========
        
        // Variável global para armazenar índice de busca
        let menuSearchIndex = [];
        
        // Função para criar índice de busca do menu
        function createMenuSearchIndex() {
            menuSearchIndex = [];
            
            // Indexar hierarquia completa do menu
            const sidebar = document.querySelector('aside');
            if (!sidebar) {
                console.log('❌ Sidebar não encontrado');
                return;
            }
            
            // Processar cada categoria principal (accordions)
            const accordions = sidebar.querySelectorAll('.accordion-item');
            console.log(`🔍 Encontrados ${accordions.length} accordions`);
            
            accordions.forEach(accordion => {
                const header = accordion.querySelector('.accordion-header');
                if (!header) return;
                
                const categoryName = cleanMenuText(header.textContent);
                
                // Indexar o cabeçalho da categoria principal
                if (categoryName.length > 2) {
                    menuSearchIndex.push({
                        name: categoryName,
                        originalText: header.textContent.trim(),
                        element: header,
                        path: [],
                        category: categoryName,
                        type: 'category'
                    });
                }
                
                // Processar conteúdo da categoria
                const content = accordion.querySelector('.accordion-content');
                if (!content) return;
                
                // Buscar botões diretos da categoria (sem subcategoria)
                const directButtons = content.querySelectorAll(':scope > button, :scope > a');
                directButtons.forEach(button => {
                    const itemName = cleanMenuText(button.textContent);
                    if (itemName.length > 2) {
                        menuSearchIndex.push({
                            name: itemName,
                            originalText: button.textContent.trim(),
                            element: button,
                            path: [categoryName],
                            category: categoryName,
                            type: 'item'
                        });
                    }
                });
                
                // Processar subcategorias (sub-accordions)
                const subAccordions = content.querySelectorAll('.sub-accordion-item');
                subAccordions.forEach(subAccordion => {
                    const subHeader = subAccordion.querySelector('.sub-accordion-header');
                    if (!subHeader) return;
                    
                    const subCategoryName = cleanMenuText(subHeader.textContent);
                    
                    // Indexar o cabeçalho da subcategoria
                    if (subCategoryName.length > 2) {
                        menuSearchIndex.push({
                            name: subCategoryName,
                            originalText: subHeader.textContent.trim(),
                            element: subHeader,
                            path: [categoryName],
                            category: categoryName,
                            subCategory: subCategoryName,
                            type: 'subcategory'
                        });
                    }
                    
                    // Processar itens da subcategoria
                    const subContent = subAccordion.querySelector('.sub-accordion-content');
                    if (subContent) {
                        // Processar botões/links diretos da subcategoria
                        const subItems = subContent.querySelectorAll(':scope > button, :scope > a');
                        subItems.forEach(item => {
                            const itemName = cleanMenuText(item.textContent);
                            if (itemName.length > 2) {
                                menuSearchIndex.push({
                                    name: itemName,
                                    originalText: item.textContent.trim(),
                                    element: item,
                                    path: [categoryName, subCategoryName],
                                    category: categoryName,
                                    subCategory: subCategoryName,
                                    type: 'item'
                                });
                            }
                        });
                        
                        // Processar sub-sub-accordions (terceiro nível)
                        const subSubAccordions = subContent.querySelectorAll('.sub-sub-accordion-item');
                        subSubAccordions.forEach(subSubAccordion => {
                            const subSubHeader = subSubAccordion.querySelector('.sub-sub-accordion-header');
                            if (!subSubHeader) return;
                            
                            const subSubCategoryName = cleanMenuText(subSubHeader.textContent);
                            
                            // Indexar o cabeçalho da sub-subcategoria
                            if (subSubCategoryName.length > 2) {
                                menuSearchIndex.push({
                                    name: subSubCategoryName,
                                    originalText: subSubHeader.textContent.trim(),
                                    element: subSubHeader,
                                    path: [categoryName, subCategoryName],
                                    category: categoryName,
                                    subCategory: subCategoryName,
                                    subSubCategory: subSubCategoryName,
                                    type: 'subsubcategory'
                                });
                            }
                            
                            // Processar card-menu-items (cards no menu)
                            const subSubContent = subSubAccordion.querySelector('.sub-sub-accordion-content');
                            if (subSubContent) {
                                const cardItems = subSubContent.querySelectorAll('.card-menu-item');
                                cardItems.forEach(cardItem => {
                                    const cardName = cardItem.getAttribute('data-card-name') || cleanMenuText(cardItem.textContent);
                                    if (cardName.length > 2) {
                                        menuSearchIndex.push({
                                            name: cardName,
                                            originalText: cardItem.textContent.trim(),
                                            element: cardItem,
                                            path: [categoryName, subCategoryName, subSubCategoryName],
                                            category: categoryName,
                                            subCategory: subCategoryName,
                                            subSubCategory: subSubCategoryName,
                                            type: 'menu-card'
                                        });
                                    }
                                });
                            }
                        });
                    }
                });
            });
            
            // ADICIONAR CARDS REAIS - buscar apenas elementos que realmente existem
            indexRealCardsFromPage();
            
            console.log('📋 Índice de busca criado:', menuSearchIndex.length, 'itens indexados');
            console.log('🔍 Exemplo de itens indexados:', menuSearchIndex.slice(0, 5).map(item => ({
                name: item.name,
                path: item.path,
                type: item.type
            })));
        }
        
        // Função para limpar texto do menu
        function cleanMenuText(text) {
            if (!text) return '';
            return text
                .replace(/[►▼●]/g, '') // Remove setas
                .replace(/[0-9]+\/[0-9]+/g, '') // Remove contadores como "1/5"
                .replace(/^\d+\s*/, '') // Remove números no início
                .replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '') // Remove emojis
                .replace(/\s+/g, ' ') // Normaliza espaços
                .trim();
        }
        
                // Função para indexar cards reais definidos no código
        function indexRealCardsFromPage() {
            console.log('🔍 Indexando cards reais definidos no código...');
            
                         // Cards que NÃO estão no menu lateral (apenas apps externos)
             const realCards = [
                 // 50+ | Maduros e Idosos - Cards reais do menu
                 { name: "Longevidade", category: "50+ | Maduros e Idosos", menuPath: "50+ | Maduros e Idosos" },
                 { name: "Analise CNIS", category: "50+ | Maduros e Idosos", menuPath: "50+ | Maduros e Idosos" },
                 { name: "CNIS Suporte", category: "50+ | Maduros e Idosos", menuPath: "50+ | Maduros e Idosos" },
                
                 // Ferramentas & Negócios - Cards reais do menu
                 { name: "FNW - Formulário Estratégico", category: "Ferramentas & Negócios", menuPath: "FNW Assessoria" },
                 { name: "FNW - ROI Maker", category: "Ferramentas & Negócios", menuPath: "FNW Assessoria" },
                 { name: "Painel ETO", category: "Ferramentas & Negócios", menuPath: "FNW Assessoria" },
                
                 // IA e Automação - Cards reais do menu
                 { name: "IA Prompt Wizzard", category: "IA e Automação", menuPath: "Wizzards" },
                 { name: "Chat Rosio Livia Geriah", category: "IA e Automação", menuPath: "Assistentes" },
                 { name: "HumanIA", category: "IA e Automação", menuPath: "Assistentes" },
                 { name: "London Lord", category: "IA e Automação", menuPath: "Assistentes" },
                 
                 // Parcerias - Cards reais do menu
                 { name: "FNW Sinergias", category: "Parcerias", menuPath: "Parcerias" },
                 { name: "IDEIA21", category: "Parcerias", menuPath: "Parcerias" },
                 { name: "IPSOLON", category: "Parcerias", menuPath: "Parcerias" },
                 { name: "Feito Por Você", category: "Parcerias", menuPath: "Feito Por Você" },
                 
                 // Entretenimento - REMOVIDOS: agora são indexados como itens do menu
                 // { name: "Séries", category: "Entretenimento" },
                 // { name: "Curiosidades", category: "Entretenimento" },
                 // { name: "Estilo de Vida", category: "Entretenimento" },
                 // { name: "Notícias de Europa", category: "Entretenimento" },
                 // { name: "CNIS", category: "Entretenimento" },
                
                // Saúde
                { name: "Nutrição", category: "Saúde" },
                { name: "Atividades", category: "Saúde" },
                { name: "Convênio", category: "Saúde" },
                { name: "Médico", category: "Saúde" },
                { name: "Farmácia", category: "Saúde" },
                { name: "Hospital", category: "Saúde" },
                
                // Comunicação
                { name: "WhatsApp", category: "Comunicação" },
                { name: "Telegram", category: "Comunicação" },
                { name: "Email Gmail", category: "Comunicação" },
                { name: "Google Meet", category: "Comunicação" },
                { name: "Zoom", category: "Comunicação" },
                { name: "WhatsApp Business", category: "Comunicação" },
                
                // Finanças
                { name: "Banco do Brasil", category: "Finanças" },
                { name: "Bradesco", category: "Finanças" },
                { name: "Caixa", category: "Finanças" },
                { name: "Itaú", category: "Finanças" },
                { name: "Nubank", category: "Finanças" },
                { name: "Santander", category: "Finanças" },
                
                // Lazer
                { name: "Netflix", category: "Lazer" },
                { name: "PlutoTV", category: "Lazer" },
                { name: "Prime Video", category: "Lazer" },
                { name: "Spotify", category: "Lazer" },
                { name: "YouTube", category: "Lazer" },
                
                // Culinária
                { name: "iFood", category: "Culinária e Gastronomia" },
                { name: "Pão de Açúcar", category: "Culinária e Gastronomia" },
                
                // Transporte
                { name: "Uber", category: "Transporte" },
                { name: "99", category: "Transporte" }
            ];
            
            // Adicionar todos os cards reais ao índice
            realCards.forEach(card => {
                let pathArray = ['Cards', card.category];
                
                // Definir o caminho correto baseado na categoria
                if (card.category === '50+ | Maduros e Idosos') {
                    pathArray = ['Ferramentas & Negócios', '50+ | Maduros e Idosos'];
                } else if (card.category === 'Ferramentas & Negócios') {
                    pathArray = ['Ferramentas & Negócios', card.menuPath || 'FNW Assessoria'];
                } else if (card.category === 'IA e Automação') {
                    pathArray = ['Suporte - IA', card.menuPath || 'Assistentes'];
                } else if (card.category === 'Parcerias') {
                    pathArray = ['PARTICIPE', card.menuPath || 'Parcerias'];
                }
                
                menuSearchIndex.push({
                    name: card.name,
                    originalText: card.name,
                    element: null, // Será encontrado dinamicamente quando necessário
                    path: pathArray,
                    category: card.category,
                    menuPath: card.menuPath,
                    type: 'card'
                });
            });
            
            console.log(`📚 ${realCards.length} cards reais indexados das definições do código`);
        }
        
                // Função para realizar busca
        function searchMenu(query) {
            if (!query || query.length < 2) {
                return [];
            }

            const searchTerm = query.toLowerCase().trim();
            const results = [];

            menuSearchIndex.forEach(item => {
                const itemName = item.name.toLowerCase();
                const matchScore = calculateMatchScore(itemName, searchTerm);

                if (matchScore > 0) {
                    results.push({
                        ...item,
                        matchScore: matchScore,
                        highlightedName: highlightSearchTerm(item.name, searchTerm)
                    });
                }
            });

            // Ordenar por relevância (score maior primeiro)
            return results.sort((a, b) => b.matchScore - a.matchScore);
        }
        
        // Função para calcular score de match
        function calculateMatchScore(text, searchTerm) {
            const textLower = text.toLowerCase();
            const searchLower = searchTerm.toLowerCase();
            
            // Match exato tem score maior
            if (textLower === searchLower) return 100;
            
            // Começa com o termo
            if (textLower.startsWith(searchLower)) return 80;
            
            // Contém o termo exato
            if (textLower.includes(searchLower)) return 60;
            
            // Busca flexível - remover espaços e símbolos para comparação
            const textClean = textLower.replace(/[^a-z0-9]/g, '');
            const searchClean = searchLower.replace(/[^a-z0-9]/g, '');
            
            if (searchClean.length > 0 && textClean.includes(searchClean)) return 50;
            
            // Busca por palavras individuais
            const words = searchLower.split(/[\s\+\-\|]+/).filter(w => w.length > 0);
            let score = 0;
            words.forEach(word => {
                if (word.length > 1 && textLower.includes(word)) {
                    score += word.length;
                }
            });
            
            return score;
        }
        
        // Função para destacar termo de busca
        function highlightSearchTerm(text, searchTerm) {
            // Escapar caracteres especiais do regex, mas preservar o significado na busca
            const escapedTerm = searchTerm.replace(/[.*?^${}()|[\]\\]/g, '\\$&').replace(/\\\+/g, '\\+');
            const regex = new RegExp(`(${escapedTerm})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }
        
        // Função para exibir resultados de busca
        function displaySearchResults(results) {
            const searchResults = document.getElementById('searchResults');
            
            if (results.length === 0) {
                // Limpar destaques quando não há resultados
                clearPreviousHighlights();
                searchResults.innerHTML = '<div class="search-no-results">Nenhum resultado encontrado</div>';
                searchResults.style.display = 'block';
                return;
            }
            
            // Expandir categorias e destacar itens no menu em tempo real
            expandAndHighlightItems(results);
            
            // Separar resultados por tipo
            const menuResults = results.filter(r => r.type !== 'card');
            const cardResults = results.filter(r => r.type === 'card');
            
            // Adicionar cabeçalho da lista
            let html = `
                <div style="padding: 12px 15px; border-bottom: 2px solid rgba(128, 76, 154, 0.3); background: rgba(128, 76, 154, 0.1); margin-bottom: 5px;">
                    <div style="color: #fff; font-weight: bold; font-size: 0.9em;">
                        🔍 Resultados da Busca (${results.length})
                    </div>
                </div>
            `;
            
            // Mostrar resultados do Menu primeiro
            if (menuResults.length > 0) {
                html += `
                    <div style="padding: 8px 15px; background: rgba(255,255,255,0.05); margin: 5px 0;">
                        <strong>📋 Menu (${menuResults.length})</strong>
                    </div>
                `;
                
                menuResults.slice(0, 5).forEach((result, index) => {
                    // Construir caminho hierárquico completo
                    let pathText = '';
                    let typeIcon = '';
                    
                    if (result.type === 'category') {
                        pathText = 'Categoria Principal';
                        typeIcon = '📁';
                    } else if (result.type === 'subcategory') {
                        pathText = result.path.join(' › ');
                        typeIcon = '📂';
                    } else if (result.type === 'subsubcategory') {
                        pathText = result.path.join(' › ');
                        typeIcon = '📂';
                    } else if (result.type === 'menu-card') {
                        pathText = result.path.join(' › ');
                        typeIcon = '🎴';
                    } else if (result.type === 'item') {
                        pathText = result.path.join(' › ');
                        typeIcon = '📄';
                    } else {
                        // Fallback para itens antigos
                        pathText = result.path.length > 0 
                            ? result.path.join(' › ') 
                            : result.category;
                        typeIcon = '📋';
                    }
                    
                    html += `
                        <div class="search-result-item" data-card-name="${result.name}" data-result-index="menu-${index}">
                            <div class="search-result-name">${typeIcon} ${result.highlightedName}</div>
                            <div class="search-result-path">📍 ${pathText}</div>
                        </div>
                    `;
                });
            }
            
            // Mostrar Cards
            if (cardResults.length > 0) {
                html += `
                    <div style="padding: 8px 15px; background: rgba(255,255,255,0.05); margin: 5px 0;">
                        <strong>📚 Cards (${cardResults.length})</strong>
                    </div>
                `;
                
                cardResults.slice(0, 5).forEach((result, index) => {
                    html += `
                        <div class="search-result-item" data-card-name="${result.name}" data-result-index="card-${index}">
                            <div class="search-result-name">${result.highlightedName}</div>
                            <div class="search-result-path">📚 ${result.category}</div>
                        </div>
                    `;
                });
            }
            
            searchResults.innerHTML = html;
            searchResults.style.display = 'block';
            
            // Adicionar event listeners para cliques nos resultados
            const resultItems = searchResults.querySelectorAll('.search-result-item');
            resultItems.forEach(item => {
                item.addEventListener('click', function() {
                    const cardName = this.getAttribute('data-card-name');
                    const resultIndex = this.getAttribute('data-result-index');
                    
                    console.log(`🖱️ Clique no resultado: "${cardName}" (${resultIndex})`);
                    
                    if (resultIndex.startsWith('card-')) {
                        // É um card - navegar para o card
                        console.log('🎯 Navegando para CARD:', cardName);
                        navigateToCard(cardName);
                    } else {
                        // É um item do menu - navegar para o item do menu
                        console.log('📋 Navegando para MENU:', cardName);
                        navigateToMenuItemByName(cardName);
                    }
                });
            });
        }
        
        // Função para expandir categorias pai
        function expandParentCategories(element) {
            let parent = element.closest('.accordion-item');
            while (parent) {
                const header = parent.querySelector('.accordion-header');
                const content = parent.querySelector('.accordion-content');
                
                if (header && content && content.style.display === 'none') {
                    header.click(); // Simula clique para expandir
                }
                
                // Verificar se está dentro de um sub-acordeão
                const subParent = element.closest('.sub-accordion-item');
                if (subParent) {
                    const subHeader = subParent.querySelector('.sub-accordion-header');
                    const subContent = subParent.querySelector('.sub-accordion-content');
                    
                    if (subHeader && subContent && subContent.style.display === 'none') {
                        subHeader.click();
                    }
                }
                
                parent = parent.parentElement?.closest('.accordion-item');
            }
        }
        
        // Função para destacar elemento temporariamente
        function highlightElement(element) {
            if (!element) return;
            
            console.log('✨ Destacando elemento:', element);
            
            // Remover destaque anterior
            const previousHighlighted = document.querySelector('.search-highlighted');
            if (previousHighlighted) {
                previousHighlighted.classList.remove('search-highlighted');
                previousHighlighted.style.cssText = '';
            }
            
            // Adicionar classe e estilo de destaque
            element.classList.add('search-highlighted');
            const originalStyle = element.style.cssText;
            
            element.style.cssText += `
                background: rgba(255, 215, 0, 0.2) !important;
                border: 3px solid #FFD700 !important;
                box-shadow: 0 0 15px rgba(255, 215, 0, 0.6) !important;
                transform: scale(1.02) !important;
                transition: all 0.3s ease !important;
                z-index: 1000 !important;
            `;
            
            // Remover destaque após 5 segundos
            setTimeout(() => {
                element.classList.remove('search-highlighted');
                element.style.cssText = originalStyle;
            }, 5000);
        }
        
        // Função para navegar até uma categoria específica
        function navigateToCategory(categoryName) {
            console.log(`📂 Procurando categoria: "${categoryName}"`);
            
            // Buscar por headers de acordeão que contenham o nome da categoria
            const accordionHeaders = document.querySelectorAll('.accordion-header, .sub-accordion-header');
            
            for (let header of accordionHeaders) {
                const headerText = header.textContent?.trim();
                if (headerText && headerText.toLowerCase().includes(categoryName.toLowerCase())) {
                    console.log(`✅ Categoria encontrada: ${headerText}`);
                    
                    // Expandir a categoria se estiver fechada
                    const content = header.parentElement?.querySelector('.accordion-content, .sub-accordion-content');
                    if (content && content.style.display === 'none') {
                        console.log('🔓 Expandindo categoria...');
                        header.click();
                    }
                    
                    // Scroll até a categoria
                    header.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                    
                    // Destacar temporariamente o header
                    highlightElement(header);
                    
                    return true;
                }
            }
            
            console.log(`❌ Categoria "${categoryName}" não encontrada no menu`);
            return false;
        }
        
        // Função para navegar até um item do menu
        function navigateToMenuItem(menuElement) {
            console.log('📋 Navegando para item do menu:', menuElement);
            
            // Fechar resultados de busca
            const searchResults = document.getElementById('searchResults');
            if (searchResults) {
                searchResults.style.display = 'none';
            }
            
            // Expandir categorias pai se necessário
            expandParentCategories(menuElement);
            
            // Navegar até o elemento
            setTimeout(() => {
                menuElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
                
                // Destacar o elemento
                highlightElement(menuElement);
            }, 500);
        }
        
        // Função para navegar até um item do menu pelo nome
        function navigateToMenuItemByName(itemName) {
            console.log(`📋 Navegando para item do menu: "${itemName}"`);
            
            // Fechar resultados de busca
            const searchResults = document.getElementById('searchResults');
            if (searchResults) {
                searchResults.style.display = 'none';
            }
            
            // Encontrar o item no índice
            const menuItem = menuSearchIndex.find(item => item.name === itemName && item.type !== 'card');
            
            if (!menuItem) {
                console.log('❌ Item do menu não encontrado no índice');
                return;
            }
            
            // Se é uma categoria, expandir ela
            if (menuItem.type === 'category') {
                console.log('📁 Navegando para categoria principal');
                if (menuItem.element) {
                    const content = menuItem.element.parentElement.querySelector('.accordion-content');
                    if (content && content.style.display === 'none') {
                        menuItem.element.click();
                    }
                    menuItem.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    highlightElement(menuItem.element);
                }
                return;
            }
            
            // Se é uma subcategoria, expandir a categoria pai e depois ela
            if (menuItem.type === 'subcategory') {
                console.log('📂 Navegando para subcategoria');
                // Primeiro expandir a categoria pai
                const parentCategory = menuItem.category;
                const parentHeader = Array.from(document.querySelectorAll('.accordion-header')).find(header => 
                    cleanMenuText(header.textContent) === parentCategory
                );
                
                if (parentHeader) {
                    const parentContent = parentHeader.parentElement.querySelector('.accordion-content');
                    if (parentContent && parentContent.style.display === 'none') {
                        parentHeader.click();
                    }
                    
                    // Aguardar e depois clicar na subcategoria
                    setTimeout(() => {
                        if (menuItem.element) {
                            const subContent = menuItem.element.parentElement.querySelector('.sub-accordion-content');
                            if (subContent && subContent.style.display === 'none') {
                                menuItem.element.click();
                            }
                            menuItem.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            highlightElement(menuItem.element);
                        }
                    }, 500);
                }
                return;
            }
            
            // Se é um item final, expandir todas as categorias pai e navegar até ele
            if (menuItem.type === 'item') {
                console.log('📄 Navegando para item final');
                
                // Expandir categoria principal
                const parentCategory = menuItem.category;
                const parentHeader = Array.from(document.querySelectorAll('.accordion-header')).find(header => 
                    cleanMenuText(header.textContent) === parentCategory
                );
                
                if (parentHeader) {
                    const parentContent = parentHeader.parentElement.querySelector('.accordion-content');
                    if (parentContent && parentContent.style.display === 'none') {
                        parentHeader.click();
                    }
                    
                    // Se tem subcategoria, expandir ela também
                    if (menuItem.subCategory) {
                        setTimeout(() => {
                            const subHeader = Array.from(document.querySelectorAll('.sub-accordion-header')).find(header => 
                                cleanMenuText(header.textContent) === menuItem.subCategory
                            );
                            
                            if (subHeader) {
                                const subContent = subHeader.parentElement.querySelector('.sub-accordion-content');
                                if (subContent && subContent.style.display === 'none') {
                                    subHeader.click();
                                }
                                
                                // Aguardar e navegar até o item final
                                setTimeout(() => {
                                    if (menuItem.element) {
                                        menuItem.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                        highlightElement(menuItem.element);
                                    }
                                }, 500);
                            }
                        }, 500);
                    } else {
                        // Item direto da categoria (sem subcategoria)
                        setTimeout(() => {
                            if (menuItem.element) {
                                menuItem.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                highlightElement(menuItem.element);
                            }
                        }, 500);
                    }
                }
            }
        }
        
        // Função para navegar até um card
        function navigateToCard(cardName) {
            console.log(`🎯 NAVEGANDO PARA O CARD: "${cardName}"`);
            
            // Fechar resultados de busca
            const searchResults = document.getElementById('searchResults');
            if (searchResults) {
                searchResults.style.display = 'none';
            }
            
            // Encontrar informações do card
            const cardInfo = menuSearchIndex.find(item => item.name === cardName && item.type === 'card');
            
            if (!cardInfo) {
                console.log('❌ Card não encontrado no índice');
                return;
            }
            
            console.log('📋 Info do card:', cardInfo);
            
            // Navegar para o menu correto baseado na categoria
            if (cardInfo.category === 'Ferramentas & Negócios') {
                console.log('🔧 Navegando para Ferramentas & Negócios');
                navigateToFerramentasCard(cardInfo);
            } else if (cardInfo.category === 'IA e Automação') {
                console.log('🤖 Navegando para IA e Automação');
                navigateToIACard(cardInfo);
            } else if (cardInfo.category === 'Parcerias') {
                console.log('🤝 Navegando para Parcerias');
                navigateToParceriasCard(cardInfo);
            } else if (cardInfo.category === '50+ | Maduros e Idosos') {
                console.log('👴 Navegando para 50+ | Maduros e Idosos');
                navigateToMadurosCard(cardInfo);
            } else {
                console.log(`📂 Navegando para categoria genérica: ${cardInfo.category}`);
                // Para cards externos (Saúde, Comunicação, etc.), apenas mostrar onde estão
                alert(`Card "${cardName}" está na categoria "${cardInfo.category}". Este é um app externo.`);
            }
        }
        
        // Navegar para cards de Ferramentas & Negócios
        function navigateToFerramentasCard(cardInfo) {
            console.log('🔧 Procurando Ferramentas & Negócios...');
            const ferramentasButton = Array.from(document.querySelectorAll('.accordion-header')).find(header => 
                header.textContent.includes('Ferramentas & Negócios')
            );
            
            if (ferramentasButton) {
                console.log('✅ Ferramentas & Negócios encontrado');
                // Expandir Ferramentas & Negócios
                const content = ferramentasButton.parentElement.querySelector('.accordion-content');
                if (content && content.style.display === 'none') {
                    console.log('🔓 Expandindo Ferramentas & Negócios');
                    ferramentasButton.click();
                }
                
                // Aguardar e clicar no submenu
                setTimeout(() => {
                    console.log(`🔍 Procurando submenu: "${cardInfo.menuPath}"`);
                    const submenuButton = Array.from(document.querySelectorAll('button')).find(btn => 
                        btn.textContent.trim() === cardInfo.menuPath
                    );
                    
                    if (submenuButton) {
                        console.log('✅ Submenu encontrado, clicando...');
                        submenuButton.click();
                        
                        // Aguardar um pouco mais para garantir que o conteúdo seja carregado
                        setTimeout(() => {
                            submenuButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            highlightElement(submenuButton);
                        }, 500);
                    } else {
                        console.log('❌ Submenu não encontrado');
                    }
                }, 800);
            } else {
                console.log('❌ Ferramentas & Negócios não encontrado');
            }
        }
        
        // Navegar para cards de IA e Automação
        function navigateToIACard(cardInfo) {
            const suporteButton = Array.from(document.querySelectorAll('.accordion-header')).find(header => 
                header.textContent.includes('Suporte - IA')
            );
            
            if (suporteButton) {
                // Expandir Suporte - IA
                const content = suporteButton.parentElement.querySelector('.accordion-content');
                if (content && content.style.display === 'none') {
                    suporteButton.click();
                }
                
                // Aguardar e clicar no submenu
                setTimeout(() => {
                    const submenuButton = Array.from(document.querySelectorAll('button')).find(btn => 
                        btn.textContent.trim() === cardInfo.menuPath
                    );
                    
                    if (submenuButton) {
                        submenuButton.click();
                        submenuButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        highlightElement(submenuButton);
                    }
                }, 500);
            }
        }
        
        // Navegar para cards de Parcerias
        function navigateToParceriasCard(cardInfo) {
            const participeButton = Array.from(document.querySelectorAll('.accordion-header')).find(header => 
                header.textContent.includes('PARTICIPE')
            );
            
            if (participeButton) {
                // Expandir PARTICIPE
                const content = participeButton.parentElement.querySelector('.accordion-content');
                if (content && content.style.display === 'none') {
                    participeButton.click();
                }
                
                // Aguardar e clicar no submenu
                setTimeout(() => {
                    const submenuButton = Array.from(document.querySelectorAll('button')).find(btn => 
                        btn.textContent.trim() === cardInfo.menuPath
                    );
                    
                    if (submenuButton) {
                        submenuButton.click();
                        submenuButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        highlightElement(submenuButton);
                    }
                }, 500);
            }
        }
        
        // Navegar para cards de 50+ | Maduros e Idosos
        function navigateToMadurosCard(cardInfo) {
            const ferramentasButton = Array.from(document.querySelectorAll('.accordion-header')).find(header => 
                header.textContent.includes('Ferramentas & Negócios')
            );
            
            if (ferramentasButton) {
                // Expandir Ferramentas & Negócios
                const content = ferramentasButton.parentElement.querySelector('.accordion-content');
                if (content && content.style.display === 'none') {
                    ferramentasButton.click();
                }
                
                // Aguardar e clicar em "50+ | Maduros e Idosos"
                setTimeout(() => {
                    const madurosButton = Array.from(document.querySelectorAll('button')).find(btn => 
                        btn.textContent.includes('50+ | Maduros e Idosos')
                    );
                    
                    if (madurosButton) {
                        madurosButton.click();
                        madurosButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        highlightElement(madurosButton);
                    }
                }, 500);
            }
        }
        
        // Função para encontrar o card real na página
        function findRealCard(cardName) {
            console.log(`🔍 Procurando card real: "${cardName}"`);
            
            // Buscar em diferentes seletores possíveis, incluindo elementos visíveis
            const selectors = [
                'a', 'button', '.card', '.course-card', '.resource-card', 
                '[class*="card"]', '.item', '[class*="item"]', 'li',
                '[onclick]', '.clickable', '.resource', '.content-item'
            ];
            
            for (let selector of selectors) {
                const elements = document.querySelectorAll(selector);
                for (let element of elements) {
                    const text = element.textContent?.trim() || '';
                    const title = element.title || element.getAttribute('data-title') || '';
                    
                    // Verificar se o elemento está visível
                    const isVisible = element.offsetParent !== null;
                    
                    if (isVisible && (
                        text.toLowerCase().includes(cardName.toLowerCase()) ||
                        title.toLowerCase().includes(cardName.toLowerCase())
                    )) {
                        console.log(`✅ Card encontrado: "${text}" (seletor: ${selector})`);
                        return element;
                    }
                }
            }
            
            console.log(`❌ Card "${cardName}" não encontrado na página`);
            return null;
        }
        
        // Função para destacar um card
        function highlightCard(cardElement) {
            // Remover destaque anterior
            const previousHighlighted = document.querySelector('.card-highlighted');
            if (previousHighlighted) {
                previousHighlighted.classList.remove('card-highlighted');
            }
            
            // Adicionar destaque ao card
            cardElement.classList.add('card-highlighted');
            
            // Adicionar efeito visual
            const originalStyle = cardElement.style.cssText;
            cardElement.style.cssText += `
                background: rgba(255, 215, 0, 0.2) !important;
                border: 3px solid #FFD700 !important;
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.6) !important;
                transform: scale(1.02) !important;
                transition: all 0.3s ease !important;
                z-index: 1000 !important;
            `;
            
            // Remover destaque após 5 segundos
            setTimeout(() => {
                cardElement.style.cssText = originalStyle;
                cardElement.classList.remove('card-highlighted');
            }, 5000);
        }
        

        
        // Variável para armazenar últimos resultados
        let lastSearchResults = [];
        

        
        // Event listeners para o campo de busca
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('menuSearchInput');
            const clearBtn = document.getElementById('clearSearchBtn');
            const searchResults = document.getElementById('searchResults');
            
            if (!searchInput) return;
            
            // Criar índice de busca após carregar o DOM
            setTimeout(createMenuSearchIndex, 2000);
            
            // Event listener para digitação
            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                
                if (query.length === 0) {
                    searchResults.style.display = 'none';
                    clearBtn.style.display = 'none';
                    clearPreviousHighlights(); // Limpar destaques quando não há busca
                    return;
                }
                
                clearBtn.style.display = 'block';
                
                if (query.length < 2) {
                    clearPreviousHighlights(); // Limpar destaques para buscas muito curtas
                    searchResults.innerHTML = '<div class="search-no-results">Digite pelo menos 2 caracteres</div>';
                    searchResults.style.display = 'block';
                    return;
                }
                
                const results = searchMenu(query);
                lastSearchResults = results;
                displaySearchResults(results);
            });
            
            // Event listener para limpar busca
            clearBtn.addEventListener('click', function() {
                searchInput.value = '';
                searchResults.style.display = 'none';
                clearBtn.style.display = 'none';
                clearPreviousHighlights(); // Limpar destaques do menu
                searchInput.focus();
            });
            
            // Event listener para tecla ESC
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    this.value = '';
                    searchResults.style.display = 'none';
                    clearBtn.style.display = 'none';
                    this.blur();
                }
            });
            
            // Event listener para cliques nos resultados de busca
            searchResults.addEventListener('click', function(e) {
                const resultItem = e.target.closest('.search-result-item');
                if (resultItem) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const cardName = resultItem.getAttribute('data-card-name');
                    const isMenuItem = resultItem.getAttribute('data-result-index')?.startsWith('menu-');
                    
                    console.log('🖱️ CLIQUE NO RESULTADO:', { cardName, isMenuItem });
                    
                    if (cardName) {
                        if (isMenuItem) {
                            // É um item do menu
                            const menuElement = menuSearchIndex.find(item => item.name === cardName)?.element;
                            if (menuElement) {
                                console.log('📋 Navegando para item do menu');
                                navigateToMenuItem(menuElement);
                            }
                        } else {
                            // É um card
                            console.log('📚 Navegando para card');
                            navigateToCard(cardName);
                        }
                    }
                }
            });
            
            // Fechar resultados ao clicar fora
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.menu-search-container') && !e.target.closest('#searchResults')) {
                    searchResults.style.display = 'none';
                }
            });
            
            // Recriar índice quando novos itens forem carregados
            const observer = new MutationObserver(function() {
                setTimeout(createMenuSearchIndex, 500);
            });
            
            const sidebar = document.querySelector('aside');
            if (sidebar) {
                observer.observe(sidebar, { 
                    childList: true, 
                    subtree: true 
                });
            }
        });
        
        // Função para expandir categorias e destacar itens no menu em tempo real
        function expandAndHighlightItems(results) {
            // Limpar destaques anteriores
            clearPreviousHighlights();
            
            // Processar todos os resultados para destacar
            results.slice(0, 5).forEach(result => { // Processa os 5 primeiros resultados
                if (result.element) {
                    // Lógica especial para subcategorias de CEL APPS
                    if (result.type === 'cel-apps-subcategory' || result.type === 'cel-apps-item') {
                        console.log(`🔧 Expandindo CEL APPS para: ${result.text}`);
                        
                        // 1. Expande CEL APPS principal
                        const celAppsHeader = document.querySelector('h2.accordion-header');
                        if (celAppsHeader && celAppsHeader.textContent.includes('CEL APPS')) {
                            const celAppsContent = celAppsHeader.nextElementSibling;
                            if (celAppsContent && celAppsContent.classList.contains('accordion-content')) {
                                if (celAppsContent.style.display === 'none') {
                                    celAppsHeader.click(); // Simula clique para expandir
                                }
                            }
                        }
                        
                        // 2. Se for um item de app específico, também expande a subcategoria
                        if (result.type === 'cel-apps-item' && result.subcategoryName) {
                            setTimeout(() => {
                                document.querySelectorAll('.sub-accordion-header').forEach(subHeader => {
                                    if (subHeader.textContent.includes(result.subcategoryName)) {
                                        const subContent = subHeader.nextElementSibling;
                                        if (subContent && subContent.classList.contains('sub-accordion-content')) {
                                            if (subContent.style.display === 'none') {
                                                subHeader.click(); // Simula clique para expandir
                                            }
                                        }
                                    }
                                });
                            }, 300);
                        }
                    }
                    
                    // Expandir categorias pai
                    expandParentCategoriesForSearch(result.element);
                    
                    // Destacar o item no menu (sem foco ainda)
                    result.element.classList.add('search-highlighted-item');
                } else if (result.type === 'card') {
                    // Para cards, expandir automaticamente o menu onde eles estão
                    expandMenuForCard(result);
                }
            });
            
            // Focar apenas no primeiro resultado (melhor match)
            if (results.length > 0) {
                if (results[0].element) {
                    setTimeout(() => {
                        results[0].element.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }, 800); // Delay maior para permitir que todas as categorias se expandam
                } else if (results[0].type === 'card') {
                    // Para cards, navegar automaticamente
                    setTimeout(() => {
                        navigateToCardAutomatically(results[0]);
                    }, 500);
                }
            }
        }
        
        // Função para expandir menu onde o card está localizado
        function expandMenuForCard(cardInfo) {
            console.log(`🎯 Expandindo menu para card: ${cardInfo.name}`);
            
            if (cardInfo.category === 'Ferramentas & Negócios') {
                const ferramentasButton = Array.from(document.querySelectorAll('.accordion-header')).find(header => 
                    header.textContent.includes('Ferramentas & Negócios')
                );
                
                if (ferramentasButton) {
                    const content = ferramentasButton.parentElement.querySelector('.accordion-content');
                    if (content && content.style.display === 'none') {
                        ferramentasButton.click();
                        
                        // Expandir submenu também
                        setTimeout(() => {
                            const submenuButton = Array.from(document.querySelectorAll('button')).find(btn => 
                                btn.textContent.trim() === cardInfo.menuPath
                            );
                            if (submenuButton) {
                                submenuButton.classList.add('search-highlighted-item');
                            }
                        }, 300);
                    }
                }
            } else if (cardInfo.category === 'IA e Automação') {
                const suporteButton = Array.from(document.querySelectorAll('.accordion-header')).find(header => 
                    header.textContent.includes('Suporte - IA')
                );
                
                if (suporteButton) {
                    const content = suporteButton.parentElement.querySelector('.accordion-content');
                    if (content && content.style.display === 'none') {
                        suporteButton.click();
                    }
                }
            } else if (cardInfo.category === 'Parcerias') {
                const participeButton = Array.from(document.querySelectorAll('.accordion-header')).find(header => 
                    header.textContent.includes('PARTICIPE')
                );
                
                if (participeButton) {
                    const content = participeButton.parentElement.querySelector('.accordion-content');
                    if (content && content.style.display === 'none') {
                        participeButton.click();
                    }
                }
            }
        }
        
        // Função para navegar automaticamente para card (sem clique)
        function navigateToCardAutomatically(cardInfo) {
            console.log(`🎯 Navegação automática para card: ${cardInfo.name}`);
            
            if (cardInfo.category === 'Ferramentas & Negócios') {
                const submenuButton = Array.from(document.querySelectorAll('button')).find(btn => 
                    btn.textContent.trim() === cardInfo.menuPath
                );
                if (submenuButton) {
                    submenuButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    submenuButton.classList.add('search-highlighted-item');
                }
            }
        }
        
        // Função para expandir categorias pai (para busca)
        function expandParentCategoriesForSearch(element) {
            // Expandir acordeão principal se necessário
            let parent = element.closest('.accordion-item');
            if (parent) {
                const header = parent.querySelector('.accordion-header');
                const content = parent.querySelector('.accordion-content');
                
                if (header && content && content.style.display === 'none') {
                    header.click(); // Simula clique para expandir
                }
            }
            
            // Expandir sub-acordeão se necessário
            let subParent = element.closest('.sub-accordion-item');
            if (subParent) {
                const subHeader = subParent.querySelector('.sub-accordion-header');
                const subContent = subParent.querySelector('.sub-accordion-content');
                
                if (subHeader && subContent && subContent.style.display === 'none') {
                    subHeader.click(); // Simula clique para expandir
                }
            }
            
            // Expandir sub-sub-acordeão se necessário (terceiro nível)
            let subSubParent = element.closest('.sub-sub-accordion-item');
            if (subSubParent) {
                const subSubHeader = subSubParent.querySelector('.sub-sub-accordion-header');
                const subSubContent = subSubParent.querySelector('.sub-sub-accordion-content');
                
                if (subSubHeader && subSubContent && subSubContent.style.display === 'none') {
                    subSubHeader.click(); // Simula clique para expandir
                }
            }
        }
        
        // Função para destacar elemento no menu
        function highlightElementInMenu(element) {
            element.classList.add('search-highlighted-item');
        }
        
        // Função para limpar destaques anteriores
        function clearPreviousHighlights() {
            const highlightedItems = document.querySelectorAll('.search-highlighted-item');
            highlightedItems.forEach(item => {
                item.classList.remove('search-highlighted-item');
            });
        }
        
        // Função para navegar até item clicado na lista de resultados
        function navigateToMenuItemFromList(index) {
            if (index >= 0 && index < lastSearchResults.length) {
                const result = lastSearchResults[index];
                
                if (result && result.element) {
                    // Feedback visual no item clicado da lista
                    const clickedListItem = document.querySelector(`[data-result-index="${index}"]`);
                    if (clickedListItem) {
                        clickedListItem.classList.add('clicked');
                        setTimeout(() => clickedListItem.classList.remove('clicked'), 300);
                    }
                    
                    // Limpar destaques anteriores primeiro
                    clearPreviousHighlights();
                    
                    // Expandir categorias pai se necessário
                    expandParentCategoriesForSearch(result.element);
                    
                    // Destacar apenas este item
                    result.element.classList.add('search-highlighted-item');
                    
                    // Fazer scroll suave até o elemento após delay
                    setTimeout(() => {
                        result.element.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }, 400);
                    
                    // Feedback visual de que foi clicado
                    console.log(`🎯 Navegando para: ${result.name} em ${result.path.join(' › ')}`);
                }
            }
        }
        
                 // =====================================================
         // IMPLEMENTAÇÃO DE BUSCA UNIVERSAL (DESABILITADA TEMPORARIAMENTE)
         // =====================================================
         
         /*
         // Substitui a função original por uma busca universal
         const originalCreateMenuSearchIndex = createMenuSearchIndex;
         const originalSearchMenu = searchMenu;
         const originalDisplaySearchResults = displaySearchResults;
        
                 // NOVA ABORDAGEM: Busca LIMPA e SIMPLES
         function createUniversalSearchIndex() {
             menuSearchIndex = [];
             console.log('🔍 Criando índice LIMPO E SIMPLES...');
             
             // LISTA MANUAL dos itens reais do Menu (para garantir que são limpos)
             const menuItemsManual = [
                 { name: 'WhatsApp', element: null, type: 'menu' },
                 { name: 'Telegram', element: null, type: 'menu' },
                 { name: 'Instagram', element: null, type: 'menu' },
                 { name: 'Facebook', element: null, type: 'menu' },
                 { name: 'YouTube', element: null, type: 'menu' },
                 { name: 'TikTok', element: null, type: 'menu' },
                 { name: 'Gmail', element: null, type: 'menu' },
                 { name: 'Google Meet', element: null, type: 'menu' },
                 { name: 'Zoom', element: null, type: 'menu' },
                 { name: 'Netflix', element: null, type: 'menu' },
                 { name: 'Prime Video', element: null, type: 'menu' },
                 { name: 'Spotify', element: null, type: 'menu' },
                 { name: 'PlutoTV', element: null, type: 'menu' },
                 { name: 'AudioLivros', element: null, type: 'menu' },
                 { name: 'Artesanato', element: null, type: 'menu' },
                 { name: 'Culinária', element: null, type: 'menu' },
                 { name: 'Eventos', element: null, type: 'menu' },
                 { name: 'Turismo', element: null, type: 'menu' },
                 { name: 'Hotelaria', element: null, type: 'menu' },
                 { name: 'Direito', element: null, type: 'menu' },
                 { name: 'Fisioterapia', element: null, type: 'menu' },
                 { name: 'Fotografia', element: null, type: 'menu' },
                 { name: 'Informática', element: null, type: 'menu' },
                 { name: 'Música', element: null, type: 'menu' },
                 { name: 'Instrumentos', element: null, type: 'menu' },
                 { name: 'Suporte', element: null, type: 'menu' },
                 { name: 'WhatsApp Business', element: null, type: 'menu' },
                 { name: 'Feito Por Você', element: null, type: 'menu' },
                 { name: 'MEUS FAVORITOS', element: null, type: 'menu' }
             ];
             
             // ADICIONAR itens limpos do menu manual
             menuItemsManual.forEach(item => {
                 menuSearchIndex.push({
                     name: item.name,
                     originalText: item.name,
                     element: findElementByText(item.name),
                     path: ['Menu'],
                     category: 'Menu',
                     type: 'menu',
                     section: 'Menu Lateral',
                     index: menuSearchIndex.length
                 });
             });
             
             // CARDS REAIS - Buscar por elementos reais na área principal
             const cardElements = document.querySelectorAll('#mainContent .card, #coursesContainer .card, .course-card, .resource-card');
             cardElements.forEach(card => {
                 const text = getOriginalCardText(card);
                 if (text && text.length > 2) {
                     menuSearchIndex.push({
                         name: text,
                         originalText: text,
                         element: card,
                         path: ['Cards'],
                         category: 'Cards',
                         type: 'card',
                         section: 'Área de Cards',
                         index: menuSearchIndex.length
                     });
                 }
             });
             
             // ADICIONAR CARDS CONHECIDOS (se não encontrou cards reais)
             addKnownCards();
             
             const stats = {
                 menu: menuSearchIndex.filter(item => item.type === 'menu').length,
                 card: menuSearchIndex.filter(item => item.type === 'card').length
             };
             
             console.log('📊 Índice LIMPO:', menuSearchIndex.length, 'itens');
             console.log('📈 Menu:', stats.menu, '| Cards:', stats.card);
             console.log('🧹 SEM LIXO TÉCNICO - Apenas conteúdo real!');
         }
             
             // 2. CARDS REAIS - Apenas elementos com classes específicas de card
             const realCards = document.querySelectorAll('.card, .course-card, .resource-card, [class*="card"]');
             realCards.forEach(card => {
                 const titleElement = card.querySelector('h1, h2, h3, h4, .title, [class*="title"]') || card;
                 const text = titleElement.textContent?.trim();
                 
                 // FILTRO ULTRA RIGOROSO para cards
                 if (text && text.length > 2 && 
                     !text.includes('partial') && 
                     !text.includes('highlight') &&
                     !text.includes('t-partial') &&
                     !text.includes('">')) {
                     
                     const cleanText = ultraCleanText(text);
                     if (cleanText && cleanText.length > 2) {
                         menuSearchIndex.push({
                             name: cleanText,
                             originalText: text,
                             element: card,
                             path: ['Cards'],
                             category: 'Cards',
                             type: 'card',
                             section: 'Área de Cards',
                             index: menuSearchIndex.length
                         });
                     }
                 }
             });
             
             // 3. CABEÇALHOS IMPORTANTES
             const headers = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
             headers.forEach(header => {
                 const text = header.textContent?.trim();
                 
                 // FILTRO ULTRA RIGOROSO para headers
                 if (text && text.length > 2 && 
                     !text.includes('partial') && 
                     !text.includes('highlight') &&
                     !text.includes('t-partial') &&
                     !text.includes('">') &&
                     !header.closest('.search-results')) {
                     
                     const cleanText = ultraCleanText(text);
                     if (cleanText && cleanText.length > 2) {
                         menuSearchIndex.push({
                             name: cleanText,
                             originalText: text,
                             element: header,
                             path: ['Cabeçalhos'],
                             category: 'Headers',
                             type: 'header',
                             section: 'Cabeçalhos',
                             index: menuSearchIndex.length
                         });
                     }
                 }
             });
             
             // 4. BOTÕES IMPORTANTES (fora do menu)
             const importantButtons = document.querySelectorAll('.main-content button, #mainContent button');
             importantButtons.forEach(button => {
                 const text = button.textContent?.trim();
                 
                 // FILTRO ULTRA RIGOROSO para buttons  
                 if (text && text.length > 2 && 
                     !text.includes('partial') && 
                     !text.includes('highlight') &&
                     !text.includes('t-partial') &&
                     !text.includes('Debug') &&
                     !text.includes('">')) {
                     
                     const cleanText = ultraCleanText(text);
                     if (cleanText && cleanText.length > 2) {
                         menuSearchIndex.push({
                             name: cleanText,
                             originalText: text,
                             element: button,
                             path: ['Botões'],
                             category: 'Buttons',
                             type: 'button',
                             section: 'Área Principal',
                             index: menuSearchIndex.length
                         });
                     }
                 }
             });
             
             const stats = {
                 menu: menuSearchIndex.filter(item => item.type === 'menu').length,
                 card: menuSearchIndex.filter(item => item.type === 'card').length,
                 header: menuSearchIndex.filter(item => item.type === 'header').length,
                 button: menuSearchIndex.filter(item => item.type === 'button').length
             };
             
             console.log('📊 Índice FOCADO:', menuSearchIndex.length, 'itens');
             console.log('📈 Por tipo:', stats);
         }
         
         // Função para encontrar elemento por texto limpo
         function findElementByText(searchText) {
             const elements = document.querySelectorAll('aside button, aside a');
             for (let element of elements) {
                 const text = element.textContent?.trim();
                 if (text && text.includes(searchText)) {
                     return element;
                 }
             }
             return null;
         }
         
         // Função para obter texto original do card (sem highlights)
         function getOriginalCardText(cardElement) {
             // Tentar obter texto limpo de diferentes formas
             const titleSelectors = ['h1', 'h2', 'h3', 'h4', 'h5', '.title', '.card-title', '[class*="title"]'];
             
             for (let selector of titleSelectors) {
                 const titleElement = cardElement.querySelector(selector);
                 if (titleElement) {
                     let text = titleElement.textContent?.trim();
                     if (text && !text.includes('partial') && !text.includes('highlight')) {
                         return text;
                     }
                 }
             }
             
             // Se não encontrou título, usar o texto do card (limitado)
             let cardText = cardElement.textContent?.trim();
             if (cardText && cardText.length < 100 && !cardText.includes('partial')) {
                 return cardText;
             }
             
             return null;
         }
         
         // Lista de cards conhecidos (quando não conseguir detectar automaticamente)
         function addKnownCards() {
             const knownCards = [
                 'Orçamento Digital',
                 'Netflix Mobile', 
                 'Projeto Marketing',
                 'Email Marketing Pro',
                 'WhatsApp Business',
                 'Telegram Premium',
                 'Longevidade',
                 'Saúde e Bem-estar',
                 'Culinária Saudável',
                 'Artesanato Criativo'
             ];
             
             knownCards.forEach(cardName => {
                 menuSearchIndex.push({
                     name: cardName,
                     originalText: cardName,
                     element: null, // Será procurado quando necessário
                     path: ['Cards'],
                     category: 'Cards',
                     type: 'card',
                     section: 'Área de Cards',
                     index: menuSearchIndex.length
                 });
             });
         }
         
         function shouldSkipForUniversalSearch(element) {
             const style = getComputedStyle(element);
             if (style.display === 'none' || style.visibility === 'hidden') return true;
             
             // Tags que nunca devem ser indexadas
             if (['SCRIPT', 'STYLE', 'META', 'LINK', 'TITLE', 'HEAD', 'NOSCRIPT'].includes(element.tagName)) return true;
             
             // FILTRO SUPER RIGOROSO - Texto contendo lixo técnico
             const text = element.textContent?.trim() || '';
             
             // Se contém qualquer coisa relacionada a highlight ou sistema interno
             if (text.includes('partial') || 
                 text.includes('highlight') || 
                 text.includes('search-') ||
                 text.includes('t-partial') ||
                 text.includes('Evt-partial') ||
                 text.includes('ento,') ||
                 text.includes('Ett-partial') ||
                 text.includes('móvt-partial') ||
                 text.includes('Hott-partial') ||
                 text.includes('Itt-partial') ||
                 text.includes('Estt-partial') ||
                 text.includes('"><') ||
                 text.includes('">') ||
                 text.includes('addevent') ||
                 text.includes('::')) return true;
             
             // Elementos de busca e sistema
             if (element.id === 'searchInput' || 
                 element.id === 'menuSearchInput' ||
                 element.classList.contains('search-results') ||
                 element.classList.contains('search-highlight') ||
                 element.classList.contains('search-highlight-partial') ||
                 element.id === 'searchResults') return true;
             
             // Elementos com classes técnicas
             const elementClasses = element.className || '';
             if (elementClasses.includes('search') || 
                 elementClasses.includes('highlight') || 
                 elementClasses.includes('partial')) return true;
             
             // IDs técnicos
             const elementId = element.id || '';
             if (elementId.includes('search') || elementId.includes('debug') || elementId.includes('btn')) return true;
             
             // Botões de debug e sistema
             const debugButtons = ['Debug', 'Reindexar', 'Eto', 'Limpar', 'Testar', '🐛 Debug Busca'];
             if (debugButtons.includes(text)) return true;
             
             // Texto muito pequeno, muito grande ou só números/símbolos
             if (text.length < 3 || text.length > 100) return true; // Reduzindo o máximo para 100
             if (/^\s*$/.test(text) || /^[\d\s\-_\.\/\(\)\[\]]+$/.test(text)) return true;
             
             // Texto que parece concatenação de múltiplos elementos
             const wordsCount = text.split(/\s+/).length;
             if (wordsCount > 15) return true; // Se tem mais de 15 palavras, provavelmente é concatenação
             
             // Texto que contém múltiplos nomes juntos (sem espaços adequados)
             if (text.match(/[A-Z][a-z]+[A-Z][a-z]+[A-Z]/)) return true; // Ex: "WhatsAppTelegramEmail"
             
             // Se é filho direto de elemento técnico, pular
             if (element.closest('.search-results') || 
                 element.closest('[class*="search"]') ||
                 element.closest('[class*="highlight"]') ||
                 element.closest('[id*="search"]')) return true;
             
             return false;
         }
        
                 function getCleanUniversalText(element) {
             // Primeiro tentar obter apenas texto direto do elemento
             let text = '';
             for (let node of element.childNodes) {
                 if (node.nodeType === Node.TEXT_NODE) {
                     text += node.textContent.trim() + ' ';
                 }
             }
             
             // Se não tem texto direto, pegar textContent (mas com cuidado)
             if (!text.trim()) {
                 text = element.textContent?.trim() || '';
                 
                 // Limitar tamanho para evitar textos gigantes
                 if (text.length > 100) text = text.substring(0, 100) + '...';
             }
             
             // Limpeza rigorosa
             text = text.replace(/\s+/g, ' ')                    // Múltiplos espaços
                       .replace(/[►▼●]/g, '')                    // Símbolos de menu
                       .replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '') // Emojis
                       .replace(/[0-9]+\/[0-9]+/g, '')          // Contadores como "1/5"
                       .replace(/^\d+$/, '')                    // Apenas números
                       .replace(/^[\[\](){}]+$/, '')            // Apenas símbolos
                       .trim();
             
             // Filtros adicionais para evitar lixo técnico
             if (text.includes('highlight-partial') || 
                 text.includes('search-') ||
                 text.includes('addevent') ||
                 text.includes('::') ||
                 text.match(/^[a-z\-_]+$/i) ||               // Apenas nomes de classes/IDs
                 text.match(/^\.[a-z\-_]+/i) ||              // Classes CSS
                 text.match(/^#[a-z\-_]+/i)) {               // IDs CSS
                 return '';
             }
             
             return text;
         }
        
        function categorizeForUniversalSearch(element) {
            if (element.closest('aside') || element.closest('.sidebar')) return 'menu';
            if (element.classList.contains('card') || element.closest('.card')) return 'card';
            if (['H1', 'H2', 'H3', 'H4', 'H5', 'H6'].includes(element.tagName)) return 'header';
            if (element.tagName === 'BUTTON' || element.classList.contains('btn')) return 'button';
            if (element.closest('.main-content') || element.closest('#mainContent')) return 'content';
            return 'other';
        }
        
        function getLocationForUniversalSearch(element) {
            let section = 'Desconhecido';
            let category = 'Outros';
            let path = [];
            
            if (element.closest('aside')) {
                section = 'Menu Lateral';
                category = 'Menu';
                const accordionHeader = element.closest('.accordion-content')?.previousElementSibling;
                if (accordionHeader) {
                    const categoryName = accordionHeader.textContent?.replace(/[►▼●0-9]/g, '').trim();
                    if (categoryName) path.push(categoryName);
                }
            } else if (element.closest('header')) {
                section = 'Cabeçalho';
                category = 'Header';
            } else if (element.closest('#mainContent')) {
                section = 'Área Principal';
                category = 'Conteúdo';
            }
            
            return { section, category, path };
        }
        
        function universalFlexibleSearch(query) {
            if (!query || query.length < 1) return [];
            
            const searchTerm = query.toLowerCase().trim();
            const results = [];
            
            menuSearchIndex.forEach(item => {
                const itemName = item.name.toLowerCase();
                const matchScore = calculateUniversalScore(itemName, searchTerm);
                
                if (matchScore > 0) {
                    results.push({
                        ...item,
                        matchScore: matchScore,
                        highlightedName: highlightUniversalTerm(item.name, searchTerm)
                    });
                }
            });
            
            return results.sort((a, b) => {
                if (b.matchScore !== a.matchScore) return b.matchScore - a.matchScore;
                const typePriority = { menu: 5, card: 4, content: 3, header: 2, button: 1 };
                return (typePriority[b.type] || 0) - (typePriority[a.type] || 0);
            });
        }
        
        function calculateUniversalScore(text, searchTerm) {
            if (text === searchTerm) return 100;
            if (text.startsWith(searchTerm)) return 90;
            if (text.endsWith(searchTerm)) return 80;
            if (text.includes(searchTerm)) return 70;
            
            let score = 0;
            let consecutiveMatches = 0;
            let lastMatchIndex = -1;
            
            for (let i = 0; i < searchTerm.length; i++) {
                const char = searchTerm[i];
                const foundIndex = text.indexOf(char, lastMatchIndex + 1);
                
                if (foundIndex !== -1) {
                    if (foundIndex === lastMatchIndex + 1) {
                        consecutiveMatches++;
                        score += consecutiveMatches * 2;
                    } else {
                        consecutiveMatches = 1;
                        score += 1;
                    }
                    lastMatchIndex = foundIndex;
                }
            }
            
            const words = searchTerm.split(' ');
            words.forEach(word => {
                if (word.length >= 1 && text.includes(word)) {
                    score += word.length * 3;
                }
            });
            
            return score;
        }
        
        function highlightUniversalTerm(text, searchTerm) {
            try {
                let regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                let highlighted = text.replace(regex, '<span class="search-highlight">$1</span>');
                
                if (highlighted === text) {
                    const chars = searchTerm.toLowerCase().split('');
                    chars.forEach(char => {
                        if (char.trim()) {
                            const charRegex = new RegExp(`(${char.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                            highlighted = highlighted.replace(charRegex, '<span class="search-highlight-partial">$1</span>');
                        }
                    });
                }
                
                return highlighted;
            } catch (e) {
                return text;
            }
        }
        
        function displayUniversalResults(results) {
            const searchResults = document.getElementById('searchResults');
            
            if (results.length === 0) {
                clearPreviousHighlights();
                searchResults.innerHTML = '<div class="search-no-results">❌ Nenhum resultado encontrado</div>';
                searchResults.style.display = 'block';
                return;
            }
            
            const groupedResults = {
                menu: results.filter(r => r.type === 'menu'),
                card: results.filter(r => r.type === 'card'),
                content: results.filter(r => r.type === 'content'),
                header: results.filter(r => r.type === 'header'),
                button: results.filter(r => r.type === 'button'),
                other: results.filter(r => r.type === 'other')
            };
            
            expandAndHighlightItems(results);
            
            let html = `
                <div style="padding: 12px 15px; border-bottom: 2px solid rgba(128, 76, 154, 0.3); background: rgba(128, 76, 154, 0.1); margin-bottom: 5px;">
                    <div style="color: #fff; font-weight: bold; font-size: 0.9em;">
                        🔍 Busca Universal (${results.length} resultados)
                    </div>
                </div>
            `;
            
            let resultIndex = 0;
            const typeIcons = { menu: '📋', card: '📚', content: '📄', header: '📰', button: '🔘', other: '📌' };
            const typeLabels = { menu: 'Menu', card: 'Cards', content: 'Conteúdo', header: 'Cabeçalhos', button: 'Botões', other: 'Outros' };
            
            Object.keys(groupedResults).forEach(type => {
                const typeResults = groupedResults[type];
                if (typeResults.length === 0) return;
                
                html += `
                    <div style="padding: 8px 15px; background: rgba(255,255,255,0.05); border-left: 3px solid #804C9A; margin: 5px 0;">
                        <strong>${typeIcons[type]} ${typeLabels[type]} (${typeResults.length})</strong>
                    </div>
                `;
                
                typeResults.slice(0, 5).forEach(result => {
                    const pathText = result.section || result.category || 'Desconhecido';
                    
                    html += `
                        <div class="search-result-item" onclick="navigateToUniversalResult(${resultIndex})" data-result-index="${resultIndex}">
                            <div class="search-result-name">${result.highlightedName}</div>
                            <div class="search-result-path">📍 ${pathText}</div>
                        </div>
                    `;
                    resultIndex++;
                });
            });
            
            searchResults.innerHTML = html;
            searchResults.style.display = 'block';
        }
        
        function navigateToUniversalResult(index) {
            const allResults = [];
            ['menu', 'card', 'content', 'header', 'button', 'other'].forEach(type => {
                const typeResults = lastSearchResults.filter(r => r.type === type);
                allResults.push(...typeResults.slice(0, 5));
            });
            
            if (index >= 0 && index < allResults.length) {
                const result = allResults[index];
                
                if (result && result.element) {
                    const clickedListItem = document.querySelector(`[data-result-index="${index}"]`);
                    if (clickedListItem) {
                        clickedListItem.classList.add('clicked');
                        setTimeout(() => clickedListItem.classList.remove('clicked'), 300);
                    }
                    
                    clearPreviousHighlights();
                    
                    if (result.type === 'menu') {
                        expandParentCategoriesForSearch(result.element);
                    }
                    
                    result.element.classList.add('search-highlighted-item');
                    
                    setTimeout(() => {
                        result.element.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                        highlightElement(result.element);
                    }, 400);
                    
                    console.log(`🎯 Navegando para [${result.type.toUpperCase()}]: ${result.name} em ${result.section}`);
                }
            }
        }
        
                 // Função SUPER FLEXÍVEL para calcular score - encontra qualquer subsequência
         function calculateUniversalScoreFixed(text, searchTerm) {
             const lowerText = text.toLowerCase();
             const lowerSearchTerm = searchTerm.toLowerCase();
             
             console.log(`🔍 Testando "${text}" vs "${searchTerm}"`);
             
             // Match exato (100 pontos)
             if (lowerText === lowerSearchTerm) {
                 console.log(`✅ Match EXATO: "${text}"`);
                 return 100;
             }
             
             // Inicia com (90 pontos)
             if (lowerText.startsWith(lowerSearchTerm)) {
                 console.log(`✅ INICIA com: "${text}"`);
                 return 90;
             }
             
             // Termina com (80 pontos)
             if (lowerText.endsWith(lowerSearchTerm)) {
                 console.log(`✅ TERMINA com: "${text}"`);
                 return 80;
             }
             
             // Contém o termo completo (70 pontos)
             if (lowerText.includes(lowerSearchTerm)) {
                 console.log(`✅ CONTÉM completo: "${text}" contém "${searchTerm}"`);
                 return 70;
             }
             
             // ⭐ NOVA LÓGICA: Busca por subsequência (termo dentro de palavra)
             // Exemplo: "longe" encontra em "Longevidade"
             const words = lowerText.split(/\s+/);
             for (let word of words) {
                 if (word.includes(lowerSearchTerm)) {
                     console.log(`✅ SUBSEQUÊNCIA: "${word}" contém "${searchTerm}" em "${text}"`);
                     return 60; // Score bom para subsequências
                 }
             }
             
             // Busca caractere por caractere em sequência
             let score = 0;
             let consecutiveMatches = 0;
             let lastFoundIndex = -1;
             
             for (let i = 0; i < lowerSearchTerm.length; i++) {
                 const char = lowerSearchTerm[i];
                 const foundIndex = lowerText.indexOf(char, lastFoundIndex + 1);
                 
                 if (foundIndex !== -1) {
                     if (foundIndex === lastFoundIndex + 1) {
                         consecutiveMatches++;
                         score += consecutiveMatches * 3; // Mais pontos para sequências
                     } else {
                         consecutiveMatches = 1;
                         score += 1;
                     }
                     lastFoundIndex = foundIndex;
                 } else {
                     // Se não encontrou um caractere, quebra a sequência
                     break;
                 }
             }
             
             // Se encontrou uma boa sequência de caracteres
             if (score >= lowerSearchTerm.length * 2) {
                 console.log(`✅ SEQUÊNCIA de caracteres: "${text}" (score: ${score})`);
                 return Math.min(score, 50); // Max 50 para sequências de caracteres
             }
             
             console.log(`❌ Nenhum match suficiente para: "${text}" (score tentativo: ${score})`);
             return 0;
         }
         
         // Comentando implementação que quebrou o sistema
         // createMenuSearchIndex = originalCreateMenuSearchIndex;
         // searchMenu = originalSearchMenu;
         // displaySearchResults = originalDisplaySearchResults;
         */
        
                 // Adicionar estilos CSS
         const universalStyles = document.createElement('style');
         universalStyles.textContent = `
             .search-highlight-partial {
                 background-color: rgba(255, 193, 7, 0.4);
                 color: #FFD700;
                 font-weight: bold;
             }
             
                     @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
                scale: 0.8;
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
                scale: 1;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
             
                     .card-highlighted {
            z-index: 1000 !important;
            position: relative !important;
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(128, 76, 154, 0.8) !important;
            animation: cardPulse 2s ease-in-out;
        }

        .card-selected {
            border: 2px solid #4CAF50 !important;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.4) !important;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05)) !important;
            transform: scale(1.01) !important;
            transition: all 0.3s ease !important;
            position: relative !important;
        }

        .card-selected::before {
            content: "✓";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            z-index: 10;
        }
        
        @keyframes cardPulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(128, 76, 154, 0.8);
            }
            50% { 
                box-shadow: 0 0 30px rgba(128, 76, 154, 1);
            }
        }
        
        .search-highlighted-item {
            background: rgba(128, 76, 154, 0.4) !important;
            color: #fff !important;
            border-left: 3px solid rgba(128, 76, 154, 1) !important;
            animation: menuItemHighlight 1.5s ease-in-out;
        }
        
        @keyframes menuItemHighlight {
            0%, 100% { 
                background: rgba(128, 76, 154, 0.4);
            }
            50% { 
                background: rgba(128, 76, 154, 0.6);
            }
        }
         `;
         document.head.appendChild(universalStyles);
         
         // Função de debug acessível
         window.debugBusca = function(termo = null) {
             console.log('=== DEBUG BUSCA UNIVERSAL ===');
             console.log('Total de itens indexados:', menuSearchIndex.length);
             
             console.log('\n📋 Primeiros 10 itens do Menu:');
             const menuItems = menuSearchIndex.filter(item => item.type === 'menu');
             menuItems.slice(0, 10).forEach(item => {
                 console.log(`- "${item.name}" (${item.section})`);
             });
             
             console.log('\n📚 Todos os Cards encontrados:');
             const cardItems = menuSearchIndex.filter(item => item.type === 'card');
             console.log(`Total de cards: ${cardItems.length}`);
             cardItems.forEach(item => {
                 console.log(`- "${item.name}" (${item.section || item.category})`);
             });
             
             console.log('\n🎴 Cards no Menu (Terceiro Nível):');
             const menuCardItems = menuSearchIndex.filter(item => item.type === 'menu-card');
             console.log(`Total de menu-cards: ${menuCardItems.length}`);
             menuCardItems.forEach(item => {
                 console.log(`- "${item.name}" (${item.path.join(' › ')})`);
             });
             
             console.log('\n📂 Sub-subcategorias (Terceiro Nível):');
             const subSubCategoryItems = menuSearchIndex.filter(item => item.type === 'subsubcategory');
             console.log(`Total de sub-subcategorias: ${subSubCategoryItems.length}`);
             subSubCategoryItems.forEach(item => {
                 console.log(`- "${item.name}" (${item.path.join(' › ')})`);
             });
             
             console.log('\n📄 Itens de Conteúdo:');
             const contentItems = menuSearchIndex.filter(item => item.type === 'content');
             contentItems.slice(0, 10).forEach(item => {
                 console.log(`- "${item.name}" (${item.section})`);
             });
             
             // Buscar especificamente por "Longevidade"
             console.log('\n🔍 Procurando por "Longevidade":');
             const longevidadeItems = menuSearchIndex.filter(item => 
                 item.name.toLowerCase().includes('longevidade')
             );
             longevidadeItems.forEach(item => {
                 console.log(`✅ ENCONTRADO: "${item.name}" (tipo: ${item.type}, seção: ${item.section})`);
             });
             
             // Teste de busca
             const testeTermo = termo || 'longe';
             console.log(`\n🔍 Teste busca "${testeTermo}":`);
             const results = universalFlexibleSearch(testeTermo);
             console.log(`Resultados encontrados: ${results.length}`);
             results.slice(0, 10).forEach(result => {
                 console.log(`- "${result.name}" (score: ${result.matchScore}, tipo: ${result.type})`);
             });
             
             // Teste manual da função de score
             console.log(`\n🧪 Teste manual: "Longevidade" vs "${testeTermo}":`);
             const scoreTest = calculateUniversalScore('Longevidade', testeTermo);
             console.log(`Score calculado: ${scoreTest}`);
         };
         
         // Função para testar termos específicos
         window.testarBusca = function(termo) {
             console.log(`\n🔍 === TESTE: "${termo}" ===`);
             const results = universalFlexibleSearch(termo);
             console.log(`Encontrados ${results.length} resultados:`);
             results.forEach((result, i) => {
                 console.log(`${i+1}. "${result.name}" (${result.type}) - Score: ${result.matchScore}`);
             });
         };
         
         // 🔧 Função para diagnóstico COMPLETO do menu
         window.diagnosticarMenu = function() {
             console.log('\n🔍 === DIAGNÓSTICO COMPLETO DO MENU ===');
             
             // 1. Conta TODOS os elementos no menu
             const allElements = document.querySelectorAll('aside *');
             console.log(`📋 Total de elementos encontrados: ${allElements.length}`);
             
             // 2. Separa por tipo de elemento
             const elementTypes = {};
             allElements.forEach(el => {
                 const tag = el.tagName.toLowerCase();
                 const classes = Array.from(el.classList).join(' ');
                 const key = classes ? `${tag}.${classes}` : tag;
                 
                 if (!elementTypes[key]) elementTypes[key] = 0;
                 elementTypes[key]++;
             });
             
             console.log('\n📊 Elementos por tipo:');
             Object.entries(elementTypes)
                 .sort((a, b) => b[1] - a[1])
                 .forEach(([type, count]) => {
                     console.log(`  ${count}x ${type}`);
                 });
             
             // 3. Identifica elementos clicáveis perdidos
             console.log('\n🔍 Elementos clicáveis que podem estar sendo perdidos:');
             const clickableElements = document.querySelectorAll('aside button, aside a, aside [onclick], aside [data-card-name], aside .clickable, aside .menu-item');
             
             clickableElements.forEach((el, i) => {
                 const text = el.textContent.trim();
                 const isIndexed = allMenuItems.some(item => item.element === el);
                 
                 if (!isIndexed && text && text.length > 1) {
                     console.log(`❌ NÃO INDEXADO: "${text}" (${el.tagName.toLowerCase()}.${Array.from(el.classList).join('.')})`);
                 }
             });
             
             // 4. Verifica elementos com texto mas sem indexação
             console.log('\n📝 Elementos com texto não indexados:');
             let lostElements = 0;
             allElements.forEach(el => {
                 const text = el.textContent.trim();
                 const hasOnlyTextContent = el.children.length === 0;
                 const isIndexed = allMenuItems.some(item => item.element === el);
                 
                 if (hasOnlyTextContent && text && text.length > 2 && !isIndexed && 
                     !text.includes('►') && !text.includes('▼') && 
                     text !== 'Carregando...' && !text.includes('...')) {
                     console.log(`🔍 Possível elemento perdido: "${text}" (${el.tagName})`);
                     lostElements++;
                 }
             });
             
             console.log(`\n📊 Resumo do diagnóstico:`);
             console.log(`  - Total de elementos: ${allElements.length}`);
             console.log(`  - Elementos indexados: ${allMenuItems.length}`);
             console.log(`  - Elementos clicáveis: ${clickableElements.length}`);
             console.log(`  - Possíveis elementos perdidos: ${lostElements}`);
             console.log(`  - Taxa de cobertura: ${((allMenuItems.length / allElements.length) * 100).toFixed(1)}%`);
         };
         
         // Função específica para testar CEL APPS
         window.testarCelApps = function() {
             console.log('\n🔍 === TESTE ESPECÍFICO: CEL APPS ===');
             
             // Testa as subcategorias
             const subcategorias = ['saude', 'comunicar', 'banco', 'alimentacao', 'utilidades', 'lazer', 'transporte'];
             subcategorias.forEach(subcat => {
                 console.log(`\n📂 Testando subcategoria: "${subcat}"`);
                 const results = universalFlexibleSearch(subcat);
                 console.log(`Encontrados ${results.length} resultados:`);
                 results.forEach((result, i) => {
                     console.log(`  ${i+1}. "${result.name}" (${result.type}) - Score: ${result.matchScore}`);
                 });
             });
             
             // Testa alguns apps específicos
             const apps = ['whatsapp', 'uber', 'banco', 'ifood', 'youtube'];
             console.log('\n📱 === TESTANDO APPS ESPECÍFICOS ===');
             apps.forEach(app => {
                 console.log(`\n📱 Testando app: "${app}"`);
                 const results = universalFlexibleSearch(app);
                 console.log(`Encontrados ${results.length} resultados:`);
                 results.forEach((result, i) => {
                     console.log(`  ${i+1}. "${result.name}" (${result.type}) - Score: ${result.matchScore}`);
                 });
             });
         };
         
         // Função de debug para sincronização
         window.debugSync = function(cardName = null) {
             console.log('=== DEBUG SINCRONIZAÇÃO BIDIRECIONAL ===');
             
             // Lista todos os card-menu-items
             const menuItems = Array.from(document.querySelectorAll('.card-menu-item'));
             console.log(`📋 Total de card-menu-items: ${menuItems.length}`);
             menuItems.forEach((item, i) => {
                 const name = item.getAttribute('data-card-name');
                 const isActive = item.classList.contains('active');
                 console.log(`${i+1}. "${name}" ${isActive ? '✅ ATIVO' : ''}`);
             });
             
             // Lista todos os cards na área principal
             const cards = Array.from(document.querySelectorAll('.course-card, .card, .resource-card'));
             console.log(`\n🎴 Total de cards na área principal: ${cards.length}`);
             cards.forEach((card, i) => {
                 const titleEl = card.querySelector('h3, .card-title, .course-title');
                 const title = titleEl ? titleEl.textContent.trim() : 'Sem título';
                 const isSelected = card.classList.contains('card-selected');
                 console.log(`${i+1}. "${title}" ${isSelected ? '✅ SELECIONADO' : ''}`);
             });
             
             // Teste de sincronização se cardName fornecido
             if (cardName) {
                 console.log(`\n🔄 Testando sincronização para: "${cardName}"`);
                 syncMenuSelection(cardName);
             }
             
             console.log(`\n🌐 Estado global: ${window.currentSelectedCard || 'Nenhum'}`);
         };
         
         // Função para testar sincronização com card específico
         window.testarSync = function(cardName) {
             console.log(`\n🧪 === TESTE SINCRONIZAÇÃO: "${cardName}" ===`);
             syncMenuSelection(cardName);
             
             setTimeout(() => {
                 window.debugSync();
             }, 500);
         };
         
         // Função para testar centralização no carrossel
         window.testarCentralizacao = function(cardName) {
             console.log(`\n🎯 === TESTE CENTRALIZAÇÃO: "${cardName}" ===`);
             
             const targetCard = Array.from(document.querySelectorAll('.course-card, .card, .resource-card')).find(card => {
                 const cardTitle = card.querySelector('h3, .card-title, .course-title');
                 return cardTitle && cardTitle.textContent.trim() === cardName.trim();
             });
             
             if (targetCard) {
                 console.log('✅ Card encontrado, centralizando...');
                 centerCardInCarousel(targetCard);
                 
                 // Adiciona destaque visual
                 targetCard.classList.add('card-highlighted');
                 setTimeout(() => {
                     targetCard.classList.remove('card-highlighted');
                 }, 3000);
             } else {
                 console.log('❌ Card não encontrado:', cardName);
                 
                 // Lista cards disponíveis
                 const availableCards = Array.from(document.querySelectorAll('.course-card, .card, .resource-card')).map(card => {
                     const cardTitle = card.querySelector('h3, .card-title, .course-title');
                     return cardTitle ? cardTitle.textContent.trim() : 'Sem título';
                 });
                 console.log('📋 Cards disponíveis:', availableCards);
             }
         };
         
         // Função para forçar centralização usando scrollIntoView
         window.forceCentralizar = function(cardName) {
             console.log(`\n🚀 === FORÇAR CENTRALIZAÇÃO: "${cardName}" ===`);
             
             const targetCard = Array.from(document.querySelectorAll('.course-card, .card, .resource-card')).find(card => {
                 const cardTitle = card.querySelector('h3, .card-title, .course-title');
                 return cardTitle && cardTitle.textContent.trim() === cardName.trim();
             });
             
             if (targetCard) {
                 console.log('✅ Card encontrado, centralizando com scrollIntoView...');
                 
                 // Método 1: scrollIntoView com inline center
                 targetCard.scrollIntoView({ 
                     behavior: 'smooth', 
                     block: 'center',
                     inline: 'center'
                 });
                 
                 // Método 2: Scroll manual após delay
                 setTimeout(() => {
                     const container = targetCard.closest('.carousel-track, .cards-container, .content-area, main');
                     if (container) {
                         const cardRect = targetCard.getBoundingClientRect();
                         const containerRect = container.getBoundingClientRect();
                         
                         const cardCenter = cardRect.left + (cardRect.width / 2);
                         const containerCenter = containerRect.left + (containerRect.width / 2);
                         const scrollOffset = cardCenter - containerCenter;
                         
                         container.scrollBy({
                             left: scrollOffset,
                             behavior: 'smooth'
                         });
                         
                         console.log('🎯 Scroll manual aplicado:', {
                             cardCenter,
                             containerCenter,
                             scrollOffset
                         });
                     }
                 }, 300);
                 
                 // Adiciona destaque visual
                 targetCard.classList.add('card-highlighted');
                 setTimeout(() => {
                     targetCard.classList.remove('card-highlighted');
                 }, 3000);
                 
                 console.log('✅ Centralização forçada aplicada');
             } else {
                 console.log('❌ Card não encontrado:', cardName);
             }
         };
         
         // 🚀 Função de "força bruta" para capturar TUDO
         window.forcaCompleta = function() {
             console.log('\n🚀 === FORÇA BRUTA: CAPTURANDO TUDO ===');
             
             // Re-faz a coleta com configuração super abrangente
             allMenuItems = [];
             let totalCapturado = 0;
             
             // Captura LITERALMENTE tudo que tem texto no menu
             const todosElementos = document.querySelectorAll('aside *');
             
             todosElementos.forEach((elemento, index) => {
                 const texto = elemento.textContent.trim();
                 const temTextoUnico = elemento.children.length === 0; // Não tem filhos (folha da árvore)
                 
                 if (texto && texto.length > 1 && temTextoUnico &&
                     !texto.includes('►') && !texto.includes('▼') &&
                     texto !== 'Carregando...' && !texto.includes('...') &&
                     !texto.match(/^\d+$/) && // Não é só número
                     texto !== '☰' && texto !== 'iA' && texto !== '×') {
                     
                     // Detecta categoria pai
                     let categoria = 'Desconhecida';
                     let elementoPai = elemento.closest('.accordion-item');
                     if (elementoPai) {
                         const header = elementoPai.querySelector('h2, .accordion-header');
                         if (header) {
                             categoria = header.textContent.replace(/►|▼|\d+/g, '').trim();
                         }
                     }
                     
                     // Verifica se já foi adicionado
                     const jaExiste = allMenuItems.some(item => 
                         item.text === texto || item.element === elemento
                     );
                     
                     if (!jaExiste) {
                         allMenuItems.push({
                             element: elemento,
                             parent: elemento.parentElement,
                             text: texto,
                             originalText: elemento.textContent.trim(),
                             type: 'forca-bruta',
                             categoryName: categoria,
                             extraKeywords: '',
                             domIndex: index
                         });
                         totalCapturado++;
                         
                         console.log(`🚀 [${totalCapturado}] CAPTURADO: "${texto}" (${categoria})`);
                     }
                 }
             });
             
             console.log(`\n✅ FORÇA BRUTA CONCLUÍDA!`);
             console.log(`📊 Total capturado: ${totalCapturado} novos itens`);
             console.log(`📋 Total geral: ${allMenuItems.length} itens indexados`);
             
             // Testa a busca após força bruta
             console.log(`\n🧪 Testando busca após força bruta...`);
             const testeBusca = universalFlexibleSearch('teste');
             console.log(`Resultado teste: ${testeBusca.length} itens encontrados`);
         };
         
         // 🔧 Função para forçar re-indexação manual
         window.reindexarAgora = function() {
             console.log('🔄 === RE-INDEXAÇÃO MANUAL ===');
             collectAllMenuItems();
             console.log('✅ Re-indexação concluída!');
         };
         
         // Botões de debug removidos para produção
        
    </script>
</body>
</html>
