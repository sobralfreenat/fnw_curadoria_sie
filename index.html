<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GERIiAH - INDIVIDUAL 7.1.1</title>
    
    <!-- Favicon e PWA Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="shortcut icon" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    
    <!-- Apple Touch Icons para iOS -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="apple-touch-icon" sizes="57x57" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    
    <!-- Android Chrome Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    <link rel="icon" type="image/png" sizes="512x512" href="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    
    <!-- Meta tags PWA -->
    <meta name="theme-color" content="#503060">
    <meta name="msapplication-TileColor" content="#503060">
    <meta name="msapplication-TileImage" content="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkdFUmlBSCAtIENhdMOhbG9nbyBkZSBSZWN1cnNvcyIsCiAgInNob3J0X25hbWUiOiAiR0VSaUFIIiwKICAiZGVzY3JpcHRpb24iOiAiUGxhdGFmb3JtYSBkZSBhcHJlbmRpemFnZW0gcGFyYSBtYWR1cm9zIGUgaWRvc29zIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiM1MDMwNjAiLAogICJ0aGVtZV9jb2xvciI6ICIjNTAzMDYwIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9kMXllaTJ6M2k2azM1ei5jbG91ZGZyb250Lm5ldC8xMjk3NDUyOS82ODRkOWFiMzYwYmNfR0VSaUFITE9HTzhTUVVBUkUyZG9ud2xvYWQucG5nIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9LAogICAgewogICAgICAic3JjIjogImh0dHBzOi8vZDF5ZWkyejNpNmszNXouY2xvdWRmcm9udC5uZXQvMTI5NzQ1MjkvNjg0ZDlhYjM2MGJjX0dFUmlBSExPR084U1FVQVJFMGRVD3dsb2FkLnBuZyIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIgogICAgfQogIF0KfQ==">
    
    <style>
        /* Reset de overflow para layout fixo */
        html, body { height: 100%; margin: 0; padding: 0; }
        body { 
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-image: linear-gradient(to bottom, #503060, #3B204A);
            background-color: #3B204A; /* Fallback */
            color: #e5e5e5; /* Cor de texto padrão clara */
            padding-top: 70px !important; /* Espaço para o header fixo */
        }
        /* Header fixo GERiAH */
        header { 
            position: fixed !important; 
            top: 0 !important; 
            left: 0 !important; 
            right: 0 !important; 
            height: 70px; 
            background-color: rgba(71, 71, 71, 0.452);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #fff; 
            display: flex; 
            align-items: center; 
            padding: 0 30px; /* Aumentado de 20px para 30px para mais espaçamento */
            z-index: 9999 !important; /* Z-index alto */
            border-bottom: 1px solid rgba(255,255,255,0.1); /* Linha sutil de separação */
            gap: 15px; /* Adiciona espaçamento entre elementos do header */
        }
        header h3 { /* Ajuste no título do header */
            margin: 0; 
            font-size: 1.2em; 
            font-weight: normal;
        }
        /* Estilos para o toggle de modo de edição */
        .edit-mode-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
            margin-right: 15px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.3);
            transition: 0.3s;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #ff6b35;
            border-color: #ff6b35;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        #toggleLabel {
            font-size: 0.9em;
            font-weight: normal;
            white-space: nowrap;
        }
        
        /* Modo de edição ativo */
        body.edit-mode {
            background-image: linear-gradient(to bottom, #6b4423, #4a2f16);
        }
        
        body.edit-mode header {
            background-color: rgba(107, 68, 35, 0.8);
        }
        
        body.edit-mode #headerTitle {
            color: #ffcc80;
        }
        
        /* Ajuste de font-size para o headerTitle - aumentado 50% */
        #headerTitle {
            font-size: 1.05em; /* 50% maior que o padrão original */
            margin: 0 15px; /* Mais espaçamento lateral */
        }
        
        body.edit-mode aside {
            background: rgba(74, 47, 22, 0.8);
            border-right: 1px solid rgba(107, 68, 35, 0.7);
        }
        
        body.edit-mode main {
            background-color: #2d1810;
        }
        
        /* Botões editáveis no modo de edição */
        body.edit-mode .editable-item {
            border: 2px dashed #ff6b35 !important;
            position: relative;
        }
        
        body.edit-mode .editable-item::after {
            content: "✏️";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
            background: #ff6b35;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* Estilos para o botão de toggle do menu (hamburger) */
        .menu-toggle {
            display: block !important; /* Força a exibição do botão hamburger */
            background: transparent;
            border: none;
            font-size: 2em;
            color: #ffffff !important; /* Cor branca para contraste */
            cursor: pointer;
            padding: 5px 10px;
            z-index: 10000 !important; /* Garante que fique acima de outros elementos do header */
            margin-right: 15px;
            line-height: 1;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5); /* Sombra para melhor legibilidade */
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }
        
        .menu-toggle:hover {
            color: #e0e0e0 !important; /* Cor ligeiramente mais escura no hover */
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
        }
        
        /* Cor específica para modo de edição */
        body.edit-mode .menu-toggle {
            color: #ffffff !important; /* Mantém branco no modo de edição */
            text-shadow: 0 1px 3px rgba(255, 107, 53, 0.5); /* Sombra laranja no modo de edição */
        }
        
        body.edit-mode .menu-toggle:hover {
            color: #fff3e0 !important; /* Tom mais quente no hover do modo de edição */
            text-shadow: 0 2px 4px rgba(255, 107, 53, 0.8);
        }
        
        /* Sidebar abaixo do header */
        aside { 
            position: fixed; 
            top: 70px !important; /* Abaixo do header GERiAH */
            bottom: 0; 
            left: 0; 
            width: 250px; 
            background: rgba(42, 26, 58, 0.8); /* Tom de roxo GERiAH com transparência */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-right: 1px solid rgba(80, 48, 96, 0.7); 
            overflow-y: auto; 
            padding: 0 15px 20px 15px; /* Removido padding-top para o header fixo */
            z-index: 990; /* Abaixo do header mas acima do main */
            transition: transform 0.3s ease-in-out; /* Transição para o slide-in/out */
        }
        /* Adicionado para espaçar a primeira categoria do topo da sidebar */
        aside .accordion-item:first-of-type {
            margin-top: 20px; /* Espaço do topo da sidebar */
        }
        /* Novo estilo para o separador cego */
        .category-separator {
            height: 15px; /* Altura do espaçador */
            background-color: rgba(26, 15, 33, 0.3); /* AJUSTADO: Púrpura mais escuro com 30% de transparência */
            margin: 15px 0; /* Margem vertical para espaçar */
            border-radius: 3px;
        }
        aside h2 { 
            margin-top: 0; /* Garante que o h2 respeite o margin-bottom do botão acima */
            font-size: 1.1em; 
            color: #fff; 
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(80, 48, 96, 0.7);
        }
        #categoriesList {
            list-style: none; 
            /* padding: 0; Removido daqui, será tratado pelo .accordion-content */
        }
        #categoriesList li { margin-bottom: 8px; }
        /* #categoriesList button { // Comentado para usar o seletor mais genérico abaixo
            width: 100%; 
            padding: 10px 15px; 
            text-align: left; 
            border: none; 
            background: transparent; 
            color: #d3d3d3; 
            cursor: pointer; 
            border-radius: 4px; 
            font-size: 0.95em;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        #categoriesList button.active, #categoriesList button:hover { 
            background: rgba(80, 48, 96, 0.9); 
            color: #fff; 
        } */

        /* Novo seletor genérico para botões dentro dos acordeões da sidebar */
        aside .accordion-content ul li button {
            width: 100%; 
            padding: 10px 15px; 
            text-align: left; 
            border: none; 
            background: transparent; 
            color: #d3d3d3; /* Lightgray para itens não ativos */
            cursor: pointer; 
            border-radius: 4px; 
            font-size: 1.0125em;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        aside .accordion-content ul li button:hover,
        aside .accordion-content ul li button.active { /* .active ainda é útil para categorias */
            background: rgba(80, 48, 96, 0.9); /* Roxo mais forte para ativo/hover */
            color: #fff; 
        }

        #myCoursesBtn { 
            /* Estilos de posicionamento fixo na aside removidos */
            /* z-index: 10; */
            /* background-color: #2A1A3A; */ 

            /* width:100%; */ /* Não mais 100% da aside */
            padding: 8px 15px; /* Padding ajustado para o header */
            color:#fff; 
            border: 1px solid #fff; 
            border-radius:4px; 
            background: transparent; /* Fundo transparente no header */
            cursor:pointer; 
            margin-left: auto; /* Empurra o botão para a direita do header */
            margin-right: 10px; /* Pequena margem da borda direita do header */
            /* margin-bottom removido pois não é mais relevante para o fluxo da aside */
            font-size: 0.9em; /* Levemente reduzido para o header */
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        #myCoursesBtn:hover { 
            background: rgba(255,255,255,0.1); /* Hover sutil no header */
            color: #fff;
        }
        /* Conteúdo ao lado da sidebar, abaixo do header */
        main { 
            margin-left: 250px; /* Largura da sidebar */
            padding: 70px 30px 20px 30px; /* AJUSTADO padding-top para 70px (era 8px) */
            background-color: #100818; /* MAIS ESCURO: Fundo sólido para o main, próximo ao preto */
            transition: margin-left 0.3s ease-in-out; /* Transição para o push/pull */
        }
        main h1 { /* Este é o #mainTitle - agora usado apenas se necessário ou pode ser removido do JS */
            margin-top: 0; 
            color: #fff; 
        }
        /* Estilo para o título da categoria quando exibido acima do carrossel */
        .category-title-header {
            font-size: 0.9em; 
            color: #fff; 
            margin-bottom: 10px; /* AJUSTADO (era 30px) para aproximar ainda mais o carrossel do título */
            padding-bottom: 10px; 
            border-bottom: 1px solid rgba(80, 48, 96, 0.7);
        }

        /* Removido .courses-grid, agora usamos .carousel-track */
        .carousel-track {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden; /* Esconde scrollbar vertical se houver */
            padding: 20px 500px 130px 500px; /* AJUSTADO padding-top (era 120px) para aproximar do título */
            margin-bottom: 1px; /* AJUSTADO (era 10px) */
            position: relative; /* Necessário para posicionar os pseudo-elementos do esfumaçado */
            /* Adicionando perspectiva para transformações 3D dos cards */
            perspective: 1200px;
            transform-style: preserve-3d; /* Garante que os filhos sejam tratados em 3D */
            /* Estilizando a scrollbar horizontal para o trilho */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: rgba(70, 40, 86, 0.9) rgba(30, 18, 40, 0.7); /* Firefox: thumb track - AJUSTADO */
        }
        .carousel-track::-webkit-scrollbar {
            height: 12px; /* AJUSTADO (era 8px) */
        }
        .carousel-track::-webkit-scrollbar-track {
            background: rgba(30, 18, 40, 0.7); /* AJUSTADO (era rgba(42, 26, 58, 0.5)) */
        }
        .carousel-track::-webkit-scrollbar-thumb {
            background: rgba(70, 40, 86, 0.9); /* AJUSTADO (era rgba(80, 48, 96, 0.8)) */
            border-radius: 4px;
        }
        .carousel-track::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 68, 116, 1); 
        }

        /* Pseudo-elementos para o efeito de esfumaçar nas laterais do carrossel */
        .carousel-track::before, .carousel-track::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0; 
            width: 280px; /* AUMENTADO: Largura da faixa de esfumaçamento (era 180px) */
            z-index: 2; 
            pointer-events: none; 
        }
        .carousel-track::before {
            left: 0;
            /* AJUSTADO: Degradê com início na cor do novo fundo do main mais dominante e transição mais para dentro */
            background: linear-gradient(to right, #100818 60%, rgba(16, 8, 24, 0.65) 85%, rgba(16, 8, 24, 0) 100%);
        }
        .carousel-track::after {
            right: 0;
            /* AJUSTADO: Degradê com início na cor do novo fundo do main mais dominante e transição mais para dentro */
            background: linear-gradient(to left, #100818 60%, rgba(16, 8, 24, 0.65) 85%, rgba(16, 8, 24, 0) 100%);
        }

        .course-card { 
            background: rgba(63, 44, 80, 0.7); 
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border:1px solid rgba(80, 48, 96, 0.9); 
            border-radius: 8px; 
            overflow:hidden; 
            box-shadow:0 4px 8px rgba(0,0,0,0.3); 
            cursor: pointer; 
            color: #e5e5e5;
            width: 308px; /* AUMENTADO 40% (de 220px) */
            flex-shrink: 0; 
            margin-right: 2px; /* MARGEM MÍNIMA para evitar que colem totalmente sem transform */
            transition: transform 0.4s ease-in-out, box-shadow 0.4s ease-in-out, opacity 0.4s ease-in-out, filter 0.4s ease-in-out, z-index 0s 0.2s; 
            opacity: 0.1; 
            filter: brightness(0.1); 
            /* Transform inicial: recuado e menor. translateX e rotateY serão via JS para vizinhos */
            transform: translateZ(-200px) scale(0.8);
            transform-origin: center center; 
        }
        .course-card:last-child {
            margin-right: 0; 
        }
        .course-card:hover {
            /* Hover mantém uma escala mais próxima do 'normal' mas ainda se destaca dos distantes */
            transform: scale(1.12); /* Mantém scale uniforme no hover, sem espremer */
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            z-index: 10; 
            opacity: 0.95; 
            filter: brightness(0.9); 
        }
        /* Nova classe para o card focado no centro do carrossel */
        .course-card.focused-card {
            /* EFEITO 3D: Card focado vem para frente e aumenta */
            transform: translateZ(60px) scale(1.12); /* Leve ajuste no scale/translateZ do focado */
            box-shadow: 0 20px 45px rgba(0,0,0,0.8); 
            z-index: 20; 
            opacity: 1; 
            filter: brightness(1); 
        }
        /* Classe para cards adjacentes (nível 1) ao focado - Usada para opacidade/brilho */
        .course-card.adjacent-style {
            opacity: 0.6; 
            filter: brightness(0.6); 
            /* transform é aplicado via JS */
        }
        /* Classe para cards vizinhos de segundo nível - Usada para opacidade/brilho */
        .course-card.secondary-neighbor-style {
            opacity: 0.3;
            filter: brightness(0.3);
            /* transform é aplicado via JS */
        }
        .course-card img { 
            width: 60px; /* AJUSTADO: Tamanho explícito para o ícone */
            height: 60px; /* AJUSTADO: Tamanho explícito para o ícone */
            object-fit: contain; /* AJUSTADO: Garante que o ícone se ajuste sem cortar */
            border-bottom: none; /* REMOVIDO: Borda inferior para ícones */
            margin: 15px auto 10px auto; /* AJUSTADO: Centraliza e adiciona margem */
            display: block; /* Garante que seja um bloco para centralizar */
        }
        .course-card .info { 
            padding:15px; 
        }
        .course-card h3 { 
            margin:0 0 10px; 
            font-size:1.05em; 
            color:#fff; 
            height: 56px; /* AUMENTADO 40% (de 40px) */
            overflow: hidden;
        }
        .course-card p { 
            font-size:0.85em; 
            color:#ccc; /* Cor da descrição um pouco mais clara */
            margin:0; 
            line-height: 1.3;
            height: 70px; /* AUMENTADO 40% (de 50px) */
            overflow: hidden;
        }
        /* Modal */
        .modal { 
            position: fixed; 
            top:0; 
            left:0; 
            width:100%; 
            height:100%; 
            background: rgba(0,0,0,0.8); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 1001; /* Mais alto que o header */
        }
        .modal.hidden { display: none; }
        .modal-content { 
            background: rgba(59, 32, 74, 0.95); /* Roxo GERiAH para modal */
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            color: #fff;
            width: 90%; 
            max-width: 700px; 
            padding: 25px; 
            border-radius:6px; 
            border: 1px solid rgba(80, 48, 96, 1);
            position: relative; 
            max-height: 90vh; 
            overflow-y: auto; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .modal-content img { 
            width:100%; 
            height:auto; 
            margin-bottom:20px; 
            border-radius: 4px; 
        }
        .modal-content h2 { 
            margin-top: 0; 
            font-size: 1.6em;
            margin-bottom: 15px;
        }
        .modal-content p {
            font-size: 1em;
            line-height: 1.6;
            color: #e0e0e0;
            margin-bottom: 10px;
        }
        .close { 
            position: absolute; 
            top: 15px; 
            right: 20px; 
            font-size: 1.8em; 
            color: #aaa; 
            cursor: pointer; 
            transition: color 0.2s ease;
        }
        .close:hover {
            color: #fff;
        }
        /* Scrollbar customizada (Webkit) - GERiAH Style */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(42, 26, 58, 0.5); /* Roxo translúcido para track */
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(80, 48, 96, 0.8); /* Roxo mais sólido para thumb */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 68, 116, 1); /* Roxo mais claro no hover */
        }

        /* Estilos para Acordeão na Sidebar */
        aside .accordion-item {
            border-bottom: 1px solid rgba(80, 48, 96, 0.7);
            margin-bottom: 25px; /* AJUSTADO: Maior espaçamento entre os itens principais */
        }

        aside .accordion-header { /* Estilo para os H2 que são cabeçalhos de acordeão */
            cursor: pointer;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            width: 100%;
            padding-bottom: 15px; /* AJUSTADO: Mais espaço abaixo do cabeçalho */
            padding-right: 25px; /* Espaço para a seta */
            margin-bottom: 0;
            font-size: 0.99em;
            color: #fff; 
            margin-top: 0; /* Garante que não haja margem superior extra */
            border-radius: 6px;
            padding-left: 10px;
            padding-top: 10px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        aside .accordion-header:hover,
        aside .accordion-header.active {
            background: rgba(80, 48, 96, 0.8);
            box-shadow: 0 2px 8px rgba(80, 48, 96, 0.4);
        }
        
        aside .accordion-header.active {
            background: rgba(100, 68, 116, 0.9);
        }
        
        /* Removemos o estilo global de aside h2 para não conflitar com accordion-header */
        /* aside h2 { ... } */


        aside .accordion-icon {
            font-size: 0.8em;
            margin-left: auto;
            flex-shrink: 0;
        }

        aside .accordion-content {
            padding-left: 10px; 
            padding-top: 5px; 
            padding-bottom: 10px; 
            display: none; /* Começa fechado */
        }
        aside .accordion-content ul { /* Para #categoriesList e #toolsCategoriesList */
            padding: 0; 
            margin:0;
            list-style: none; /* Garante que não haja marcadores de lista padrão */
        }
        aside .accordion-content ul li {
            margin-bottom: 15px; /* AJUSTADO: Espaçamento entre itens das subcategorias */
        }
        /* Fim Estilos Acordeão */

        /* Estilos para Sub-Acordeões dentro de EXCLUSIVO */
        .sub-accordion-item {
            margin-bottom: 15px;
        }
        
        .sub-accordion-header {
            width: 100%;
            background: transparent;
            border: none;
            color: #d3d3d3;
            cursor: pointer;
            padding: 8px 25px 8px 15px; /* Ajustado: mais padding à direita para a seta */
            text-align: left;
            border-radius: 4px;
            font-size: 0.9em;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: flex;
            justify-content: flex-start;
            align-items: center;
        }
        
        .sub-accordion-header:hover,
        .sub-accordion-header.active {
            background: rgba(80, 48, 96, 0.7);
            color: #fff;
        }
        
        .sub-accordion-content {
            padding-left: 20px;
            padding-top: 10px;
        }
        
        .sub-accordion-icon {
            font-size: 0.7em;
            margin-left: auto;
            flex-shrink: 0;
        }
        /* Fim Estilos Sub-Acordeão */

        /* Ajustes para o Modal de Curadoria - GERiAH Style */
        #curationModal .modal-content {
            /* Herda a maioria dos estilos de .modal-content */
            background: rgba(59, 32, 74, 0.98); /* Um pouco mais opaco para legibilidade */
        }
        /* Estilos para o Modal P.A.I (Painel de Acesso Imediato) */
        #paiModal .modal-content {
            /* Ajustes específicos se necessário, por ex, para altura do iframe */
            /* background: rgba(50, 25, 65, 0.98); /* Um roxo um pouco diferente se desejar */
            height: 90%; /* Ajustar conforme necessidade */
            width: 90%; /* Ajustar conforme necessidade */
            max-width: 1400px; /* Um pouco maior para ferramentas complexas */
            display: flex; /* Para organizar título e iframe */
            flex-direction: column; /* Título acima, iframe abaixo */
        }
        #paiModal iframe {
            flex-grow: 1; /* Iframe ocupa o espaço restante */
            border-radius: 0 0 6px 6px; /* Se o modal-content tiver border-radius */
        }

        #curationModal h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #fff;
        }
        #curationConfirm p, #curationReview h3, #curationList li {
            color: #e5e5e5;
        }
        #curationConfirm button, #curationReview button {
            background-color: rgba(100, 68, 116, 0.9); /* Roxo GERiAH para botões */
            border: 1px solid rgba(120, 88, 136, 1);
            padding: 10px 15px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        #curationConfirm button:hover, #curationReview button:hover {
            background-color: rgba(120, 88, 136, 1);
            border-color: rgba(140, 108, 156, 1);
        }
        #curationConfirm button#curateNo, #curationReview button#curateBack { /* Botão secundário */
            background-color: rgba(70, 70, 70, 0.8);
            border-color: rgba(90,90,90,1);
        }
        #curationConfirm button#curateNo:hover, #curationReview button#curateBack:hover {
            background-color: rgba(90, 90, 90, 0.9);
            border-color: rgba(110,110,110,1);
        }
        #curationList input[type=checkbox] {
            margin-right: 8px;
            accent-color: #804C9A; /* Cor roxa para o checkbox */
        }

        /* Media Query para Telas Pequenas (Mobile) */
        @media (max-width: 768px) {
            body { padding-top: 70px; } /* Ajusta padding do body */
            header {
                justify-content: flex-start; /* Alinha itens à esquerda */
            }
            .menu-toggle {
                display: block; /* Mostra o botão hamburger no mobile */
                color: #ffffff !important; /* Cor branca para contraste no mobile */
                text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5); /* Sombra para melhor legibilidade */
            }
            aside {
                transform: translateX(-100%); /* Esconde a sidebar por padrão no mobile */
                left: 0; /* Garante que o ponto de partida seja 0 */
                box-shadow: 2px 0 5px rgba(0,0,0,0.3); /* Sombra para destacar quando aberta */
            }
            main {
                margin-left: 0; /* Main ocupa largura total quando sidebar está oculta */
            }

            /* Estado: Sidebar aberta */
            body.sidebar-open aside {
                transform: translateX(0); /* Mostra a sidebar */
            }
            body.sidebar-open main {
                margin-left: 250px; /* Main é empurrado para a direita pela sidebar */
            }
            /* Opcional: Adicionar um overlay escuro quando a sidebar estiver aberta */
            body.sidebar-open::after {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0,0,0,0.5);
                z-index: 980; /* Abaixo da sidebar, acima do main */
            }

            /* Ajustes para o botão de Meus Cursos no mobile */
            #myCoursesBtn {
                margin-left: auto; /* Empurra para a direita para alinhar ao final do header */
            }

            .carousel-track {
                /* Reduzir padding para telas menores */
                padding: 80px 60px 80px 60px;
            }

            .carousel-track::before,
            .carousel-track::after {
                width: 100px; /* Largura do esfumaçado reduzida */
            }

            .carousel-track::before {
                background: linear-gradient(to right, #100818 30%, rgba(16, 8, 24, 0.65) 75%, rgba(16, 8, 24, 0) 100%);
            }

            .carousel-track::after {
                background: linear-gradient(to left, #100818 30%, rgba(16, 8, 24, 0.65) 75%, rgba(16, 8, 24, 0) 100%);
            }
        }

        .access-course-button {
            background-color: #804C9A; /* Roxo GERiAH */
            border: none;
            padding: 8px 15px;
            margin-top: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: block; /* Ocupa a largura total */
            width: calc(100% - 0px); /* Ajusta para preencher o info div */
            text-align: center;
            text-decoration: none; /* Remove underline para links */
        }
        .access-course-button:hover {
            background-color: #6C3D82; /* Roxo mais escuro no hover */
        }
        /* Fim Novos estilos para botão Acessar */

        /* Estilos para Sub-Acordeões dentro de EXCLUSIVO */

        /* Estilo para mensagens de instrução */
        .instruction-message {
            color: #ccc;
            text-align: left;
            margin: 80px 30px 50px 30px;
            font-size: 1.2em;
            line-height: 1.4;
        }
        
        /* Logo discreto de suporte */
        .support-logo {
            width: 48px;
            height: 48px;
            opacity: 1.0; /* Totalmente opaco/aceso */
            cursor: pointer;
            transition: opacity 0.3s ease, transform 0.3s ease;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            margin-left: auto;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .support-logo:hover {
            opacity: 1.0; /* Mantém totalmente opaco no hover */
            transform: scale(1.1);
        }
        
        .support-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }
        
        /* Quando o toggle está visível, logo fica mais visível */
        .support-logo.toggle-visible {
            opacity: 1.0; /* Totalmente visível */
            background: rgba(255, 107, 53, 0.2);
            border: 2px solid rgba(255, 107, 53, 0.5);
        }
        
        .support-logo.toggle-visible:hover {
            opacity: 1.0; /* Mantém totalmente visível */
            background: rgba(255, 107, 53, 0.3);
        }
        
        /* Ajustar posicionamento no header */
        header .support-logo {
            position: relative;
        }
        
        /* Logo visível mesmo no modo de edição */
        body.edit-mode .support-logo {
            opacity: 0.8; /* Mais visível no modo de edição */
            background: rgba(255, 107, 53, 0.1);
        }
        
        body.edit-mode .support-logo:hover {
            opacity: 1.0; /* Totalmente visível no hover do modo de edição */
        }
        
        /* Estilos para itens personalizados */
        .customized-item {
            position: relative;
            background: rgba(76, 175, 80, 0.1) !important;
            border-left: 3px solid #4CAF50 !important;
        }
        
        .customized-item::before {
            content: "✨";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
            opacity: 0.7;
        }
        
        body.edit-mode .customized-item {
            background: rgba(255, 193, 7, 0.2) !important;
            border-left: 3px solid #FFC107 !important;
        }
        
        body.edit-mode .customized-item::before {
            content: "✏️";
        }
        
        /* Estilos para badges do menu Meus Apps */
        .check-icon {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            font-size: 0.8em;
            padding: 2px 5px;
            border-radius: 50%;
            margin-right: 8px;
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
            animation: check-glow 3s infinite;
        }
        
        /* Ícone de check para apps individuais funcionais */
        .app-check {
            color: #4CAF50;
            font-size: 0.9em;
            margin-right: 6px;
            text-shadow: 0 1px 2px rgba(76, 175, 80, 0.3);
        }
        
        /* Ícone de pendente para apps não testados ainda */
        .app-pending {
            color: #FF9800;
            font-size: 0.9em;
            margin-right: 6px;
            text-shadow: 0 1px 2px rgba(255, 152, 0, 0.3);
        }
        
        .apps-counter {
            color: #4CAF50;
            font-size: 0.9em;
            margin-right: 100px !important;
        }
        
        @keyframes check-glow {
            0%, 100% { 
                box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 2px 8px rgba(76, 175, 80, 0.6);
                transform: scale(1.05);
            }
        }
        
        /* Hover effect para o header Meus Apps */
        .accordion-header:has(.check-icon):hover .check-icon {
            background: linear-gradient(45deg, #66BB6A, #81C784);
            transform: scale(1.1);
        }
        
        .accordion-header:has(.apps-counter):hover .apps-counter {
            background: rgba(76, 175, 80, 1);
            transform: scale(1.05);
        }
        
        /* Indicadores de status das subcategorias */
        .subcat-status {
            font-size: 0.8em;
            margin-right: 6px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .subcat-status.complete {
            color: #4CAF50; /* Verde - todos os apps funcionam */
        }
        
        .subcat-status.partial {
            color: #FF9800; /* Laranja - alguns apps reservados */
        }
        
        .subcat-status.empty {
            color: #757575; /* Cinza - nenhum app funcional */
        }
        
        /* Estilo para subcategorias não implementadas - visual desbotado */
        .sub-accordion-header:has(.subcat-status.empty) {
            opacity: 0.5;
            color: #999999 !important;
        }
        
        .sub-accordion-header:has(.subcat-status.empty) img {
            opacity: 0.4;
            filter: grayscale(50%);
        }
        
        .sub-accordion-header:has(.subcat-status.empty):hover {
            opacity: 0.7;
            background: rgba(80, 48, 96, 0.3) !important;
        }

        /* Esconder contadores quando modo de edição está inativo */
        body:not(.edit-mode) .apps-counter {
            display: none !important;
        }
        
        /* Mostrar contadores apenas quando modo de edição está ativo */
        body.edit-mode .apps-counter {
            display: inline !important;
        }

        /* Badge USER */
        .user-badge {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            z-index: 999;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 175, 80, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            opacity: 0.7;
            pointer-events: none;
        }

        .user-badge:hover {
            opacity: 1;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }


        /* Estilos para categoria MEUS FAVORITOS */
        .add-favorite-placeholder {
            list-style: none;
            margin: 10px 0;
        }

        .add-favorite-btn {
            width: 100%;
            background: linear-gradient(135deg, #4A148C, #6A1B9A); /* Roxo mais escuro para melhor contraste */
            border: none;
            padding: 12px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            color: #ffffff; /* Texto branco para contraste */
            font-weight: 500; /* Texto mais destacado */
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border-radius: 6px; /* Bordas arredondadas */
        }

        .add-favorite-btn:hover {
            background: linear-gradient(135deg, #6A1B9A, #7B1FA2); /* Roxo mais claro no hover */
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(74, 20, 140, 0.4); /* Sombra roxa */
        }

        .add-favorite-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Favoritos individuais */
        .favorite-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            margin: 8px 0;
            padding: 10px;
            transition: all 0.3s ease;
            position: relative;
        }

        .favorite-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .favorite-item .favorite-link {
            color: #e5e5e5;
            text-decoration: none;
            display: block;
            font-weight: 500;
        }

        .favorite-item .favorite-link:hover {
            color: #FFD700;
        }

        .favorite-delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        body.edit-mode .favorite-delete-btn {
            display: block;
        }

        /* Estilos para o botão de toggle do menu (hamburger) */

        /* Badge USER integrado no sidebar */
        .sidebar-user-header {
            background: linear-gradient(135deg, #4A148C, #6A1B9A);
            color: white;
            padding: 12px 15px;
            margin: 0;
            font-size: 0.85rem;
            font-weight: bold;
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .sidebar-user-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            pointer-events: none;
        }

        /* Remover badge fixo */
        .user-badge {
            display: none;
        }
    </style>

</head>
<body>
    <header>
        <button id="menuToggle" class="menu-toggle">☰</button>
        <h3 id="headerTitle">Acessos</h3>
        <div id="supportLogo" class="support-logo">
            <img src="https://d1yei2z3i6k35z.cloudfront.net/12974529/684d9ab360bc7_GERiAHLOGO8SQUARE2donwload.png" 
                 alt="GERiAH Support" 
                 title="Clique para acessar ferramentas de suporte">
        </div>
        <div class="edit-mode-toggle" id="editModeToggleContainer" style="display: none;">
            <label class="toggle-switch">
                <input type="checkbox" id="editModeToggle">
                <span class="toggle-slider"></span>
            </label>
            <span id="toggleLabel">Editar</span>
        </div>
        <button id="myCoursesBtn">iA</button>
    </header>
    <aside>
        <div class="sidebar-user-header">
            🎯 INDIVIDUAL
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header">
                <img src="https://api.iconify.design/tabler/apps.svg?color=%23e5e5e5" alt="MeusApps Logo" style="width: 24px; height: 24px; margin-right: 10px; vertical-align: middle;">
                CEL APPS 
                <span class="apps-counter">45</span>
                <span class="accordion-icon">►</span>
            </h2>
            <div class="accordion-content">
                <ul id="meusAppsMainItemsList">
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/health-recognition.svg?color=%23e5e5e5" alt="Saúde Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                <span class="subcat-status partial">●</span>
                                Saúde
                                <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">4</span>
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="saudeItemsList"><li>Carregando...</li></ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/message.svg?color=%23e5e5e5" alt="Comunicar Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                <span class="subcat-status partial">●</span>
                                Comunicar
                                <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">6</span>
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="comunicacaoItemsList"><li>Carregando...</li></ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/credit-card.svg?color=%23e5e5e5" alt="Banco Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                <span class="subcat-status partial">●</span>
                                Banco
                                <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">6</span>
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="bancoItemsList"><li>Carregando...</li></ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/pizza.svg?color=%23e5e5e5" alt="Alimentação Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                <span class="subcat-status partial">●</span>
                                Alimentação
                                <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">2</span>
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="alimentacaoItemsList"><li>Carregando...</li></ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/tool.svg?color=%23e5e5e5" alt="Utilidades Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                <span class="subcat-status partial">●</span>
                                Utilidades
                                <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">20</span>
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="utilidadesItemsList"><li>Carregando...</li></ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/device-gamepad.svg?color=%23e5e5e5" alt="Lazer Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                <span class="subcat-status partial">●</span>
                                Lazer
                                <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">5</span>
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="lazerItemsList"><li>Carregando...</li></ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/car.svg?color=%23e5e5e5" alt="Transporte Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                <span class="subcat-status partial">●</span>
                                Transporte
                                <span class="apps-counter" style="padding-right: 200px !important; margin-right: 0 !important;">4</span>
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="transporteItemsList"><li>Carregando...</li></ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="category-separator"></div>
        <div class="accordion-item">
            <h2 class="accordion-header">
                <img src="https://api.iconify.design/tabler/gift.svg?color=%23e5e5e5" alt="Exclusivo Logo" style="width: 24px; height: 24px; margin-right: 10px; vertical-align: middle;">
                EXCLUSIVO 
                <span class="accordion-icon">►</span>
            </h2>
            <div class="accordion-content">
                <ul id="paiMainItemsList">
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/video.svg?color=%23e5e5e5" alt="Videos Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                Videos Disponíveis
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="videosItemsList"><li>Carregando...</li></ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/school.svg?color=%23e5e5e5" alt="Conteudo de Apoio Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                Conteúdo de Apoio
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="categoriesList"><li>Carregando...</li></ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/tools.svg?color=%23e5e5e5" alt="Ferramentas Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                Ferramentas & Negócios
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="paiItemsList"><li>Nenhuma categoria F.A.I. configurada.</li></ul>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="sub-accordion-item">
                            <button class="sub-accordion-header">
                                <img src="https://api.iconify.design/tabler/brain.svg?color=%23e5e5e5" alt="Suporte IA Logo" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
                                Suporte - IA
                                <span class="sub-accordion-icon">►</span>
                            </button>
                            <div class="sub-accordion-content" style="display: none;">
                                <ul id="suporteIaItemsList"><li>Carregando subcategorias...</li></ul> 
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="category-separator"></div>
        <div class="accordion-item">
            <h2 class="accordion-header">
                <img src="https://api.iconify.design/tabler/users.svg?color=%23e5e5e5" alt="Participe Logo" style="width: 24px; height: 24px; margin-right: 10px; vertical-align: middle;">
                PARTICIPE 
                <span class="accordion-icon">►</span>
            </h2>
            <div class="accordion-content">
                <ul id="participeItemsList"><li>Carregando...</li></ul>
            </div>
        </div>
        <div class="category-separator"></div>
        <div class="accordion-item">
            <h2 class="accordion-header">
                <img src="https://api.iconify.design/tabler/star.svg?color=%23FFD700" alt="Favoritos Logo" style="width: 24px; height: 24px; margin-right: 10px; vertical-align: middle;">
                MEUS FAVORITOS 
                <span class="apps-counter" id="favoritosCounter">0/7</span>
                <span class="accordion-icon">►</span>
            </h2>
            <div class="accordion-content">
                <ul id="favoritosItemsList">
                    <li class="add-favorite-placeholder">
                        <button class="add-favorite-btn" id="addFavoriteBtn">
                            <span style="font-size: 1.2em;">➕</span>
                            Adicionar Favorito
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </aside>
    <main>
        <h1 id="mainTitle"></h1>
        <div id="coursesContainer"><p class="instruction-message">Selecione uma categoria no Menu e acesse os recursos.</p></div>
    </main>

    <div id="modal" class="modal hidden">
        <div class="modal-content">
            <span id="modalClose" class="close">&times;</span>
            <div id="courseDetails"></div>
        </div>
    </div>

    <!-- Modal de Curadoria -->
    <div id="curationModal" class="modal hidden">
      <div class="modal-content">
        <h2>Curadoria de Recursos</h2>
        <!-- Passo 1: adicionar/ignorar -->
        <div id="curationConfirm">
          <p id="curationMessage"></p>
          <p id="curationRemaining" style="font-weight:bold; margin:5px 0;"></p>
          <button id="curateYes">Sim</button>
          <button id="curateNo">Não</button>
          <button id="accessNowBtn" style="display:none;">Acessar Agora</button>
        </div>
        <!-- Passo 2: rever seleção com nome/email -->
        <div id="curationReview" style="display:none; margin-top:15px;">
          <h3>Revise sua seleção</h3>
          <ul id="curationList"></ul>
          <div style="margin-top:10px;">
            <button id="curateBack">Voltar</button>
            <button id="curateContinue">Continuar</button>
            <button id="curateFinish">Finalizar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- NOVO Modal P.A.I. -->
    <div id="paiModal" class="modal hidden">
        <div class="modal-content pai-modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; padding-bottom:10px; border-bottom: 1px solid rgba(80, 48, 96, 0.7);">
                <h2 id="paiModalTitle" style="margin:0; font-size:1.4em; color: #fff;"></h2>
                <span id="paiModalClose" class="close" style="font-size:1.8em; cursor:pointer; color: #aaa;">&times;</span>
            </div>
            <iframe id="paiModalIframe" style="width:100%; height:100%; border:none; background-color: #fff;"></iframe>
        </div>
    </div>

    <!-- Modal de Confirmação do Modo de Edição -->
    <div id="editModeConfirmModal" class="modal hidden">
        <div class="modal-content">
            <span id="editModeConfirmClose" class="close">&times;</span>
            <h2>🔧 Ativar Modo de Edição</h2>
            <p>No modo de edição você poderá:</p>
            <ul style="text-align: left; margin: 20px 0; color: #e0e0e0;">
                <li>✏️ Personalizar nomes dos aplicativos</li>
                <li>🔗 Alterar URLs para seus sites preferidos</li>
                <li>🎨 Modificar ícones (futuro)</li>
                <li>💾 Salvar suas configurações</li>
            </ul>
            <p style="color: #ffcc80; font-weight: bold;">⚠️ Suas alterações serão salvas automaticamente</p>
            <div style="margin-top: 25px;">
                <button id="confirmEditMode" style="background-color: #ff6b35; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer; font-weight: bold;">Ativar Modo de Edição</button>
                <button id="cancelEditMode" style="background-color: #666; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer;">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Edição Individual -->
    <div id="itemEditModal" class="modal hidden">
        <div class="modal-content">
            <span id="itemEditClose" class="close">&times;</span>
            <h2>✏️ Editar Item</h2>
            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 10px; color: #e0e0e0; font-weight: bold;">
                    📝 Nome do Aplicativo:
                </label>
                <input type="text" id="editItemName" style="width: 100%; padding: 10px; border: 1px solid #666; border-radius: 4px; background: #2a2a2a; color: white; font-size: 16px;" placeholder="Digite o nome do aplicativo">
                
                <label style="display: block; margin: 20px 0 10px 0; color: #e0e0e0; font-weight: bold;">
                    🔗 URL de Destino:
                </label>
                <input type="url" id="editItemUrl" style="width: 100%; padding: 10px; border: 1px solid #666; border-radius: 4px; background: #2a2a2a; color: white; font-size: 16px;" placeholder="https://exemplo.com">
                
                <div style="margin: 20px 0; padding: 15px; background: rgba(255, 107, 53, 0.1); border: 1px solid rgba(255, 107, 53, 0.3); border-radius: 4px;">
                    <p style="margin: 0; color: #ffcc80; font-size: 14px;">
                        💡 <strong>Dica:</strong> Certifique-se de incluir "https://" no início da URL
                    </p>
                </div>
            </div>
            
            <div style="margin-top: 25px; text-align: right;">
                <button id="cancelItemEdit" style="background-color: #666; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer;">Cancelar</button>
                <button id="saveItemEdit" style="background-color: #ff6b35; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer; font-weight: bold;">💾 Salvar Alterações</button>
            </div>
        </div>
    </div>

    <!-- Modal de App (para Play Store) -->
    <div id="appModal" class="modal hidden">
        <div class="modal-content">
            <span id="appModalClose" class="close">&times;</span>
            <div style="text-align: center; padding: 20px;">
                <h2 id="appModalTitle" style="margin-bottom: 20px; color: #fff;"></h2>
                <div style="background: rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <p style="color: #e0e0e0; margin-bottom: 15px;">📱 Este é um aplicativo móvel oficial</p>
                    <p style="color: #ccc; font-size: 0.9em; margin-bottom: 20px;">Clique no botão abaixo para:</p>
                    <ul style="color: #ccc; text-align: left; margin: 15px 0; padding-left: 20px;">
                        <li>✅ Abrir o app se já estiver instalado</li>
                        <li>📥 Ir para a loja para download se não estiver instalado</li>
                    </ul>
                </div>
                <button id="openAppButton" style="
                    background: linear-gradient(45deg, #4CAF50, #45a049);
                    border: none;
                    padding: 15px 30px;
                    font-size: 16px;
                    cursor: pointer;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                    transition: transform 0.2s ease;
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    🚀 Abrir Aplicativo
                </button>
                <p style="color: #999; font-size: 0.8em; margin-top: 15px;">
                    💡 Você permanecerá no GERiAH até clicar no botão
                </p>
            </div>
        </div>
    </div>

    <!-- Modal de Edição de Cards -->
    <div id="cardEditModal" class="modal hidden">
        <div class="modal-content">
            <span id="cardEditModalClose" class="close">&times;</span>
            <h2>Editar Card</h2>
            <form id="cardEditForm">
                <div style="margin-bottom: 15px;">
                    <label for="editCardTitle" style="display: block; margin-bottom: 5px; color: #fff;">Título:</label>
                    <input type="text" id="editCardTitle" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="editCardImage" style="display: block; margin-bottom: 5px; color: #fff;">URL da Imagem:</label>
                    <input type="url" id="editCardImage" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="editCardUrl" style="display: block; margin-bottom: 5px; color: #fff;">URL de Acesso:</label>
                    <input type="url" id="editCardUrl" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="editCardDescription" style="display: block; margin-bottom: 5px; color: #fff;">Descrição:</label>
                    <textarea id="editCardDescription" rows="3" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; resize: vertical;"></textarea>
                </div>
                <div style="text-align: right;">
                    <button type="button" id="cancelCardEdit" style="margin-right: 10px; padding: 8px 16px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                    <button type="button" id="saveCardEdit" style="padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Edição de Itens Simples -->
    <div id="simpleItemEditModal" class="modal hidden">
        <div class="modal-content">
            <span id="simpleItemEditModalClose" class="close">&times;</span>
            <h2>Editar Item</h2>
            <form id="simpleItemEditForm">
                <div style="margin-bottom: 15px;">
                    <label for="editSimpleItemName" style="display: block; margin-bottom: 5px; color: #fff;">Nome:</label>
                    <input type="text" id="editSimpleItemName" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="editSimpleItemUrl" style="display: block; margin-bottom: 5px; color: #fff;">URL de Acesso:</label>
                    <input type="url" id="editSimpleItemUrl" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div style="text-align: right;">
                    <button type="button" id="cancelSimpleItemEdit" style="margin-right: 10px; padding: 8px 16px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancelar</button>
                    <button type="button" id="saveSimpleItemEdit" style="padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Adicionar Favorito -->
    <div id="addFavoriteModal" class="modal hidden">
        <div class="modal-content">
            <span id="addFavoriteModalClose" class="close">&times;</span>
            <h2>⭐ Adicionar aos Meus Favoritos</h2>
            <div style="margin: 20px 0;">
                <label style="display: block; margin-bottom: 10px; color: #e0e0e0; font-weight: bold;">
                    📝 Nome do Favorito:
                </label>
                <input type="text" id="addFavoriteName" style="width: 100%; padding: 10px; border: 1px solid #666; border-radius: 4px; background: #2a2a2a; color: white; font-size: 16px;" placeholder="Ex: Meu Site Favorito">
                
                <label style="display: block; margin: 20px 0 10px 0; color: #e0e0e0; font-weight: bold;">
                    🔗 URL de Destino:
                </label>
                <input type="url" id="addFavoriteUrl" style="width: 100%; padding: 10px; border: 1px solid #666; border-radius: 4px; background: #2a2a2a; color: white; font-size: 16px;" placeholder="https://exemplo.com">
                
                <label style="display: block; margin: 20px 0 10px 0; color: #e0e0e0; font-weight: bold;">
                    📄 Descrição (opcional):
                </label>
                <textarea id="addFavoriteDescription" style="width: 100%; padding: 10px; border: 1px solid #666; border-radius: 4px; background: #2a2a2a; color: white; font-size: 16px; resize: vertical;" rows="3" placeholder="Breve descrição do site ou ferramenta"></textarea>
                
                <div style="margin: 25px 0; padding: 20px; background: rgba(76, 175, 80, 0.1); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 8px;">
                    <p style="margin: 0 0 15px 0; color: #81C784; font-size: 15px; line-height: 1.6;">
                          ⭐ <strong>Versão INDIVIDUAL:</strong> Você pode adicionar até <strong>7 favoritos</strong> personalizados.<br><br>
                          🚀 <strong>PERSONALIZADO:</strong> Favoritos ilimitados + categorias personalizadas!
                    </p>
                    <div style="text-align: center; margin-top: 15px;">
                        <button onclick="showContactAlert()" style="
                            background: linear-gradient(135deg, #ff6b35, #e55a2b);
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 6px;
                            font-weight: bold;
                            font-size: 13px;
                            cursor: pointer;
                            text-transform: uppercase;
                            transition: all 0.3s ease;
                            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            🚀 FAZER UPGRADE
                        </button>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 25px; text-align: right;">
                <button id="cancelAddFavorite" style="background-color: #666; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer;">Cancelar</button>
                <button id="saveAddFavorite" style="background-color: #4CAF50; color: white; border: none; padding: 12px 20px; margin: 5px; border-radius: 4px; cursor: pointer; font-weight: bold;">⭐ Adicionar Favorito</button>
            </div>
        </div>
    </div>

    <script>
        // Variáveis para controle do modo de edição - DEFINIDAS NO INÍCIO
        let isEditMode = false;
        let isToggleVisible = false;
        let currentEditingItem = null;
        let customItemData = {};
        
        const curationList = [];
        const MAX_CURATION = 4;

        // Variáveis para MEUS FAVORITOS (USER)
        let userFavorites = [];
        const MAX_USER_FAVORITES = 7;
        let customCardData = {};

        // Nova estrutura para categorias P.A.I.
        const paiCategoriesData = [
            {
                name: "50+ | Maduros e Idosos",
                items: [
                    { name: "Longevidade", url: "https://longevidade.com.br/", image: "https://api.iconify.design/tabler/plant.svg?color=%23e5e5e5" }, 
                    { name: "Analise CNIS", url: "https://sobralfreenat.github.io/poc_avaliacao_cnis_aposentadoria/", image: "https://api.iconify.design/tabler/file-text.svg?color=%23e5e5e5" },
                    { name: "CNIS Suporte", url: "https://sobralfreenat.github.io/cnis_fluxo02_backoffice/", image: "https://api.iconify.design/tabler/tool.svg?color=%23e5e5e5" }
                ]
            },
            {
                name: "FNW Assessoria",
                items: [
           //         { name: "Plataforma FNW Assessoria", url: "https://sobralfreenat.github.io/menu_fixo_replica/", image: "https://api.iconify.design/tabler/briefcase.svg?color=%23e5e5e5" },
                    { name: "FNW - Formulário Estratégico", url: "https://websim.com/@shiningrainbow72249063/formul-rio-estrat-gico", image: "https://api.iconify.design/tabler/file-text.svg?color=%23e5e5e5" },
                    { name: "FNW - ROI Maker", url: "https://sobralfreenat.github.io/fnw_clevel_roi-maker/", image: "https://api.iconify.design/tabler/calculator.svg?color=%23e5e5e5" },
                    { name: "Painel ETO", url: "https://sobralfreenat.github.io/fnw_connect_panel/", image: "https://api.iconify.design/tabler/layout-dashboard.svg?color=%23e5e5e5" },
           //         { name: "Mapa Tatico SP MG", url: "https://sobralfreenat.github.io/mapa150_sp-106_mg/", image: "https://api.iconify.design/tabler/map-2.svg?color=%23e5e5e5" }
                ]
            }
        ];

        // Restaurando a estrutura de subcategorias para Suporte IA
        const suporteIaCategoriesData = [
            {
                name: "Wizzards",
                items: [
                    { name: "IA Prompt Wizzard", url: "https://sobralfreenat.github.io/agent_ai_prompt_gen_tool/", image: "https://api.iconify.design/tabler/wand.svg?color=%23e5e5e5" },
               //     { name: "Plano de Aula - S", url: "https://sobralfreenat.github.io/fnw_plano_aula/", image: "https://api.iconify.design/tabler/school.svg?color=%23e5e5e5" }
                ]
            },
            {
                name: "Assistentes",
                items: [
                    { name: "Chat Rosio Livia Geriah", url: "https://sobralfreenat.github.io/chat_rosio_livia_geriah/", image: "https://api.iconify.design/tabler/message-dots.svg?color=%23e5e5e5" },
                    { name: "HumanIA", url: "https://dash.superagentes.ai/@humania", image: "https://api.iconify.design/tabler/users-group.svg?color=%23e5e5e5" },
                    { name: "London Lord", url: "https://sobralfreenat.github.io/agb_gabriel_bourne_master/", image: "https://api.iconify.design/tabler/user-hexagon.svg?color=%23e5e5e5" }
                ]
            },
            {
               // name: "Agentes",
                items: [
                    { name: "Agente Exemplo 1", url: "#", image: "https://api.iconify.design/tabler/robot.svg?color=%23e5e5e5" },
                    { name: "Agente Exemplo 2", url: "#", image: "https://api.iconify.design/tabler/gizmo.svg?color=%23e5e5e5" }
                ],
                statusMessage: "" // Limpa a mensagem pois agora temos itens
            },
            {
                // name: "Automações",
                items: [
                    { name: "Automação Exemplo 1", url: "#", image: "https://api.iconify.design/simple-icons/n8n.svg?color=%23e5e5e5" },
                    { name: "Automação Exemplo 2", url: "#", image: "https://api.iconify.design/simple-icons/make.svg?color=%23e5e5e5" }
                ],
                statusMessage: "" // Limpa a mensagem pois agora temos itens
            }
        ];

        // Nova estrutura para categoria "Participe"
        const participeCategoriesData = [
            {
                name: "Parcerias",
                items: [
                    { name: "FNW Sinergias", url: "https://sobralfreenat.github.io/fnw_parceria_sinergia/", image: "https://api.iconify.design/tabler/home.svg?color=%23e5e5e5" },
                    { name: "IDEIA21", url: "https://websim.com/@shiningrainbow72249063/ideia21-instituto-de-design-estilo-imagem-e-arte", image: "https://api.iconify.design/tabler/user.svg?color=%23e5e5e5" },
                    { name: "IPSOLON", url: "https://websim.com/@shiningrainbow72249063/ipsolon-instituto-de-promo-o-da-sa-de-orientada-lo", image: "https://api.iconify.design/tabler/git-fork.svg?color=%23e5e5e5" }

                ]
            },
            {
                name: "Feito Por Você",
                items: [
                    { name: "Feito Por Você", url: "https://forms.gle/kFdaEY5L9gDYCUpC8", image: "https://api.iconify.design/tabler/edit.svg?color=%23e5e5e5" } // Use um ícone relevante
                ]
            }
        ];

        // Nova estrutura para categoria "Videos"
        const videosCategoriesData = [
            {
                name: "Entretenimento",
                items: [
                    { name: "Séries", url: "https://pluto.tv/br/live-tv/5f1212ad1728050007a523b8", image: "https://api.iconify.design/tabler/square.svg?color=%23e5e5e5" }, // Alterado para um ícone genérico para teste
                    { name: "Curiosidades", url: "https://pluto.tv/br/live-tv/5f1213ba0ecebc00070e170f", image: "https://api.iconify.design/tabler/circle.svg?color=%23e5e5e5" }, // Use um ícone relevante
                    { name: "Estilo de Vida", url: "https://pluto.tv/br/live-tv/664df5221dc48600087592b1", image: "https://api.iconify.design/tabler/triangle.svg?color=%23e5e5e5" }, // Use um ícone relevante
					
					{ name: "Notícias de Europa", url: "https://www.youtube.com/embed/O9mOtdZ-nSk", image: "https://api.iconify.design/tabler/box.svg?color=%23e5e5e5" } // Use um ícone relevante
                ]
            },
            {
                name: "Internos",
                items: [
                { name: "CNIS", url: "https://www.youtube.com/embed/OkqGQA-0XQU", image: "https://api.iconify.design/tabler/video.svg?color=%23e5e5e5" }, // Use um ícone relevante


// <iframe width="853" height="480" src="https://www.youtube.com/embed/OkqGQA-0XQU" title="GERiAH  CNIS01  2025 06 12 11 53 38" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe> 



//<iframe width="889" height="500" src="https://www.youtube.com/embed/O9mOtdZ-nSk" title="euronews en directo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>




                   // { name: "Curiosidades", url: "https://pluto.tv/br/live-tv/5f1213ba0ecebc00070e170f", image: "https://api.iconify.design/tabler/circle.svg?color=%23e5e5e5" }, // Use um ícone relevante
                  //  { name: "Estilo de Vida", url: "https://pluto.tv/br/live-tv/664df5221dc48600087592b1", image: "https://api.iconify.design/tabler/triangle.svg?color=%23e5e5e5" } // Use um ícone relevante
                ]
            },
            {
                name: "Ofertas",
                items: [
                    //{ name: "Curiosidades", url: "https://pluto.tv/br/live-tv/5f1213ba0ecebc00070e170f", image: "https://api.iconify.design/tabler/circle.svg?color=%23e5e5e5" } // Use um ícone relevante
                ]
            }
        ];

        // Variáveis para parâmetros da URL e estado de embedding
        let urlParams = new URLSearchParams(window.location.search);
        let embeddedMode = urlParams.get('embedded') === 'true';
        let parentOrigin = urlParams.get('origin');
        let userToken = urlParams.get('userToken');
        let userId = urlParams.get('userId'); // Pode ser usado futuramente se necessário
        console.log('GERIiAH_USER: userToken from URL params:', userToken);
        console.log('GERIiAH_USER: embeddedMode from URL params:', embeddedMode);

        // Usa o token da URL se disponível, senão usa o fallback
        const apiToken = userToken || 'dbb2c4d19a5ef0fec48e363618611614b4e0dfce'; 

        const categoryUrl = 'https://www.iped.com.br/api/category/get-categories';
        const coursesUrl = 'https://www.iped.com.br/api/course/get-courses';

        const relevantKeywordsFor50Plus = [
            'saude', 'bem-estar', 'memoria', 'mente', 'corpo', 'nutricao', 'alimentacao', 'exercicio', 'ginastica', 'yoga', 'pilates', 'dança', 'esportes', 'fisioterapia',
            'artesanato', 'pintura', 'desenho', 'musica', 'canto', 'instrumento', 'fotografia',
            'historia', 'cultura', 'arte', 'literatura', 'idiomas', 'linguas', 'escrita',
            'finanças', 'investimentos', 'empreendedorismo', 'negocios', 'direito', 'aposentadoria',
            'jardinagem', 'horta', 'culinaria', 'gastronomia', 'receitas',
            'tecnologia', 'digital', 'informatica', 'informática', 'internet', 'computador', 'celular', 'redes sociais',
            'viagem', 'turismo', 'lazer', 'jogos', 'espiritualidade', 'meditacao', 'qualidade de vida', 'voluntariado',
            'gsuite', 'g-suite', 'google', 'gmail', 'drive', 'docs', 'sheets', 'slides', 'forms', 'calendar', 'meet', 'workspace',
            'planilha', 'documento', 'apresentacao', 'formulario', 'agenda', 'email', 'nuvem', 'cloud', 'office', 'produtividade'
        ];

        // Função para ocultar o header e ajustar layout se em modo embedded
        function adjustForEmbeddedMode() {
            if (embeddedMode) {
                const headerElement = document.querySelector('header');
                const asideElement = document.querySelector('aside');
                const menuToggle = document.getElementById('menuToggle');

                // Forçar visibilidade e posicionamento do header no modo embarcado
                if (headerElement) {
                    headerElement.style.setProperty('display', 'flex', 'important');
                    headerElement.style.setProperty('position', 'fixed', 'important');
                    headerElement.style.setProperty('top', '0', 'important');
                    headerElement.style.setProperty('left', '0', 'important');
                    headerElement.style.setProperty('right', '0', 'important');
                    headerElement.style.setProperty('z-index', '9999', 'important');
                }
                // Forçar visibilidade e z-index do botão de menu (hambúrguer)
                if (menuToggle) {
                    menuToggle.style.setProperty('display', 'block', 'important');
                    menuToggle.style.setProperty('z-index', '10000', 'important');
                }
                // Ajusta o padding-top do body para 70px, pois o header está visível
                document.body.style.setProperty('padding-top', '70px', 'important');
                
                // Ajusta a posição do aside para o topo da página (abaixo do header)
                if (asideElement) {
                    asideElement.style.setProperty('top', '70px', 'important');
                }

                // --- Início da lógica restaurada para botões de curadoria no modo embarcado ---
                const accessNowBtn = document.getElementById('accessNowBtn');
                if (accessNowBtn) {
                    accessNowBtn.style.display = 'inline-block'; // Mostra o botão em modo embedded
                    // Estilizar como os outros botões:
                    accessNowBtn.style.backgroundColor = 'rgba(100, 68, 116, 0.9)';
                    accessNowBtn.style.color = 'white';
                    accessNowBtn.style.border = '1px solid rgba(120, 88, 136, 1)';
                    accessNowBtn.style.padding = '10px 15px';
                    accessNowBtn.style.margin = '5px';
                    accessNowBtn.style.borderRadius = '4px';
                    accessNowBtn.style.cursor = 'pointer';
                    accessNowBtn.style.fontWeight = 'bold';
                    accessNowBtn.addEventListener('click', () => {
                        if (current && parentOrigin) {
                            window.parent.postMessage({ action: 'acessarItem', itemId: current.course_id }, parentOrigin);
                            document.getElementById('curationModal').classList.add('hidden'); // Fecha o modal
                        }
                    });
                }
                 // No modo embedded, o botão "Sim" para adicionar à curadoria deve estar oculto
                const curateYesBtn = document.getElementById('curateYes');
                if(curateYesBtn) curateYesBtn.style.display = 'none';
                
                // No modo embedded, o botão "Não" (ignorar) deve estar oculto
                const curateNoBtn = document.getElementById('curateNo');
                if(curateNoBtn) curateNoBtn.style.display = 'none';
                 // Ajustar texto do prompt de curadoria em modo embedded
                const curationMessageEl = document.getElementById('curationMessage');
                if (curationMessageEl && current) {
                    curationMessageEl.textContent = `Acessar conteúdo "${current.course_title}"?`;
                }
                const curationRemainingEl = document.getElementById('curationRemaining');
                if(curationRemainingEl) curationRemainingEl.style.display = 'none'; // Não relevante para acesso direto
                // --- Fim da lógica restaurada para botões de curadoria no modo embarcado ---
            }
        }


        async function fetchCategories() {
            const ul = document.getElementById('categoriesList');
            ul.innerHTML = '<li>Carregando...</li>';
            console.log('fetchCategories: Iniciando requisição para categorias...');
            console.log('fetchCategories: Usando apiToken:', apiToken);
            
            // DEBUG: Mostrar palavras-chave que estão sendo usadas
            console.log('DEBUG: Palavras-chave para filtro:', relevantKeywordsFor50Plus);
            
            try {
                const fd = new FormData();
                fd.append('token', apiToken);
                fd.append('all_formats', 'true');
                const res = await fetch(categoryUrl, { method: 'POST', body: fd });
                console.log('fetchCategories: Resposta recebida. Status:', res.status, 'OK:', res.ok);
                const data = await res.json();
                console.log('fetchCategories: Dados da resposta:', data);
                if (data.CATEGORIES) renderCategories(data.CATEGORIES);
                else {
                    ul.innerHTML = '<li>Erro ao carregar categorias.</li>';
                    console.error('fetchCategories: Dados de categorias inválidos ou ausentes.', data);
                }
            } catch (error) {
                ul.innerHTML = '<li>Erro de rede.</li>';
                console.error('fetchCategories: Erro na requisição:', error);
            }
        }

        function renderCategories(cats) {
            const ul = document.getElementById('categoriesList');
            ul.innerHTML = '';
            let categoriesRendered = 0;

            // DEBUG: Log de todas as categorias recebidas
            console.log('DEBUG: Categorias recebidas da API IPED:', cats.length);
            cats.forEach((cat, idx) => {
                console.log(`DEBUG: Categoria ${idx + 1}: "${cat.category_title}"`);
            });

            cats.forEach((cat, idx) => {
                const categoryTitleLower = cat.category_title.toLowerCase();
                const isRelevant = relevantKeywordsFor50Plus.some(keyword => categoryTitleLower.includes(keyword));

                // DEBUG: Log do processo de filtragem
                console.log(`DEBUG: "${cat.category_title}" -> ${categoryTitleLower} -> Relevante: ${isRelevant}`);

                if (isRelevant) {
                    const li = document.createElement('li');
                    const btn = document.createElement('button');
                    btn.textContent = cat.category_title;
                    btn.dataset.id = cat.category_id;
                    btn.addEventListener('click', () => selectCategory(btn));
                    li.appendChild(btn);
                    ul.appendChild(li);
                    categoriesRendered++;
                    console.log(`DEBUG: Categoria "${cat.category_title}" ADICIONADA à lista`);
                }
            });

            console.log(`DEBUG: Total de categorias renderizadas: ${categoriesRendered}`);

            if (categoriesRendered === 0) {
                ul.innerHTML = '<li>Nenhuma categoria de interesse para 50+ encontrada no momento.</li>';
            }
        }

        function selectCategory(btn) {
            // Atualiza classe ativa
            document.querySelectorAll('#categoriesList button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            // Limpa o contêiner de cursos antes de buscar novos
            document.getElementById('coursesContainer').innerHTML = '<p style="color: #ccc;">Carregando recursos da categoria: ' + btn.textContent + '...</p>';
            fetchCourses(btn.dataset.id, btn.textContent);
            // Chama closeSidebar() após a seleção de categoria
            closeSidebar();
        }

        async function fetchCourses(catId, catTitle) {
            const cont = document.getElementById('coursesContainer');
            try {
                const fd = new FormData();
                fd.append('token', apiToken);
                fd.append('category_id', catId);
                fd.append('all_formats', 'true');
                const res = await fetch(coursesUrl, { method: 'POST', body: fd });
                const data = await res.json();
                if (data.COURSES) renderCourses(data.COURSES, catTitle);
                else cont.innerHTML = '<p style="color: #ff6b6b;">Erro ao carregar recursos.</p>';
            } catch {
                cont.innerHTML = '<p style="color: #ff6b6b;">Erro de rede ao buscar recursos.</p>';
            }
        }

        function renderCourses(courses, categoryTitle) {
            console.log('renderCourses: userToken value:', userToken);
            const container = document.getElementById('coursesContainer');
            container.innerHTML = '';

            // Cria o título da categoria principal (antigo #mainTitle, agora dinâmico)
            // Este título fica fora do carrossel, no topo da área de cursos.
            const categoryHeader = document.createElement('h2');
            categoryHeader.className = 'category-title-header'; // Reutiliza o estilo existente
            categoryHeader.textContent = categoryTitle;
            container.appendChild(categoryHeader);

            if (!courses || courses.length === 0) { // Verificação mais robusta
                // Se não há cursos, apenas mostra a mensagem abaixo do título da categoria.
                // Não cria o .carousel-track nem os pseudo-elementos de esfumaçar.
                const noCoursesMessage = document.createElement('p');
                noCoursesMessage.textContent = 'Nenhum recurso encontrado nesta categoria.';
                noCoursesMessage.style.color = '#ccc';
                noCoursesMessage.style.marginTop = '20px';
                container.appendChild(noCoursesMessage);
                return;
            }

            // Cria o trilho do carrossel
            const carouselTrack = document.createElement('div');
            carouselTrack.className = 'carousel-track';

            courses.forEach(course => {
                const card = document.createElement('div');
                card.className = 'course-card';
                if(course.course_id) card.dataset.courseId = course.course_id;

                let displayTitle = course.course_title || 'Curso sem título';
                if (displayTitle.toLowerCase().startsWith('curso de ')) {
                    displayTitle = displayTitle.substring(9); // Remove "Curso de " (9 caracteres)
                }

                card.innerHTML = `
                    <img src="${course.course_image || 'https://via.placeholder.com/308x196.png?text=Sem+Imagem'}" alt="${course.course_title || 'Curso sem título'}" style="width:100%; height:196px; object-fit:cover; border-bottom: 1px solid rgba(80, 48, 96, 0.9);">
                    <div class="info" style="padding:15px;">
                        <h3 style="margin:0 0 10px; font-size:1.05em; color:#fff; height: 56px; overflow: hidden;">${displayTitle}</h3>
                        <p style="font-size:0.85em; color:#ccc; margin:0; line-height: 1.3; height: 70px; overflow: hidden;">${(course.course_description || 'Sem descrição disponível.').substring(0, 100)}...</p>
                        ${userToken ? `<button class="access-course-button" data-course-id="${course.course_id}">Acessar</button>` : ''}
                    </div>`;

                if (userToken) {
                    // Se o usuário está logado, o clique no card não faz nada,
                    // e a ação de acesso é via o botão "Acessar".
                    // card.onclick = null; // Já é null por padrão se não for atribuído
                    const accessButton = card.querySelector('.access-course-button');
                    if (accessButton) {
                        accessButton.addEventListener('click', (e) => {
                            e.stopPropagation(); // Impede que o clique no botão propague para o card
                            if (course.course_id && parentOrigin) {
                                window.parent.postMessage({ action: 'acessarItem', itemId: course.course_id }, parentOrigin);
                            }
                            closeSidebar(); // Fechar sidebar após iniciar o acesso ao curso
                        });
                    }
                } else {
                    // Se o usuário NÃO está logado, o clique no card abre o modal de curadoria.
                    card.onclick = () => {
                        promptCurate(course);
                        // closeSidebar(); // REMOVIDO: Permitir que o menu hambúrguer funcione com o modal aberto
                    };
                }
                carouselTrack.appendChild(card);
            });
            container.appendChild(carouselTrack);

            // Adiciona listener de scroll ao carrossel recém-criado
            const debouncedUpdateFocus = debounce(() => updateCarouselFocus(carouselTrack), 50);
            
            let scrollEndTimer = null;
            carouselTrack.addEventListener('scroll', () => {
                // Atualiza o foco visualmente durante o scroll
                debouncedUpdateFocus(); 

                // Detecta o fim do scroll para o snap
                clearTimeout(scrollEndTimer);
                scrollEndTimer = setTimeout(() => {
                    snapToNearestCard(carouselTrack);
                }, 150); // Ajuste este valor se necessário (tempo para considerar o scroll parado)
            });

            // Chama uma vez para definir o foco inicial se houver scroll inicial
            updateCarouselFocus(carouselTrack); 
        }

        function snapToNearestCard(carouselTrack) {
            if (!carouselTrack || carouselTrack.children.length === 0) return;

            const cards = Array.from(carouselTrack.querySelectorAll('.course-card'));
            if (cards.length === 0) return;

            const trackRect = carouselTrack.getBoundingClientRect();
            const trackVisibleWidth = carouselTrack.clientWidth; // Largura visível, excluindo scrollbars
            const trackScrollLeft = carouselTrack.scrollLeft;

            let nearestCard = null;
            let smallestDistance = Infinity;

            // Calcula a "linha central" da área visível do carrossel
            const viewportCenterLine = trackScrollLeft + trackVisibleWidth / 2;

            cards.forEach(card => {
                const cardMidPoint = card.offsetLeft + card.offsetWidth / 2;
                const distance = Math.abs(viewportCenterLine - cardMidPoint);

                if (distance < smallestDistance) {
                    smallestDistance = distance;
                    nearestCard = card;
                }
            });

            if (nearestCard) {
                // Calcula o scrollLeft necessário para centralizar o nearestCard
                const targetScrollLeft = nearestCard.offsetLeft - (trackVisibleWidth / 2) + (nearestCard.offsetWidth / 2);
                
                // Só faz o scroll se a posição alvo for significativamente diferente da atual
                // para evitar loops de snap em alguns casos, e para não "snappar" se já estiver perto.
                if (Math.abs(carouselTrack.scrollLeft - targetScrollLeft) > 1) { 
                    carouselTrack.scrollTo({
                        left: targetScrollLeft,
                        behavior: 'smooth'
                    });
                    // A debouncedUpdateFocus no listener de scroll cuidará de atualizar o visual após a animação de snap.
                }
            }
        }

        // Função Debounce para otimizar eventos de scroll/resize
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Função para atualizar o foco no card central do carrossel
        function updateCarouselFocus(carouselTrack) {
            if (!carouselTrack || carouselTrack.children.length === 0) return;

            const trackRect = carouselTrack.getBoundingClientRect();
            const trackCenter = trackRect.left + trackRect.width / 2;
            const cards = Array.from(carouselTrack.querySelectorAll('.course-card'));

            const cardWidth = cards[0] ? cards[0].offsetWidth : 308;

            // --- Parâmetros Responsivos --- 
            const isMobile = window.innerWidth <= 768;

            // Parâmetros de estilo
            const MAX_SCALE = isMobile ? 1.15 : 1.28; 
            const MIN_SCALE = 0.8;
            const MAX_TRANSLATE_Z = isMobile ? 30 : 60; 
            const MIN_TRANSLATE_Z = isMobile ? -100 : -200;
            const MAX_OPACITY = 1.0;
            const MIN_OPACITY_EDGE = isMobile ? 0.6 : 0.4; 
            const MIN_OPACITY_FAR = isMobile ? 0.2 : 0.1; 
            const MAX_BRIGHTNESS = 1.0;
            const MIN_BRIGHTNESS_EDGE = isMobile ? 0.6 : 0.4;
            const MIN_BRIGHTNESS_FAR = isMobile ? 0.2 : 0.1;

            const BORDER_DARK_COLOR = '#21112E';
            const BORDER_LIGHT_COLOR = '#D3C5E0';
            const BORDER_THICKNESS = 2; 

            const FOCUS_ZONE_WIDTH = cardWidth * (isMobile ? 1.5 : 2.0); 

            const Y_ROTATE_PER_CARD = isMobile ? 5 : 10; 
            const Y_ROTATE_FOCUS_DAMPING = 0.4; 
            const X_TRANSLATE_BASE_FACTOR = cardWidth * (isMobile ? 0.15 : 0.25);
            // --- Fim Parâmetros Responsivos ---


            let centralCardIndex = -1;
            let minDistanceToTrackCenterForPivoting = Infinity;
            cards.forEach((card, index) => {
                const cardRect = card.getBoundingClientRect();
                const cardCenter = cardRect.left + cardRect.width / 2;
                const distance = Math.abs(cardCenter - trackCenter);
                if (distance < minDistanceToTrackCenterForPivoting) {
                    minDistanceToTrackCenterForPivoting = distance;
                    centralCardIndex = index;
                }
            });

            cards.forEach((card, index) => {
                const cardRect = card.getBoundingClientRect();
                const cardCenter = cardRect.left + cardRect.width / 2;

                const distanceToTrackCenterCurrentCard = Math.abs(cardCenter - trackCenter);
                let focusFactor = 1 - (distanceToTrackCenterCurrentCard / (FOCUS_ZONE_WIDTH / 2));
                focusFactor = Math.max(0, Math.min(1, focusFactor));

                const scale = MIN_SCALE + (MAX_SCALE - MIN_SCALE) * focusFactor;
                const translateZ = MIN_TRANSLATE_Z + (MAX_TRANSLATE_Z - MIN_TRANSLATE_Z) * focusFactor;
                
                let opacity, brightness;
                let boxShadow = `0 8px 20px rgba(0,0,0,${(0.3 + focusFactor * 0.5).toFixed(2)})`; // Sombra base interpolada

                if (focusFactor > 0.95) { // Ápice do foco
                    const elevationShadow = `0 20px 45px rgba(0,0,0,0.8)`;
                    const darkBorder = `0 0 0 ${BORDER_THICKNESS}px ${BORDER_DARK_COLOR}`;
                    const lightBorder = `0 0 0 ${BORDER_THICKNESS * 2}px ${BORDER_LIGHT_COLOR}`;
                    boxShadow = `${darkBorder}, ${lightBorder}, ${elevationShadow}`;
                } else if (focusFactor > 0.5) { // Zona de foco intermediária
                    const currentElevationAlpha = (0.3 + focusFactor * 0.5).toFixed(2);
                    boxShadow = `0 ${Math.round(8 + 12 * focusFactor)}px ${Math.round(20 + 25 * focusFactor)}px rgba(0,0,0,${currentElevationAlpha})`;
                } // Para focusFactor <= 0.5, a sombra base já definida é suficiente (menor e mais sutil)

                if (focusFactor > 0) {
                    opacity = MIN_OPACITY_EDGE + (MAX_OPACITY - MIN_OPACITY_EDGE) * focusFactor;
                    brightness = MIN_BRIGHTNESS_EDGE + (MAX_BRIGHTNESS - MIN_BRIGHTNESS_EDGE) * focusFactor;
                } else {
                    const falloffDistance = cardWidth * 1.5;
                    const distBeyondFocusZone = distanceToTrackCenterCurrentCard - (FOCUS_ZONE_WIDTH / 2);
                    const decay = Math.max(0, 1 - (distBeyondFocusZone / falloffDistance));
                    opacity = MIN_OPACITY_FAR + (MIN_OPACITY_EDGE - MIN_OPACITY_FAR) * decay;
                    brightness = MIN_BRIGHTNESS_FAR + (MIN_BRIGHTNESS_EDGE - MIN_BRIGHTNESS_FAR) * decay;
                }
                
                let translateX = 0;
                let rotateY = 0;

                if (centralCardIndex !== -1) {
                    const offsetFromCentral = index - centralCardIndex; 

                    rotateY = offsetFromCentral * Y_ROTATE_PER_CARD * (1 - (focusFactor * Y_ROTATE_FOCUS_DAMPING));

                    if (offsetFromCentral !== 0) {
                        // Cards são empurrados para os lados baseados no offset.
                        // Este efeito é atenuado se o card atual (index) estiver ele mesmo em foco.
                        translateX = offsetFromCentral * X_TRANSLATE_BASE_FACTOR * (1 - focusFactor * 0.6);
                    } else {
                        translateX = 0; // Card central não tem translateX relativo ao pivô.
                    }
                }
                
                card.style.transform = `translateX(${translateX.toFixed(1)}px) rotateY(${rotateY.toFixed(1)}deg) translateZ(${translateZ.toFixed(0)}px) scale(${scale.toFixed(2)})`;
                card.style.opacity = opacity.toFixed(2);
                card.style.filter = `brightness(${brightness.toFixed(2)})`;
                card.style.zIndex = Math.floor(translateZ + 200); 
                card.style.boxShadow = boxShadow;

                card.classList.remove('focused-card', 'adjacent-style', 'secondary-neighbor-style');
            });
        }

        async function openDetails(id) {
            try {
                const fd = new FormData();
                fd.append('token', apiToken);
                fd.append('course_id', id);
                const res = await fetch(coursesUrl, { method: 'POST', body: fd });
                const d = await res.json();
                if (d.COURSES && d.COURSES[0]) showModal(d.COURSES[0]);
            } catch {
                console.error('Erro ao carregar detalhes');
            }
        }

        function showModal(course) {
            const md = document.getElementById('modal');
            const div = document.getElementById('courseDetails');
            div.innerHTML = `
                <img src="${course.course_image || ''}">
                <h2>${course.course_title}</h2>
                <p>${course.course_description || ''}</p>
                <p><strong>Professor:</strong> ${course.course_teacher?.teacher_name || ''}</p>
                <p><strong>Preço:</strong> R$${course.course_price?.toFixed(2) || '--'}</p>`;
            md.classList.remove('hidden');
        }

        document.getElementById('modalClose').addEventListener('click', () => {
            document.getElementById('modal').classList.add('hidden');
        });

        document.getElementById('myCoursesBtn').addEventListener('click', () => {
            window.location.href = 'https://sobralfreenat.github.io/chat_rosio_livia_geriah/';
        });

        const MAX_SELECTION = 4;
        let selection = [];
        let current = null;
        
        function promptCurate(course) {
            current = course;
            const curationMessageEl = document.getElementById('curationMessage');
            const curationRemainingEl = document.getElementById('curationRemaining');
            const accessNowBtn = document.getElementById('accessNowBtn');
            const curateYesBtn = document.getElementById('curateYes');
            const curateNoBtn = document.getElementById('curateNo');

            if (embeddedMode) {
                if (curationMessageEl) curationMessageEl.textContent = `Acessar conteúdo "${current.course_title}"?`;
                if (curationRemainingEl) curationRemainingEl.style.display = 'none';
                if (accessNowBtn) accessNowBtn.style.display = 'inline-block';
                if (curateYesBtn) curateYesBtn.style.display = 'none';
                if (curateNoBtn) curateNoBtn.style.display = 'none';
            } else {
                if (curationMessageEl) curationMessageEl.textContent = `Adicionar "${course.course_title}" à sua curadoria?`;
                if (curationRemainingEl) {
                    curationRemainingEl.style.display = 'block';
                    curationRemainingEl.textContent = `Você pode selecionar ${MAX_SELECTION - selection.length} recurso${selection.length !== MAX_SELECTION-1?'s':''}`;
                }
                if (accessNowBtn) accessNowBtn.style.display = 'none';
                if (curateYesBtn) curateYesBtn.style.display = 'inline-block';
                if (curateNoBtn) curateNoBtn.style.display = 'inline-block';
            }
            
            document.getElementById('curationConfirm').style.display = 'block';
            document.getElementById('curationReview').style.display = 'none';
            document.getElementById('curationModal').classList.remove('hidden');
        }

        document.getElementById('curateYes').onclick = () => {
            if (selection.length < MAX_SELECTION && !selection.find(c => c.course_id === current.course_id)) {
                selection.push(current);
            }
            // Se não estiver em modo embedded, vai para a revisão.
            // Se estiver em modo embedded, este botão não deveria ser clicável ou visível.
            if (!embeddedMode) {
                showReview();
            } else {
                // Em modo embedded, o fluxo de curadoria é diferente, "Sim" não se aplica diretamente aqui.
                // O acesso é feito pelo botão "Acessar Agora".
                 document.getElementById('curationModal').classList.add('hidden');
            }
        };

        // O botão "Não" (ignorar) em modo não-embedded simplesmente fecha o modal ou vai para revisão sem adicionar.
        // Em modo embedded, este botão também não é primário. Se visível, poderia apenas fechar o modal.
        document.getElementById('curateNo').onclick = () => {
            if (!embeddedMode) {
                showReview(); // No modo normal, "Não" ainda pode levar à revisão (para desmarcar outros)
            } else {
                 // Em modo embedded, "Não" pode simplesmente fechar o modal se "Acessar Agora" não for clicado.
                document.getElementById('curationModal').classList.add('hidden');
            }
        };


        function showReview() {
            // Esta função é principalmente para o modo não-embedded (curadoria completa)
            if (embeddedMode) {
                // Não deve chegar aqui no fluxo de "Acessar Agora"
                document.getElementById('curationModal').classList.add('hidden');
                return;
            }
            document.getElementById('curationConfirm').style.display = 'none';
            document.getElementById('curationReview').style.display = 'block';
            const ul = document.getElementById('curationList'); ul.innerHTML = '';
            selection.forEach((c,i) => {
                const li = document.createElement('li');
                li.innerHTML = `<label><input type='checkbox' data-idx='${i}' checked> ${c.course_title}</label>`;
                ul.appendChild(li);
            });
        }

        // Atualiza seleção a partir das checkboxes da revisão
        function applyReview() {
            const newSel = [];
            document.querySelectorAll('#curationList input[type=checkbox]').forEach(cb => {
                if (cb.checked) newSel.push(selection[parseInt(cb.dataset.idx)]);
            });
            selection = newSel;
        }
        // Atualiza contagem no passo de confirmação
        function updateRemainingConfirm() {
            document.getElementById('curationRemaining').textContent =
                `Você pode selecionar ${MAX_SELECTION - selection.length} recurso${selection.length !== MAX_SELECTION - 1 ? 's' : ''}`;
        }
        document.getElementById('curateBack').onclick = () => {
            applyReview();
            updateRemainingConfirm();
            document.getElementById('curationReview').style.display = 'none';
            document.getElementById('curationConfirm').style.display = 'block';
        };
        document.getElementById('curateContinue').onclick = () => {
            applyReview();
            document.getElementById('curationModal').classList.add('hidden');
        };
        document.getElementById('curateFinish').onclick = () => {
            applyReview(); // Garante que a seleção da lista de checkboxes seja aplicada
            const finalList = selection;

            if (embeddedMode && parentOrigin) {
                // Em modo embedded, envia a lista de cursos para a página pai
                // A página pai será responsável por coletar nome/email se necessário
                window.parent.postMessage({ action: 'finalizarTrilha', trilhaData: finalList }, parentOrigin);
                document.getElementById('curationModal').classList.add('hidden');
                // Limpa a seleção para a próxima vez que o modal for aberto.
                selection = []; 
                updateRemainingConfirm();
            } else {
                // Comportamento original: prompt para nome/email e download JSON
                const name = prompt('Digite seu nome:');
                const email = prompt('Digite seu email:');
                if (!name || !email) {
                    alert('Nome e email são obrigatórios.');
                    return;
                }
                const payload = { name, email, courses: finalList };
                const dataStr = JSON.stringify(payload, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const fileName = `trilha_${name.replace(/\\s+/g,'_')}_${email.replace(/[@\\.]/g,'_')}.json`;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                document.getElementById('curationModal').classList.add('hidden');
                // Limpa a seleção
                selection = []; 
                updateRemainingConfirm();
            }
        };

        // RENOMEADA e AJUSTADA: Agora recebe uma ÚNICA categoria P.A.I. e renderiza seus itens.
        function displayPaiCategoryItems(paiCategory, parentCategoryName = "Participe") {
            const container = document.getElementById('coursesContainer');
            container.innerHTML = ''; // Limpa conteúdo anterior

            const paiSectionTitle = document.createElement('h2');
            paiSectionTitle.className = 'category-title-header';
            paiSectionTitle.textContent = `${parentCategoryName} - ${paiCategory.name}`; // AJUSTADO: Usa o parâmetro da categoria pai
            container.appendChild(paiSectionTitle);

            if ((!paiCategory.items || paiCategory.items.length === 0)) {
                const noItemsMessage = document.createElement('p');
                if (paiCategory.statusMessage) {
                    noItemsMessage.textContent = paiCategory.statusMessage;
                } else {
                    noItemsMessage.textContent = `Nenhum recurso encontrado na categoria ${parentCategoryName}: ${paiCategory.name}.`; // AJUSTADO: Usa o parâmetro da categoria pai
                }
                noItemsMessage.style.color = '#ccc';
                noItemsMessage.style.marginTop = '20px';
                container.appendChild(noItemsMessage);
                return;
            }

            const carouselTrack = document.createElement('div');
            carouselTrack.className = 'carousel-track';

            paiCategory.items.forEach(paiItem => {
                const card = document.createElement('div');
                card.className = 'course-card';

                card.addEventListener('click', () => {
                    openPaiItemInModal(paiItem);
                });

                card.innerHTML = `
                    <img src="${paiItem.image || 'https://via.placeholder.com/308x196.png?text=Recurso'}" alt="${paiItem.name}" style="width:100%; height:196px; object-fit:cover; border-bottom: 1px solid rgba(80, 48, 96, 0.9);">
                    <div class="info" style="padding:15px;">
                        <h3 style="margin:0 0 10px; font-size:1.05em; color:#fff; height: 56px; overflow: hidden;">${paiItem.name}</h3>
                        <p style="font-size:0.85em; color:#ccc; margin:0; line-height: 1.3; height: 70px; overflow: hidden;">Acesse Aqui</p>
                    </div>
                `;
                carouselTrack.appendChild(card);

                // Adicionar console.log para depuração do ícone
                const imgElement = card.querySelector('img');
                if (imgElement) {
                    console.log(`Ícone para ${paiItem.name}: ${imgElement.src}`);
                }
            });
            container.appendChild(carouselTrack);

            const debouncedUpdateFocus = debounce(() => updateCarouselFocus(carouselTrack), 50);
            let scrollEndTimer = null;
            carouselTrack.addEventListener('scroll', () => {
                debouncedUpdateFocus();
                clearTimeout(scrollEndTimer);
                scrollEndTimer = setTimeout(() => {
                    snapToNearestCard(carouselTrack);
                }, 150);
            });

            setTimeout(() => {
                updateCarouselFocus(carouselTrack);
            }, 0);
        }

        function openPaiItemInModal(paiItem) {
            // Detecta URLs da Play Store e mostra modal especial
            if (paiItem.url.includes('play.google.com/store/apps')) {
                showAppModal(paiItem);
                return;
            }
            
            const modal = document.getElementById('paiModal');
            const titleElement = document.getElementById('paiModalTitle');
            const iframeElement = document.getElementById('paiModalIframe');

            if (!modal || !titleElement || !iframeElement) {
                console.error('Elementos do modal P.A.I. não encontrados.');
                return;
            }

            titleElement.textContent = paiItem.name;
            iframeElement.src = paiItem.url;
            modal.classList.remove('hidden');
        }

        function showAppModal(appItem) {
            const modal = document.getElementById('appModal');
            const titleElement = document.getElementById('appModalTitle');
            const openButton = document.getElementById('openAppButton');

            if (!modal || !titleElement || !openButton) {
                console.error('Elementos do modal de app não encontrados.');
                return;
            }

            titleElement.textContent = appItem.name;
            
            // Remove listeners anteriores e adiciona novo
            const newButton = openButton.cloneNode(true);
            openButton.parentNode.replaceChild(newButton, openButton);
            
            newButton.addEventListener('click', () => {
                window.open(appItem.url, '_blank');
                modal.classList.add('hidden');
            });

            modal.classList.remove('hidden');
        }

        function renderSuporteIaSubcategoriesSidebar() {
            const ul = document.getElementById('suporteIaItemsList');
            ul.innerHTML = ''; 

            if (!suporteIaCategoriesData || suporteIaCategoriesData.length === 0) {
                ul.innerHTML = '<li>Nenhuma subcategoria de Suporte IA configurada.</li>';
                return;
            }

            suporteIaCategoriesData.forEach(subCategory => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                btn.textContent = subCategory.name;

                btn.addEventListener('click', () => {
                    ul.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    displayPaiCategoryItems(subCategory, "Suporte-IA"); // Passa o nome da categoria pai
                    closeSidebar(); // Fechar sidebar após selecionar subcategoria de Suporte IA
                });
                li.appendChild(btn);
                ul.appendChild(li);
            });
        }

        // Função para fechar a sidebar em mobile (definida globalmente)
        function closeSidebar() {
            if (window.innerWidth <= 768) { // Apenas em telas móveis
                document.body.classList.remove('sidebar-open');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const aside = document.querySelector('aside'); // Definir aside aqui para escopo
            const menuToggle = document.getElementById('menuToggle');
            const body = document.body;

            // Inicializa o menu mobile
            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    body.classList.toggle('sidebar-open');
                });
            }

            // Event listeners para modo de edição
            const editModeToggle = document.getElementById('editModeToggle');
            const confirmEditMode = document.getElementById('confirmEditMode');
            const cancelEditMode = document.getElementById('cancelEditMode');
            const editModeConfirmClose = document.getElementById('editModeConfirmClose');
            const supportLogo = document.getElementById('supportLogo');

            // LIMPEZA COMPLETA E FORÇADA - ESTADO SEMPRE LIMPO
            // Remove TODOS os estados salvos relacionados ao modo de edição
            localStorage.removeItem('editMode');
            localStorage.removeItem('toggleVisible');
            
            // Força estado inicial completamente limpo
            isEditMode = false;
            isToggleVisible = false;
            
            // Remove todas as classes e estados visuais
            body.classList.remove('edit-mode');
            document.getElementById('headerTitle').textContent = 'Acessos';
            document.getElementById('editModeToggleContainer').style.setProperty('display', 'none', 'important');
            
            // Limpa o toggle e logo
            if (editModeToggle) editModeToggle.checked = false;
            if (supportLogo) {
                supportLogo.classList.remove('toggle-visible');
                supportLogo.style.opacity = '0.4'; // Força opacidade inicial
            }
            
            // Remove classes editáveis
            removeEditableClasses();
            
            // Debug para verificar estado inicial
            console.log('Estado inicial:', {
                isEditMode: isEditMode,
                isToggleVisible: isToggleVisible,
                toggleDisplay: document.getElementById('editModeToggleContainer').style.display,
                bodyClasses: body.className
            });

            // Não restaurar NADA do localStorage - sempre começar do zero
            // Comentado para forçar estado limpo:
            // const savedToggleVisible = localStorage.getItem('toggleVisible') === 'true';
            // if (savedToggleVisible) { ... }

            // Preparando para futuras implementações de controle de acesso/pagamento

            // Clique no logo de suporte para mostrar/esconder toggle
            if (supportLogo) {
                supportLogo.addEventListener('click', () => {
                    toggleEditModeVisibility();
                });
            }

            // Toggle do modo de edição
            if (editModeToggle) {
                editModeToggle.addEventListener('change', (e) => {
                    if (e.target.checked && !isEditMode) {
                        // Tentar ativar - mostrar confirmação
                        showEditModeConfirmation();
                        // Reverter o toggle até a confirmação
                        e.target.checked = false;
                    } else if (!e.target.checked && isEditMode) {
                        // Desativar diretamente
                        toggleEditMode(false);
                    }
                });
            }

            // Confirmar ativação do modo de edição
            if (confirmEditMode) {
                confirmEditMode.addEventListener('click', () => {
                    toggleEditMode(true);
                    hideEditModeConfirmation();
                });
            }

            // Cancelar ativação do modo de edição
            if (cancelEditMode) {
                cancelEditMode.addEventListener('click', () => {
                    hideEditModeConfirmation();
                });
            }

            // Fechar modal de confirmação
            if (editModeConfirmClose) {
                editModeConfirmClose.addEventListener('click', () => {
                    hideEditModeConfirmation();
                });
            }

            // Adiciona um listener para cliques fora da sidebar quando ela está aberta
            document.addEventListener('click', (event) => {
                if (body.classList.contains('sidebar-open') &&
                    !aside.contains(event.target) &&
                    !menuToggle.contains(event.target)) {
                    closeSidebar();
                }
            });

            adjustForEmbeddedMode(); 
            fetchCategories();
            renderMeusAppsCategoriesSidebar(); // Adicionando chamada para renderizar a nova categoria 'MeusApps'
            renderPaiCategoriesSidebar(); 
            renderSuporteIaSubcategoriesSidebar(); // Re-adicionando esta chamada
            renderParticipeCategoriesSidebar(); // Adicionando chamada para renderizar a nova categoria 'Participe'
            renderVideosCategoriesSidebar(); // Adicionando chamada para renderizar a nova categoria 'Videos'
            
            // Inicializar favoritos do usuário
            loadUserFavorites();

            const paiModal = document.getElementById('paiModal');
            const paiModalClose = document.getElementById('paiModalClose');
            const paiModalIframe = document.getElementById('paiModalIframe');

            if (paiModal && paiModalClose && paiModalIframe) {
                paiModalClose.addEventListener('click', () => {
                    paiModal.classList.add('hidden');
                    paiModalIframe.src = 'about:blank'; // Limpa o iframe para parar carregamento
                });
            }

            // Event listeners para o modal de app
            const appModal = document.getElementById('appModal');
            const appModalClose = document.getElementById('appModalClose');

            if (appModal && appModalClose) {
                appModalClose.addEventListener('click', () => {
                    appModal.classList.add('hidden');
                });
            }

            // Accordion functionality for sidebar
            document.querySelectorAll('aside .accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('.accordion-icon');
                    const isMeusAppsHeader = header.textContent.trim().startsWith('Meus Apps');
                    const isPaiHeader = header.textContent.trim().startsWith('EXCLUSIVO');
                    const isParticipeHeader = header.textContent.trim().startsWith('Participe');
                    
                    if (!content) return;

                    const isVisible = content.style.display === 'block';
                    
                    // Remove active de todos os cabeçalhos principais
                    document.querySelectorAll('aside .accordion-header').forEach(h => {
                        if (h !== header) {
                            h.classList.remove('active');
                        }
                    });
                    
                    document.querySelectorAll('aside .accordion-content').forEach(c => {
                        if (c !== content) {
                            c.style.display = 'none';
                            const otherIcon = c.previousElementSibling.querySelector('.accordion-icon');
                            if (otherIcon) otherIcon.textContent = '►';
                        }
                    });

                    content.style.display = isVisible ? 'none' : 'block';
                    if (icon) {
                        icon.textContent = isVisible ? '►' : '▼';
                    }
                    
                    // Adiciona ou remove active do cabeçalho clicado
                    if (isVisible) {
                        header.classList.remove('active');
                    } else {
                        header.classList.add('active');
                    }

                    // Mensagens específicas para cada categoria principal
                    if (isMeusAppsHeader && !isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma subcategoria de Meus Apps na lista.</p>';
                    } else if (isMeusAppsHeader && isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione um conteúdo ou ferramenta ao lado.</p>';
                    } else if (isPaiHeader && !isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma categoria dentro de EXCLUSIVO na lista.</p>';
                    } else if (isPaiHeader && isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione um conteúdo ou ferramenta ao lado.</p>';
                    } else if (isParticipeHeader && !isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma opção da categoria Participe na lista.</p>';
                    } else if (isParticipeHeader && isVisible) {
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma opção da categoria Participe na lista.</p>';
                    }
                });
            });

            // Sub-accordion functionality for PAI category
            document.querySelectorAll('.sub-accordion-header').forEach(subHeader => {
                subHeader.addEventListener('click', () => {
                    const subContent = subHeader.nextElementSibling;
                    const subIcon = subHeader.querySelector('.sub-accordion-icon');
                    const subHeaderText = subHeader.textContent.trim();
                    
                    if (!subContent) return;

                    const isSubVisible = subContent.style.display === 'block';
                    
                    // Fecha todos os outros sub-acordeões
                    document.querySelectorAll('.sub-accordion-content').forEach(c => {
                        if (c !== subContent) {
                            c.style.display = 'none';
                            const otherSubIcon = c.previousElementSibling.querySelector('.sub-accordion-icon');
                            if (otherSubIcon) otherSubIcon.textContent = '►';
                            c.previousElementSibling.classList.remove('active');
                        }
                    });

                    subContent.style.display = isSubVisible ? 'none' : 'block';
                    if (subIcon) {
                        subIcon.textContent = isSubVisible ? '►' : '▼';
                    }
                    
                    if (isSubVisible) {
                        subHeader.classList.remove('active');
                        document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma categoria dentro de EXCLUSIVO na lista.</p>';
                    } else {
                        subHeader.classList.add('active');
                        
                        // Mensagens específicas para cada sub-categoria
                        if (subHeaderText.startsWith('Videos Disponíveis')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma opção da categoria Videos Disponíveis na lista.</p>';
                        } else if (subHeaderText.startsWith('Conteúdo de Apoio')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma categoria ao lado para ver os recursos.</p>';
                        } else if (subHeaderText.startsWith('Ferramentas')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma subcategoria de Ferramentas & Negócios na lista.</p>';
                        } else if (subHeaderText.startsWith('Suporte - IA')) {
                            document.getElementById('coursesContainer').innerHTML = '<p class="instruction-message">Selecione uma subcategoria de Suporte - IA na lista.</p>';
                        }
                    }
                });
            });

            // Event listeners para o Modal de Edição Individual
            const itemEditClose = document.getElementById('itemEditClose');
            const cancelItemEdit = document.getElementById('cancelItemEdit');
            const saveItemEdit = document.getElementById('saveItemEdit');

            if (itemEditClose) {
                itemEditClose.addEventListener('click', closeItemEditModal);
            }

            if (cancelItemEdit) {
                cancelItemEdit.addEventListener('click', closeItemEditModal);
            }

            if (saveItemEdit) {
                saveItemEdit.addEventListener('click', () => {
                    saveItemEditData();
                });
            }

            // Carrega dados personalizados salvos
            loadCustomItemData();

            // Event listeners para modal de edição de cards
            document.getElementById('cardEditModalClose').addEventListener('click', closeCardEditModal);
            document.getElementById('cancelCardEdit').addEventListener('click', closeCardEditModal);
            document.getElementById('saveCardEdit').addEventListener('click', saveCardEdit);

            // Fecha modal de edição de cards ao clicar fora
            document.getElementById('cardEditModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCardEditModal();
                }
            });

            // Carrega dados personalizados
            loadCustomItemData();

            // Event listeners para modal de edição de itens simples
            document.getElementById('simpleItemEditModalClose').addEventListener('click', closeSimpleItemEditModal);
            document.getElementById('cancelSimpleItemEdit').addEventListener('click', closeSimpleItemEditModal);
            document.getElementById('saveSimpleItemEdit').addEventListener('click', saveSimpleItemEdit);

            // Fecha modal de edição de itens simples ao clicar fora
            document.getElementById('simpleItemEditModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSimpleItemEditModal();
                }
            });

            // Carrega dados personalizados
            loadCustomItemData();
            
            // Event listeners para modal de adicionar favorito
            document.getElementById('addFavoriteModalClose').addEventListener('click', closeAddFavoriteModal);
            document.getElementById('cancelAddFavorite').addEventListener('click', closeAddFavoriteModal);
            document.getElementById('saveAddFavorite').addEventListener('click', saveNewFavorite);

            // Fecha modal de adicionar favorito ao clicar fora
            document.getElementById('addFavoriteModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddFavoriteModal();
                }
            });
        });

        function renderPaiCategoriesSidebar() {
            const paiListUl = document.getElementById('paiItemsList');
            paiListUl.innerHTML = ''; // Limpa itens anteriores, como "Nenhum item P.A.I configurado."

            if (!paiCategoriesData || paiCategoriesData.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Nenhuma categoria P.A.I. configurada.';
                paiListUl.appendChild(li);
                return;
            }

            paiCategoriesData.forEach(paiCategory => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                btn.textContent = paiCategory.name;
                // Adiciona a classe 'active' ao primeiro botão por padrão ou com base em estado salvo
                // if (index === 0) btn.classList.add('active'); 

                btn.addEventListener('click', () => {
                    // Remove 'active' de todos os botões P.A.I.
                    paiListUl.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                    // Adiciona 'active' ao botão clicado
                    btn.classList.add('active');
                    // Exibe os itens da categoria P.A.I. selecionada
                    displayPaiCategoryItems(paiCategory, "EXCLUSIVO"); // Passa o nome da categoria pai
                    closeSidebar(); // Fechar sidebar após selecionar categoria P.A.I.
                });

                li.appendChild(btn);
                paiListUl.appendChild(li);
            });
        }

        function renderParticipeCategoriesSidebar() {
            const participeListUl = document.getElementById('participeItemsList');
            participeListUl.innerHTML = '';

            if (!participeCategoriesData || participeCategoriesData.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Nenhuma categoria de Participação configurada.';
                participeListUl.appendChild(li);
                return;
            }

            participeCategoriesData.forEach(participeCategory => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                btn.textContent = participeCategory.name;

                btn.addEventListener('click', () => {
                    participeListUl.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    displayPaiCategoryItems(participeCategory, "Participe"); // Passa o nome da categoria pai
                    closeSidebar();
                });

                li.appendChild(btn);
                participeListUl.appendChild(li);
            });
        }

        function renderMeusAppsCategoriesSidebar() {
            console.log('renderMeusAppsCategoriesSidebar chamada, isEditMode:', isEditMode); // Debug
            // Agora os sub-acordeões são renderizados diretamente no HTML
            // Esta função renderiza os conteúdos de cada sub-acordeão

            // Renderizar Saúde
            const saudeUl = document.getElementById('saudeItemsList');
            const saudeData = meusAppsCategoriesData.find(cat => cat.name === "Saúde");
            renderSubCategoryItems(saudeUl, saudeData);

            // Renderizar Comunicar
            const comunicacaoUl = document.getElementById('comunicacaoItemsList');
            const comunicacaoData = meusAppsCategoriesData.find(cat => cat.name === "Comunicar");
            renderSubCategoryItems(comunicacaoUl, comunicacaoData);

            // Renderizar Banco
            const bancoUl = document.getElementById('bancoItemsList');
            const bancoData = meusAppsCategoriesData.find(cat => cat.name === "Banco");
            renderSubCategoryItems(bancoUl, bancoData);

            // Renderizar Alimentação
            const alimentacaoUl = document.getElementById('alimentacaoItemsList');
            const alimentacaoData = meusAppsCategoriesData.find(cat => cat.name === "Alimentação");
            renderSubCategoryItems(alimentacaoUl, alimentacaoData);

            // Renderizar Transporte
            const transporteUl = document.getElementById('transporteItemsList');
            const transporteData = meusAppsCategoriesData.find(cat => cat.name === "Transporte");
            renderSubCategoryItems(transporteUl, transporteData);

            // Renderizar Utilidades
            const utilidadesUl = document.getElementById('utilidadesItemsList');
            const utilidadesData = meusAppsCategoriesData.find(cat => cat.name === "Utilidades");
            renderSubCategoryItems(utilidadesUl, utilidadesData);

            // Renderizar Lazer
            const lazerUl = document.getElementById('lazerItemsList');
            const lazerData = meusAppsCategoriesData.find(cat => cat.name === "Lazer");
            renderSubCategoryItems(lazerUl, lazerData);
        }

        function renderSubCategoryItems(ul, categoryData) {
            if (!categoryData || !categoryData.items || categoryData.items.length === 0) {
                ul.innerHTML = '<li>Nenhum item disponível.</li>';
                return;
            }

            ul.innerHTML = '';
            
            // Lista dos apps testados e funcionando
            const testedApps = ['Bradesco', 'Banco do Brasil', 'Caixa', 'Nubank', 'Santander', 'WhatsApp', 'Telegram', 'PlutoTV', 'YouTube', 'Google Meet', 'WhatsApp Business', 'iFood', 'Pão de Açúcar', 'Uber', '99'];
            
            // Lista dos apps implementados (mas podem não estar testados)
            const implementedApps = ['Bradesco', 'Banco do Brasil', 'Caixa', 'Nubank', 'Santander', 'Itaú', 'WhatsApp', 'Telegram', 'PlutoTV', 'YouTube', 'Google Meet', 'WhatsApp Business', 'iFood', 'Pão de Açúcar', 'Uber', '99'];
            
            categoryData.items.forEach(item => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                
                // Verifica se há dados personalizados para este item
                const itemKey = generateItemKey(item);
                const customData = customItemData[itemKey];
                let displayName = customData ? customData.name : item.name;
                const targetUrl = customData ? customData.url : item.url;
                
                // Adiciona ícone baseado no status real
                const isReserved = item.disabled || item.name === "Reservado";
                const isTested = testedApps.includes(item.name);
                const isImplemented = implementedApps.includes(item.name);
                let statusIcon = '';
                
                if (!isReserved && isTested) {
                    statusIcon = '<span class="app-check">✓</span> ';
                } else if (!isReserved && isImplemented && !isTested) {
                    statusIcon = '<span class="app-pending">●</span> ';
                }
                // Apps não implementados ficam sem ícone
                
                // Se o item tem subitens, adiciona um indicador visual
                if (item.hasSubItems) {
                    // Conta quantos subitens não são "Reservado" ou disabled
                    const activeSubItems = item.subItems ? item.subItems.filter(subItem => 
                        !subItem.disabled && subItem.name !== "Reservado"
                    ).length : 0;
                    
                    statusIcon += `<span style="color: #4CAF50; margin-right: 4px;">📋</span> `;
                    // O contador será adicionado depois do nome APENAS no modo edição
                    console.log(`Verificando contador para ${item.name}:`, { 
                        isEditMode: isEditMode, 
                        activeSubItems: activeSubItems,
                        shouldShowCounter: isEditMode 
                    }); // Debug detalhado
                    
                    if (isEditMode) {
                        console.log(`✅ Adicionando contador ${activeSubItems} para ${item.name} (modo edição ativo)`); // Debug
                        displayName += ` <span style="color: #4CAF50; font-size: 0.8em; font-weight: bold;">${activeSubItems}</span>`;
                    } else {
                        console.log(`❌ NÃO adicionando contador para ${item.name} (modo edição inativo)`); // Debug
                    }
                }
                
                btn.innerHTML = statusIcon + displayName;

                // Tratamento especial para itens reservados
                if (isReserved) {
                    if (isEditMode) {
                        // No modo de edição, itens reservados ficam editáveis
                        btn.style.opacity = '0.7';
                        btn.style.cursor = 'pointer';
                        btn.style.color = '#cccccc';
                        btn.disabled = false;
                        btn.title = 'Clique para personalizar este espaço reservado';
                        
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Editando item reservado:', item.name);
                            openSimpleItemEditModal(categoryData.name, item.name);
                        });
                        
                        // Adiciona botão de edição para itens reservados
                        li.style.position = 'relative';
                        
                        const editBtn = document.createElement('button');
                        editBtn.className = 'edit-simple-item-btn';
                        editBtn.innerHTML = '✏️';
                        editBtn.style.cssText = `
                            position: absolute;
                            right: 8px;
                            top: 50%;
                            transform: translateY(-50%);
                            background: rgba(101, 31, 57, 0.9);
                            border: none;
                            border-radius: 50%;
                            width: 22px;
                            height: 22px;
                            cursor: pointer;
                            font-size: 11px;
                            z-index: 10;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        `;
                        
                        editBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Editando item reservado via botão:', item.name);
                            openSimpleItemEditModal(categoryData.name, item.name);
                        });
                        
                        li.appendChild(editBtn);
                    } else {
                        // No modo normal, itens reservados ficam desabilitados
                        btn.style.opacity = '0.4';
                        btn.style.cursor = 'not-allowed';
                        btn.style.color = '#666666';
                        btn.disabled = true;
                        btn.title = 'Espaço reservado para futuras funcionalidades';
                    }
                } else if (!isImplemented && !item.hasSubItems) {
                    // Apps não implementados ainda (mas permite subitens mesmo sem implementação)
                    btn.style.opacity = '0.5';
                    btn.style.color = '#999999';
                    btn.style.cursor = 'not-allowed';
                    btn.disabled = true;
                    btn.title = 'App ainda não implementado';
                } else if (isImplemented && !isTested && !item.hasSubItems) {
                    // Apps implementados mas não testados ainda (apenas Itaú)
                    btn.style.opacity = '0.7';
                    btn.style.color = '#cccccc';
                    btn.title = 'App implementado mas ainda não testado';
                } else {
                    // Apps testados e funcionais OU itens com subitens
                    // Adiciona classe se foi personalizado
                    if (customData) {
                        btn.classList.add('customized-item');
                    }
                    
                    btn.addEventListener('click', (e) => {
                        console.log('Botão clicado:', { 
                            itemName: item.name, 
                            isEditMode: isEditMode,
                            hasSubItems: item.hasSubItems,
                            hasEditableClass: btn.classList.contains('editable-item')
                        }); // Debug
                        
                        // Se estiver no modo de edição, abre o modal de edição
                        if (isEditMode) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Abrindo modal de edição para:', item.name); // Debug
                            openItemEditModal(item, btn);
                            return;
                        }
                        
                        console.log('Abrindo item normalmente:', item.name); // Debug
                        
                        
                        // Comportamento normal - abre o item
                        ul.querySelectorAll('button:not([disabled])').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        // Se o item tem subitens, exibe os cards
                        if (item.hasSubItems && item.subItems) {
                            displaySubItemsAsCards(item, categoryData.name);
                        } else {
                            // Usa a URL personalizada se existir
                            const itemToOpen = {
                                ...item,
                                name: displayName,
                                url: targetUrl
                            };
                            
                            openPaiItemInModal(itemToOpen);
                        }
                        closeSidebar();
                    });
                    
                    // Adiciona botão de edição para itens simples no modo de edição
                    if (isEditMode && !item.hasSubItems) {
                        li.style.position = 'relative';
                        
                        const editBtn = document.createElement('button');
                        editBtn.className = 'edit-simple-item-btn';
                        editBtn.innerHTML = '✏️';
                        editBtn.style.cssText = `
                            position: absolute;
                            right: 8px;
                            top: 50%;
                            transform: translateY(-50%);
                            background: rgba(101, 31, 57, 0.9);
                            border: none;
                            border-radius: 50%;
                            width: 22px;
                            height: 22px;
                            cursor: pointer;
                            font-size: 11px;
                            z-index: 10;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        `;
                        
                        editBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('Editando item simples:', item.name);
                            openSimpleItemEditModal(categoryData.name, item.name);
                        });
                        
                        li.appendChild(editBtn);
                    }
                }

                li.appendChild(btn);
                ul.appendChild(li);
            });
        }

        // Nova função para exibir subitens como cards no carrossel
        function displaySubItemsAsCards(parentItem, categoryName) {
            const container = document.getElementById('coursesContainer');
            container.innerHTML = '';

            // Cria o título da subcategoria
            const categoryHeader = document.createElement('h2');
            categoryHeader.className = 'category-title-header';
            categoryHeader.textContent = `${categoryName} - ${parentItem.name}`;
            container.appendChild(categoryHeader);

            if (!parentItem.subItems || parentItem.subItems.length === 0) {
                const noItemsMessage = document.createElement('p');
                noItemsMessage.textContent = `Nenhum recurso encontrado em ${parentItem.name}.`;
                noItemsMessage.style.color = '#ccc';
                noItemsMessage.style.marginTop = '20px';
                container.appendChild(noItemsMessage);
                return;
            }

            // Cria o trilho do carrossel
            const carouselTrack = document.createElement('div');
            carouselTrack.className = 'carousel-track';

            parentItem.subItems.forEach((subItem, index) => {
                const card = document.createElement('div');
                card.className = 'course-card';
                
                // Verifica se há dados personalizados para este card
                const cardKey = generateCardKey(categoryName, parentItem.name, index);
                const customData = customCardData[cardKey];
                
                // Usa dados personalizados se disponíveis, senão usa os originais
                const displayName = customData ? customData.name : subItem.name;
                const displayDescription = customData ? customData.description : (subItem.description || 'Clique para acessar');
                const displayUrl = customData ? customData.url : subItem.url;
                
                // Verifica se é um card editável
                if (subItem.isCard) {
                    // Card editável com imagem personalizada
                    const cardImage = customData ? customData.cardImage : (subItem.cardImage || subItem.image || 'https://via.placeholder.com/308x196.png?text=AudioLivro');
                    
                    console.log(`Renderizando card editável: ${displayName}`, {
                        isEditMode: isEditMode,
                        shouldShowButton: isEditMode,
                        parentItemName: parentItem.name,
                        cardIndex: index
                    });
                    
                    card.innerHTML = `
                        <div class="card-image-container" style="position: relative;">
                            <img src="${cardImage}" alt="${displayName}" style="width:100%; height:196px; object-fit:cover; border-bottom: 1px solid rgba(80, 48, 96, 0.9);">
                            ${isEditMode ? `<button class="edit-card-btn" onclick="openCardEditModal('${parentItem.name}', ${index})" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 14px;">✏️</button>` : ''}
                        </div>
                        <div class="info" style="padding:15px;">
                            <h3 style="margin:0 0 10px; font-size:1.05em; color:#fff; height: 56px; overflow: hidden;">${displayName}</h3>
                            <p style="font-size:0.85em; color:#ccc; margin:0; line-height: 1.3; height: 70px; overflow: hidden;">${displayDescription}</p>
                        </div>
                    `;
                } else {
                    // Card padrão
                    card.innerHTML = `
                        <img src="${subItem.image || 'https://via.placeholder.com/308x196.png?text=Recurso'}" alt="${subItem.name}" style="width:100%; height:196px; object-fit:cover; border-bottom: 1px solid rgba(80, 48, 96, 0.9);">
                        <div class="info" style="padding:15px;">
                            <h3 style="margin:0 0 10px; font-size:1.05em; color:#fff; height: 56px; overflow: hidden;">${subItem.name}</h3>
                            <p style="font-size:0.85em; color:#ccc; margin:0; line-height: 1.3; height: 70px; overflow: hidden;">${subItem.description || 'Clique para acessar'}</p>
                        </div>
                    `;
                }

                card.addEventListener('click', (e) => {
                    // Não abrir se clicou no botão de editar
                    if (e.target.classList.contains('edit-card-btn')) {
                        return;
                    }
                    
                    // Cria objeto com dados personalizados se disponíveis
                    const itemToOpen = {
                        name: displayName,
                        url: displayUrl,
                        description: displayDescription
                    };
                    
                    // Detecta se é URL da Play Store para mostrar modal específico
                    if (displayUrl.includes('play.google.com/store/apps')) {
                        showAppModal(itemToOpen);
                    } else {
                        // Para URLs web, abre em modal iframe
                        openPaiItemInModal(itemToOpen);
                    }
                });

                carouselTrack.appendChild(card);
            });

            container.appendChild(carouselTrack);

            // Adiciona funcionalidade de carrossel
            const debouncedUpdateFocus = debounce(() => updateCarouselFocus(carouselTrack), 50);
            let scrollEndTimer = null;
            carouselTrack.addEventListener('scroll', () => {
                debouncedUpdateFocus();
                clearTimeout(scrollEndTimer);
                scrollEndTimer = setTimeout(() => {
                    snapToNearestCard(carouselTrack);
                }, 150);
            });

            setTimeout(() => {
                updateCarouselFocus(carouselTrack);
            }, 0);
        }

        function renderVideosCategoriesSidebar() {
            const videosListUl = document.getElementById('videosItemsList');
            videosListUl.innerHTML = '';

            if (!videosCategoriesData || videosCategoriesData.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Nenhuma categoria de Vídeos configurada.';
                videosListUl.appendChild(li);
                return;
            }

            videosCategoriesData.forEach(videoCategory => {
                const li = document.createElement('li');
                const btn = document.createElement('button');
                btn.textContent = videoCategory.name;

                btn.addEventListener('click', () => {
                    videosListUl.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    displayPaiCategoryItems(videoCategory, "Videos"); // Passa o nome da categoria pai
                    closeSidebar();
                });

                li.appendChild(btn);
                videosListUl.appendChild(li);
            });
        }

        // Nova estrutura para categoria "Meus Apps"
        const meusAppsCategoriesData = [
            {
                name: "Saúde",
                items: [
                    { 
                        name: "Prevenção", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Drogasil", 
                                url: "https://play.google.com/store/apps/details?id=br.com.drogasil", 
                                image: "https://api.iconify.design/tabler/pill.svg?color=%23e5e5e5", 
                                description: "Drogaria Online 24h - App oficial",
                                isCard: true,
                                cardImage: "https://logoeps.com/wp-content/uploads/2013/03/drogasil-vector-logo.png"
                            },
                            { 
                                name: "SUS Digital", 
                                url: "https://play.google.com/store/apps/details?id=br.gov.datasus.cnsdigital", 
                                image: "https://api.iconify.design/tabler/id-badge.svg?color=%23e5e5e5", 
                                description: "Cartão Nacional de Saúde Digital",
                                isCard: true,
                                cardImage: "https://www.gov.br/saude/pt-br/assuntos/saude-digital/cartao-nacional-de-saude/sus-digital.png"
                            },
                            { 
                                name: "Conecte SUS", 
                                url: "https://play.google.com/store/apps/details?id=br.gov.datasus.conectesus", 
                                image: "https://api.iconify.design/tabler/heart-handshake.svg?color=%23e5e5e5", 
                                description: "Aplicativo oficial do SUS",
                                isCard: true,
                                cardImage: "https://conectesus.saude.gov.br/static/media/logo-conecte-sus.png"
                            },
                            { 
                                name: "Naturais", 
                                url: "#", 
                                image: "https://api.iconify.design/tabler/leaf.svg?color=%23e5e5e5", 
                                description: "Produtos naturais e fitoterápicos",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { name: "Nutrição", url: "https://www.dietbox.me/", image: "https://api.iconify.design/tabler/apple.svg?color=%23e5e5e5" },
                    { name: "Atividades", url: "https://www.smartfit.com.br/", image: "https://api.iconify.design/tabler/barbell.svg?color=%23e5e5e5" },
                    { name: "Convênio", url: "https://www.unimed.coop.br/", image: "https://api.iconify.design/tabler/shield-heart.svg?color=%23e5e5e5" },
                    { name: "Médico", url: "https://www.doctoralia.com.br/", image: "https://api.iconify.design/tabler/stethoscope.svg?color=%23e5e5e5" },
                    { name: "Farmácia", url: "https://www.drogasil.com.br/", image: "https://api.iconify.design/tabler/pill.svg?color=%23e5e5e5" },
                    { name: "Hospital", url: "https://www.hospitalsiriolibanes.org.br/", image: "https://api.iconify.design/tabler/building-hospital.svg?color=%23e5e5e5" }
                ]
            },
            {
                name: "Comunicar",
                items: [
                    { name: "WhatsApp", url: "https://play.google.com/store/apps/details?id=com.whatsapp", image: "https://api.iconify.design/logos/whatsapp-icon.svg?color=%23e5e5e5" },
                    { name: "Telegram", url: "https://play.google.com/store/apps/details?id=org.telegram.messenger", image: "https://api.iconify.design/logos/telegram.svg?color=%23e5e5e5" },
                    { name: "Email Gmail", url: "https://mail.google.com/", image: "https://api.iconify.design/logos/google-gmail.svg?color=%23e5e5e5" },
                    { name: "Google Meet", url: "https://meet.google.com/", image: "https://api.iconify.design/logos/google-meet.svg?color=%23e5e5e5" },
                    { name: "Zoom", url: "https://zoom.us/", image: "https://api.iconify.design/logos/zoom-icon.svg?color=%23e5e5e5" },
                    { name: "WhatsApp Business", url: "https://play.google.com/store/apps/details?id=com.whatsapp.w4b", image: "https://api.iconify.design/logos/whatsapp-icon.svg?color=%23e5e5e5" },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
                ]
            },
            {
                name: "Banco",
                items: [
                    { name: "Banco do Brasil", url: "https://play.google.com/store/apps/details?id=br.com.bb.android", image: "https://api.iconify.design/tabler/building-bank.svg?color=%23e5e5e5" },
                    { name: "Bradesco", url: "https://play.google.com/store/apps/details?id=com.bradesco", image: "https://api.iconify.design/tabler/credit-card.svg?color=%23e5e5e5" },
                    { name: "Caixa", url: "https://play.google.com/store/apps/details?id=br.com.gabba.Caixa", image: "https://api.iconify.design/tabler/home.svg?color=%23e5e5e5" },
                    { name: "Itaú", url: "https://play.google.com/store/apps/details?id=com.itau", image: "https://api.iconify.design/tabler/building-bank.svg?color=%23e5e5e5" },
                    { name: "Nubank", url: "https://play.google.com/store/apps/details?id=com.nu.production", image: "https://api.iconify.design/tabler/credit-card.svg?color=%23e5e5e5" },
                    { name: "Santander", url: "https://play.google.com/store/apps/details?id=com.santander.app", image: "https://api.iconify.design/tabler/credit-card.svg?color=%23e5e5e5" },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
                ]
            },
            {
                name: "Utilidades",
                items: [
                    { 
                        name: "Calculadora", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Calculadora Google", 
                                url: "https://www.google.com/search?q=calculator", 
                                image: "https://api.iconify.design/tabler/calculator.svg?color=%23e5e5e5", 
                                description: "Calculadora online do Google",
                                isCard: true,
                                cardImage: "https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png"
                            },
                            { 
                                name: "Calculadora Científica", 
                                url: "https://web2.0calc.com/", 
                                image: "https://api.iconify.design/tabler/math-function.svg?color=%23e5e5e5", 
                                description: "Calculadora científica avançada",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "Conversor de Unidades", 
                                url: "https://www.convertworld.com/pt/", 
                                image: "https://api.iconify.design/tabler/arrows-exchange.svg?color=%23e5e5e5", 
                                description: "Conversor de medidas e unidades",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1611224923853-80b023f02d71?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "Calculadora Financeira", 
                                url: "https://www.calculadorafinanceira.com.br/", 
                                image: "https://api.iconify.design/tabler/coin.svg?color=%23e5e5e5", 
                                description: "Cálculos financeiros e investimentos",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1554224155-6726b3ff858f?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { 
                        name: "Clima", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Weather.com", 
                                url: "https://weather.com/pt-BR", 
                                image: "https://api.iconify.design/tabler/cloud.svg?color=%23e5e5e5", 
                                description: "Previsão do tempo detalhada",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "ClimaTempo", 
                                url: "https://www.climatempo.com.br/", 
                                image: "https://api.iconify.design/tabler/sun.svg?color=%23e5e5e5", 
                                description: "Previsão do tempo no Brasil",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "INMET", 
                                url: "https://portal.inmet.gov.br/", 
                                image: "https://api.iconify.design/tabler/cloud-rain.svg?color=%23e5e5e5", 
                                description: "Instituto Nacional de Meteorologia",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1534088568595-a066f410bcda?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "AccuWeather", 
                                url: "https://www.accuweather.com/pt/br/brazil-weather", 
                                image: "https://api.iconify.design/tabler/temperature.svg?color=%23e5e5e5", 
                                description: "Previsão meteorológica global",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1592210454359-9043f067919b?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { 
                        name: "Tradutor", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Google Tradutor", 
                                url: "https://translate.google.com/", 
                                image: "https://api.iconify.design/logos/google-translate.svg?color=%23e5e5e5", 
                                description: "Tradutor do Google",
                                isCard: true,
                                cardImage: "https://ssl.gstatic.com/translate/community/backgrounds/globe_small.png"
                            },
                            { 
                                name: "DeepL", 
                                url: "https://www.deepl.com/translator", 
                                image: "https://api.iconify.design/tabler/language.svg?color=%23e5e5e5", 
                                description: "Tradutor com IA avançada",
                                isCard: true,
                                cardImage: "https://static.deepl.com/img/logo/deepl-logo-blue.svg"
                            },
                            { 
                                name: "Reverso", 
                                url: "https://www.reverso.net/text-translation", 
                                image: "https://api.iconify.design/tabler/abc.svg?color=%23e5e5e5", 
                                description: "Tradutor com contexto e exemplos",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1455390582262-044cdead277a?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "Linguee", 
                                url: "https://www.linguee.com.br/", 
                                image: "https://api.iconify.design/tabler/book.svg?color=%23e5e5e5", 
                                description: "Dicionário e tradutor bilíngue",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { 
                        name: "Mapas", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Google Maps", 
                                url: "https://maps.google.com/", 
                                image: "https://api.iconify.design/logos/google-maps.svg?color=%23e5e5e5", 
                                description: "Mapas e navegação do Google",
                                isCard: true,
                                cardImage: "https://developers.google.com/static/maps/images/maps-icon.svg"
                            },
                            { 
                                name: "Waze", 
                                url: "https://www.waze.com/pt-BR/live-map", 
                                image: "https://api.iconify.design/tabler/route.svg?color=%23e5e5e5", 
                                description: "Navegação com trânsito em tempo real",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1569154941061-e231b4725ef1?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "OpenStreetMap", 
                                url: "https://www.openstreetmap.org/", 
                                image: "https://api.iconify.design/tabler/map-2.svg?color=%23e5e5e5", 
                                description: "Mapa colaborativo mundial",
                                isCard: true,
                                cardImage: "https://wiki.openstreetmap.org/w/images/thumb/b/b0/Openstreetmap_logo.svg/256px-Openstreetmap_logo.svg.png"
                            },
                            { 
                                name: "Here Maps", 
                                url: "https://wego.here.com/", 
                                image: "https://api.iconify.design/tabler/map-pin.svg?color=%23e5e5e5", 
                                description: "Mapas e navegação Here",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1524661135-423995f22d0b?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { 
                        name: "Calendário", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Google Calendar", 
                                url: "https://calendar.google.com/", 
                                image: "https://api.iconify.design/logos/google-calendar.svg?color=%23e5e5e5", 
                                description: "Calendário do Google",
                                isCard: true,
                                cardImage: "https://ssl.gstatic.com/calendar/images/dynamiclogo_2020q4/calendar_31_2x.png"
                            },
                            { 
                                name: "Outlook Calendar", 
                                url: "https://outlook.live.com/calendar/", 
                                image: "https://api.iconify.design/logos/microsoft-outlook.svg?color=%23e5e5e5", 
                                description: "Calendário do Outlook",
                                isCard: true,
                                cardImage: "https://res-1.cdn.office.net/files/fabric-cdn-prod_20230815.002/assets/brand-icons/product/svg/outlook_48x1.svg"
                            },
                            { 
                                name: "Calendário Online", 
                                url: "https://www.calendario.com.br/", 
                                image: "https://api.iconify.design/tabler/calendar-event.svg?color=%23e5e5e5", 
                                description: "Calendário brasileiro online",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=250&fit=crop"
                            },
                            { 
                                name: "TimeAndDate", 
                                url: "https://www.timeanddate.com/calendar/", 
                                image: "https://api.iconify.design/tabler/clock.svg?color=%23e5e5e5", 
                                description: "Calendário mundial com fusos",
                                isCard: true,
                                cardImage: "https://images.unsplash.com/photo-1495364141860-b0d03eccd065?w=400&h=250&fit=crop"
                            }
                        ]
                    },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
                ]
            },
            {
                name: "Lazer",
                items: [
                    { 
                        name: "AudioLivros", 
                        hasSubItems: true,
                        subItems: [
                            { 
                                name: "Audible", 
                                url: "https://www.audible.com.br/", 
                                image: "https://api.iconify.design/tabler/headphones.svg?color=%23e5e5e5", 
                                description: "Plataforma de audiolivros da Amazon",
                                isCard: true,
                                cardImage: "https://m.media-amazon.com/images/G/32/audible/web/logo-audible-white._CB1565125222_.png"
                            },
                            { 
                                name: "Storytel", 
                                url: "https://www.storytel.com/br/pt/", 
                                image: "https://api.iconify.design/tabler/book-2.svg?color=%23e5e5e5", 
                                description: "Streaming de audiolivros e e-books",
                                isCard: true,
                                cardImage: "https://cdn.storytel.com/web/assets/storytel-logo-white.svg"
                            }
                        ]
                    },
                    { name: "Netflix", url: "https://www.netflix.com/", image: "https://api.iconify.design/logos/netflix-icon.svg?color=%23e5e5e5" },
                    { name: "PlutoTV", url: "https://pluto.tv/br/", image: "https://api.iconify.design/tabler/device-tv.svg?color=%23e5e5e5" },
                    { name: "Prime Video", url: "https://www.primevideo.com/", image: "https://api.iconify.design/tabler/video.svg?color=%23e5e5e5" },
                    { name: "Spotify", url: "https://open.spotify.com/", image: "https://api.iconify.design/logos/spotify-icon.svg?color=%23e5e5e5" },
                    { name: "YouTube", url: "https://play.google.com/store/apps/details?id=com.google.android.youtube", image: "https://api.iconify.design/logos/youtube-icon.svg?color=%23e5e5e5" },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
                ]
            },
            {
                name: "Alimentação",
                items: [
                    { name: "iFood", url: "https://play.google.com/store/apps/details?id=br.com.brainweb.ifood", image: "https://api.iconify.design/tabler/tools-kitchen-2.svg?color=%23e5e5e5" },
                    { name: "Pão de Açúcar", url: "https://play.google.com/store/apps/details?id=br.com.paodeacucar.mobile", image: "https://api.iconify.design/tabler/shopping-cart.svg?color=%23e5e5e5" },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
                    { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
                ]
            },
            {
                name: "Transporte",
                items: [
        { name: "Uber", url: "https://play.google.com/store/apps/details?id=com.ubercab", image: "https://api.iconify.design/tabler/car.svg?color=%23e5e5e5" },
        { name: "99", url: "https://play.google.com/store/apps/details?id=com.taxis99", image: "https://api.iconify.design/tabler/taxi.svg?color=%23e5e5e5" },
        { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
        { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
        { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
        { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true },
        { name: "Reservado", url: "#", image: "https://api.iconify.design/tabler/dots.svg?color=%23666666", disabled: true }
            ]
        },   
    ];
        

        // Nova estrutura para categoria "Participe"

        // Variáveis para controle do modo de edição - MOVIDAS PARA O TOPO
        // let isEditMode = false; // REMOVIDO - já definido no início
        // let isToggleVisible = false; // REMOVIDO - já definido no início  
        // let currentEditingItem = null; // REMOVIDO - já definido no início
        // let customItemData = {}; // REMOVIDO - já definido no início
        
        // Função para ativar/desativar modo de edição
        function toggleEditMode(activate) {
            isEditMode = activate;
            const body = document.body;
            const headerTitle = document.getElementById('headerTitle');
            const editToggle = document.getElementById('editModeToggle');
            
            console.log(`Modo de edição ${activate ? 'ATIVADO' : 'DESATIVADO'}:`, {
                isEditMode: isEditMode,
                bodyHasClass: body.classList.contains('edit-mode')
            });

            if (activate) {
                body.classList.add('edit-mode');
                headerTitle.textContent = 'Edição... [INDIVIDUAL]';
                if (editToggle) editToggle.checked = true;
                
                // Adiciona classes editáveis aos elementos
                addEditableClasses();
                
                // Adiciona indicadores de upgrade
                addUpgradeIndicators();
                
                // Ativa interceptação de edição de categorias
                interceptCategoryEdit();
            } else {
                body.classList.remove('edit-mode');
                headerTitle.textContent = 'Acessos';
                if (editToggle) editToggle.checked = false;
                
                // Remove classes editáveis
                removeEditableClasses();
                
                // Remove indicadores de upgrade
                addUpgradeIndicators();
            }

            // Re-renderiza a sidebar para atualizar contadores
            renderMeusAppsCategoriesSidebar();
            
            // Re-renderiza cards se estiver visualizando qualquer subcategoria com cards
            const currentTitle = document.querySelector('.category-title-header');
            if (currentTitle) {
                const titleText = currentTitle.textContent;
                
                // Extrai o nome da categoria e subcategoria do título (formato: "Categoria - Subcategoria")
                const titleParts = titleText.split(' - ');
                if (titleParts.length === 2) {
                    const categoryName = titleParts[0].trim();
                    const subCategoryName = titleParts[1].trim();
                    
                    // Encontra a categoria nos dados
                    const category = meusAppsCategoriesData.find(cat => cat.name === categoryName);
                    if (category) {
                        // Encontra o item/subcategoria
                        const subCategoryItem = category.items.find(item => item.name === subCategoryName);
                        if (subCategoryItem && subCategoryItem.hasSubItems) {
                            console.log(`Re-renderizando cards para: ${categoryName} - ${subCategoryName}`);
                            displaySubItemsAsCards(subCategoryItem, categoryName);
                        }
                    }
                }
            }
            
            // Salva o estado no localStorage
            localStorage.setItem('editMode', activate.toString());
        }
        
        // Função para re-renderizar os botões de Meus Apps
        function reRenderMeusAppsButtons() {
            console.log('Re-renderizando botões, isEditMode:', isEditMode); // Debug
            renderMeusAppsCategoriesSidebar();
        }
        
        // Função para adicionar classes editáveis
        function addEditableClasses() {
            // Adicionar apenas aos botões de Meus Apps (nos sub-acordeões)
            const meusAppsSubButtons = document.querySelectorAll('#saudeItemsList button:not([disabled]), #comunicacaoItemsList button:not([disabled]), #bancoItemsList button:not([disabled]), #utilidadesItemsList button:not([disabled]), #lazerItemsList button:not([disabled])');
            console.log('addEditableClasses: Encontrados', meusAppsSubButtons.length, 'botões para adicionar classe editable'); // Debug
            meusAppsSubButtons.forEach((btn, index) => {
                btn.classList.add('editable-item');
                console.log(`Classe editable-item adicionada ao botão ${index + 1}:`, btn.textContent); // Debug
                
                // Intercepta cliques em botões "Reservado"
                if (btn.textContent.trim() === 'Reservado') {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        showUpgradeAlert('Adicionar novos aplicativos');
                    });
                    
                    // Adiciona indicador visual
                    if (!btn.querySelector('.PERSONALIZADO-mini-indicator')) {
                        const miniIndicator = document.createElement('span');
                        miniIndicator.className = 'PERSONALIZADO-mini-indicator';
                        miniIndicator.innerHTML = '🚀';
                        miniIndicator.style.cssText = `
                            position: absolute;
                            top: -5px;
                            right: -5px;
                            background: #ff6b35;
                            border-radius: 50%;
                            width: 16px;
                            height: 16px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            z-index: 10;
                        `;
                        btn.style.position = 'relative';
                        btn.appendChild(miniIndicator);
                    }
                }
            });
        }
        
        // Função para remover classes editáveis
        function removeEditableClasses() {
            const editableItems = document.querySelectorAll('.editable-item');
            editableItems.forEach(item => {
                item.classList.remove('editable-item');
                
                // Remove indicadores mini de upgrade
                const miniIndicator = item.querySelector('.PERSONALIZADO-mini-indicator');
                if (miniIndicator) {
                    miniIndicator.remove();
                }
            });
        }
        
        // Função para mostrar modal de confirmação
        function showEditModeConfirmation() {
            document.getElementById('editModeConfirmModal').classList.remove('hidden');
        }
        
        // Função para esconder modal de confirmação
        function hideEditModeConfirmation() {
            document.getElementById('editModeConfirmModal').classList.add('hidden');
        }

        // Função para mostrar/esconder o toggle de edição
        function toggleEditModeVisibility() {
            const toggleContainer = document.getElementById('editModeToggleContainer');
            const supportLogo = document.getElementById('supportLogo');
            
            isToggleVisible = !isToggleVisible;
            
            if (isToggleVisible) {
                toggleContainer.style.display = 'flex';
                supportLogo.classList.add('toggle-visible');
                // NÃO salvar estado no localStorage - sempre força clique manual
                // localStorage.setItem('toggleVisible', 'true'); // REMOVIDO
            } else {
                toggleContainer.style.display = 'none';
                supportLogo.classList.remove('toggle-visible');
                // Sempre desativar o modo de edição ao esconder o toggle
                if (isEditMode) {
                    toggleEditMode(false);
                }
                // Não salvar estado - sempre inicia oculto
                // localStorage.removeItem('editMode'); // Já removido na função toggleEditMode
                // localStorage.setItem('toggleVisible', 'false'); // REMOVIDO
            }
        }

        // Funções para o Modal de Edição Individual
        function openItemEditModal(itemData, buttonElement) {
            currentEditingItem = { data: itemData, element: buttonElement };
            
            // Carrega dados personalizados se existirem
            const itemKey = generateItemKey(itemData);
            const customData = customItemData[itemKey] || {};
            
            // Preenche os campos do modal
            document.getElementById('editItemName').value = customData.name || itemData.name;
            document.getElementById('editItemUrl').value = customData.url || itemData.url;
            
            // Mostra o modal
            document.getElementById('itemEditModal').classList.remove('hidden');
        }

        function closeItemEditModal() {
            document.getElementById('itemEditModal').classList.add('hidden');
            currentEditingItem = null;
        }

        function saveItemEditData() {
            if (!currentEditingItem) return;
            
            const newName = document.getElementById('editItemName').value.trim();
            const newUrl = document.getElementById('editItemUrl').value.trim();
            
            // Validação básica
            if (!newName) {
                alert('Por favor, digite um nome para o aplicativo.');
                return;
            }
            
            if (!newUrl) {
                alert('Por favor, digite uma URL válida.');
                return;
            }
            
            // Adiciona https:// se não tiver protocolo
            let finalUrl = newUrl;
            if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) {
                finalUrl = 'https://' + newUrl;
            }
            
            // Salva os dados personalizados
            const itemKey = generateItemKey(currentEditingItem.data);
            customItemData[itemKey] = {
                name: newName,
                url: finalUrl,
                originalName: currentEditingItem.data.name,
                originalUrl: currentEditingItem.data.url
            };
            
            // Salva no localStorage
            localStorage.setItem('customItemData', JSON.stringify(customItemData));
            
            // Atualiza o botão visualmente
            updateButtonDisplay(currentEditingItem.element, newName);
            
            // Fecha o modal
            closeItemEditModal();
            
            // Feedback visual
            showSaveConfirmation();
        }

        function generateItemKey(itemData) {
            // Gera uma chave única baseada no nome original do item
            return itemData.name.toLowerCase().replace(/\s+/g, '_');
        }

        function updateButtonDisplay(buttonElement, newName) {
            // Atualiza o texto do botão
            buttonElement.textContent = newName;
            
            // Adiciona uma classe para indicar que foi personalizado
            buttonElement.classList.add('customized-item');
        }

        function showSaveConfirmation() {
            // Cria um feedback visual temporário
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 4px;
                z-index: 10000;
                box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            `;
            feedback.textContent = '✅ Alterações salvas com sucesso!';
            document.body.appendChild(feedback);
            
            // Remove após 3 segundos
            setTimeout(() => {
                document.body.removeChild(feedback);
            }, 3000);
        }

        function loadCustomItemData() {
            // Carrega dados personalizados do localStorage
            const saved = localStorage.getItem('customItemData');
            if (saved) {
                try {
                    customItemData = JSON.parse(saved);
                } catch (e) {
                    console.error('Erro ao carregar dados personalizados:', e);
                    customItemData = {};
                }
            }
            
            // Carrega também os dados de cards
            loadCustomCardData();
            
            // Migra dados antigos para novo formato se necessário
            migrateOldDataFormat();
        }

        // Função para migrar dados antigos para novo formato
        function migrateOldDataFormat() {
            let needsSave = false;
            
            // Migra dados de cards
            const oldCardKeys = Object.keys(customCardData).filter(key => !key.startsWith('card_') && !key.startsWith('item_'));
            oldCardKeys.forEach(oldKey => {
                const parts = oldKey.split('_');
                if (parts.length === 3) {
                    const [categoryName, parentItemName, cardIndex] = parts;
                    const newKey = generateCardKey(categoryName, parentItemName, cardIndex);
                    
                    // Move dados para nova chave se não existir
                    if (!customCardData[newKey]) {
                        customCardData[newKey] = customCardData[oldKey];
                        needsSave = true;
                    }
                    
                    // Remove chave antiga
                    delete customCardData[oldKey];
                    needsSave = true;
                }
            });
            
            // Migra dados de itens simples
            const oldItemKeys = Object.keys(customItemData).filter(key => !key.startsWith('item_'));
            oldItemKeys.forEach(oldKey => {
                const parts = oldKey.split('_');
                if (parts.length === 2) {
                    const [categoryName, itemName] = parts;
                    const newKey = generateItemKey(categoryName, itemName);
                    
                    // Move dados para nova chave se não existir
                    if (!customItemData[newKey]) {
                        customItemData[newKey] = customItemData[oldKey];
                        needsSave = true;
                    }
                    
                    // Remove chave antiga
                    delete customItemData[oldKey];
                    needsSave = true;
                }
            });
            
            // Salva se houve mudanças
            if (needsSave) {
                localStorage.setItem('customCardData', JSON.stringify(customCardData));
                localStorage.setItem('customItemData', JSON.stringify(customItemData));
                console.log('Dados migrados para novo formato de chaves');
            }
        }

        // Variáveis para controle da edição de cards
        let currentEditingCard = null;

        // Função para abrir modal de edição de card
        function openCardEditModal(parentItemName, cardIndex) {
            // Encontra o item pai e o card específico
            const category = meusAppsCategoriesData.find(cat => 
                cat.items.some(item => item.name === parentItemName)
            );
            
            if (!category) return;
            
            const parentItem = category.items.find(item => item.name === parentItemName);
            if (!parentItem || !parentItem.subItems || !parentItem.subItems[cardIndex]) return;
            
            const card = parentItem.subItems[cardIndex];
            currentEditingCard = { 
                categoryName: category.name,
                parentItemName: parentItemName, 
                cardIndex: cardIndex,
                originalCard: card 
            };
            
            // Carrega dados personalizados se existirem
            const cardKey = generateCardKey(category.name, parentItemName, cardIndex);
            const customData = customCardData[cardKey] || {};
            
            // Preenche os campos do modal
            document.getElementById('editCardTitle').value = customData.name || card.name;
            document.getElementById('editCardImage').value = customData.cardImage || card.cardImage || card.image;
            document.getElementById('editCardUrl').value = customData.url || card.url;
            document.getElementById('editCardDescription').value = customData.description || card.description || '';
            
            // Mostra o modal
            document.getElementById('cardEditModal').classList.remove('hidden');
        }

        // Função para fechar modal de edição de card
        function closeCardEditModal() {
            document.getElementById('cardEditModal').classList.add('hidden');
            currentEditingCard = null;
        }

        // Função para salvar edição de card
        function saveCardEdit() {
            if (!currentEditingCard) return;
            
            const newTitle = document.getElementById('editCardTitle').value.trim();
            const newImage = document.getElementById('editCardImage').value.trim();
            const newUrl = document.getElementById('editCardUrl').value.trim();
            const newDescription = document.getElementById('editCardDescription').value.trim();
            
            // Validação básica
            if (!newTitle) {
                alert('Por favor, digite um título para o card.');
                return;
            }
            
            if (!newUrl) {
                alert('Por favor, digite uma URL de acesso válida.');
                return;
            }
            
            // Adiciona https:// se não tiver protocolo
            let finalUrl = newUrl;
            if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) {
                finalUrl = 'https://' + newUrl;
            }
            
            // Salva os dados personalizados
            const cardKey = generateCardKey(
                currentEditingCard.categoryName, 
                currentEditingCard.parentItemName, 
                currentEditingCard.cardIndex
            );
            
            customCardData[cardKey] = {
                name: newTitle,
                cardImage: newImage,
                url: finalUrl,
                description: newDescription,
                originalName: currentEditingCard.originalCard.name,
                originalCardImage: currentEditingCard.originalCard.cardImage,
                originalUrl: currentEditingCard.originalCard.url,
                originalDescription: currentEditingCard.originalCard.description
            };
            
            // Salva no localStorage
            localStorage.setItem('customCardData', JSON.stringify(customCardData));
            
            // Re-renderiza os cards para mostrar as mudanças
            const category = meusAppsCategoriesData.find(cat => cat.name === currentEditingCard.categoryName);
            const parentItem = category.items.find(item => item.name === currentEditingCard.parentItemName);
            displaySubItemsAsCards(parentItem, currentEditingCard.categoryName);
            
            // Fecha o modal
            closeCardEditModal();
            
            // Feedback visual
            showSaveConfirmation();
        }

        // Função para gerar chave única do card
        function generateCardKey(categoryName, parentItemName, cardIndex) {
            // Encontra o índice da categoria para garantir unicidade absoluta
            const categoryIndex = meusAppsCategoriesData.findIndex(cat => cat.name === categoryName);
            // Inclui mais informações para garantir unicidade absoluta
            return `card_${categoryIndex}_${categoryName}_${parentItemName}_${cardIndex}`.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
        }

        // Função para carregar dados personalizados de cards
        function loadCustomCardData() {
            const saved = localStorage.getItem('customCardData');
            if (saved) {
                try {
                    customCardData = JSON.parse(saved);
                } catch (e) {
                    console.error('Erro ao carregar dados personalizados de cards:', e);
                    customCardData = {};
                }
            }
        }

        // Função para aplicar dados personalizados aos cards
        function applyCustomCardData() {
            Object.keys(customCardData).forEach(cardKey => {
                const customData = customCardData[cardKey];
                
                // Novo formato: card_index_categoria_subcategoria_cardindex
                if (cardKey.startsWith('card_')) {
                    const parts = cardKey.substring(5).split('_'); // Remove 'card_' e divide
                    if (parts.length >= 4) {
                        const cardIndex = parts.pop(); // Último elemento é o índice do card
                        const parentItemName = parts.pop(); // Penúltimo é o item pai
                        const categoryIndex = parts.shift(); // Primeiro é o índice da categoria
                        const categoryName = parts.join('_'); // Resto é a categoria
                        
                        // Usa o índice da categoria para encontrar a categoria correta
                        const category = meusAppsCategoriesData[parseInt(categoryIndex)];
                        
                        if (category && category.name.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '') === categoryName) {
                            const parentItem = category.items.find(item => 
                                item.name.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '') === parentItemName
                            );
                            
                            if (parentItem && parentItem.subItems && parentItem.subItems[parseInt(cardIndex)]) {
                                const card = parentItem.subItems[parseInt(cardIndex)];
                                // Aplica os dados personalizados temporariamente para renderização
                                card._customName = customData.name;
                                card._customCardImage = customData.cardImage;
                                card._customUrl = customData.url;
                                card._customDescription = customData.description;
                            }
                        }
                    }
                } else {
                    // Formato antigo para compatibilidade (será removido gradualmente)
                    const [categoryName, parentItemName, cardIndex] = cardKey.split('_');
                    
                    const category = meusAppsCategoriesData.find(cat => 
                        cat.name.toLowerCase().replace(/\s+/g, '_') === categoryName
                    );
                    
                    if (category) {
                        const parentItem = category.items.find(item => 
                            item.name.toLowerCase().replace(/\s+/g, '_') === parentItemName
                        );
                        
                        if (parentItem && parentItem.subItems && parentItem.subItems[parseInt(cardIndex)]) {
                            const card = parentItem.subItems[parseInt(cardIndex)];
                            // Aplica os dados personalizados temporariamente para renderização
                            card._customName = customData.name;
                            card._customCardImage = customData.cardImage;
                            card._customUrl = customData.url;
                            card._customDescription = customData.description;
                        }
                    }
                }
            });
        }

        // Variáveis para controle da edição de itens simples
        let currentEditingSimpleItem = null;

        // Função para abrir modal de edição de item simples
        function openSimpleItemEditModal(categoryName, itemName) {
            // Encontra o item específico
            const category = meusAppsCategoriesData.find(cat => cat.name === categoryName);
            if (!category) return;
            
            const item = category.items.find(i => i.name === itemName);
            if (!item || item.hasSubItems) return; // Só para itens simples
            
            currentEditingSimpleItem = { 
                categoryName: categoryName,
                itemName: itemName,
                originalItem: item 
            };
            
            // Carrega dados personalizados se existirem
            const itemKey = generateItemKey(categoryName, itemName);
            const customData = customItemData[itemKey] || {};
            
            // Preenche os campos do modal
            document.getElementById('editSimpleItemName').value = customData.name || item.name;
            document.getElementById('editSimpleItemUrl').value = customData.url || item.url;
            
            // Mostra o modal
            document.getElementById('simpleItemEditModal').classList.remove('hidden');
        }

        // Função para fechar modal de edição de item simples
        function closeSimpleItemEditModal() {
            document.getElementById('simpleItemEditModal').classList.add('hidden');
            currentEditingSimpleItem = null;
        }

        // Função para salvar edição de item simples
        function saveSimpleItemEdit() {
            if (!currentEditingSimpleItem) return;
            
            const newName = document.getElementById('editSimpleItemName').value.trim();
            const newUrl = document.getElementById('editSimpleItemUrl').value.trim();
            
            // Validação básica
            if (!newName) {
                alert('Por favor, digite um nome para o item.');
                return;
            }
            
            if (!newUrl) {
                alert('Por favor, digite uma URL de acesso válida.');
                return;
            }
            
            // Adiciona https:// se não tiver protocolo
            let finalUrl = newUrl;
            if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) {
                finalUrl = 'https://' + newUrl;
            }
            
            // Salva os dados personalizados
            const itemKey = generateItemKey(
                currentEditingSimpleItem.categoryName, 
                currentEditingSimpleItem.itemName
            );
            
            customItemData[itemKey] = {
                name: newName,
                url: finalUrl,
                originalName: currentEditingSimpleItem.originalItem.name,
                originalUrl: currentEditingSimpleItem.originalItem.url
            };
            
            // Salva no localStorage
            localStorage.setItem('customItemData', JSON.stringify(customItemData));
            
            // Re-renderiza a sidebar para mostrar as mudanças
            renderMeusAppsCategoriesSidebar();
            
            // Fecha o modal
            closeSimpleItemEditModal();
            
            // Feedback visual
            showSaveConfirmation();
        }

        // Função para gerar chave única do item simples
        function generateItemKey(categoryName, itemName) {
            // Encontra o índice da categoria para garantir unicidade absoluta
            const categoryIndex = meusAppsCategoriesData.findIndex(cat => cat.name === categoryName);
            // Inclui prefixo, índice da categoria e sanitização para garantir unicidade absoluta
            return `item_${categoryIndex}_${categoryName}_${itemName}`.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
        }

        function loadCustomItemData() {
            // Carrega dados personalizados do localStorage
            const saved = localStorage.getItem('customItemData');
            if (saved) {
                try {
                    customItemData = JSON.parse(saved);
                } catch (e) {
                    console.error('Erro ao carregar dados personalizados:', e);
                    customItemData = {};
                }
            }
            
            // Carrega também os dados de cards
            loadCustomCardData();
        }

        // Função para limpar dados conflitantes (usar apenas em caso de emergência)
        function clearConflictingData() {
            if (confirm('ATENÇÃO: Isso irá limpar TODAS as personalizações. Tem certeza?')) {
                customCardData = {};
                customItemData = {};
                localStorage.removeItem('customCardData');
                localStorage.removeItem('customItemData');
                
                // Re-renderiza tudo
                renderMeusAppsCategoriesSidebar();
                
                alert('Dados limpos com sucesso! Todas as personalizações foram removidas.');
                console.log('Dados conflitantes limpos pelo usuário');
            }
        }

        // Inicialização quando a página carrega
        document.addEventListener('DOMContentLoaded', function() {
            // VERSÃO INDIVIDUAL: SEM limpeza automática - dados são persistidos
            console.log('🔧 Versão INDIVIDUAL inicializada - dados persistidos');
            
            // Carrega dados existentes
            loadCustomItemData();
            renderMeusAppsCategoriesSidebar();
            renderVideosCategoriesSidebar();
            
            // Função global para emergência (acessível via console)
            window.clearAllCustomData = clearConflictingData;
            
            // Funções de Export/Import disponíveis globalmente
            window.exportUserConfig = exportUserConfig;
            window.importUserConfig = importUserConfig;
            
            console.log('🔧 Sistema de edição INDIVIDUAL inicializado');
            console.log('💡 Funções disponíveis:');
            console.log('   - exportUserConfig() - Exporta configurações');
            console.log('   - importUserConfig(jsonData) - Importa configurações');
            console.log('   - clearAllCustomData() - Limpa todas as personalizações');
            
            // Adiciona botões de Export/Import
            setTimeout(addExportImportButtons, 1000);
        });

        // Função para exportar configurações do usuário
        function exportUserConfig() {
            const config = {
                version: "7.1.0",
                timestamp: new Date().toISOString(),
                type: "INDIVIDUAL",
                customizations: customCardData,
                itemCustomizations: customItemData,
                userFavorites: userFavorites,
                metadata: {
                    totalCustomizations: Object.keys(customCardData).length + Object.keys(customItemData).length,
                    totalFavorites: userFavorites.length
                }
            };
            
            const jsonString = JSON.stringify(config, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `geriah_user_config_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('✅ Configurações exportadas com sucesso!');
            alert(`✅ Configurações exportadas!\n\n📊 Incluído:\n• ${Object.keys(customItemData).length} personalizações de itens\n• ${Object.keys(customCardData).length} personalizações de cards\n• ${userFavorites.length} favoritos pessoais`);
        }

        // Função para importar configurações do usuário
        function importUserConfig(jsonData) {
            try {
                let config;
                
                // Se recebeu string, faz parse
                if (typeof jsonData === 'string') {
                    config = JSON.parse(jsonData);
                } else {
                    config = jsonData;
                }
                
                // Validação básica
                if (!config.type || config.type !== 'INDIVIDUAL') {
                    throw new Error('Arquivo não é uma configuração USER válida');
                }
                
                // Confirma importação
                const itemCount = Object.keys(config.itemCustomizations || config.customItemData || {}).length;
                const cardCount = Object.keys(config.customizations || config.customCardData || {}).length;
                const favCount = (config.userFavorites || []).length;
                
                if (!confirm(`Importar configurações de ${config.timestamp}?\n\n📊 Será importado:\n• ${itemCount} personalizações de itens\n• ${cardCount} personalizações de cards\n• ${favCount} favoritos pessoais\n\nIsso substituirá suas configurações atuais.`)) {
                    return;
                }
                
                // Importa dados - suporta tanto formato novo quanto antigo
                if (config.itemCustomizations || config.customItemData) {
                    customItemData = config.itemCustomizations || config.customItemData;
                    localStorage.setItem('customItemData', JSON.stringify(customItemData));
                }
                
                if (config.customizations || config.customCardData) {
                    customCardData = config.customizations || config.customCardData;
                    localStorage.setItem('customCardData', JSON.stringify(customCardData));
                }
                
                if (config.userFavorites) {
                    userFavorites = config.userFavorites;
                    saveUserFavorites();
                    renderUserFavorites();
                }
                
                // Re-renderiza tudo
                renderMeusAppsCategoriesSidebar();
                
                console.log('✅ Configurações importadas com sucesso!');
                alert('✅ Configurações importadas com sucesso!');
                
            } catch (error) {
                console.error('❌ Erro ao importar configurações:', error);
                alert('❌ Erro ao importar configurações: ' + error.message);
            }
        }

        // Função para criar input de arquivo para importação
        function createImportFileInput() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        importUserConfig(e.target.result);
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Adiciona botões de Export/Import ao DOM
        function addExportImportButtons() {
            if (!document.getElementById('exportImportButtons')) {
                const buttonsContainer = document.createElement('div');
                buttonsContainer.id = 'exportImportButtons';
                buttonsContainer.style.cssText = `
                    position: fixed;
                    bottom: 80px;
                    right: 20px;
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                    z-index: 1000;
                `;
                
                const exportBtn = document.createElement('button');
                exportBtn.textContent = '📤 Exportar';
                exportBtn.style.cssText = `
                    border: none;
                    padding: 8px 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 12px;
                    transition: all 0.3s ease;
                `;
                exportBtn.onclick = exportUserConfig;
                
                const importBtn = document.createElement('button');
                importBtn.textContent = '📥 Importar';
                importBtn.style.cssText = `
                    background: #2196F3;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 12px;
                    transition: all 0.3s ease;
                `;
                importBtn.onclick = createImportFileInput;
                
                buttonsContainer.appendChild(exportBtn);
                buttonsContainer.appendChild(importBtn);
                document.body.appendChild(buttonsContainer);
                
                console.log('✅ Botões Export/Import adicionados');
            }
        }

        // Função para mostrar aviso de upgrade
        function showUpgradeAlert(feature) {
            const upgradeModal = document.createElement('div');
            upgradeModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #2d1810, #4a2f16);
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                max-width: 400px;
                border: 2px solid #ff6b35;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            `;
            
            modalContent.innerHTML = `
                <div style="color: #ff6b35; font-size: 3rem; margin-bottom: 15px;">🚀</div>
                <h2 style="color: #ffcc80; margin-bottom: 15px; font-size: 1.5rem;">Recurso PERSONALIZADO</h2>
                <p style="color: #e5e5e5; margin-bottom: 20px; line-height: 1.5;">
                    <strong>${feature}</strong> está disponível apenas na versão <strong>PERSONALIZADO</strong>.
                </p>
                <div style="background: rgba(255, 107, 53, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="color: #ffcc80; margin: 0; font-size: 0.9rem;">
                        ✨ <strong>PERSONALIZADO inclui:</strong><br>
                        • Criar/editar categorias<br>
                        • Personalizar cores e logo<br>
                        • Configurações avançadas<br>
                        • Suporte prioritário
                    </p>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button id="upgradeBtn" style="
                        background: linear-gradient(135deg, #ff6b35, #e55a2b);
                        border: none;
                        padding: 12px 20px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">🚀 FAZER UPGRADE</button>
                    <button id="closeUpgradeModal" style="
                        background: transparent;
                        color: #e5e5e5;
                        border: 1px solid #666;
                        padding: 12px 20px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">Fechar</button>
                </div>
            `;
            
            upgradeModal.appendChild(modalContent);
            document.body.appendChild(upgradeModal);
            
            // Event listeners
            document.getElementById('upgradeBtn').onclick = function() {
                alert('🚀 Entre em contato para upgrade PERSONALIZADO!\n\n📧 Email: novosnegocios@geriah.com\n📱 WhatsApp: +55 11 91159-5028');
                document.body.removeChild(upgradeModal);
            };
            
            document.getElementById('closeUpgradeModal').onclick = function() {
                document.body.removeChild(upgradeModal);
            };
            
            upgradeModal.onclick = function(e) {
                if (e.target === upgradeModal) {
                    document.body.removeChild(upgradeModal);
                }
            };
        }

        // Função para interceptar tentativas de edição de categoria
        function interceptCategoryEdit() {
            // Intercepta cliques nos headers das categorias principais
            document.addEventListener('click', function(e) {
                // Se estiver em modo de edição e clicar em header de categoria
                if (isEditMode && e.target.closest('.accordion-header')) {
                    const header = e.target.closest('.accordion-header');
                    const categoryName = header.textContent.trim().split('\n')[0].trim();
                    
                    // Verifica se é uma categoria principal (não subcategoria)
                    if (header.parentElement.classList.contains('accordion-item')) {
                        e.preventDefault();
                        e.stopPropagation();
                        showUpgradeAlert(`Editar categoria "${categoryName}"`);
                        return false;
                    }
                }
                
                // Intercepta tentativas de adicionar nova categoria/subcategoria
                if (isEditMode && e.target.closest('.sub-accordion-header')) {
                    const subHeader = e.target.closest('.sub-accordion-header');
                    const subCategoryName = subHeader.textContent.trim().split('\n')[0].trim();
                    
                    // Se clicar com Ctrl ou Alt (indicando intenção de adicionar)
                    if (e.ctrlKey || e.altKey) {
                        e.preventDefault();
                        e.stopPropagation();
                        showUpgradeAlert(`Adicionar nova subcategoria em "${subCategoryName}"`);
                        return false;
                    }
                }
            });
        }

        // Função para adicionar indicadores visuais de upgrade
        function addUpgradeIndicators() {
            if (isEditMode) {
                // Adiciona indicadores nas categorias principais
                const categoryHeaders = document.querySelectorAll('.accordion-header');
                categoryHeaders.forEach(header => {
                    if (!header.querySelector('.PERSONALIZADO-indicator')) {
                        const indicator = document.createElement('span');
                        indicator.className = 'PERSONALIZADO-indicator';
                        indicator.innerHTML = '🚀';
                        indicator.style.cssText = `
                            position: absolute;
                            right: 30px;
                            top: 50%;
                            transform: translateY(-50%);
                            background: linear-gradient(135deg, #ff6b35, #e55a2b);
                            border-radius: 10px;
                            font-size: 0.7rem;
                            cursor: pointer;
                            z-index: 100;
                        `;
                        indicator.title = 'Clique para upgrade PERSONALIZADO';
                        indicator.onclick = function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            showUpgradeAlert('Editar estrutura de categorias');
                        };
                        header.style.position = 'relative';
                        header.appendChild(indicator);
                    }
                });
            } else {
                // Remove indicadores quando sair do modo de edição
                document.querySelectorAll('.PERSONALIZADO-indicator').forEach(indicator => {
                    indicator.remove();
                });
            }
        }

        // ========== FUNÇÕES PARA MEUS FAVORITOS (USER) ==========

        // Função para carregar favoritos do localStorage
        function loadUserFavorites() {
            const saved = localStorage.getItem('userFavorites');
            if (saved) {
                try {
                    userFavorites = JSON.parse(saved);
                } catch (e) {
                    console.error('Erro ao carregar favoritos:', e);
                    userFavorites = [];
                }
            }
            renderUserFavorites();
        }

        // Função para salvar favoritos no localStorage
        function saveUserFavorites() {
            localStorage.setItem('userFavorites', JSON.stringify(userFavorites));
        }

        // Função para renderizar a lista de favoritos
        function renderUserFavorites() {
            const list = document.getElementById('favoritosItemsList');
            const counter = document.getElementById('favoritosCounter');
            
            if (!list || !counter) return;
            
            // Atualiza contador
            counter.textContent = `${userFavorites.length}/${MAX_USER_FAVORITES}`;
            
            // Limpa lista
            list.innerHTML = '';
            
            // Adiciona favoritos existentes
            userFavorites.forEach((favorite, index) => {
                const li = document.createElement('li');
                li.className = 'favorite-item';
                li.innerHTML = `
                    <a href="${favorite.url}" target="_blank" class="favorite-link" title="${favorite.description || favorite.name}">
                        ${favorite.name}
                    </a>
                    <button class="favorite-delete-btn" onclick="deleteFavorite(${index})" title="Remover favorito">×</button>
                `;
                list.appendChild(li);
            });
            
            // Adiciona botão "Adicionar" se não atingiu o limite
            if (userFavorites.length < MAX_USER_FAVORITES) {
                const li = document.createElement('li');
                li.className = 'add-favorite-placeholder';
                li.innerHTML = `
                    <button class="add-favorite-btn" onclick="openAddFavoriteModal()">
                        <span style="font-size: 1.2em;">➕</span>
                        Adicionar Favorito (${userFavorites.length}/${MAX_USER_FAVORITES})
                    </button>
                `;
                list.appendChild(li);
            } else {
                // Mostra botão desabilitado quando atingir limite
                const li = document.createElement('li');
                li.className = 'add-favorite-placeholder';
                li.innerHTML = `
                    <button class="add-favorite-btn" disabled onclick="showUpgradeAlert('Adicionar mais de ${MAX_USER_FAVORITES} favoritos')">
                        🚀 Limite atingido - PERSONALIZADO para mais
                    </button>
                `;
                list.appendChild(li);
            }
        }

        // Função para abrir modal de adicionar favorito
        function openAddFavoriteModal() {
            if (userFavorites.length >= MAX_USER_FAVORITES) {
                showUpgradeAlert(`Adicionar mais de ${MAX_USER_FAVORITES} favoritos`);
                return;
            }
            
            // Limpa campos
            document.getElementById('addFavoriteName').value = '';
            document.getElementById('addFavoriteUrl').value = '';
            document.getElementById('addFavoriteDescription').value = '';
            
            // Mostra modal
            document.getElementById('addFavoriteModal').classList.remove('hidden');
        }

        // Função para fechar modal de adicionar favorito
        function closeAddFavoriteModal() {
            document.getElementById('addFavoriteModal').classList.add('hidden');
        }

        // Função para salvar novo favorito
        function saveNewFavorite() {
            const name = document.getElementById('addFavoriteName').value.trim();
            const url = document.getElementById('addFavoriteUrl').value.trim();
            const description = document.getElementById('addFavoriteDescription').value.trim();
            
            // Validação
            if (!name) {
                alert('Por favor, digite um nome para o favorito.');
                return;
            }
            
            if (!url) {
                alert('Por favor, digite uma URL válida.');
                return;
            }
            
            // Adiciona https:// se necessário
            let finalUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                finalUrl = 'https://' + url;
            }
            
            // Verifica limite
            if (userFavorites.length >= MAX_USER_FAVORITES) {
                showUpgradeAlert(`Adicionar mais de ${MAX_USER_FAVORITES} favoritos`);
                return;
            }
            
            // Adiciona favorito
            const newFavorite = {
                id: Date.now(), // ID único
                name: name,
                url: finalUrl,
                description: description,
                createdAt: new Date().toISOString()
            };
            
            userFavorites.push(newFavorite);
            saveUserFavorites();
            renderUserFavorites();
            closeAddFavoriteModal();
            
            // Feedback
            console.log('✅ Favorito adicionado:', newFavorite);
            alert(`⭐ "${name}" foi adicionado aos seus favoritos!`);
        }

        // Função para deletar favorito
        function deleteFavorite(index) {
            if (index >= 0 && index < userFavorites.length) {
                const favorite = userFavorites[index];
                if (confirm(`Remover "${favorite.name}" dos favoritos?`)) {
                    userFavorites.splice(index, 1);
                    saveUserFavorites();
                    renderUserFavorites();
                    console.log('🗑️ Favorito removido:', favorite);
                }
            }
        }

        // Event listeners para modal de favoritos
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar favoritos na inicializa��o
            loadUserFavorites();
        });

        // ========== FIM DAS FUN��ES DE FAVORITOS ==========

        // Função para mostrar aviso de contato para upgrade
        function showContactAlert() {
            const contactModal = document.createElement('div');
            contactModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #2d1810, #4a2f16);
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                max-width: 450px;
                border: 2px solid #ff6b35;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            `;
            
            modalContent.innerHTML = `
                <div style="color: #ff6b35; font-size: 3rem; margin-bottom: 15px;">🚀</div>
                <h2 style="color: #ffcc80; margin-bottom: 15px; font-size: 1.5rem;">Upgrade para PERSONALIZADO</h2>
                <p style="color: #e5e5e5; margin-bottom: 20px; line-height: 1.5;">
                    Entre em contato conosco para fazer o upgrade e desbloquear todos os recursos!
                </p>
                <div style="background: rgba(255, 107, 53, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="color: #ffcc80; margin: 0; font-size: 0.9rem; text-align: left;">
                        ✨ <strong>PERSONALIZADO inclui:</strong><br>
                        • Favoritos ilimitados<br>
                        • Criar/editar categorias personalizadas<br>
                        • Personalizar cores e logo<br>
                        • Configurações avançadas<br>
                        • Suporte prioritário
                    </p>
                </div>
                <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="color: #81C784; margin: 0; font-size: 0.9rem;">
                        📧 <strong>Email:</strong> novosnegocios@geriah.com<br>
                        📱 <strong>WhatsApp:</strong> +55 11 91159-5028
                    </p>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button id="closeContactModal" style="
                        background: linear-gradient(135deg, #ff6b35, #e55a2b);
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: bold;
                        transition: all 0.3s ease;
                    ">Entendi</button>
                </div>
            `;
            
            contactModal.appendChild(modalContent);
            document.body.appendChild(contactModal);
            
            // Event listeners
            document.getElementById('closeContactModal').onclick = function() {
                document.body.removeChild(contactModal);
            };
            
            contactModal.onclick = function(e) {
                if (e.target === contactModal) {
                    document.body.removeChild(contactModal);
                }
            };
        }
    </script>
</body>
</html>
